<h1><a name="_Toc171523764"></a>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Elementary procedures for Mobility Management</h1>
<h2><a name="_Toc171523765"></a>4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; General</h2>
<p>This clause describes the procedures used for mobility management for non-GPRS services and for GPRS-services at the radio interface (Reference Point Um and Uu).</p>
<p>The main function of the Mobility Management sublayer is to support the mobility of user terminals, such as informing the network of its present location and providing user identity confidentiality.</p>
<p>A further function of the MM sublayer is to provide connection management services to the different entities of the upper Connection Management (CM) sublayer (see 3GPP&nbsp;TS&nbsp;24.007&nbsp;[20]).</p>
<p>There are two sets of procedures defined in this chapter:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; MM procedures for non-GPRS services (performed by the MM entity of the MM sublayer); and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM procedures for GPRS services (performed by the GMM entity of the MM sublayer), see 3GPP&nbsp;TS&nbsp;24.007&nbsp;[20].</p>
<p>All the MM procedures described in this clause can only be performed if a RR connection has been established between the MS and the network. Else, the MM sublayer has to initiate the establishment of a RR connection (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;3.3 and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<p>In A/Gb mode, the GMM procedures described in this clause, use services provided by the RR sublayer without prior RR connection establishment.</p>
<p>In Iu mode: all the GMM procedures described in this clause can only be performed if a PS signalling connection has been established between the MS and the network. Else, the GMM sublayer has to initiate the establishment of a PS signalling connection (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<p>GMM procedures are mandatory and applicable only for GPRS MSs and networks supporting those MSs. For GPRS MSs which are IMSI attached for both GPRS and non-GPRS services, some MM procedures are replaced by GMM combined procedures provided that the network operates in network operation mode I, i.e. is supporting combined GMM procedures. GMM combined procedures are not applicable for the GPRS MS operation mode C but are mandatory for the GPRS MS operation modes A and B and networks supporting network operation mode I, see 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74].</p>
<h3><a name="_Toc171523766"></a>4.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM and GMM procedures</h3>
<h4><a name="_Toc171523767"></a>4.1.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Types of MM and GMM procedures</h4>
<p>Depending on how they can be initiated, three types of MM procedures can be distinguished:</p>
<p>1)&nbsp;&nbsp; MM common procedures:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A MM common procedure can always be initiated whilst a RR connection exists. The procedures belonging to this type are:</p>
<p>Initiated by the network:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; TMSI reallocation procedure;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; authentication procedure;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; identification procedure;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; MM information procedure;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; abort procedure.</p>
<p>However, abort procedure is used only if an MM connection is being established or has already been established i.e. not during MM specific procedures or during IMSI detach procedure, see subclause&nbsp;4.3.5.</p>
<p>Initiated by the mobile station:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; IMSI detach procedure (with the exceptions specified in subclause&nbsp;4.3.4).</p>
<p>2)&nbsp;&nbsp; MM specific procedures:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A MM specific procedure can only be initiated if no other MM specific procedure is running or no MM connection exists. The procedures belonging to this type are:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; normal location updating procedure;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; periodic updating procedure;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; IMSI attach procedure; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; eCall inactivity procedure.</p>
<p>3)&nbsp;&nbsp; MM connection management procedures:</p>
<p>These procedures are used to establish, maintain and release a MM connection between the mobile station and the network, over which an entity of the upper CM layer can exchange information with its peer. A MM connection establishment can only be performed if no MM specific procedure is running. More than one MM connection may be active at the same time.</p>
<p>Depending on how they can be initiated, three types of GMM procedures can be distinguished:</p>
<p>1)&nbsp;&nbsp; GMM common procedures:</p>
<p>In Iu mode, a GMM common procedure can always be initiated whilst a PS signalling connection exists.</p>
<p>The procedures belonging to this type are:</p>
<p>Initiated by the network when a GMM context has been established:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; P-TMSI (re-) allocation;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GPRS authentication and ciphering;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GPRS identification;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GPRS information.</p>
<p>2)&nbsp;&nbsp; GMM specific procedures:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Initiated by the network and used to detach the IMSI in the network for GPRS services and/or non-GPRS services and to release a GMM context:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Initiated by the MS and used to attach or detach the IMSI in the network for GPRS services and/or non-GPRS services and to establish or release a GMM context:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GPRS attach and combined GPRS attach;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach and combined GPRS detach;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; eCall inactivity procedure.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Initiated by the MS when a GMM context has been established:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; normal routing area updating and combined routing area updating;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; periodic routing area updating.</p>
<p>3)&nbsp;&nbsp; GMM connection management procedures (Iu mode only):</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Initiated by the MS and used to establish a secure connection to the network and/or to request the resource reservation for sending data:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service Request.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The Service Request procedure can only be initiated if no MS initiated GMM specific procedure is ongoing.</p>
<p>&nbsp;</p>
<h5><a name="_Toc171523768"></a>4.1.1.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Integrity Checking of Signalling Messages in the Mobile Station (Iu mode only)</h5>
<p>In Iu mode only, integrity protected signalling is mandatory with one exception regarding emergency calls (see subclause&nbsp;4.1.1.1.1a). In Iu mode only, all layer 3 protocols shall use integrity protected signalling once the security mode procedure has been successfully activated in the network and the MS. Integrity protection of all layer 3 signalling messages is the responsibility of lower layers. It is the network which activates integrity protection. This is done using the security mode control procedure (3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]).</p>
<p>The supervision that integrity protection is activated shall be the responsibility of the MM and GMM layer in the MS (see 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]). In order to do this, the lower layers shall provide the MM and GMM layer with an indication on when the integrity protection is activated in the MS (i.e. one indication to the MM layer when a security mode control procedure for the CS domain is processed successfully and one indication to the GMM layer when a security mode control procedure for the PS domain is processed successfully).</p>
<p>The CS and PS domains in the network and the MM and GMM layers in the MS, are not aware of whether integrity protection has been started in the lower layers by the other domain. It is mandatory for the network to initiate one security mode control procedure for the CS domain and one for the PS domain.</p>
<p>Except the messages listed below, no layer 3 signalling messages shall be processed by the receiving MM and GMM entities or forwarded to the CM entities, unless the network has activated the integrity protection for that domain.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; MM messages:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; AUTHENTICATION REQUEST</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; AUTHENTICATION REJECT</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; IDENTITY REQUEST</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; LOCATION UPDATING ACCEPT (at periodic location update with no change of location area or temporary identity, and, any Per MS T3212 value is not changed)</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; LOCATION UPDATING REJECT (if the cause is not #25)</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; CM SERVICE ACCEPT, if the following two conditions apply:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no other MM connection is established; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the CM SERVICE ACCEPT is the response to a CM SERVICE REQUEST with CM SERVICE TYPE IE set to 'emergency call establishment'</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; CM SERVICE REJECT (if the cause is not #25)</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ABORT</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM messages:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; AUTHENTICATION &amp; CIPHERING REQUEST</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; AUTHENTICATION &amp; CIPHERING REJECT</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; IDENTITY REQUEST</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ATTACH REJECT (if the cause is not #25)</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ROUTING AREA UPDATE ACCEPT, if any of the following conditions applies:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS performs periodic routing area updating with:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no change in routing area or temporary identities;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no change in T3312 extended value;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no change in Network feature support value; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; extended DRX parameters IE not included.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the GMM entity in the MS has received an ATTACH ACCEPT message with neither ciphering nor integrity protection applied in response to an ATTACH REQUEST message with attach type set to "emergency attach"; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS has performed intersystem change from S1 mode to Iu mode with a PDN connection for emergency bearer services for which the "null integrity protection algorithm" EIA0 has been used while in S1&nbsp;mode.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ROUTING AREA UPDATE REJECT (if the cause is not #25)</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; SERVICE REJECT (if the cause is not #25)</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; DETACH ACCEPT (for non power-off)</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ATTACH ACCEPT, if the ATTACH ACCEPT is the response to an ATTACH REQUEST with attach type set to "emergency attach".</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; SERVICE ACCEPT, if any of the following conditions applies:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the GMM entity in the MS has received an ATTACH ACCEPT message with neither ciphering nor integrity protection applied in response to an ATTACH REQUEST message, with attach type set to "emergency attach"; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS has performed intersystem change from S1 mode to Iu mode with a PDN connection for emergency bearer services for which the "null integrity protection algorithm" EIA0 has been used while in S1 mode.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; CC messages:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; all CC messages, if the following two conditions apply:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no other MM connection is established; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MM entity in the MS has received a CM SERVICE ACCEPT message with no ciphering or integrity protection applied as response to a CM SERVICE REQUEST message, with CM SERVICE TYPE set to 'Emergency call establishment&rsquo; sent to the network;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MM connection was established locally due to the SRVCC handover of a PDN connection for emergency bearer services for which the "null integrity protection algorithm" EIA0 has been used while in S1 mode or for which integrity protection has not been activated while in Iu mode; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MM connection was established locally due to the 5G-SRVCC handover from NG-RAN to UTRAN of an emergency PDU session for which the "null integrity protection algorithm" 5G-IA0 has been used while in N1 mode.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; SM messages:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; all SM messages, if any of the following conditions applies:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the GMM entity in the MS has received an ATTACH ACCEPT message with neither ciphering nor integrity protection applied in response to an ATTACH REQUEST message, with attach type set to "emergency attach"; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS has performed intersystem change from S1 mode to Iu mode with a PDN connection for emergency bearer services for which the "null integrity protection algorithm" EIA0 has been used while in S1 mode.</p>
<p>Once integrity protection is activated, the receiving layer 3 entity in the MS shall not process any layer 3 signalling messages unless they have been successfully integrity checked by the lower layers. If any signalling messages, having not successfully passed the integrity check, are received, then the lower layers in the MS shall discard that message (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]). If any layer 3 signalling message is received, in either PS or CS domains, as not integrity protected even though the integrity protection has been activated in the MS by that domain in the network, then the lower layers shall discard this message (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]).</p>
<p>Integrity checking on the network side is performed by the RNC and is described in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111].</p>
<h5><a name="_Toc171523769"></a>4.1.1.1.1a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Integrity protection for emergency call (Iu mode only)</h5>
<p>The network should initiate the security mode procedure for an emergency call, in the same way as it would for any other call except in the cases defined in sub-clause "Security Procedures Not Applied" in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a].</p>
<p>For the establishment of a MM connection for an emergency call when no other MM connection is established (e.g. for an emergency call initiated without a SIM/USIM no other MM connections can exist) the decision on whether or not to apply the security procedures shall be made by the network as defined in the subclause "Emergency Call Handling" in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. If the MM connection was established locally due to the SRVCC handover of a PDN connection for emergency bearer services for which the "null integrity protection algorithm" EIA0 has been used while in S1 mode or for which integrity protection has not been activated while in Iu mode, the network need not apply the security procedures for this call. If the MM connection was established locally due to the 5G-SRVCC handover from NG-RAN to UTRAN of an emergency PDU session for which the "null integrity protection algorithm" 5G-IA0 has been used while in N1 mode, the network need not apply the security procedures for this call.</p>
<p>For an attach for emergency bearer services, (e.g. initiated without a SIM/USIM) the decision on whether or not to apply the security procedures shall be made by the network as defined in the subclause "Emergency Call Handling" in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. After intersystem change from S1 mode to Iu mode with a PDN connection for emergency bearer services for which the "null integrity protection algorithm" EIA0 has been used while in S1 mode, the network need not apply the security procedures for this connection.</p>
<p>For an initial registration for emergency services, (e.g. initiated without a SIM/USIM) the decision on whether or not to apply the security procedures shall be made by the network as defined in the clause&nbsp;J.2 of 3GPP&nbsp;TS&nbsp;33.501&nbsp;[170]. After 5G-SRVCC handover from NG-RAN to UTRAN with an emergency PDU session for which the "null integrity protection algorithm" 5G-IA0 has been used while in N1 mode, the network need not apply the security procedures for this connection.</p>
<h4><a name="_Toc171523770"></a>4.1.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM-GMM co-ordination for GPRS MS's</h4>
<h5><a name="_Toc171523771"></a>4.1.1.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS MS operating in mode A or B in a network that operates in mode I</h5>
<p>If the network operates in mode I, GPRS MSes that operate in mode A or B and wish to be or are simultaneously IMSI attached for GPRS and non-GPRS services, shall use the combined GPRS attach and the combined and periodic routing area updating procedures instead of the corresponding MM specific procedures IMSI attach and normal and periodic location area updating.</p>
<p>A GPRS MS operating in mode A or B in a network that operates in mode I, shall perform the combined GPRS attach or routing area update procedure regardless the value of the ATT flag.</p>
<p>If a GPRS MS is operating in mode A or B in a network that operates in mode I the IMSI detach shall be performed by the GMM using the combined GPRS detach procedure.</p>
<p>A GPRS MS operating in mode A or B in a network that operates in mode I, shall perform the combined GPRS detach procedure regardless the value of the ATT flag.</p>
<p>A GPRS MS operating in mode A or B in network that operates in mode I, shall use the combined GMM specific procedures in place of the MM specific procedures unless the re-activation of the MM specific procedures is explicitly described, so all conditions describing when to trigger an MM specific procedure listed in subclauses&nbsp;4.3&nbsp;and&nbsp;4.4 shall not apply.</p>
<p>A GPRS MS operating in mode A or B in a network that operates in mode I should not use any MM timers relating to MM specific procedures, (e.g. T3210, T3211, T3212, T3213) unless the re-activation of the MM specific procedures is explicitly described. If the MM timers are already running, the MS should not react on the expiration of the timers.</p>
<p>NOTE&nbsp;1:&nbsp; Whenever GMM performs a combined GMM procedure, a GPRS MS enters the MM state MM LOCATION UPDATING PENDING in order to prevent the MM from performing a location area updating procedure.</p>
<p>If the authentication procedure is performed by MM and the authentication is rejected by the network (i.e. upon receive of AUTHENTICATION REJECT), the MS shall in addition set the GPRS update status to GU3 ROAMING NOT ALLOWED and shall, if available, delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number stored. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed. The MS shall abort any GMM procedure and shall enter state GMM-DEREGISTERED. If S1 mode is supported in the MS, the MS shall handle the EMM parameters EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the EPS authentication is not accepted by the network.</p>
<p>If the PS or CS domain is barred because of domain specific access control, a GPRS MS operating in mode A or B in a network that operates in mode I shall act as if in network operation mode II and access to the barred domain shall be stopped entirely. If the MS detects that a domain is barred, this shall not trigger any MM or GMM specific procedure.</p>
<p>A GPRS MS operating in mode A or B in a network that operates in mode I shall perform a normal location updating procedure (in order to remove the Gs association in the MSC/VLR) when the following conditions are fulfilled:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the GPRS MS has camped on a cell where the PS domain is barred and the CS domain is unbarred; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; T3312, T3311, T3302, or T3330 expires; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for the last attempt to update the registration of the location area a combined GMM procedure was performed.</p>
<p>Additionally the MS shall treat the expiry of T3312 when the PS domain changes from barred to unbarred, analogous to the descriptions for the cases when the timer expires out of coverage or in a cell that does not support GPRS (see subclause&nbsp;4.7.2.2).</p>
<p>If timer T3312 expires and both the PS and CS domain are barred, then a GPRS MS operating in mode A or B in a network that operates in mode I shall treat the expiry of T3312 when the GPRS MS detects that the PS or CS domain becomes unbarred, analogous to the descriptions for the cases when the timer expires out of coverage (see subclause&nbsp;4.7.2.2).</p>
<p>If the PS domain is barred and timer T3312 expires during an ongoing CS connection, then a GPRS MS operating in mode A or B in a network that operates in mode I shall treat the expiry of T3312 when the MM state MM-IDLE is entered, analogous to the descriptions for the cases when the timer expires out of coverage or in a cell that does not support GPRS (see subclause&nbsp;4.7.2.2), or in a cell where the PS domain is barred.</p>
<p>A GPRS MS operating in mode A or B in a network that operates in mode I shall perform a combined routing area update procedure indicating "combined RA/LA updating with IMSI attach" (in order to establish the Gs association in the MSC/VLR) when the following conditions are fulfilled:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the GPRS MS detects that CS or PS domain or both change from barred to unbarred;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; as a result of the change of the domain specific barring status, both domains are unbarred; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for the last attempt to update the registration of the location area an MM specific procedure was performed (see subclause&nbsp;4.7.5.2.1) or for the last attempt to update the registration of the routing area a normal routing area update was performed.</p>
<p>A GPRS MS operating in mode A or B on a PLMN which is part of "forbidden PLMNs for GPRS service" list in a network that is operating in mode I shall act as if in network operation mode II and proceed with appropriate MM procedures.</p>
<h5><a name="_Toc171523772"></a>4.1.1.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS MS operating in mode A or B in a network that operates in mode II</h5>
<p>If the network operates in mode II, a GPRS MS that operates in mode A or B and wishes to be or is simultaneously IMSI attached for GPRS and non-GPRS services, shall use the MM specific procedures listed in subclauses&nbsp;4.3&nbsp;and&nbsp;4.4 and the GMM specific procedures listed in subclauses&nbsp;4.7.3, 4.7.4 and 4.7.5. The applicability of periodic location updating is further specified in subclause&nbsp;4.4.2 and the periodic routing area updating is specified in subclause&nbsp;4.7.2.2. If the GPRS MS, which operates in mode A or B, wishes to be IMSI attached for GPRS and "SMS-only service"or is simultaneously IMSI attached for GPRS and non-GPRS services in order to obtain GPRS services and "SMS-only service", then the GPRS MS shall first complete the GMM specific procedure before performing the MM specific procedures. If this GPRS MS receives in the ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT message the Additional network feature support IE indicating "SMS via GPRS supported", then the GPRS MS shall not perform the MM specific procedure until a new ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT message indicating "SMS via GPRS not supported" or the GPRS MS does not wish to be IMSI attached only for GPRS and "SMS-only service".</p>
<p>If the authentication procedure is performed by MM and the authentication is rejected by the network (i.e upon receive of AUTHENTICATION REJECT), the MS shall in addition set the GPRS update status to GU3 ROAMING NOT ALLOWED and shall, if available, delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number stored. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed. The MS shall abort any GMM procedure and shall enter state GMM-DEREGISTERED. If S1 mode is supported in the MS, the MS shall handle the EMM parameters EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the EPS authentication is not accepted by the network.</p>
<p>If the PS or CS domain is barred because of domain specific access control, a GPRS MS operating in mode A or B in a network that operates in mode II shall use the MM specific procedures or GMM specific procedures, respectively, in the domain which is unbarred. If the MS detects that a domain changes from barred to unbarred, it shall behave as specified in subclauses&nbsp;4.3.4.4, 4.4.4.9, 4.5.1.2, 4.7.3.1.5, 4.7.4.1.4, 4.7.5.1.5, and 4.7.13.5.</p>
<h4><a name="_Toc171523773"></a>4.1.1.2A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Coordination between GMM and EMM</h4>
<p>See subclause&nbsp;5.1.4 in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120].</p>
<h4><a name="_Toc171523774"></a>4.1.1.2B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Coordination between GMM and 5GMM</h4>
<p>See subclause&nbsp;5.1.5 in 3GPP&nbsp;TS&nbsp;24.501&nbsp;[167].</p>
<h4><a name="_Toc171523775"></a>4.1.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Core Network System Information for MM (Iu mode only)</h4>
<p>In the network broadcast system information some of the system information is used by MM.</p>
<p>At reception of new system information, the RRC layer in the MS delivers the contents of the CN common system information and the CS domain specific system information to the MM layer in the MS.</p>
<p>The Core Network system information is included in specific information elements within some RRC messages sent to MS (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]). In the Core Network system information the Common system information part and the CS domain specific system information part contains settings of parameters controlling MM functionality. No MM messages contain the Core Network System Information.</p>
<h4><a name="_Toc171523776"></a>4.1.1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Core Network System Information for GMM (Iu mode only)</h4>
<h5><a name="_Toc171523777"></a>4.1.1.4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; General</h5>
<p>In the network broadcast system information some of the system information is used by GMM.</p>
<p>At reception of new system information, the RRC layer in the MS delivers the contents of the CN common system information and the PS domain specific system information to the GMM layer in the MS.</p>
<p>The Core Network system information is included in specific information elements within some RRC messages sent to MS (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]). In the Core Network system information the Common system information part and the PS domain specific system information part contains settings of parameters controlling GMM functionality. No GMM messages contain the Core Network System Information.</p>
<h5><a name="_Toc171523778"></a>4.1.1.4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Control of Network Mode of Operation I</h5>
<p>The behaviour of the MS with respect to NMO I is determined by the combination of PS domain specific system information IE as defined in subclause&nbsp;10.5.1.12.3 and the setting of the parameter "NMO_I_Behaviour" in the NAS configuration Management Object as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or in USIM file NAS<sub>CONFIG</sub> as specified in 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the parameter "NMO_I_Behaviour" in the NAS configuration Management Object is set to the value of "1", the bit 2 "NMO I" of system information as described in figure&nbsp;10.5.1.12.3/table&nbsp;10.5.1.12.3 is applied; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the parameter "NMO_I_Behaviour" in the NAS configuration Management Object is set to the value of zero or is not provisioned, the bit 1 "NMO" of system information as described in figure&nbsp;10.5.1.12.3/table&nbsp;10.5.1.12.3 is applied.</p>
<h4><a name="_Toc171523779"></a>4.1.1.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Access class control</h4>
<p>The network can restrict the access for certain groups of mobile stations. These groups are also known as access classes.</p>
<p>The restriction can apply for access to both domains (common access class control or EAB, depending on EAB configuration) or to one domain only (domain specific access control) (see 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14]).</p>
<p>Additionally, the network can alleviate the access restriction in both domains or domain specifically, and allow restricted mobile stations to respond to paging messages or to perform generic location updating, or GPRS attach or routing area updating procedure.</p>
<p>A network operator can also restrict some MSs to access the network for location registration, although via common access class control or domain specific access class control the MSs are permitted to access the network for other purposes. Therefore, for each access to the network the mobile station shall determine from the information received via the system information broadcast whether access is allowed or not:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; For paging response the mobile station shall evaluate the control information for common access control (as specified in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84], 3GPP&nbsp;TS&nbsp;44.060 [76], and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]), the control information for EAB (as specified in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84], and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]), domain specific access control (as specified in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]), and the specific control information for paging response (as specified in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]; see "Paging Permission with Access Control").</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; For generic location updating, GPRS attach and routing area updating procedures the mobile station shall evaluate the control information for:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; common access control (as specified in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84], 3GPP&nbsp;TS&nbsp;44.060&nbsp;[76], and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; domain specific access control (as specified in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; specific control information for location registration (as specified in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]; see "Paging Permission with Access Control"); and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; EAB as specified for A/Gb mode in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84], and for Iu mode in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The same control information shall also be taken into account, when the present document requires the mobile station to initiate a generic location updating, or GPRS attach or routing area updating procedure when it detects that a domain changes from barred to unbarred (see e.g. subclauses&nbsp;4.1.1.2.1 and 4.1.1.2.2).</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; For GPRS attach and routing area updating procedures in Iu mode, the mobile station shall evaluate the control information for:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ACDC if the mobile station supports ACDC (as specified in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The same control information shall also be taken into account, when the present document requires the mobile station to initiate a GPRS attach or routing area updating procedure in Iu mode when it detects that PS domain changes from barred to unbarred (see e.g. subclauses&nbsp;4.1.1.2.1 and 4.1.1.2.2).</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; For all other purposes the mobile station shall evaluate the control information for common access control as specified in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84], 3GPP&nbsp;TS&nbsp;44.060&nbsp;[76], and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c], the control information for EAB (as specified in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84], and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]), domain specific access control (as specified in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) and in Iu mode for PS domain if the mobile station supports ACDC, the control information for ACDC (as specified in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<h4><a name="_Toc171523780"></a>4.1.1.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Specific requirements for MS configured to use timer T3245</h4>
<p>The following requirement applies for an MS that is configured to use timer&nbsp;T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]):</p>
<p>When the MS adds a PLMN identity to the "forbidden PLMN list" or the "forbidden PLMNs for GPRS service" list or sets the SIM/USIM as invalid for non-GPRS services or GPRS services or both, and timer T3245 is not running, the MS shall start timer T3245 with a random value, uniformly drawn from the range between 12h and 24h.</p>
<p>Upon expiry of the timer T3245, the MS shall erase the "forbidden PLMN list" and the "forbidden PLMNs for GPRS service" list and set the SIM/USIM to valid for non-GPRS services and GPRS services. When the lists are erased, the MS performs a cell selection according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>If the MS is switched off when the timer T3245 is running, the MS shall behave as follows when the MS is switched on and the SIM/USIM in the MS remains the same:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; let t1 be the time remaining for T3245 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 &ndash; t. If t1 is equal to or less than t, then the MS will follow the behaviour as defined in the paragraph above upon expiry of the timer T3245. If the MS is not capable of determining t, then the MS shall restart the timer with the value t1.</p>
<h4><a name="_Toc171523781"></a>4.1.1.6A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Specific requirements for the MS when receiving non-integrity protected reject messages</h4>
<p>This subclause specifies the requirements for an MS that is not configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) and receives a LOCATION UPDATING REJECT, CM SERVICE REJECT, ABORT, ATTACH REJECT, ROUTING AREA UPDATE REJECT or SERVICE REJECT message without integrity protection with specific MM or GMM causes.</p>
<p>NOTE&nbsp;1:&nbsp; Additional MS requirements for this case, requirements for other MM or GMM causes, and requirements for the case when the MS receives a successfully integrity checked reject message are specified in subclauses&nbsp;4.4.4.7, 4.5.1.1, 4.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4.</p>
<p>The present subclause is applicable to A/Gb mode and Iu mode. In A/Gb mode,</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for the CS domain, as integrity protection is not supported, all messages received by the MS are considered to be received "before the network has activated the integrity protection"; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for the PS domain, if integrity protection is not required (see subclause&nbsp;4.7.1.2a.), all messages received by the MS are considered to be received "before the network has activated the integrity protection".</p>
<p>The MS may maintain a list of PLMN-specific attempt counters and a list of PLMN-specific PS-attempt counters. The maximum number of possible entries in each list is implementation dependent.</p>
<p>Additionally, the MS may maintain one counter for "SIM/USIM considered invalid for non-GPRS services" events and one counter for "SIM/USIM considered invalid for GPRS services" events.</p>
<p>If the MS maintains the above lists of attempt counters and the event counters, a MS supporting N1 mode, shall store them in its non-volatile memory. The UE shall erase the lists and reset the event counters to zero when the UICC containing the USIM is removed. The counter values shall not be affected by the activation or deactivation of power saving mode.</p>
<p>The MS may also maintain a list of "forbidden location areas for non-GPRS services" and a list of "forbidden location areas for GPRS services". If the MS is in a location area which is included in the list of "forbidden location areas for non-GPRS services", the MS shall not initiate any MM procedure. If the MS is in a location area which is included in the list of "forbidden location areas for GPRS services", the MS shall not initiate any GMM, SM, SMS or SS procedure for GPRS services.</p>
<p>If the MS receives a LOCATION UPDATING REJECT message without integrity protection with MM cause value #2, #3, #6, #11, #12, #13 or #15 before the network has activated the integrity protection for the CS domain, the MS shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running, and take the following actions:</p>
<p>1)&nbsp;&nbsp; if the MM cause value received is #3 or #6, and</p>
<ol>
<li>a) if the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events and the counter has a value less than an MS implementation-specific maximum value, the MS shall:</li>
<li>i) delete any LAI, TMSI and ciphering key sequence number stored in the SIM/USIM, reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause&nbsp;4.1.2.2);</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delete the list of equivalent PLMNs;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events, if not already incremented over the same RRC connection;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; store the current LAI in the list of "forbidden location areas for roaming"; and</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; search for a suitable cell in another location area or a tracking area according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121]; or</p>
<ol start="4">
<li>ii) proceed as specified in subclause&nbsp;4.4.4.7 and;</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events, if not already incremented over the same RRC connection;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events; and</p>
<ol start="4">
<li>b) else the MS shall proceed as specified in subclause&nbsp;4.4.4.7;</li>
</ol>
<p>2)&nbsp;&nbsp; if the MM cause value received is #2, and</p>
<ol>
<li>a) if the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events and the counter has a value less than an MS implementation-specific maximum value, the MS shall:</li>
<li>i) delete any LAI, TMSI and ciphering key sequence number stored in the SIM/USIM, reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause&nbsp;4.1.2.2);</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delete the list of equivalent PLMNs;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events, if not already incremented over the same RRC connection;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the MS maintains a list of "forbidden location areas for non-GPRS services" and a list of "forbidden location areas for GPRS services", proceed as follows:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the current LAI is already included in the list of "forbidden location areas for GPRS services" or the MS is not operating in MS operation mode A or B, store the current LAI in the list of "forbidden location areas for roaming"; otherwise store the current LAI in the list of "forbidden location areas for non-GPRS services"; and</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; attempt to select a suitable cell according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121], different from the cell where the LOCATION UPDATING REJECT was received; or</p>
<p>NOTE&nbsp;2:&nbsp; The cell on which the reject was received could still be a suitable cell.</p>
<ol start="4">
<li>ii) proceed as specified in subclause&nbsp;4.4.4.7 and;</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events, if not already incremented over the same RRC connection;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events; and</p>
<ol start="4">
<li>b) else the MS shall proceed as specified in subclause&nbsp;4.4.4.7;</li>
</ol>
<p>3)&nbsp;&nbsp; if the MM cause value received is #12, #13 or #15, the MS shall additionally proceed as specified in subclause&nbsp;4.4.4.7;</p>
<p>4)&nbsp;&nbsp; if the MM cause value received is #11 and the MS is in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present):</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; the MS shall delete any LAI, TMSI and ciphering key sequence number stored in the SIM/USIM, reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause&nbsp;4.1.2.2). Additionally, the MS shall store the current LAI in the list of "forbidden location areas for roaming"; and</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; the MS shall search for a suitable cell in another location area or a tracking area according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121]; and</p>
<p>5)&nbsp;&nbsp; if the MM cause value received is #11 and if the MS is not in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), in addition to the MS requirements specified in subclause&nbsp;4.4.4.7,</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the MS maintains a list of PLMN-specific attempt counters and the PLMN-specific attempt counter for the PLMN sending the reject message has a value less than an MS implementation-specific maximum value, the MS shall increment the PLMN-specific attempt counter for the PLMN.</p>
<p>If the MS receives a CM SERVICE REJECT or ABORT message with MM cause value #6 without integrity protection before the network has activated the integrity protection for the CS domain, the MS shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running, and</p>
<ol>
<li>a) if the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events and the counter has a value less than an MS implementation-specific maximum value, the MS shall:</li>
<li>i) proceed as specified in subclauses&nbsp;4.5.1.1 or 4.3.5.2 respectively with the exception that the MS shall not consider the SIM/USIM as invalid for non-GPRS services and;</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delete the list of equivalent PLMNs;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events, if not already incremented over the same RRC connection;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reset the location update attempt counter;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; store the current LAI in the list of "forbidden location areas for roaming"; and</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; search for a suitable cell in another location area or a tracking area according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121]; or</p>
<ol start="4">
<li>ii) proceed as specified in subclauses&nbsp;4.5.1.1 or 4.3.5.2 respectively and;</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events, if not already incremented over the same RRC connection;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events; and</p>
<ol start="4">
<li>b) else the MS shall proceed as specified in subclause&nbsp;4.5.1.1 or 4.3.5.2 respectively.</li>
</ol>
<p>If the MS receives an ATTACH REJECT or ROUTING AREA UPDATE REJECT message without integrity protection with GMM cause value #3, #6, #7, #8, #11, #12, #13, #14 or #15 before the network has activated the integrity protection for the PS domain, the MS shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running, and shall take the following actions:</p>
<p>6)&nbsp;&nbsp; if the GMM cause value received is #3, #6, or #8, and</p>
<ol>
<li>a) if the MS maintains a counter for "SIM/USIM considered invalid for GPRS services" events and the counter has a value less than an MS implementation-specific maximum value, the MS shall:</li>
<li>i) set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number;</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delete the list of equivalent PLMNs;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; increment the counter for "SIM/USIM considered invalid for GPRS services" events;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events and the counter has a value less than an MS implementation-specific maximum value, set the update status to U3 ROAMING NOT ALLOWED, delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. In Iu mode, the MS shall increment the counter for "SIM/USIM considered invalid for non-GPRS services" events, if not already incremented over the same RRC connection. In A/Gb mode, the MS shall increment the counter for "SIM/USIM considered invalid for non-GPRS services" events;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if a GPRS attach or routing area updating procedure was performed, reset the GPRS attach attempt counter or the routing area updating attempt counter, respectively;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if S1 mode is supported by the MS, handle the EMM parameters attach attempt counter or tracking area updating attempt counter, EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when an EPS attach or tracking area update procedure is rejected with the EMM cause of the same value in a NAS message without integrity protection;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; store the current LAI in the list of "forbidden location areas for roaming" and enter the state GMM-DEREGISTERED.LIMITED-SERVICE; and</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; search for a suitable cell in another location area or a tracking area according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121]; or</p>
<ol start="4">
<li>ii) proceed as specified in subclauses&nbsp;4.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4;</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; increment the counter for "SIM/USIM considered invalid for GPRS services" events; and</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events and the counter has a value less than an MS implementation-specific maximum value:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events, if not already incremented over the same RRC connection</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, increment the counter for "SIM/USIM considered invalid for non-GPRS services" events; and</p>
<ol start="4">
<li>b) else the MS shall proceed as specified in subclause&nbsp;4.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4;</li>
</ol>
<p>7)&nbsp;&nbsp; if the GMM cause value received is #7, and</p>
<ol>
<li>a) if the MS maintains a counter for "SIM/USIM considered invalid for GPRS services" events and the counter has a value less than an MS implementation-specific maximum value, the MS shall:</li>
<li>i) set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number;</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delete the list of equivalent PLMNs;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; increment the counter for "SIM/USIM considered invalid for GPRS services" events;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if a GPRS attach or routing area updating procedure was performed, reset the GPRS attach attempt counter or the routing area updating attempt counter, respectively;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if S1 mode is supported by the MS, handle the EMM parameters attach attempt counter or tracking area updating attempt counter, EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when an EPS attach or tracking area update procedure is rejected with the EMM cause of the same value in a NAS message without integrity protection;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enter the state GMM-DEREGISTERED.LIMITED-SERVICE;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the MS maintains a list of "forbidden location areas for non-GPRS services" and a list of "forbidden location areas for GPRS services", proceed as follows:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the current LAI is already included in the list of "forbidden location areas for non-GPRS services" or the MS is operating in MS operation mode C, store the current LAI in the list of "forbidden location areas for roaming"; otherwise store the current LAI in the list of "forbidden location areas for GPRS services"; and</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; attempt to select a suitable cell according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121], different from the cell where the ATTACH REJECT or ROUTING AREA UPDATING REJECT was received; or</p>
<p>NOTE&nbsp;3:&nbsp; The cell on which the reject was received could still be a suitable cell.</p>
<ol start="4">
<li>ii) proceed as specified in subclauses&nbsp;4.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4; and</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; increment the counter for "SIM/USIM considered invalid for GPRS services" events; and</p>
<ol start="4">
<li>b) else the MS shall proceed as specified in subclause&nbsp;4.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4;</li>
</ol>
<p>8)&nbsp;&nbsp; if the GMM cause value received is #12, #13 or #15, the MS shall additionally proceed as specified in subclauses&nbsp;4.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4;</p>
<p>9)&nbsp;&nbsp; if the GMM cause value received is #11 or #14 and the MS is in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present):</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number. The MS shall delete the list of equivalent PLMNs. Additionally, if a GPRS attach or the routing area updating procedure was performed, the MS shall reset the GPRS attach attempt counter or the routing area updating attempt counter respectively;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for GMM cause value #11, the MS shall store the current LAI in the list of "forbidden location areas for roaming", and enter the state GMM-DEREGISTERED.LIMITED-SERVICE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for GMM cause value #14, the MS shall enter the state GMM-DEREGISTERED.LIMITED-SERVICE. If the MS maintains a list of "forbidden location areas for non-GPRS services" and a list of "forbidden location areas for GPRS services", proceed as follows:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the current LAI is already included in the list of "forbidden location areas for non-GPRS services" or the MS is operating in MS operation mode C, store the current LAI in the list of "forbidden location areas for roaming"; otherwise store the current LAI in the list of "forbidden location areas for GPRS services";</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter or tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the procedure is rejected with the EMM cause with the same value without integrity protection; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall search for a suitable cell in another location area or in another tracking area according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121].</p>
<p>10) if the GMM cause value received is #11 and the MS is not in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the MS shall additionally proceed as specified in subclauses&nbsp; 4.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, 4.7.5.2.4 and 4.7.13.4:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Furthermore, if the MS maintains a list of PLMN-specific attempt counters and the PLMN-specific attempt counter for the PLMN sending the reject message has a value less than an MS implementation-specific maximum value, the MS shall increment the PLMN-specific attempt counter for the PLMN.</p>
<p>11) if the GMM cause value received is #14 and the MS is not in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the MS shall additionally proceed as specified in subclauses&nbsp;4.7.3.1.4, 4.7.3.2.4, 4.7.5.1.4, and 4.7.5.2.4:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Furthermore, if the MS maintains a list of PLMN-specific PS-attempt counters and the PLMN-specific PS-attempt counter for the PLMN sending the reject message has a value less than an MS implementation-specific maximum value, the MS shall increment the PLMN-specific PS-attempt counter for the PLMN.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS maintains a list of "forbidden location areas for non-GPRS services" and a list of "forbidden location areas for GPRS services", proceed as follows:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the current LAI is already included in the list of "forbidden location areas for non-GPRS services" or the MS is operating in MS operation mode C, store the current LAI in the list of "forbidden location areas for roaming"; otherwise store the current LAI in the list of "forbidden location areas for GPRS services" and the MS shall enter the state GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>If the MS receives a SERVICE REJECT message without integrity protection with GMM cause value #3, #6, #7, #8, #11, #12, #13 or #15 before the network has activated the integrity protection for the PS domain, the MS shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running, and proceed as specified under items 6, 7, 8, 9 and 10 above.</p>
<p>Upon expiry of timer T3247, the MS shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; erase the list of "forbidden location areas for regional provision of service" and the list of "forbidden location areas for roaming";</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; set the SIM/USIM to valid for non-GPRS services, if</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS does not maintain a counter for "SIM/USIM considered invalid for non-GPRS services" events; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events and this counter has a value less than an MS implementation-specific maximum value.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; set the SIM/USIM to valid for GPRS services, if</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS does not maintain a counter for "SIM/USIM considered invalid for GPRS services" events; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS maintains a counter for "SIM/USIM considered invalid for GPRS services" events and this counter has a value less than an MS implementation-specific maximum value.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; erase the list of "forbidden location areas for non-GPRS services" and the list of "forbidden location areas for GPRS services", if the MS maintains these lists;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the MS maintains a list of PLMN-specific attempt counters, for each PLMN-specific attempt counter that has a value greater than zero and less than an MS implementation-specific maximum value, remove the respective PLMN from the extension of the "forbidden PLMNs" list;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the MS maintains a list of PLMN-specific PS-attempt counters, for each PLMN-specific PS-attempt counter that has a value greater than zero and less than an MS implementation-specific maximum value, remove the respective PLMN from the "forbidden PLMNs for GPRS service" list. If the resulting "forbidden PLMNs for GPRS service" list is empty and the MS is supporting S1 mode, the MS re-enables the E-UTRA capability as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when timer T3247 expires;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the MS is supporting S1 mode, perform the actions as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when timer T3247 expires;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the MS is supporting N1 mode, perform the actions as specified in 3GPP&nbsp;TS&nbsp;24.501&nbsp;[167] for the case when timer T3247 expires; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; initiate a location updating procedure, GPRS attach procedure or routing area updating procedure, if still needed, dependent on MM state and update status, and GMM state and GPRS update status, or perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>If the MS maintains a list of PLMN-specific attempt counters and PLMN-specific PS-attempt counters, when the MS is switched off, the MS shall, for each PLMN-specific attempt counter that has a value greater than zero and less than the MS implementation-specific maximum value, remove the respective PLMN from the forbidden PLMN list. When the SIM/USIM is removed, the MS should perform this action.</p>
<p>NOTE&nbsp;4:&nbsp; If the respective PLMN was stored in the extension of the "forbidden PLMNs" list, then according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14] the MS will delete the contents of this extension when the MS is switched off or the SIM/USIM is removed.</p>
<h4><a name="_Toc171523782"></a>4.1.1.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of NAS level mobility management congestion control</h4>
<p>The network may detect GMM or MM signalling congestion and perform NAS level mobility management congestion control. PS domain NAS level mobility management congestion control consists of general NAS level mobility management congestion control and subscribed APN based congestion control. CS domain NAS level mobility management congestion control consists of general NAS level mobility management congestion control.</p>
<p>Under NAS level mobility management congestion control the network may reject mobility management signalling requests from MSs as specified in 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74]. The network should not reject requests for emergency bearer services.</p>
<p>When subscribed APN based congestion control is active for a particular APN, the network may reject attach request from MSs with subscription to this APN.</p>
<p>In mobility management the network may detect NAS signalling congestion. The network may start or stop performing the subscribed APN based congestion control based on mobility management level criteria such as:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; rate of mobility management NAS messages from a group of MSs with a subscription to a particular APN exceeds or falls below certain thresholds; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; setting in network management.</p>
<p>When the NAS level mobility management congestion control is active, the network may include a value for the mobility management back-off timer T3246 or T3346 in the reject messages. The MS starts the mobility management back-off timer with the value received in the mobility management reject messages. To avoid that large numbers of MSs simultaneously initiate deferred requests, the network should select the value for the mobility management back-off timer for the rejected MSs so that timeouts are not synchronised.</p>
<p>For subscribed APN based congestion control the value of timer T3346 for a particular APN may be APN dependent.</p>
<p>If the timer T3346 is running when the MS enters state GMM-DEREGISTERED, the MS remains switched on, and the SIM/USIM in the MS remains the same, then timer T3346 is kept running until it expires or it is stopped.</p>
<p>If the MS is switched off when the timer T3246 or T3346 is running, the MS shall behave as follows for each running timer when the MS is switched on and the SIM/USIM in the MS remains the same:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; let t1 be the time remaining until timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than&nbsp;t, then the timer shall be restarted with the value t1 &ndash; t. If t1 is equal to or less than t, then the timer need not be restarted. If the MS is not capable of determining t, then the MS shall restart the timer with the value t1; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if prior to switch off, timer T3346 was started due to a NAS request message (ATTACH REQUEST, ROUTING AREA UPDATE REQUEST or SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority", then if timer T3346 is restarted at switch on, the MS configured for low priority shall handle mobility management requests as indicated in subclauses&nbsp;4.7.3.1.5, 4.7.5.1.5 and&nbsp;4.7.13.5.</p>
<p>If the MS enters a new PLMN while timer T3246 is running, and the new PLMN is not equivalent to the PLMN where the MS started timer T3246, the MS shall stop timer T3246 when initiating mobility management procedures in the new PLMN.</p>
<p>If the MS enters a new PLMN while timer T3346 is running, and the new PLMN is not equivalent to the PLMN where the MS started timer T3346, the MS shall stop timer T3346 when initiating mobility management procedures in the new PLMN.</p>
<p>At an inter-system change from S1&nbsp;mode to A/Gb mode or from Iu mode to A/Gb mode within the same RA, if the timer T3346 is running and the TIN indicates "RAT‑related TMSI", the MS shall set the GPRS update status to GU2 NOT UPDATED and enter state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.</p>
<p>After change in RAI, if the timer T3346 is running and GPRS update status is GU1 UPDATED then MS shall set the GPRS update status to GU2 NOT UPDATED and enter state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.</p>
<p>After change in LAI, if the timer T3246 is running and MM update status is U1 UPDATED then MS shall set the MM update status to U2 NOT UPDATED and enter state MM IDLE, ATTEMPTING TO UPDATE.</p>
<h4><a name="_Toc171523783"></a>4.1.1.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of security related parameters at switch on and switch off</h4>
<p>At switch on, an ME supporting UTRAN Iu mode shall proceed as follows:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if a USIM is inserted, the ME shall read the START<sub>CS</sub> and START<sub>PS</sub> value from the USIM. If START<sub>CS</sub> and/or START<sub>PS</sub> read from the USIM are greater than or equal to the maximum value of START<sub>CS</sub> and START<sub>PS</sub> provided on the USIM (see 3GPP TS 31.102 [112]) or the CKSN or GPRS CKSN stored on the USIM indicates "no key available", the ME shall set the START value in the volatile memory of the ME for the corresponding core network domain(s) to zero. In addition if the read START<sub>CS</sub> and/or START<sub>PS</sub> are greater than or equal to the maximum value, the ME shall delete the corresponding CKSN or GPRS CKSN from the ME and the USIM. The ME shall set the START<sub>CS</sub> and START<sub>PS</sub> value on the USIM to the maximum value of START<sub>CS</sub> and START<sub>PS</sub> provided on the USIM (see 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]); and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if a SIM is inserted, the ME shall read the START<sub>CS</sub> and START<sub>PS</sub> value from the non-volatile memory. If START<sub>CS</sub> and/or START<sub>PS</sub> read from the non-volatile memory are greater than or equal to the default value specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a], subclause 6.8.2.4 or the CKSN or GPRS CKSN stored on the SIM indicates "no key available", the ME shall set the START value in the volatile memory of the ME for the corresponding core network domain(s) to zero. In addition if the read START<sub>CS</sub> and/or START<sub>PS</sub> are greater than or equal to the default value, the ME shall delete the corresponding CKSN or GPRS CKSN from the ME. The ME shall set the START<sub>CS</sub> and START<sub>PS</sub> value in the non-volatile memory to the default value specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a], subclause 6.8.2.4.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The lower layer handles the START<sub>CS</sub> and START<sub>PS</sub> value stored in the volatile memory of the ME as specified in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c].</p>
<p>Only at switch off, an ME supporting UTRAN Iu mode shall proceed for each of the two domains, CS and PS, as follows:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if since switch on the ME performed an authentication procedure for the respective domain and stored the new security context on the USIM or SIM, and the new security context was not taken into use, the ME shall set the START value for this domain on the USIM or, if a SIM is inserted, in the non-volatile memory to zero; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; otherwise, if a security context for the respective domain is stored on the USIM or SIM, i.e. the CKSN or GPRS CKSN stored on the USIM or SIM is different from "no key available", the ME shall store the current START value used by the lower layer for this domain on the USIM or, if a SIM is inserted, in the non-volatile memory.</p>
<h4><a name="_Toc171523784"></a>4.1.1.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Equivalent PLMNs list</h4>
<p>The mobile equipment shall store a list of "equivalent PLMNs". These PLMNs shall be regarded by the MS as equivalent to each other for PLMN selection and cell selection/re-selection. The same list is used by 5GMM, EMM, GMM and MM (see 3GPP&nbsp;TS&nbsp;24.501&nbsp;[167] and 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120]).</p>
<p>The list of equivalent PLMNs is replaced or deleted at the end of each location updating procedure, routing area updating procedure and GPRS attach procedure. The stored list consists of a list of equivalent PLMNs as downloaded by the network plus the PLMN code of the registered PLMN that downloaded the list. The stored list shall not be deleted when the MS is switched off. The stored list shall be deleted if the SIM/USIM is removed or when an MS attached for emergency bearer services enters the state GMM-DEREGISTERED. The maximum number of possible entries in the stored list is 16.</p>
<h4><a name="_Toc171523785"></a>4.1.1.10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dedicated core network</h4>
<p>The network may reject mobility management signalling requests from MSs due to dedicated core network as specified in 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74]. When the network rejects mobility management signalling requests due to dedicated core network, the mechanism for general NAS level mobility management congestion control as specified in subclause&nbsp;4.1.1.7 shall be followed.</p>
<h3><a name="_Toc171523786"></a>4.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM sublayer states</h3>
<p>The description of the states for the MM sublayer is organized as follows. The main states for the MS side, related to the procedures, are described in subclause&nbsp;4.1.2.1.1. The MM IDLE state is subdivided in substates for the description of the behaviour in idle mode (subclause&nbsp;4.1.2.1.2). This behaviour depends on an update status, described in subclause&nbsp;4.1.2.2. The states for the network side are described in subclause&nbsp;4.1.2.3.</p>
<h4><a name="_Toc171523787"></a>4.1.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM sublayer states in the mobile station</h4>
<p>In this subclause, the possible states for the MM sublayer in the mobile station is described. In figure&nbsp;4.1 of the present document, an overview of the MM sublayer protocol is given.</p>
<h5><a name="_Toc171523788"></a>4.1.2.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Main states</h5>
<p>0&nbsp;&nbsp;&nbsp; NULL</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station is inactive (e.g. power down). Important parameters are stored. Only manual action by the user may transfer the MM sublayer to another state.</p>
<p>3&nbsp;&nbsp;&nbsp; LOCATION UPDATING INITIATED</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A location updating procedure has been started and the MM awaits a response from the network. The timer T3210 is running.</p>
<p>5&nbsp;&nbsp;&nbsp; WAIT FOR OUTGOING MM CONNECTION</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM connection establishment has been started, and the MM awaits a response from the network. The timer T3230 is running.</p>
<p>6&nbsp;&nbsp;&nbsp; MM CONNECTION ACTIVE</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer has a RR connection to its peer entity on the network side. One or more MM connections are active.</p>
<p>7&nbsp;&nbsp;&nbsp; IMSI DETACH INITIATED</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The IMSI detach procedure has been started. The timer T3220 is running.</p>
<p>8&nbsp;&nbsp;&nbsp; PROCESS CM SERVICE PROMPT</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer has a RR connection to its peer entity on the network side. The Mobile Station has received a CM SERVICE PROMPT message but has not yet responded $(CCBS)$.</p>
<p>9&nbsp;&nbsp;&nbsp; WAIT FOR NETWORK COMMAND</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer has a RR connection to its peer entity in the network, but no MM connection is established. The mobile station is passive, awaiting further commands from the network. The timer T3240 may be running.</p>
<p>10&nbsp; LOCATION UPDATE REJECTED</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A location updating procedure has been rejected and RR connection release is awaited. The timer T3240 is running.</p>
<p>&nbsp;</p>
<p>Figure 4.1a/3GPP&nbsp;TS 24.008: Overview mobility management protocol/MS Side</p>
<p>&nbsp;</p>
<p>Additions to Figure 4.1a/3GPP TS 24.008</p>
<ol start="13">
<li>WAIT FOR RR CONNECTION (LOCATION UPDATING)</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer has requested RR connection establishment for starting the location updating procedure.</p>
<ol start="14">
<li>WAIT FOR RR CONNECTION (MM CONNECTION)</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer has requested RR connection establishment for dedicated mode for starting the MM connection establishment.</p>
<ol start="15">
<li>WAIT FOR RR CONNECTION (IMSI DETACH)</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer has requested RR connection establishment for starting the IMSI detach procedure.</p>
<ol start="17">
<li>WAIT FOR REESTABLISH</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A lower layer failure has occurred and re-establishment may be performed from the disturbed CM layer entities.</p>
<ol start="18">
<li>WAIT FOR RR ACTIVE</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer has requested activation of the RR sublayer.</p>
<ol start="19">
<li>MM IDLE</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; There is no MM procedure running and no RR connection exists except that a local MM context may exist when the RR sublayer is in Group Receive mode. This is a compound state, and the actual behaviour of the mobile station to Connection Management requests is determined by the actual substate as described hereafter.</p>
<ol start="20">
<li>WAIT FOR ADDITIONAL OUTGOING MM CONNECTION.</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM connection establishment for an additional MM connection has been started, and the MM awaits response from the network.</p>
<ol start="21">
<li>MM CONNECTION ACTIVE (GROUP TRANSMIT MODE)</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Only applicable for mobile stations supporting VGCS talking:) The MM sublayer has a RR connection on the VGCS channel to its peer entity on the network side. Only one MM connection is active.</p>
<ol start="22">
<li>WAIT FOR RR CONNECTION (GROUP TRANSMIT MODE)</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Only applicable for mobile stations supporting VGCS talking:) The MM sublayer has requested to perform an uplink access on the VGCS channel.</p>
<ol start="23">
<li>LOCATION UPDATING PENDING</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Only applicable for GPRS MS operation modes A and B; not shown in figure 4.1a) A location updating has been started using the combined GPRS attach procedure or the combined GPRS routing area updating procedure.</p>
<ol start="24">
<li>IMSI DETACH PENDING</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Only applicable for GPRS MS operation modes A and B; not shown in figure 4.1a) An IMSI detach for non-GPRS services has been started using the combined GPRS detach procedure at not switching off.</p>
<ol start="25">
<li>RR CONNECTION RELEASE NOT ALLOWED</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Only applicable for mobile stations supporting RRLP procedures (see 3GPP&nbsp;TS&nbsp;44.031&nbsp;[23b]) or LCS procedures over RRC (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c])). All MM connections are released by their CM entities, but the RR connection is maintained by the network due to an ongoing RRLP procedure or LCS procedure over RRC.</p>
<h5><a name="_Toc171523789"></a>4.1.2.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substates of the MM IDLE state</h5>
<p>For the description of the behaviour of the MS the MM IDLE state is subdivided in several substates, also called the service states. The service state pertains to the whole MS (ME alone if no SIM/USIM is inserted, or ME plus SIM/USIM). The service state depends on the update status (see subclause&nbsp;4.1.2.2) and on the selected cell.</p>
<p>19.1 NORMAL SERVICE</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Valid subscriber data are available, update status is U1, a cell is selected that belongs to the LA where the subscriber is registered.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In this state, all requests from the CM layers are treated normally.</p>
<p>19.2 ATTEMPTING TO UPDATE</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Valid subscriber data are available, update status is U2 and a cell is selected. Requests from upper layers are accepted. Emergency call requests are treated normally, otherwise the request triggers first a location updating attempt in the selected cell, and then triggers the needed procedure only in case of successful location updating, otherwise the request is rejected.</p>
<p>19.3 LIMITED SERVICE</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Valid subscriber data are available, update status is U3, and a cell is selected, which is known not to be able to provide normal service. Only emergency services are offered.</p>
<p>19.4 NO IMSI</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; No valid subscriber data (no SIM/USIM, or the SIM/USIM is not considered valid by the ME), and a cell is selected. Only emergency services are offered.</p>
<p>19.5 NO CELL AVAILABLE</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; No cell can be selected. This state is entered after a first intensive search failed (state 19.7). Cells are searched at a low rhythm.</p>
<p>This state is also entered when S1 mode is activated in the MS and current cell is an E-UTRAN cell. No services, except those provided by CS fallback and SMS over SGs, are offered.</p>
<p>19.6 LOCATION UPDATE NEEDED</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Valid subscriber data are available, and for some reason a location updating must be done as soon as possible (for instance update status is U1 but the selected cell is not in the registered LA, or the timer has expired). This state is usually of no duration, but can last, e.g. due to access class control, (see subclause&nbsp;4.1.1.2.1).</p>
<p>19.7 PLMN SEARCH</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station is searching for PLMNs, and the conditions for state 19.8 are not met. This state is ended when either a cell is selected (the new state is 19.1, 19.3 or 19.6), or when it is concluded that no cell is available for the moment (the new state is 19.5).</p>
<p>19.8 PLMN SEARCH, NORMAL SERVICE</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Valid subscriber data are available, update status is U1, a cell is selected which belongs to the LA where the subscriber is registered, and the mobile station is searching for PLMNs. This state is ended when either a cell is selected (the new state is 19.1, 19.3 or 19.6), or when it is concluded that no cell is available for the moment (the new state is 19.5).</p>
<p>19.9 RECEIVING GROUP CALL (NORMAL SERVICE)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Only applicable for mobile stations supporting VGCS listening or VBS listening. Valid subscriber data are available, update status is U1, a VGCS channel or VBS channel is received in a cell that belongs to the LA where the subscriber is registered.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In this state, only requests from the GCC or BCC layers are treated.</p>
<p>19.10 RECEIVING GROUP CALL (LIMITED SERVICE)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Only applicable for mobile stations supporting VGCS listening or VBS listening. Valid subscriber data are available, update status is U3, a VGCS channel or VBS channel is received in a cell which is known not to be able to provide normal service.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In this state, only requests from the GCC or BCC layers for the reception of VGCS or VBS calls are treated and group call emergency services are offered.</p>
<p>19.11 eCALL INACTIVE</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Valid subscriber data are available, update status is U4, and a cell is selected, which is expected to be able to provide normal service. Only emergency services and test/reconfiguration calls (see 3GPP&nbsp;TS&nbsp;22.101&nbsp;[8]) can be initiated by the mobile station. This state is applicable only to an eCall only mobile station (as determined by information configured in USIM). The state is entered by the mobile station in order to avoid MM activity and MM signalling in the absence of an emergency call or test/reconfiguration call. The state is ended when an emergency services or test/reconfiguration calls[8] is initiated by the mobile station, the new state depends on the result of the procedure when returning to MM-IDLE described in subclause&nbsp;4.2.3.</p>
<h4><a name="_Toc171523790"></a>4.1.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The update Status</h4>
<p>In parallel with the sublayer states described in subclause&nbsp;4.1.2.1 and which control the MM sublayer protocol, an update status exists.</p>
<p>The update status pertains to a specific subscriber embodied by a SIM/USIM. This status is defined even when the subscriber is not activated (SIM/USIM removed or connected to a switched-off ME). It is stored in a non volatile memory in the SIM/USIM. The update status is changed only as a result of a location updating procedure attempt (with the exception of an authentication failure and of some cases of CM service rejection). In some cases, the update status is changed as a result of a GPRS attach, GPRS routing area update, service request network initiated GPRS detach procedure or due to change in LAI while timer T3246 running.</p>
<p>U1 UPDATED</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The last location updating attempt was successful (correct procedure outcome, and the answer was acceptance from the network). With this status, the SIM/USIM contains also the LAI of the LA where the subscriber is registered, and possibly valid TMSI, GSM ciphering key, UMTS integrity key, UMTS ciphering key and ciphering key sequence number. Furthermore, if the ME supports any A5 ciphering algorithm that requires a 128-bit ciphering key and a USIM is in use, then the ME may contain a valid GSM Kc<sub>128</sub>. The "Location update status" stored on the SIM/USIM shall be "updated".</p>
<p>U2 NOT UPDATED</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The last location updating attempt made failed procedurally (no significant answer was received from the network, including the cases of failures or congestion inside the network).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For this status, the SIM/USIM can contain a valid LAI of the location area to which the subscriber was registered, and possibly also a valid TMSI, GSM ciphering key, UMTS integrity key, UMTS ciphering key and ciphering key sequence number. For compatibility reasons, all these fields shall be set to the "deleted" value if the LAI is deleted. However the presence of other values shall not be considered an error by the mobile station. Furthermore, if the ME supports any A5 ciphering algorithm that requires a 128-bit ciphering key and a USIM is in use, then the ME shall delete the GSM Kc<sub>128</sub> stored if the LAI is deleted. The "Location update status" stored on the SIM/USIM shall be "not updated".</p>
<p>U3 ROAMING NOT ALLOWED</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The last location updating attempt run correctly, but the answer from the network was negative (because of roaming or subscription restrictions).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For this status, the SIM/USIM can contain a valid LAI, TMSI, GSM ciphering key, UMTS integrity key, UMTS ciphering key or ciphering key sequence number. For compatibility reasons, all these fields shall be set to the "deleted" value if the LAI is deleted. However the presence of other values shall not be considered an error by the mobile station. Furthermore, if the ME supports any A5 ciphering algorithm that requires a 128-bit ciphering key and a USIM is in use, then the ME shall delete the GSM Kc<sub>128</sub> stored if the LAI is deleted. The "Location update status" stored on the SIM/USIM shall be "Location Area not allowed".</p>
<p>U4 UPDATING DISABLED</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Location updating has been disabled.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For this status, the SIM/USIM does not contain any valid LAI, TMSI, GSM ciphering key, UMTS integrity key, UMTS ciphering key or ciphering key sequence number. For compatibility reasons, all these fields shall be set to the "deleted" value at the moment the status is set to eCALL INACTIVE. However the presence of other values shall not be considered an error by the mobile station. Furthermore, if the ME supports any A5 ciphering algorithm that requires a 128-bit ciphering key and a USIM is in use, then the ME shall delete the GSM Kc<sub>128</sub> stored at the moment the status is set to eCALL INACTIVE. The "Location update status" stored on the SIM/USIM shall be "not updated".</p>
<h4><a name="_Toc171523791"></a>4.1.2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM sublayer states on the network side</h4>
<ol>
<li>IDLE</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer is not active except possibly when the RR sublayer is in Group Receive mode.</p>
<ol start="2">
<li>WAIT FOR RR CONNECTION</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer has received a request for MM connection establishment from the CM layer. A RR connection to the mobile station is requested from the RR sublayer (i.e. paging is performed).</p>
<ol start="3">
<li>MM CONNECTION ACTIVE</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer has a RR connection to a mobile station. One or more MM connections are active, or no MM connection is active but an RRLP procedure or LCS procedure over RRC is ongoing.</p>
<ol start="4">
<li>IDENTIFICATION INITIATED</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The identification procedure has been started by the network. The timer T3270 is running.</p>
<ol start="5">
<li>AUTHENTICATION INITIATED</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The authentication procedure has been started by the network. The timer T3260 is running.</p>
<ol start="6">
<li>TMSI REALLOCATION INITIATED</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The TMSI reallocation procedure has been started by the network. The timer T3250 is running.</p>
<ol start="7">
<li>SECURITY MODE INITIATED</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In Iu mode, the security mode setting procedure has been requested to the RR sublayer. In A/Gb mode, the cipher mode setting procedure has been requested to the RR sublayer.</p>
<p>8a. WAIT FOR MOBILE ORIGINATED MM CONNECTION</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A CM SERVICE REQUEST message is received and processed, and the MM sublayer awaits the "opening message" of the MM connection.</p>
<p>8b. WAIT FOR NETWORK ORIGINATED MM CONNECTION</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A CM SERVICE PROMPT message has been sent by the network and the MM sublayer awaits the "opening message" of the MM connection $(CCBS)$.</p>
<ol start="9">
<li>WAIT FOR REESTABLISHMENT</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The RR connection to a mobile station with one or more active MM connection has been lost. The network awaits a possible re-establishment request from the mobile station.</p>
<ol start="10">
<li>WAIT OF A GROUP CALL</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Only applicable in case for mobile station supporting VGCS talking. The MM sublayer has received a request for establishing a VGCS from the GCC sublayer. The request for establishing a VGCS channels is given to the RR sublayer.</p>
<ol start="11">
<li>GROUP CALL ACTIVE</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Only applicable in case of mobile station supporting VGCS talking. A VGCS channel is established by the RR sublayer. An RR connection to the talking mobile station can be established by the RR sublayer on the VGCS channel. The MM sublayer is active but no sending of MM message between the network and the mobile station has occurred.</p>
<ol start="12">
<li>MM CONNECTION ACTIVE (GROUP CALL)</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Only applicable in case of mobile station supporting VGCS talking. The MM sublayer has a RR connection to the talking mobile station on the VGCS channel. Only one MM connection is active.</p>
<ol start="13">
<li>WAIT FOR BROADCAST CALL</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Only applicable in case of VBS. The MM sublayer has received a request for a VBS establishment from the BCC sublayer. The request for establishment of VBS channels is given to the RR sublayer.</p>
<ol start="14">
<li>BROADCAST CALL ACTIVE</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Only applicable in case of VBS. A VBS channel is established by the RR sublayer. The MM sublayer is active but no explicit MM establishment between the Network and the mobile station has occurred.</p>
<h3><a name="_Toc171523792"></a>4.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS mobility management (GMM) sublayer states</h3>
<p>In this subclause, the GMM protocol of the MS and the network are described by means of two different state machines. In subclause&nbsp;4.1.3.1, the states of the GMM entity in the MS are introduced. The behaviour of the MS depends on a GPRS update status that is described in subclause&nbsp;4.1.3.2. The states for the network side are described in subclause&nbsp;4.1.3.3.</p>
<h4><a name="_Toc171523793"></a>4.1.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM states in the MS</h4>
<p>In this subclause, the possible GMM states are described of a GMM entity in the mobile station. subclause&nbsp;4.1.3.1.1 summarises the main states of a GMM entity, see figure 4.1b of the present document. The substates that have been defined are described in subclause&nbsp;4.1.3.1.2 and subclause&nbsp;4.1.3.1.3.</p>
<p>However, it should be noted that this subclause does not include a description of the detailed behaviour of the MS in the single states and does not cover abnormal cases. Thus, figure 4.1b of the present document is rather intended to give an overview of the state transitions than to be a complete state transition diagram. A detailed description of the behaviour of the MS is given in subclause&nbsp;4.2. Especially, with respect to the behaviour of the MS in abnormal cases it is referred to subclause&nbsp;4.7.</p>
<h5><a name="_Toc171523794"></a>4.1.3.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Main states</h5>
<p>4.1.3.1.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-NULL</p>
<p>The GPRS capability is disabled in the MS. No GPRS mobility management function shall be performed in this state.</p>
<p>4.1.3.1.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED</p>
<p>The GPRS capability has been enabled in the MS, but no GMM context has been established. In this state, the MS may establish a GMM context by starting the GPRS attach or combined GPRS attach procedure.</p>
<p>4.1.3.1.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED-INITIATED</p>
<p>A GPRS attach or combined GPRS attach procedure has been started and the MS is awaiting a response from the network.</p>
<p>4.1.3.1.1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED</p>
<p>A GMM context has been established, i.e. the GPRS attach or combined GPRS attach procedure has been successfully performed. In this state, the MS may activate PDP contexts, MBMS contexts, may send and receive user data and signalling information and may reply to a page request. Furthermore, cell and routing area updating are performed.</p>
<p>4.1.3.1.1.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED-INITIATED</p>
<p>The MS has requested release of the GMM context by starting the GPRS detach or combined GPRS detach procedure. This state is only entered if the MS is not being switched off at detach request.</p>
<p>4.1.3.1.1.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-ROUTING-AREA-UPDATING-INITIATED</p>
<p>A routing area updating procedure has been started and the MS is awaiting a response from the network.</p>
<p>4.1.3.1.1.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-SERVICE-REQUEST-INITIATED (Iu mode only)</p>
<p>A service request procedure has been started and the MS is awaiting a response from the network.</p>
<h5><a name="_Toc171523795"></a>4.1.3.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substates of state GMM-DEREGISTERED</h5>
<p>The GMM-DEREGISTERED state is subdivided into several substates as explained below. The substates pertain to the whole MS (ME alone if no SIM/USIM is inserted, or ME plus SIM/USIM). The selection of the appropriate substate depends on the GPRS update status, see subclause&nbsp;4.1.3.2, and on the selected cell.</p>
<p>4.1.3.1.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED.NORMAL-SERVICE</p>
<p>Valid subscriber data is available,&nbsp; a suitable cell has been found and the PLMN or LA is not in the forbidden list. In this state, a request for GPRS attach is performed using the stored temporary mobile subscriber identity for GPRS (P-TMSI), routing area identification (RAI) and GPRS ciphering key sequence number in case of GU1. If the GPRS update status is GU2, the IMSI shall be used to attach for GPRS services.</p>
<p>4.1.3.1.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED.LIMITED-SERVICE</p>
<p>Valid subscriber data is available, and a cell is selected, which is known not to be able to provide normal service.</p>
<p>4.1.3.1.2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED.ATTACH-NEEDED</p>
<p>Valid subscriber data is available and for some reason a GPRS attach must be performed as soon as possible. This state is usually of no duration, but can last, e.g. due to access class control (see subclause&nbsp;4.1.1.2.1).</p>
<p>4.1.3.1.2.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED.ATTEMPTING-TO-ATTACH</p>
<p>A cell is selected, a previous GPRS attach was rejected or failed due to a missing response from the network. The execution of further attach procedures depends on the GPRS attach attempt counter. No GMM procedure except GPRS attach shall be initiated by the MS in this substate.</p>
<p>4.1.3.1.2.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED.NO-IMSI</p>
<p>No valid subscriber data is available (no SIM/USIM, or the SIM/USIM is not considered valid by the ME) and a cell has been selected.</p>
<p>4.1.3.1.2.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED.NO-CELL-AVAILABLE</p>
<p>No cell can be selected. This substate is entered after a first intensive search failed (substate PLMN SEARCH). Cells are searched for at a low rhythm. No services are offered.</p>
<p>4.1.3.1.2.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED.PLMN-SEARCH</p>
<p>The mobile station is searching for PLMNs. This substate is left either when a cell has been selected (the new substate is NORMAL-SERVICE or LIMITED-SERVICE) or when it has been concluded that no cell is available at the moment (the new substate is NO-CELL-AVAILABLE).</p>
<p>4.1.3.1.2.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED.SUSPENDED (A/Gb mode only)</p>
<p>The MS shall enter this substate when entering dedicated mode and the MS limitations make it unable to communicate on GPRS channels. The MS shall leave this substate when leaving dedicated mode.</p>
<h5><a name="_Toc171523796"></a>4.1.3.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substates of state GMM-REGISTERED</h5>
<p>The state GMM-REGISTERED is subdivided into several substate as explained below. The substates pertain to the whole MS (ME alone if no SIM/USIM is inserted, or ME plus SIM/USIM).</p>
<p>4.1.3.1.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.NORMAL-SERVICE</p>
<p>User data and signalling information may be sent and received.</p>
<p>4.1.3.1.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.SUSPENDED (A/Gb mode only)</p>
<p>The MS shall enter this substate when entering dedicated mode and when the MS limitations makes it unable to communicate on GPRS channels. In this substate, no user data should be sent and no signalling information shall be sent. The MS shall leave this substate when leaving dedicated mode.</p>
<p>4.1.3.1.3.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.UPDATE-NEEDED</p>
<p>The MS has to perform a routing area updating procedure, but its access class is not allowed in the cell due to access class control (see subclause&nbsp;4.1.1.2.1). The procedure will be initiated as soon as access is granted (this might be due to a cell-reselection or due to change of the access classes allowed in the current cell). No GMM procedure except routing area updating shall be initiated by the MS in this substate. In this substate, no user data and no signalling information shall be sent.</p>
<p>4.1.3.1.3.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.ATTEMPTING-TO-UPDATE</p>
<p>A routing area updating procedure failed due to a missing response from the network. The MS retries the procedure controlled by timers and a GPRS attempt counter. No GMM procedure except routing area updating shall be initiated by the MS in this substate. No data shall be sent or received.</p>
<p>4.1.3.1.3.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.NO-CELL-AVAILABLE</p>
<p>GPRS coverage has been lost or PSM is active in the MS. If PSM is active, the MS can deactivate PSM at any time by activating the AS layer when the MS needs to send mobile originated signalling or user data. Otherwise, the MS shall not initiate any GMM procedures except of cell (and PLMN) reselection.</p>
<p>&nbsp;</p>
<p>Figure 4.1b/3GPP TS 24.008:GMM main states in the MS</p>
<p>4.1.3.1.3.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.LIMITED-SERVICE</p>
<p>A cell is selected, which is known not to be able to provide normal service. The MS will remain in this sub-state until a cell is selected which is able to provide normal service.</p>
<p>4.1.3.1.3.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM</p>
<p>A combined routing area updating procedure or a combined GPRS attach procedure was successful for GPRS services only. The MS retries the procedure controlled by timers and a GPRS attempt counter. User data and signalling information may be sent and received.</p>
<p>4.1.3.1.3.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.IMSI-DETACH-INITIATED</p>
<p>The MS performs a combined GPRS detach procedure for non-GPRS services only (detach type "IMSI Detach"). This state is entered if the MS is attached for GPRS and non-GPRS services in a network that operates in network mode I and wants to detach for non-GPRS services only. User data and signalling information may be sent and received.</p>
<p>4.1.3.1.3.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.PLMN-SEARCH</p>
<p>The mobile station is searching for PLMNs. This substate is left either when a cell has been selected (the new substate is NORMAL-SERVICE or LIMITED-SERVICE) or when it has been concluded that no cell is available at the moment (the new substate is NO-CELL-AVAILABLE).</p>
<h4><a name="_Toc171523797"></a>4.1.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS update status</h4>
<p>In addition to the GMM sublayer states described so far, a GPRS update status exists.</p>
<p>The GPRS update status pertains to a specific subscriber embodied by a SIM/USIM. This status is defined even when the subscriber is not activated (SIM/USIM removed or connected to a switched off ME). It is stored in a non volatile memory in the SIM/USIM. The GPRS update status is changed only after execution of a GPRS attach, combined GPRS attach, network initiated GPRS detach, authentication, service request, paging for GPRS services using IMSI,&nbsp; routing area updating, combined routing area updating procedure or due to change in RAI while timer T3346 running.</p>
<p>GU1: UPDATED</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The last GPRS attach or routing area updating attempt was successful (correct procedure outcome, and the answer was accepted by the network). The SIM/USIM contains the RAI of the routing area (RA) to which the subscriber was attached, and possibly a valid P-TMSI, GPRS GSM ciphering key, GPRS UMTS ciphering key, GPRS UMTS integrity key and GPRS ciphering key sequence number. Furthermore, if the ME supports any GEA ciphering algorithm that requires a 128-bit ciphering key and a USIM is in use, then the ME may contain a valid GPRS GSM Kc<sub>128</sub>. Furthermore, if the ME supports any GIA integrity algorithm that requires a 128-bit integrity key and a USIM is in use, then the ME may contain a valid GPRS GSM Kint.</p>
<p>GU2: NOT UPDATED</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The last GPRS attach or routing area updating attempt failed procedurally, e.g. no response was received from the network. This includes the cases of failures or congestion inside the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In this case, the SIM/USIM can contain the RAI of the routing area (RA) to which the subscriber was attached, and possibly also a valid P-TMSI, GPRS GSM ciphering key, GPRS UMTS ciphering key, GPRS UMTS integrity key and GPRS ciphering key sequence number. For compatibility reasons, all these fields shall be set to the "deleted" value if the RAI is deleted. However, the presence of other values shall not be considered an error by the MS. Furthermore, if the ME supports any GEA ciphering algorithm that requires a 128-bit ciphering key and a USIM is in use, then the ME shall delete the GPRS GSM Kc<sub>128</sub> stored if the RAI is deleted. Furthermore, if the ME supports any GIA integrity algorithm that requires a 128-bit integrity key and a USIM is in use, then the ME shall delete the GPRS GSM Kint stored if the RAI is deleted.</p>
<p>GU3: ROAMING NOT ALLOWED</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The last GPRS attach or routing area updating attempt was correctly performed, but the answer from the network was negative (because of roaming or subscription restrictions).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In this case, the SIM/USIM can contain the RAI of the routing area (RA) to which the subscriber was attached, and possibly also a valid P-TMSI, GPRS GSM ciphering key, GPRS UMTS ciphering key, GPRS UMTS integrity key or GPRS ciphering key sequence number. For compatibility reasons, all these fields shall be set to the value "deleted" if the RAI is deleted. However, the presence of other values shall not be considered an error by the MS. Furthermore, if the ME supports any GEA ciphering algorithm that requires a 128-bit ciphering key and a USIM is in use, then the ME shall delete the GPRS GSM Kc<sub>128</sub> stored if the RAI is deleted. Furthermore, if the ME supports any GIA integrity algorithm that requires a 128-bit integrity key and a USIM is in use, then the ME shall delete the GPRS GSM Kint stored if the RAI is deleted.</p>
<p>If the MS is attached for emergency bearer services, the MS shall not store the GMM parameters described in this subclause on the SIM/USIM or in non-volatile memory. Instead the MS shall temporarily store these parameters locally in the ME and the MS shall delete these parameters when the MS is detached.</p>
<h4><a name="_Toc171523798"></a>4.1.3.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM mobility management states on the network side</h4>
<p>In this subsubclause, the possible states are described for the GMM on the network side. Subclause&nbsp;4.1.3.3.1 summarises the main states. The corresponding substates are described in subclause&nbsp;4.1.3.3.2.</p>
<p>However, it should be noted that this subclause does not include a description of the detailed behaviour of the network in the single states and does not cover abnormal cases. Thus, figure 4.1c/3GPP TS 24.008 is rather intended to give an overview of the state transitions than to be a complete state transition diagram. A detailed description of the behaviour of the MS is given in subclause&nbsp;4.2. Especially, with respect to the behaviour of the MS in abnormal cases it is referred to subclause&nbsp;4.7.</p>
<h5><a name="_Toc171523799"></a>4.1.3.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Main States</h5>
<p>4.1.3.3.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED</p>
<p>The network has no GMM context or the GMM context is marked as detached, the MS is detached. In this state, the network may answer to a GPRS attach or combined GPRS attach procedure initiated by the MS.</p>
<p>4.1.3.3.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-COMMON-PROCEDURE-INITIATED</p>
<p>A common GMM procedure, as defined in subclause&nbsp;4.1.1, has been started. The network is awaiting the answer from the MS.</p>
<p>4.1.3.3.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED</p>
<p>The GMM context has been established and the GPRS attach procedure has been successfully performed.</p>
<p>4.1.3.3.1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED-INITIATED</p>
<p>The network has started a GPRS detach procedure and is awaiting the answer from the MS.</p>
<p>Figure 4.1c/3GPP TS 24.008: GMM main states on the network side</p>
<h5><a name="_Toc171523800"></a>4.1.3.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substates of state GMM-REGISTERED</h5>
<p>The state GMM-REGISTERED is subdivided into two substates as explained below.</p>
<p>4.1.3.3.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.NORMAL-SERVICE</p>
<p>User data and signalling information may be sent and received.</p>
<p>4.1.3.3.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.SUSPENDED (A/Gb mode only)</p>
<p>In this substate, the lower layers shall be prevented of sending user data or signalling information.</p>
<h2><a name="_Toc171523801"></a>4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Behaviour of the MS in MM Idle state, GMM-DEREGISTERED state and GMM-REGISTERED state</h2>
<p>In this subclause, the detailed behaviour of the MS in the main states MM IDLE, GMM-DEREGISTERED and GMM-REGISTERED is described. Subclauses&nbsp;4.2.1 to 4.2.3 refer to the state MM IDLE, whereas subclauses&nbsp;4.2.4 and 4.2.5 refer to the states GMM-DEREGISTERED and GMM-REGISTERED, respectively.</p>
<p>The MM IDLE state is entered when none of the MM procedures are running and no RR connection exists. It is left when one of the MM procedures are triggered or a RR connection is established.</p>
<p>The specific behaviour in the MM IDLE state depends on the service state of the mobile station as described in subclause&nbsp;4.1.2.1.2. The service state depends in particular on the update status which is defined in subclause&nbsp;4.1.2.2.</p>
<p>How an appropriate service state is chosen after power on is described in subclause&nbsp;4.2.1, and the specific behaviour of the mobile station in MM IDLE state is described in subclause&nbsp;4.2.2. The service state chosen when the MM IDLE state is returned to from any state except NULL state is described in subclause&nbsp;4.2.3.</p>
<p>It should be noted that transitions between the various MM idle states are caused by (e.g.):</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; results of procedures on RR connected mode (see subclause&nbsp;4.2.3);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; insertion or removal of the SIM/USIM;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; cell selection/reselection (see also 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98]);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; PLMN search;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; loss of coverage.</p>
<p>How various MM procedures affects the service state and the update status is described in the detailed descriptions of the procedures in subclauses&nbsp;4.3 to 4.5.</p>
<h3><a name="_Toc171523802"></a>4.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Primary Service State selection</h3>
<h4><a name="_Toc171523803"></a>4.2.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Selection of the Service State after Power On.</h4>
<p>For an eCall only mobile station (as determined by information configured in the USIM), Timers T3242 and T3243 are considered to have expired at power-on. When mobility management is activated after power-on, the service state is 19.7 PLMN SEARCH. The detailed processing in this state is described in detail in 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14], 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82], 3GPP&nbsp;TS&nbsp;45.008&nbsp;[34] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98], where procedures for power on and selection of PLMN is described in detail. If the "Location update status" stored on the SIM/USIM is different from "updated", then the mobile shall act as if the "Location update status" stored on the SIM/USIM is "not updated".</p>
<p>The service state when the PLMN SEARCH state is left depends on the outcome of the search and on the presence of the SIM/USIM:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if no cell has been found, the state is NO CELL AVAILABLE, until a cell is found;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if no SIM/USIM is present the state is NO IMSI;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for an eCall only mobile station (as determined by information configured in USIM), the state is eCALL INACTIVE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the mobile station has been continuously activated since loosing coverage and then returns to coverage, and if the selected cell is in the location area where the mobile station is registered and the timer T3212 has not expired, then the state is NORMAL SERVICE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the selected cell is in the location area where the mobile station is registered and IMSI ATTACH is not required and timer T3212 has not expired, then the state is NORMAL SERVICE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the mobile station is in automatic network selection mode and the selected cell is in a forbidden PLMN, is in a forbidden LA, or is a CSG cell whose CSG ID and associated PLMN identity are not in the Allowed CSG list or in the Operator CSG list stored in the MS, then the mobile station enters the LIMITED SERVICE state;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the mobile station is in manual network selection mode and no cell of the selected PLMN has been found, or the cell that is found in the selected PLMN is a CSG cell whose CSG ID and associated PLMN identity are not in the Allowed CSG list or in the Operator CSG list stored in the MS, then the mobile station enters the LIMITED SERVICE state;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; otherwise, the mobile station enters the LOCATION UPDATE NEEDED state.</p>
<h4><a name="_Toc171523804"></a>4.2.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Other Cases</h4>
<p>The state PLMN SEARCH is also entered in the following cases:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in state NO IMSI, a SIM/USIM is inserted;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in any state except NO IMSI, NO CELL AVAILABLE, NORMAL SERVICE and RECEIVING GROUP CALL (NORMAL SERVICE) after the user has asked for a PLMN selection;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in any state except NO IMSI and NO CELL AVAILABLE, coverage is lost;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; roaming is denied;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; optionally, when the mobile station is in the ATTEMPTING TO UPDATE state and is in Automatic Network Selection mode and location update attempt counter is greater than or equal to 4.</p>
<p>The service state when the PLMN SEARCH is left depends on the outcome of the search and on the presence of the SIM/USIM as specified in subclause&nbsp;4.2.1.1.</p>
<h3><a name="_Toc171523805"></a>4.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Detailed Description of the MS behaviour in MM IDLE State.</h3>
<p>In the MM IDLE state the mobile station shall behave according to the service state. In the following subclauses the behaviour is described for the non transient service states. It should be noted that after procedures in RR connected mode, e.g. location updating procedures, subclause&nbsp;4.2.3 applies which specifies the selection of the MM idle state. Furthermore when in sub-state NORMAL SERVICE, if a PLMN selection is requested, the MS enters sub-state SEARCH FOR PLMN, NORMAL SERVICE.</p>
<h4><a name="_Toc171523806"></a>4.2.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service State, NORMAL SERVICE</h4>
<p>When in state MM IDLE and service state NORMAL SERVICE, the mobile station shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; provided that T3246 is not running, perform normal location updating when a new location area is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform location updating procedure at expiry of timer T3211 or T3213;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform periodic updating at expiration of timer T3212;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform IMSI detach;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; provided that T3246 is not running, support requests from the CM layer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; support request for emergency calls;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; respond to paging; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for an eCall only mobile station (as determined by information configured in USIM), perform the eCall inactivity procedure at expiry of timer T3242 or timer T3243.</p>
<p>In addition, mobile stations supporting VGCS listening or VBS listening shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; indicate notifications to the GCC or BCC sublayer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; respond to notification if the GCC or BCC sublayer requests the reception of a voice group or broadcast call for which no channel description has been received in the notification by the RR sublayer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; request the RR sublayer to receive a voice group or broadcast call if the GCC or BCC sublayer requests the reception of a voice group or broadcast call for which a channel description has been received in the notification by the RR sublayer and then go to the service state RECEIVING GROUP CALL (NORMAL SERVICE).</p>
<h4><a name="_Toc171523807"></a>4.2.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service State, ATTEMPTING TO UPDATE</h4>
<p>When in state MM IDLE and service state ATTEMPTING TO UPDATE the mobile station shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform location updating procedure at expiry of timer T3211, T3213 or T3246;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform normal location updating when entering a new PLMN, if timer T3246 is running and the new PLMN is not equivalent to the PLMN where the MS started timer T3246;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform normal location updating when the location area identification of the serving cell changes, if timer T3246 is not running;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if entry into this state was caused by c) or d) or f) (with cause different from "abnormal release, unspecified") or g) (with cause "retry upon entry into a new cell") of subclause&nbsp;4.4.4.9, then location updating shall be performed when a new cell is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if entry into this state was caused by e) or f) (with cause "abnormal release, unspecified"), g) (with cause different from "retry upon entry into a new cell"), i) or j) of subclause&nbsp;4.4.4.9, then location updating shall not be performed because a new cell is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform normal location updating at expiry of timer T3212;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not perform IMSI detach unless timer T3246 is running and the location area of the current cell is same as the stored location area;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; support request for emergency calls;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; use other request from CM layer as triggering of normal location updating procedure (if the location updating procedure is successful, then the request for MM connection is accepted, see subclause&nbsp;4.5.1), if timer T3246 is not running;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; respond to paging, if the location area of the current cell is same as the stored location area;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; respond to paging (with IMSI) ; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for an eCall only mobile station (as determined by information configured in USIM), perform the eCall inactivity procedure at expiry of timer T3242 or timer T3243.</p>
<p>In addition, mobile stations supporting VGCS listening or VBS listening shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; indicate notifications to the GCC or BCC sublayer for which a channel description has been received in the notification by the RR sublayer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; reject requests of the GCC or BCC sublayer to respond to notifications for which no channel description has been received in the notification by the RR sublayer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; request the RR sublayer to receive a voice group or broadcast call if the GCC or BCC sublayer requests the reception of a voice group or broadcast call for which a channel description has been received in the notification by the RR sublayer and then go to the service state RECEIVING GROUP CALL (LIMITED SERVICE).</p>
<h4><a name="_Toc171523808"></a>4.2.2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service State, LIMITED SERVICE</h4>
<p>When in state MM IDLE and service state LIMITED SERVICE the mobile station shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not perform periodic updating;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not perform IMSI detach;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; reject any requests from CM entities for MM connections except for emergency calls;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform normal location updating when a cell is entered which may provide normal service (e.g.&nbsp;location area not in one of the forbidden LAI lists.); and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for an eCall only mobile station (as determined by information configured in USIM), perform the eCall inactivity procedure at expiry of timer T3242 or timer T3243.</p>
<p>When in state MM IDLE and service state LIMITED SERVICE the mobile station may:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; respond to paging (with IMSI);</p>
<p>In addition, mobile stations supporting VGCS listening or VBS listening shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; indicate notifications to the GCC or BCC sublayer for which a channel description has been received in the notification by the RR sublayer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; reject requests of the GCC or BCC sublayer to respond to notifications for which no channel description has been received in the notification by the RR sublayer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; request the RR sublayer to receive a voice group or broadcast call if the GCC or BCC sublayer requests the reception of a voice group or broadcast call for which a channel description has been received in the notification by the RR sublayer and then go to the service state RECEIVING GROUP CALL (LIMITED SERVICE).</p>
<h4><a name="_Toc171523809"></a>4.2.2.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service State, NO IMSI</h4>
<p>When in state MM IDLE and service state NO IMSI the mobile station shall (see subclause&nbsp;3.2, 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP TS&nbsp;45.008&nbsp;[34]):</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not start any normal location updating attempt;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not perform periodic updating;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not perform IMSI detach if powered down;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; reject any request from CM entities for MM connections except for emergency calls;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not respond to paging;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; only perform default cell selection.</p>
<p>In addition, mobile stations supporting VGCS listening or VBS listening shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not indicate notifications to the GCC or BCC layer.</p>
<h4><a name="_Toc171523810"></a>4.2.2.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service State, SEARCH FOR PLMN, NORMAL SERVICE</h4>
<p>When in state MM IDLE and service state SEARCH FOR PLMN, NORMAL SERVICE the mobile station shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if timer T3211 or T3213 expires in this state perform a location updating procedure at the latest if and when back to NORMAL SERVICE state and if the cell is not changed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if timer T3212 expires in this state perform a periodic location updating procedure at the latest if and when back to NORMAL SERVICE state;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform IMSI detach;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; support requests from the CM layer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; listen as far as possible to paging, and respond; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for an eCall only mobile station (as determined by information configured in USIM), perform the eCall inactivity procedure at expiry of timer T3242 or T3243.</p>
<p>In addition, mobile stations supporting VGCS listening or VBS listening shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; listen as far as possible to notifications and indicate notifications to the GCC or BCC layer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; respond to notification if the GCC or BCC sublayer requests the reception of a voice group or broadcast call for which no channel description has been received in the notification by the RR sublayer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; request the RR sublayer to receive a voice group or broadcast call if the GCC or BCC sublayer requests the reception of a voice group or broadcast call for which a channel description has been received in the notification by the RR sublayer.</p>
<h4><a name="_Toc171523811"></a>4.2.2.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service State, SEARCH FOR PLMN</h4>
<p>When in state MM IDLE and service state SEARCH FOR PLMN the mobile station shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not start any normal location updating attempt;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not perform periodic updating;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not perform IMSI detach if powered down;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; reject any request from CM entities for MM connections except emergency calls;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not respond to paging.</p>
<h4><a name="_Toc171523812"></a>4.2.2.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service State, RECEIVING GROUP CALL (NORMAL SERVICE)</h4>
<p>Only applicable for mobile stations supporting VGCS listening or VBS listening:</p>
<p>When in state MM IDLE and service state RECEIVING GROUP CALL (NORMAL SERVICE), the mobile station shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform normal location updating when a new location area is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform location updating procedure at expiry of timer T3211 or T3213;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform periodic updating at expiration of timer T3212;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform IMSI detach;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; support requests from the GCC or BCC layers;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; indicate notifications or paging information to the GCC or BCC layer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; respond to notification if the GCC or BCC sublayer requests the reception of a voice group or broadcast call for which no channel description has been received in the notification by the RR sublayer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; request the RR sublayer to receive another voice group or broadcast call if the GCC or BCC sublayer requests the reception of a voice group or broadcast call for which a channel description has been received in the notification by the RR sublayer.</p>
<h4><a name="_Toc171523813"></a>4.2.2.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service State, RECEIVING GROUP CALL (LIMITED SERVICE)</h4>
<p>Only applicable for mobile stations supporting VGCS listening or VBS listening:</p>
<p>When in state MM IDLE and service state RECEIVING GROUP CALL (LIMITED SERVICE), the mobile station shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not perform periodic updating;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not perform IMSI detach;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; reject any requests from CM entities for MM connections except for emergency calls;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform normal location updating when a cell is entered which may provide normal service (e.g.&nbsp;location area not in one of the forbidden LAI lists.);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; it may respond to paging (with IMSI);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; indicate notifications to the GCC or BCC sublayer for which a channel description has been received in the notification by the RR sublayer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; reject requests of the GCC or BCC sublayer to respond to notifications for which no channel description has been received in the notification by the RR sublayer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; request the RR sublayer to receive a voice group or broadcast call if the GCC or BCC sublayer requests the reception of a voice group or broadcast call for which a channel description has been received in the notification by the RR sublayer and then go to the service state RECEIVING GROUP CALL (LIMITED SERVICE).</p>
<h4><a name="_Toc171523814"></a>4.2.2.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service State, eCALL INACTIVE</h4>
<p>When in state MM IDLE and service state eCALL INACTIVE, the mobile station shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not perform periodic updating;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not perform IMSI detach;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; reject any requests from CM entities for MM connections except for emergency calls and calls to a non-emergency MSISDN for test and terminal reconfiguration services;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not perform normal location updating; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not respond to paging.</p>
<h3><a name="_Toc171523815"></a>4.2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service state when back to state MM IDLE from another state</h3>
<p>When returning to MM IDLE, e.g., after a location updating procedure, the mobile station selects the cell as specified in 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98]. With one exception, this is a normal cell selection.</p>
<p>An eCall only mobile station (as determined by information configured in USIM), shall start timer T3242 if the return to MM IDLE state is the result of an emergency services call and shall start timer T3243 if the return to MM IDLE state is the result of a call to a non-emergency MSISDN for test and terminal reconfiguration services, as described in subclause&nbsp;4.4.7.</p>
<p>If this return to idle state is not subsequent to a location updating procedure terminated with reception of cause "Roaming not allowed in this location area", the service state depends on the result of the cell selection procedure, on the update status of the mobile station, on the location data stored in the mobile station and on the presence of the SIM/USIM:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if no cell has been found, the state is NO CELL AVAILABLE, until a cell is found;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if no SIM/USIM is present, or if the inserted SIM/USIM is considered invalid by the MS, the state is NO IMSI;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for an eCall only mobile station (as determined by information configured in USIM), if timer T3242 or timer T3243 has expired and service state PLMN SEARCH is not required, the state is eCALL INACTIVE and the eCall inactivity procedure is performed as described in subclause&nbsp;4.4.7;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the selected cell is in the location area where the MS is registered, then the state is NORMAL SERVICE; it shall be noted that this also includes an abnormal case described in subclause&nbsp;4.4.4.9;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; (Only applicable for mobile stations supporting VGCS listening or VBS listening.) if the mobile stations was in the service state RECEIVING GROUP CALL (NORMAL SERVICE) or RECEIVING GROUP CALL (LIMITED SERVICE) before the location updating procedure and the selected cell is in the location area where the mobile station is registered, then the state is RECEIVING GROUP CALL (NORMAL SERVICE);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the selected cell is in a location area where the mobile station is not registered but in which the MS is allowed to attempt a location update, then the state is LOCATION UPDATE NEEDED;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the selected cell is in a location area where the mobile station is not allowed to attempt a location update, then the state is LIMITED SERVICE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the selected cell is a CSG cell whose CSG ID and associated PLMN identity are not in the Allowed CSG list or in the Operator CSG list stored in the MS, then the state is LIMITED SERVICE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; (Only applicable for MSs supporting VGCS listening or VBS listening.) if the MSs was in the service state RECEIVING GROUP CALL (NORMAL SERVICE) or RECEIVING GROUP CALL (LIMITED SERVICE) before the location updating procedure and the selected cell is in the location area where the MS is not allowed to attempt a location update, then the state is RECEIVING GROUP CALL (LIMITED SERVICE);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; after some abnormal cases occurring during an unsuccessful location updating procedure, as described in subclause&nbsp;4.4.4.9, the state is ATTEMPTING TO UPDATE.</p>
<p>In case of a return from a location updating procedure to which was answered "Roaming not allowed in this location area", the service state PLMN SEARCH is entered as specified in subclause&nbsp;4.2.1.2.</p>
<h3><a name="_Toc171523816"></a>4.2.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Behaviour in state GMM-DEREGISTERED</h3>
<p>The state GMM-DEREGISTERED is entered when:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is switched on;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the GPRS capability has been enabled in the MS;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS detach or combined GPRS detach procedure has been performed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GMM procedure has failed (except routing area updating, see subclause&nbsp;4.7.5); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS attached for emergency bearer services is in PMM-IDLE mode and its periodic routing area update timer expires (see subclause&nbsp;4.7.2.2).</p>
<p>The selection of the appropriate substate of GMM-DEREGISTERED after switching on is described in subclause&nbsp;4.2.4.1. The specific behaviour of the MS in state GMM-DEREGISTERED is described in subclause&nbsp;4.2.4.2. The substate chosen when the GMM-DEREGISTERED state is returned to from another state except state GMM-NULL is described in subclause&nbsp;4.2.4.3.</p>
<p>It should be noted that transitions between the various substates of GMM-DEREGISTERED are caused by (e.g.):</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; insertion or removal of the SIM/USIM;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; cell selection/reselection (see also 3GPP TS&nbsp;43.022 [82] and 3GPP TS&nbsp;25.304 [98]);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; PLMN search;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; loss/regain of coverage; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; change of RA.</p>
<p>How various GMM procedures affect the GMM-DEREGISTERED substates and the GPRS update status is described in the detailed description of the GMM procedures in subclause&nbsp;4.7.</p>
<h4><a name="_Toc171523817"></a>4.2.4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Primary substate selection</h4>
<h5><a name="_Toc171523818"></a>4.2.4.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Selection of the substate after power on or enabling the MS's GPRS capability</h5>
<p>When the MS is switched on, the substate shall be PLMN-SEARCH in case the SIM/USIM is inserted and valid. See 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14] and 3GPP&nbsp;TS&nbsp;45.008&nbsp;[34] for further details.</p>
<p>When the GPRS capability in an activated MS has been enabled, the selection of the GMM-DEREGISTERED substate depends on the MM state and the GPRS update status.</p>
<p>The substate chosen after PLMN-SEARCH, in case of power on or after enabling of the GPRS capability is:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the cell is not supporting GPRS, the substate shall be NO-CELL-AVAILABLE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if no SIM/USIM is present the substate shall be NO-IMSI;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if a suitable cell supporting GPRS has been found and the PLMN or LA is not in the forbidden list, then the substate shall be NORMAL-SERVICE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the selected cell supporting GPRS is in a forbidden PLMN, is in a forbidden LA, or is a CSG cell with a CSG ID and associated PLMN identity that are not in Allowed CSG list or in the Operator CSG list stored in the MS , then the MS shall enter the substate LIMITED-SERVICE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the MS is in manual network selection mode and no cell supporting GPRS of the selected PLMN has been found, the MS shall enter the substate NO-CELL-AVAILABLE.</p>
<h5><a name="_Toc171523819"></a>4.2.4.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Other Cases</h5>
<p>When the MM state is IDLE, the GMM substate PLMN-SEARCH shall also be entered in the following cases:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when a SIM/USIM is inserted in substate NO-IMSI;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the user has asked for a PLMN selection in any substate except NO IMSI and NO CELL AVAILABLE ;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when coverage is lost in any substate except NO IMSI and NO CELL AVAILABLE ;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Roaming is denied;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; optionally, when the MS is in automatic network selection mode and the maximum allowed number of consecutive unsuccessful attach attempts controlled by the GPRS attach attempt counter (subclause&nbsp;4.7.3) have been performed.</p>
<h4><a name="_Toc171523820"></a>4.2.4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Detailed description of the MS behaviour in state GMM-DEREGISTERED</h4>
<p>In state GMM-DEREGISTERED, the MS shall behave according to the substate. In the following subclauses, the behaviour is described for the non transient substates.</p>
<h5><a name="_Toc171523821"></a>4.2.4.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, NORMAL-SERVICE</h5>
<p>The MS:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall initiate GPRS attach or combined GPRS attach procedure if timer T3346 is not running. If timer T3346 is running, then MS shall initiate an GPRS attach or combined GPRS attach procedure on the expiry of timer T3346; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may initiate GPRS attach for emergency bearer services (UTRAN Iu mode only) even if timer T3346 is running.</p>
<h5><a name="_Toc171523822"></a>4.2.4.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, ATTEMPTING-TO-ATTACH</h5>
<p>The MS:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall initiate GPRS attach on the expiry of timers T3311, T3302, or T3346;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall initiate GPRS attach when entering a new PLMN, if timer T3346 is running and the new PLMN is not equivalent to the PLMN where the MS started timer T3346, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the location area this cell is belonging to is not in one of the lists of forbidden LAs;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may initiate GPRS attach for emergency bearer services (UTRAN Iu mode only) even if timer T3346 is running;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall initiate GPRS attach when the routing area of the serving cell has changed, if timer T3346 is not running, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the location area this cell is belonging to is not in one of the lists of forbidden LAs;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall if entry into this state was caused by b) or d) with cause "Retry upon entry into a new cell" of subclause&nbsp;4.7.3.1.5, perform GPRS attach when a new cell is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall if entry into this state was caused by c) or d) with cause different from "Retry upon entry into a new cell" of subclause&nbsp;4.7.3.1.5, not perform GPRS attach when a new cell is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall use requests for non-GPRS services from CM layers to trigger the combined GPRS attach procedure, if timer T3346 is not running and the network operates in network operation mode I. Depending on which of the timers T3311 or T3302 is running the MS shall stop the relevant timer and act as if the stopped timer has expired; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may initiate GPRS attach upon request of the upper layers to establish a PDN connection for emergency bearer services (UTRAN Iu mode only).</p>
<h5><a name="_Toc171523823"></a>4.2.4.2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, LIMITED-SERVICE</h5>
<p>The MS:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall initiate GPRS attach when a cell is entered which may provide normal service (e.g. location area is not in one of the forbidden lists); and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may initiate GPRS attach for emergency bearer services (UTRAN Iu mode only).</p>
<h5><a name="_Toc171523824"></a>4.2.4.2.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, NO-IMSI</h5>
<p>The MS:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall perform default cell selection; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may initiate GPRS attach for emergency bearer services (UTRAN Iu mode only).</p>
<h5><a name="_Toc171523825"></a>4.2.4.2.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, NO-CELL</h5>
<p>The MS shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform cell selection according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] and shall choose an appropriate substate.</p>
<h5><a name="_Toc171523826"></a>4.2.4.2.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, PLMN-SEARCH</h5>
<p>The MS shall perform PLMN selection. If a new PLMN is selected, the MS shall reset the GPRS attach attempt counter and initiate the GPRS attach procedure (see subclause&nbsp;4.7.3.1).</p>
<p>If the selected cell is known not to be able to provide normal service, the MS may initiate GPRS attach for emergency bearer services (UTRAN Iu mode only).</p>
<h5><a name="_Toc171523827"></a>4.2.4.2.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, ATTACH-NEEDED</h5>
<p>The MS shall start a GPRS attach procedure if still needed as soon as the access class control allows network contact in the selected cell.</p>
<p>The MS may initiate GPRS attach for emergency bearer services (UTRAN Iu mode only).</p>
<h5><a name="_Toc171523828"></a>4.2.4.2.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, SUSPENDED (A/Gb mode only)</h5>
<p>The MS:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall not send any user data; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall not send any signalling information.</p>
<h4><a name="_Toc171523829"></a>4.2.4.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate when back to state GMM-DEREGISTERED from another GMM state</h4>
<p>When returning to state GMM-DEREGISTERED, the MS shall select a cell as specified in 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>The substate depends on the result of the cell selection procedure, the outcome of the previously performed GMM specific procedures, on the GPRS update status of the MS, on the location area data stored in the MS and on the presence of the SIM/USIM:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if no cell has been found, the substate is NO-CELL-AVAILABLE, until a cell is found;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if no SIM/USIM is present or if the inserted SIM/USIM is considered invalid by the MS, the substate shall be NO-IMSI;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if a suitable cell supporting GPRS has been found and the PLMN or LA is not in the forbidden list, the substate shall be NORMAL-SERVICE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if a GPRS attach shall be performed (e.g. network requested reattach), the substate shall be ATTEMPTING-TO-ATTACH;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if a PLMN reselection (according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14]) is needed, the substate shall be PLMN SEARCH;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the selected cell is known not to be able to provide normal service, the substate shall be LIMITED-SERVICE.</p>
<h3><a name="_Toc171523830"></a>4.2.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Behaviour in state GMM-REGISTERED</h3>
<p>The state GMM-REGISTERED is entered when:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GMM context is established, i.e. the MS is IMSI attached for GPRS services only or for GPRS and non-GPRS services.</p>
<p>The specific behaviour of the MS in state GMM-REGISTERED is described in subclause&nbsp;4.2.5.1. The primary substate when entering the state GMM-REGISTERED is always NORMAL-SERVICE.</p>
<p>It should be noted that transitions between the various substates of GMM-REGISTERED are caused by (e.g.):</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; cell selection/reselection (see also 3GPP&nbsp;TS&nbsp;43.022 [82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98]);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; change of RA;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; loss/regain of coverage.</p>
<p>How various GMM procedures affect the GMM-REGISTERED substates is described in the detailed description of the procedures in subclause&nbsp;4.7.</p>
<h4><a name="_Toc171523831"></a>4.2.5.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Detailed description of the MS behaviour in state GMM-REGISTERED</h4>
<p>In state GMM-REGISTERED, the MS shall behave according to the substate as explained below.</p>
<h5><a name="_Toc171523832"></a>4.2.5.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, NORMAL-SERVICE</h5>
<p>The MS shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform cell selection/reselection according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98];</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; initiate normal routing area updating;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform periodic routing area updating except when attached for emergency bearer services (see subclause&nbsp;4.7.2.2); and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; receive and transmit user data and signalling information.</p>
<p>GPRS MSs in operation modes C or A shall answer to paging requests.</p>
<p>GPRS MS in operation mode B may answer to paging requests.</p>
<h5><a name="_Toc171523833"></a>4.2.5.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, SUSPENDED (A/Gb mode only)</h5>
<p>The MS:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall not send any user data;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall not send any signalling information; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall not perform cell-updates.</p>
<h5><a name="_Toc171523834"></a>4.2.5.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, UPDATE-NEEDED</h5>
<p>The MS shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not send any user data;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; not send any signalling information, unless for a routing area update procedure upon request of the upper layers to establish a PDN connection for emergency bearer services (UTRAN Iu mode only);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform cell selection/reselection according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98]; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; choose the appropriate new substate depending on the GPRS update status as soon as the access class control allows network contact in the selected cell.</p>
<h5><a name="_Toc171523835"></a>4.2.5.1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, ATTEMPTING-TO-UPDATE</h5>
<p>The MS:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall not send any user data;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall initiate routing area updating procedure on the expiry of timers T3311, T3302 or T3346;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall initiate routing area updating procedure when entering a new PLMN, if timer T3346 is running and the new PLMN is not equivalent to the PLMN where the MS started timer T3346, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the location area this cell is belonging to is not in one of the lists of forbidden LAs;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall initiate routing area updating procedure when the routing area of the serving cell has changed, if timer T3346 is not running, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the location area this cell is belonging to is not in one of the lists of forbidden LAs;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall, if entry into this state was caused by b) or d) with cause "Retry upon entry into a new cell" of subclause&nbsp;4.7.5.1.5, initiate routing area updating procedure when a new cell is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall, if entry into this state was caused by c) or d) with cause different from "Retry upon entry into a new cell" of subclause&nbsp;4.7.5.1.5, not initiate routing area updating procedure when a new cell is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall use request for non-GPRS services from CM layers to trigger the combined routing area updating procedure, if timer T3346 is not running and the network operates in network operation mode I. Depending on which of the timers T3311 or T3302 is running the MS shall stop the relevant timer and act as if the stopped timer has expired;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may use a request for an MMTEL voice call or MMTEL video call from the upper layers to initiate routing area updating procedure (Iu mode only), if timer T3346 is not running;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may initiate routing area updating procedure upon request of the upper layers to establish a PDN connection for emergency bearer services (UTRAN Iu mode only);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall initiate routing area updating procedure upon request of the upper layers to establish a PDN connection without the NAS signalling low priority indication as specified in subclause 4.7.5.1.5, item&nbsp;j), if timer T3346 is running due to a NAS request message (ROUTING AREA UPDATE REQUEST or SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority" and timer T3302 and timer T3311 are not running;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may detach locally and initiate GPRS attach for emergency bearer services even if timer T3346 is running;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall initiate routing area updating procedure in response to paging; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall not initiate the signalling procedure for GPRS detach unless the routing area of the current cell is same as the stored routing area. Optionally, the MS may perform local GPRS detach.</p>
<h5><a name="_Toc171523836"></a>4.2.5.1.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, NO-CELL-AVAILABLE</h5>
<p>The MS shall perform cell selection/reselection according to 3GPP&nbsp;TS&nbsp;43.022 [82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98]. If PSM is active, the MS can deactivate PSM at any time by activating the AS layer when the MS needs to send mobile originated signalling or user data.</p>
<h5><a name="_Toc171523837"></a>4.2.5.1.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, LIMITED-SERVICE</h5>
<p>The MS:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall perform cell selection/reselection according to 3GPP&nbsp;TS&nbsp;43.022 [82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98];</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may respond to paging (with IMSI); and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may initiate GPRS attach for emergency bearer services (UTRAN Iu mode only).</p>
<h5><a name="_Toc171523838"></a>4.2.5.1.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, ATTEMPTING-TO-UPDATE-MM</h5>
<p>The MS shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform cell selection/reselection according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98];</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; receive and transmit user data and signalling information;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; initiate routing area update indicating "combined RA/LA updating with IMSI attach" on the expiry of timers T3311 or T3302;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; initiate routing area update indicating "combined RA/LA updating with IMSI attach" when the routing area of the serving cell has changed and the location area this cell is belonging to is not in the list of forbidden LAs.</p>
<p>GPRS MSs in operation modes C or A shall answer to paging requests.</p>
<p>GPRS MS in operation mode B may answer to paging requests.</p>
<h5><a name="_Toc171523839"></a>4.2.5.1.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Substate, PLMN-SEARCH</h5>
<p>When the MM state is IDLE, the GMM substate PLMN-SEARCH may be entered if the MS is in automatic network selection mode and the maximum allowed number of consecutive unsuccessful routing area update attempts controlled by the GPRS routing area updating attempt counter (subclause&nbsp;4.7.5) have been performed. If a new PLMN is selected, the MS shall reset the routing area updating attempt counter and perform the routing area updating procedure.</p>
<p>If the selected cell is known not to be able to provide normal service, the MS may initiate GPRS attach for emergency bearer services (UTRAN Iu mode only).</p>
<h2><a name="_Toc171523840"></a>4.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM common procedures</h2>
<p>As described in subclause&nbsp;4.1.1, a MM common procedure can be initiated at any time whilst a RR connection exists between the network and the mobile station.</p>
<h3><a name="_Toc171523841"></a>4.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TMSI reallocation procedure</h3>
<h4><a name="_Toc171523842"></a>4.3.1.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; General</h4>
<p>The purpose of the TMSI reallocation procedure is to provide identity confidentiality, i.e. to protect a user against being identified and located by an intruder (see 3GPP&nbsp;TS&nbsp;42.009&nbsp;[5], 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13] and 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]).</p>
<p>If the identity confidentiality service is applied for an IMSI, a Temporary Mobile Subscriber Identity (TMSI) is used for identification within the radio interface signalling procedures.</p>
<p>In a network supporting the feature 'Intra domain connection of RAN nodes to multiple CN nodes' a TMSI shall be allocated to each IMSI attached mobile station. See 3GPP&nbsp;TS&nbsp;23.236&nbsp;[94], subclause&nbsp;4.3.</p>
<p>The structure of the TMSI is specified in 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10]. The TMSI has significance only within a location area. Outside the location area it has to be combined with the Location Area Identifier (LAI) to provide for an unambiguous identity.</p>
<p>Usually the TMSI reallocation is performed at least at each change of a location area. (Such choices are left to the network operator).</p>
<p>The reallocation of a TMSI can be performed either by a unique procedure defined in this subclause or implicitly by a location updating procedure using the TMSI. The implicit reallocation of a TMSI is described together with that procedure.</p>
<p>If a TMSI provided by a mobile station is unknown in the network e.g. due to a data base failure, the network may require the mobile station to provide its International Mobile Subscriber Identity (IMSI). In this case the identification procedure (see subclause&nbsp;4.3.3) should be used before the TMSI reallocation procedure may be initiated.</p>
<p>The TMSI reallocation can be initiated by the network at any time whilst a RR connection exists between the network and the mobile station.</p>
<p>NOTE&nbsp;1:&nbsp; Usually the TMSI reallocation is performed in ciphered mode.</p>
<p>NOTE&nbsp;2:&nbsp; Normally the TMSI reallocation will take place in conjunction with another procedure, e.g. at location updating or at call setup (see 3GPP&nbsp;TS&nbsp;29.002&nbsp;[37]).</p>
<p>NOTE&nbsp;3:&nbsp; The explicit TMSI reallocation procedure is started by the network only if the mobile station is updated in the current location area or if a location updating procedure is ongoing for that particular mobile station, or if the network wishes to send a non-broadcast LAI according to 3GPP&nbsp;TS&nbsp;23.236&nbsp;[94] to the mobile station.</p>
<h4><a name="_Toc171523843"></a>4.3.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TMSI reallocation initiation by the network</h4>
<p>The network initiates the TMSI reallocation procedure by sending a TMSI REALLOCATION COMMAND message to the mobile station and starts the timer T3250.</p>
<p>The TMSI REALLOCATION COMMAND message contains a new combination of TMSI and LAI allocated by the network or a LAI and the IMSI if the used TMSI shall be deleted. Usually the TMSI-REALLOCATION COMMAND message is sent to the mobile station using a RR connection in ciphered mode (see 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13] and 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]).</p>
<h4><a name="_Toc171523844"></a>4.3.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TMSI reallocation completion by the mobile station</h4>
<p>Upon receipt of the TMSI REALLOCATION COMMAND message the mobile station:</p>
<ol>
<li>a) shall stores the Location Area Identifier (LAI) in the SIM/USIM;</li>
<li>b) shall enter the sub-state NORMAL SERVICE if the MS is in the sub-state ATTEMPTING TO UPDATE;</li>
<li>c) if the received identity is the IMSI of the relevant mobile station, shall delete any TMSI;</li>
<li>d) if the received identity is a TMSI, shall store the TMSI in the SIM/USIM; and</li>
<li>e) shall send a TMSI REALLOCATION COMPLETE message to the network.</li>
</ol>
<h4><a name="_Toc171523845"></a>4.3.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TMSI reallocation completion in the network.</h4>
<p>Upon receipt of the TMSI REALLOCATION COMPLETE message, the network stops the timer T3250 and either considers the new TMSI as valid or, if an IMSI was sent to the mobile station, considers the old TMSI as deleted.</p>
<p>If the RR connection is no more needed, then the network will request the RR sublayer to release it (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;3.5 and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<h4><a name="_Toc171523846"></a>4.3.1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases in the mobile station</h4>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) RR connection failure:</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall consider the new TMSI and new LAI, if any, as valid and the old TMSI and old LAI as deleted as soon as a TMSI REALLOCATION COMMAND message or another message containing a new TMSI (e.g. LOCATION UPDATING ACCEPT message) is correctly received. Any RR connection failure at a later stage shall not have any impact on the TMSI and LAI storage.</p>
<h4><a name="_Toc171523847"></a>4.3.1.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the network side</h4>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) RR connection failure:</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the RR connection is lost before the TMSI REALLOCATION COMPLETE message is received, the network shall release all MM connections, if any. Furthermore, the network should consider both the old and the new TMSI as occupied for a certain recovery time.</p>
<p>During this period the network:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may use the IMSI for paging or network originated transactions on the CM layer. Upon response from the mobile station the TMSI reallocation procedure shall be restarted;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may consider the new TMSI as valid if it is used by the mobile station; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may use the identification procedure followed by a new TMSI reallocation procedure, if the mobile station uses the old TMSI (see subclause&nbsp;4.3.3).</p>
<p>Other implementations are possible, e.g. the network may page with the old TMSI.</p>
<ol>
<li>b) Expiry of timer T3250:</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The TMSI reallocation procedure is supervised by the timer T3250 (see example in figure&nbsp;4.1). At expiry of timer T3250 the network may release the RR connection. In this case, the network shall abort the reallocation procedure release all MM connections if any, and follow the rules for the case a as described above.</p>
<p>Figure 4.1/3GPP TS 24.008: TMSI reallocation sequence</p>
<h3><a name="_Toc171523848"></a>4.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication procedure</h3>
<h4><a name="_Toc171523849"></a>4.3.2a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication procedure used for a UMTS authentication challenge</h4>
<p>The purpose of the authentication procedure is fourfold (see 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]):</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; First to permit the network to check whether the identity provided by the mobile station is acceptable or not;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Second to provide parameters enabling the mobile station to calculate a new UMTS ciphering key;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Third to provide parameters enabling the mobile station to calculate a new UMTS integrity key;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Fourth to permit the mobile station to authenticate the network.</p>
<p>The cases where the authentication procedure should be used are defined in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a].</p>
<p>The UMTS authentication procedure is always initiated and controlled by the network. However, there is the possibility for the MS to reject the UMTS authentication challenge sent by the network.</p>
<p>The MS shall support the UMTS authentication challenge, if a USIM is inserted.</p>
<p>A UMTS security context is established in the MS and the network when a UMTS authentication challenge is performed in A/Gb mode or in Iu mode. After a successful UMTS authentication, the UMTS ciphering key, the UMTS integrity key, the GSM ciphering key and the ciphering key sequence number, are stored both in the network and the MS. Furthermore, in A/Gb mode both the ME and the network may derive and store a GSM Kc<sub>128</sub> as part of the UMTS security context as described in the subclause&nbsp;4.3.2.3a.</p>
<h4><a name="_Toc171523850"></a>4.3.2b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication Procedure used for a GSM authentication challenge</h4>
<p>The purpose of the authentication procedure is twofold (see 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13]):</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; First to permit the network to check whether the identity provided by the mobile station is acceptable or not;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Second to provide parameters enabling the mobile station to calculate a new GSM ciphering key.</p>
<p>The cases where the authentication procedure should be used are defined in 3GPP&nbsp;TS&nbsp;42.009&nbsp;[5].</p>
<p>The authentication procedure is always initiated and controlled by the network. GSM authentication challenge shall be supported by a ME supporting GERAN or UTRAN.</p>
<p>A GSM security context is established in the MS and the network when a GSM authentication challenge is performed in A/Gb mode or in Iu mode. However, in Iu mode the MS shall not accept a GSM authentication challenge, if a USIM is inserted. After a successful GSM authentication, the GSM ciphering key and the ciphering key sequence number, are stored both in the network and the MS.</p>
<h4><a name="_Toc171523851"></a>4.3.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication request by the network</h4>
<p>The network initiates the authentication procedure by transferring an AUTHENTICATION REQUEST message across the radio interface and starts the timer T3260. The AUTHENTICATION REQUEST message contains the parameters necessary to calculate the response parameters (see 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13] (in case of GSM authentication challenge) and 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a] (in case of an UMTS authentication challenge)).</p>
<p>In a GSM authentication challenge, the AUTHENTICATION REQUEST message also contains the GSM ciphering key sequence number allocated to the key which may be computed from the given parameters.</p>
<p>In a UMTS authentication challenge, the AUTHENTICATION REQUEST message also contains the ciphering key sequence number allocated to the key set of UMTS ciphering key, UMTS integrity key and GSM ciphering key which may be computed from the given parameters. Furthermore, the ciphering key sequence number is also linked to a GSM Kc<sub>128</sub> if after the authentication procedure the network in A/Gb mode selects an A5 ciphering algorithm that requires a 128-bit ciphering key.</p>
<h4><a name="_Toc171523852"></a>4.3.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication response by the mobile station</h4>
<p>The mobile station shall be ready to respond upon an AUTHENTICATION REQUEST message at any time whilst a RR connection exists. With exception of the cases described in subclause&nbsp;4.3.2.5.1, it shall process the challenge information and send back an AUTHENTICATION RESPONSE message to the network.</p>
<p>If a SIM is inserted in the MS, the MS shall ignore the Authentication Parameter AUTN IE if included in the AUTHENTICATION REQUEST message and shall proceed as in case of a GSM authentication challenge. It shall not perform the authentication of the network described in subclause&nbsp;4.3.2.5.1.</p>
<p>In a GSM authentication challenge, the new GSM ciphering key calculated from the challenge information shall overwrite the previous GSM ciphering key and any previously stored UMTS ciphering key and UMTS integrity key shall be deleted. The new GSM ciphering key shall be stored on the SIM/USIM together with the ciphering key sequence number.</p>
<p>In a UMTS authentication challenge, the new UMTS ciphering key, the new GSM ciphering key and the new UMTS integrity key calculated from the challenge information shall overwrite the previous UMTS ciphering key, GSM ciphering key and UMTS integrity key. The new UMTS ciphering key, GSM ciphering key and UMTS integrity key are stored on the USIM together with the ciphering key sequence number. Furthermore, in A/Gb mode when after the authentication procedure an A5 ciphering algorithm that requires a 128-bit ciphering key is taken into use, then a new GSM Kc<sub>128</sub> shall also be calculated as described in the subclause&nbsp;4.3.2.3a.</p>
<p>The SIM/USIM will provide the mobile station with the authentication response, based upon the authentication challenge given from the ME. A UMTS authentication challenge will result in the USIM passing a RES to the ME. A GSM authentication challenge will result in the SIM/USIM passing a SRES to the ME.</p>
<p>A ME supporting UMTS authentication challenge may support the following procedure:</p>
<p>In order to avoid a synchronisation failure, when the mobile station receives an AUTHENTICATION REQUEST message, the mobile station shall store the received RAND together with the RES returned from the USIM in the volatile memory and associate it with CS domain. When the MS receives a subsequent AUTHENTICATION REQUEST message, if the stored RAND value for the CS domain is equal to the new received value in the AUTHENTICATION REQUEST message, then the mobile station shall not pass the RAND to the USIM, but shall immediately send the AUTHENTICATION RESPONSE message with the stored RES for the CS domain. If, for the CS domain, there is no valid stored RAND in the mobile station or the stored RAND is different from the new received value in the AUTHENTICATION REQUEST message, the mobile station shall pass the RAND to the USIM, shall override any previously stored RAND and RES with the new ones and start, or reset and restart timer T3218.</p>
<p>The RAND and RES values stored in the mobile station shall be deleted and timer T3218, if running, shall be stopped:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; upon receipt of a SECURITY MODE COMMAND (Iu mode only), <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CIPHERING MODE COMMAND (A/Gb mode only),<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CM_SERVICE_ACCEPT,<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CM_SERVICE_REJECT,<br /> &nbsp;&nbsp; LOCATION_UPDATING_ACCEPT <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; or AUTHENTICATION REJECT message;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; upon expiry of timer T3218; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the mobile station enters the MM state MM IDLE or NULL.</p>
<h4><a name="_Toc171523853"></a>4.3.2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication processing in the network</h4>
<p>Upon receipt of the AUTHENTICATION RESPONSE message, the network stops the timer T3260 and checks the validity of the response (see 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13] in case of a GSM authentication challenge respective 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a] in case of an UMTS authentication challenge).</p>
<p>Upon receipt of the AUTHENTICATION FAILURE message, the network stops the timer T3260. In Synch failure case, the core network may renegotiate with the HLR/AuC and provide the MS with new authentication parameters.</p>
<h4><a name="_Toc171523854"></a>4.3.2.3a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 128-bit circuit-switched GSM ciphering key</h4>
<p>The ME and the network may derive and store a 128-bit circuit-switched GSM ciphering key or GSM Kc<sub>128 </sub>from an established UMTS security context. If the GSM Kc<sub>128</sub> exists, then it is also part of the UMTS security context.</p>
<p>The ME with a USIM in use shall compute a new GSM Kc<sub>128</sub> using the UMTS ciphering key and the UMTS integrity key from an established UMTS security context as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. The new GSM Kc<sub>128</sub> shall be stored only in the ME. The ME shall overwrite the existing GSM Kc<sub>128</sub> with the new GSM Kc<sub>128</sub>. The ME shall delete the GSM Kc<sub>128</sub> at switch off, when the USIM is disabled as well as under the conditions identified in the subclause&nbsp;4.1.2.2&nbsp;and&nbsp;4.3.2.4. The ME with a USIM in use shall apply the GSM Kc<sub>128</sub> when in A/Gb mode an A5 ciphering algorithm that requires a 128-bit ciphering key is taken into use.</p>
<p>The network shall compute the GSM Kc<sub>128</sub> using the UMTS integrity key and the UMTS ciphering key from an established UMTS security context as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a] only when in A/Gb mode an A5 ciphering algorithm that requires a 128-bit ciphering key is to be used.</p>
<h4><a name="_Toc171523855"></a>4.3.2.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ciphering key sequence number</h4>
<p>The security parameters for authentication and ciphering are tied together in sets.</p>
<p>In a GSM authentication challenge, from a challenge parameter RAND both the authentication response parameter SRES and the GSM ciphering key can be computed given the secret key associated to the IMSI.</p>
<p>In a UMTS authentication challenge, from a challenge parameter RAND, the authentication response parameter RES and the UMTS ciphering key and the UMTS integrity key can be computed given the secret key associated to the IMSI. In addition, in the USIM a GSM ciphering key can be computed from the UMTS ciphering key and the UMTS integrity key by means of an unkeyed conversion function. Furthermore, in A/Gb mode if an A5 ciphering algorithm that requires a 128-bit ciphering key is taken into use, then a GSM Kc<sub>128</sub> shall also be calculated as described in the subclause&nbsp;4.3.2.3a.</p>
<p>In order to allow start of ciphering on a RR connection without authentication, the ciphering key sequence numbers are introduced. The ciphering key sequence number is managed by the network in the way that the AUTHENTICATION REQUEST message contains the ciphering key sequence number allocated to the GSM ciphering key (in case of a GSM authentication challenge) or the UMTS ciphering key and the UMTS integrity key (in case of a UMTS authentication challenge) which may be computed from the RAND parameter carried in that message.</p>
<p>If an authentication procedure has been completed successfully and a ciphering key sequence number is stored in the network, the network shall include a different ciphering key sequence number in the AUTHENTICATION REQUEST message when it intiates a new authentication procedure.</p>
<p>The mobile station stores the ciphering key sequence number with the GSM ciphering key (in case of a GSM authentication challenge) and the UMTS ciphering key and the UMTS integrity key (in case of a UMTS authentication challenge) and indicates to the network in the first message (LOCATION UPDATING REQUEST, CM SERVICE REQUEST, PAGING RESPONSE, CM RE-ESTABLISHMENT REQUEST) which ciphering key sequence number the stored GSM ciphering key (in case of a GSM authentication challenge) or set of UMTS ciphering, UMTS integrity, derived GSM ciphering key, and potentially the derived GSM Kc<sub>128</sub> (in case of a UMTS authentication challenge) has.</p>
<p>When the deletion of the ciphering key sequence number is described this also means that the associated GSM ciphering key, the UMTS ciphering key and the UMTS integrity key shall be considered as invalid and also the GSM Kc<sub>128</sub> shall be deleted if any (i.e. the established GSM security context or the UMTS security context is no longer valid).</p>
<p>In A/Gb mode, the network may choose to start ciphering with the stored GSM ciphering key or GSM Kc<sub>128</sub> (under the restrictions given in 3GPP&nbsp;TS&nbsp;42.009&nbsp;[5]) if the stored ciphering key sequence number and the one given from the mobile station are equal.</p>
<p>NOTE 1:&nbsp; The decision of starting ciphering with the GSM ciphering key or the GSM Kc<sub>128</sub> depends on whether the network indicates in the CIPHERING MODE COMMAND message an A5 ciphering algorithm which requires a 64 or 128-bit ciphering key as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a].</p>
<p>In Iu mode, the network may choose to start ciphering and integrity with the stored UMTS ciphering key and UMTS integrity key (under the restrictions given in 3GPP&nbsp;TS&nbsp;42.009&nbsp;[5] and 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]) if the stored ciphering key sequence number and the one given from the mobile station are equal.</p>
<p>NOTE 2:&nbsp; In some specifications the term KSI (Key Set Identifier) might be used instead of the term ciphering key sequence number.</p>
<h4><a name="_Toc171523856"></a>4.3.2.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication not accepted by the network</h4>
<p>If the authentication response (RES or SRES) is not valid, the network response depends upon the type of identity used by the mobile station in the first message, that is:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the TMSI was used; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the IMSI was used.</p>
<p>If the TMSI has been used, the network may decide to initiate the identification procedure. If the IMSI given by the mobile station then differs from the one the network had associated with the TMSI, the authentication should be restarted with the correct parameters. If the IMSI provided by the MS is the expected one (i.e. authentication has really failed), the network should send an AUTHENTICATION REJECT message to the mobile station.</p>
<p>If the IMSI has been used, or the network decides not to try the identification procedure, an AUTHENTICATION REJECT message should be transferred to the mobile station.</p>
<p>After having sent this message, all MM connections in progress (if any) are released and the network should initiate the RR connection release procedure described in subclause&nbsp;3.5.of 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] (A/Gb mode only), 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] (UTRAN Iu mode only), or in 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111] (GERAN Iu mode only).</p>
<p>Upon receipt of an AUTHENTICATION REJECT message,</p>
<ol>
<li>a) if the message has been successfully integrity checked by the lower layers, the mobile station shall set the update status in the SIM/USIM to U3 ROAMING NOT ALLOWED, delete from the SIM/USIM the stored TMSI, LAI and ciphering key sequence number. The SIM/USIM shall be considered as invalid until switching off or the SIM/USIM is removed. If the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value. If the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</li>
<li>b) if the message is received without integrity protection, then the MS shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see subclause&nbsp;4.1.1.6A). Additionally, the MS shall:</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events and the counter has a value less than an MS implementation-specific maximum value, proceed as specified in subclause&nbsp;4.1.1.6A, list item 1.a) for the case a LOCATION UPDATING REJECT message is received without integrity protection. Additionally, if the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall increment this counter; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; otherwise proceed as specified under list item a) above for the case that the message has been successfully checked by the lower layers.</p>
<p>List item b) above is also applicable, if the message is received in A/Gb mode.</p>
<p>If the AUTHENTICATION REJECT message is received in the state IMSI DETACH INITIATED the mobile station shall follow subclause&nbsp;4.3.4.3.</p>
<p>If the AUTHENTICATION REJECT message is received in any other state the mobile station shall abort any MM specific, MM connection establishment or call re-establishment procedure, stop any of the timers T3210, T3230, T3214 or T3216 (if they were running), release all MM connections (if any), start timer T3240 and enter the state WAIT FOR NETWORK COMMAND, expecting the release of the RR connection. If the RR connection is not released within a given time controlled by the timer T3240, the mobile station shall abort the RR connection. In both cases, either after a RR connection release triggered from the network side or after a RR connection abort requested by the MS-side, the MS enters state MM IDLE, substate NO IMSI.</p>
<h5><a name="_Toc171523857"></a>4.3.2.5.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication not accepted by the MS</h5>
<p>In a UMTS authentication challenge, the authentication procedure is extended to allow the MS to check the authenticity of the core network. Thus allowing, for instance, detection of false base station.</p>
<p>Following a UMTS authentication challenge, the MS may reject the core network, on the grounds of an incorrect AUTN parameter (see 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]). This parameter contains two possible causes for authentication failure:</p>
<ol>
<li>a) MAC code failure:</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS considers the MAC code (supplied by the core network in the AUTN parameter) to be invalid, it shall send an AUTHENTICATION FAILURE message to the network, with the reject cause 'MAC failure'. The MS shall then follow the procedure described in subclause&nbsp;4.3.2.6 (c).</p>
<ol>
<li>b) SQN failure:</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS considers the SQN (supplied by the core network in the AUTN parameter) to be out of range, it shall send a AUTHENTICATION FAILURE message to the network, with the reject cause 'Synch failure' and a re-synchronization token AUTS provided by the USIM (see 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]). The MS shall then follow the procedure described in subclause&nbsp;4.3.2.6 (d).</p>
<p>In UMTS, an MS with a USIM inserted shall reject the authentication challenge if no Authentication Parameter AUTN IE was present in the AUTHENTICATION REQUEST message (i.e. a GSM authentication challenge has been received when the MS expects a UMTS authentication challenge). In such a case, the MS shall send the AUTHENTICATION FAILURE message to the network, with the reject cause "GSM authentication unacceptable". The MS shall then follow the procedure described in subclause&nbsp;4.3.2.6 (c).</p>
<p>If the MS returns an AUTHENTICATION_FAILURE message to the network, the MS shall delete any previously stored RAND and RES and shall stop timer T3218, if running.</p>
<h4><a name="_Toc171523858"></a>4.3.2.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases</h4>
<p>(a) RR connection failure:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon detection of a RR connection failure before the AUTHENTICATION RESPONSE message is received, the network shall release all MM connections (if any) and abort any ongoing MM specific procedure.</p>
<p>(b) Expiry of timer T3260:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The authentication procedure is supervised on the network side by the timer T3260. At expiry of this timer the network may release the RR connection. In this case the network shall abort the authentication procedure and any ongoing MM specific procedure, release all MM connections if any, and initiate the RR connection release procedure described in subclause&nbsp;3.5 of 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] (A/Gb mode only), 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] (UTRAN Iu mode only), or in 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111] (GERAN Iu mode only).</p>
<p>(c) Authentication failure (reject cause "MAC failure" or "GSM authentication unacceptable"):</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall send an AUTHENTICATION FAILURE message, with reject cause "MAC failure" or "GSM authentication unacceptable" according to subclause&nbsp;4.3.2.5.1, to the network and start timer T3214. Furthermore, the MS shall stop any of the retransmission timers that are running (e.g. T3210, T3220 or T3230). Upon the first receipt of an AUTHENTICATION FAILURE message from the MS with reject cause "MAC failure" or "GSM authentication unacceptable", the network may initiate the identification procedure described in subclause&nbsp;4.3.3. This is to allow the network to obtain the IMSI from the MS. The network may then check that the TMSI originally used in the authentication challenge corresponded to the correct IMSI. Upon receipt of the IDENTITY REQUEST message from the network, the MS shall send the IDENTITY RESPONSE message.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon receipt of an AUTHENTICATION FAILURE message from the MS with reject cause "MAC failure" or "GSM authentication unacceptable", the network may also terminate the authentication procedure (see subclause&nbsp;4.3.2.5).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the TMSI/IMSI mapping in the network was incorrect, the network should respond by sending a new AUTHENTICATION REQUEST message to the MS. Upon receiving the new AUTHENTICATION REQUEST message from the network, the MS shall stop the timer T3214, if running, and then process the challenge information as normal. If theTMSI/IMSI mapping in the network was correct, the network should terminate the authentication procedure by sending an AUTHENTICATION REJECT message.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid SQN and MAC is received), the MS shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3210, T3220 or T3230), if they were running and stopped when the MS received the first failed AUTHENTICATION REQUEST message.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives the second AUTHENTICATION REQUEST message while T3214 is running, and the MAC value cannot be resolved or the message contains a GSM authentication challenge, the MS shall follow the procedure specified in this subclause (c), starting again from the beginning. If the SQN is invalid, the MS shall proceed as specified in (d).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; It can be assumed that the source of the authentication challenge is not genuine (authentication not accepted by the MS) if any of the following occur:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the timer T3214 expires;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS detects any combination of the authentication failures: "MAC failure", "invalid SQN", and "GSM authentication unacceptable", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only, if the authentication challenges causing the second and third authentication failure are received by the MS, while the timer T3214 or T3216 started after the previous authentication failure is running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer T3214, if the timer is running and the MS detects an RR connection failure or the network releases the RR connection.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; When it has been deemed by the MS that the source of the authentication challenge is not genuine (i.e. authentication not accepted by the MS), the MS shall behave as described in subclause&nbsp;4.3.2.6.1.</p>
<p>&nbsp;</p>
<p>Figure 4.2/3GPP TS 24.008: Authentication Failure Procedure <br /> (reject cause "MAC failure" or "GSM authentication unacceptable")</p>
<p>(d) Authentication failure (reject cause "synch failure"):</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall send an AUTHENTICATION FAILURE message, with reject cause "synch failure", to the network and start the timer T3216. Furthermore, the MS shall stop any of the retransmission timers that are running (e.g. T3210, T3220 or T3230). Upon the first receipt of an AUTHENTICATION FAILURE message from the MS with the reject cause "synch failure", the network shall use the returned AUTS parameter from the authentication failure parameter IE in the AUTHENTICATION FAILURE message, to re-synchronise. The re-synchronisation procedure requires the VLR/MSC to delete all unused authentication vectors for that IMSI and obtain new vectors from the HLR. When re-synchronisation is complete, the network shall initiate the authentication procedure. Upon receipt of the AUTHENTICATION REQUEST message, the MS shall stop the timer T3216, if running.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon receipt of two consecutive AUTHENTICATION FAILURE messages from the MS with reject cause "synch failure", the network may terminate the authentication procedure by sending an AUTHENTICATION REJECT message.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network is validated successfully (a new AUTHENTICATION REQUEST message is received which contains a valid SQN and MAC) while T3216 is running, the MS shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3210, T3220 or T3230), if they were running and stopped when the MS received the first failed AUTHENTICATION REQUEST message.</p>
<p>If the MS receives the second AUTHENTICATION REQUEST message while T3216 is running, and the MAC value cannot be resolved or the message contains a GSM authentication challenge, the MS shall proceed as specified in (c); if the SQN is invalid, the MS shall follow the procedure specified in this subclause (d), starting again fom the beginning.</p>
<p>The MS shall deem that the network has failed the authentication check and behave as described in subclause&nbsp;4.3.2.6.1, if any of the following occurs:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the timer T3216 expires;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS detects any combination of the authentication failures: "MAC failure", "invalid SQN", and "GSM authentication unacceptable", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only, if the authentication challenges causing the second and third authentication failure are received by the MS, while the timer T3214 or T3216 started after the previous authentication failure is running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer T3216, if the timer is running and the MS detects an RR connection failure or the network releases the RR connection.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; When it has been deemed by the MS that the source of the authentication challenge is not genuine (i.e. authentication not accepted by the MS), the MS shall behave as described in subclause&nbsp;4.3.2.6.1.</p>
<p>Figure 4.2a/3GPP TS 24.008: Authentication Failure Procedure (reject cause "Synch failure")</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon receipt of an AUTHENTICATION REJECT message, the mobile station shall perform the actions as specified in subclause&nbsp;4.3.2.5. If an MS has an MM connection for an emergency call established or is establishing an MM connection for an emergency call when timer T3214 or T3216 expires, the MS shall not deem that the network has failed the authentication check and not behave as described in subclause&nbsp;4.3.2.6.1.</p>
<h5><a name="_Toc171523859"></a>4.3.2.6.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MS behaviour towards a network that has failed the authentication procedure</h5>
<p>If the MS deems that the network has failed the authentication check, then it shall request RR or RRC to release the RR connection and the PS signalling connection, if any, and bar the active cell or cells (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c], 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] and 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84]). The MS shall start any retransmission timers (e.g. T3210, T3220 or T3230), if they were running and stopped when the MS received the first AUTHENTICATION REQUEST message containing an invalid MAC or invalid SQN, or no AUTN when a UMTS authentication challenge was expected.</p>
<h4><a name="_Toc171523860"></a>4.3.2.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of keys at intersystem change from Iu mode to A/Gb mode</h4>
<p>At inter-system change from Iu mode to A/Gb mode, ciphering may be started (see 3GPP TS 44.018 [84]) without any new authentication procedure. Deduction of the appropriate security key for ciphering in A/Gb mode, depends on the current GSM/UMTS security context stored in the MS and the network.</p>
<p>The ME shall handle the GSM ciphering key and a potential GSM Kc<sub>128</sub> according to table&nbsp;4.3.2.7.1.</p>
<p>Table 4.3.2.7.1/3GPP TS 24.008: Inter-system change from Iu mode to A/Gb mode</p>
<table>
<tbody>
<tr>
<td width="243">
<p>Security context established in MS and network in Iu mode</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>At inter-system change to A/Gb mode:</p>
</td>
</tr>
<tr>
<td width="243">
<p>GSM security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall apply the stored GSM ciphering key that was received from the GSM security context residing in the SIM/USIM during the latest successful ciphering mode setting or security mode control procedure before the inter-system change.</p>
<p>&nbsp;</p>
</td>
</tr>
<tr>
<td width="243">
<p>UMTS security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>If an A5 algorithm is taken into use that requires a 64-bit ciphering key, then an ME shall apply the stored GSM ciphering key that was derived by the USIM from the UMTS ciphering key and the UMTS integrity key and provided by the USIM during the latest successful ciphering mode setting or security mode control procedure before the inter-sytem change.</p>
<p>If an A5 algorithm is taken into use that requires a 128-bit ciphering key, then an ME shall apply the GSM Kc<sub>128</sub> derived by the ME from the UMTS ciphering key and the UMTS integrity key (see 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]) provided by USIM during the lastest successful ciphering mode setting or security mode control procedure before the inter-system change (see subclause&nbsp;4.3.2.3a).</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A USIM with UMTS security context, passes the UMTS ciphering key, the UMTS integrity key and the derived GSM ciphering key to the ME independent on the current radio access being UTRAN or GERAN.</p>
<h4><a name="_Toc171523861"></a>4.3.2.7a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Use of established security contexts</h4>
<p>In A/Gb mode, in the case of an established GSM security context, the GSM ciphering key shall be loaded from the SIM/USIM and taken into use by the ME when any valid CIPHERING MODE COMMAND is received during an RR connection (the definition of a valid CIPHERING MODE COMMAND message is given in 3GPP TS 44.018 [84] subclause&nbsp;3.4.7.2).</p>
<p>In A/Gb mode, in the case of an established UMTS security context, the GSM ciphering key shall be loaded from the USIM and taken into use by the MS when a valid CIPHERING MODE COMMAND is received during an RR connection (the definition of a valid CIPHERING MODE COMMAND message is given in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;3.4.7.2) which indicates an A5 ciphering algorithm that requires a 64-bit ciphering key. The network shall derive a GSM ciphering key from the UMTS ciphering key and the UMTS integrity key by using the conversion function named "c3" defined in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a].</p>
<p>In A/Gb mode, in the case of an established UMTS security context, the UMTS ciphering key and the UMTS integrity key shall be loaded from the USIM in order for the ME to derive the GSM Kc<sub>128</sub> (see 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]) and shall be taken into use by the ME when a valid CIPHERING MODE COMMAND is received during an RR connection (the definition of a valid CIPHERING MODE COMMAND message is given in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;3.4.7.2) which indicates an A5 ciphering algorithm that requires a 128-bit ciphering key. The network shall derive a GSM Kc<sub>128</sub> from the UMTS ciphering key and the UMTS integrity as defined in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a].</p>
<p>In Iu mode, in the case of an established GSM security context, the ME shall derive a UMTS ciphering key and a UMTS integrity key from the GSM ciphering key by using the conversion functions named "c4" and "c5" defined in 3GPP&nbsp;TS&nbsp;33.102 [5a]. The GSM ciphering key shall be loaded from the SIM/USIM and the derived UMTS ciphering key and UMTS integrity key shall be taken into use by the MS when a valid SECURITY MODE COMMAND indicating CS domain is received during an RR connection (the definition of a valid SECURITY MODE COMMAND message is given in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]). The network shall derive a UMTS ciphering key and a UMTS integrity key from the GSM ciphering key by using the conversion functions named "c4" and "c5" defined in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a].</p>
<p>In Iu mode, in the case of an established UMTS security context, the UMTS ciphering key and UMTS integrity key shall be loaded from the USIM and taken into use by the MS when a valid SECURITY MODE COMMAND indicating CS domain is received during a RR connection (the definition of a valid SECURITY MODE COMMAND message is given in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]).</p>
<p>In Iu mode and A/Gb mode, if the MS received a valid SECURITY MODE COMMAND indicating CS domain in Iu mode or a valid CIPHERING MODE COMMAND in A/Gb mode before the network initiates a new Authentication procedure and establishes a new GSM/UMTS security context, the new keys are taken into use in the MS when a new valid SECURITY MODE COMMAND indicating CS domain in Iu mode, or a new valid CIPHERING MODE COMMAND in A/Gb mode, is received during the RR connection. In case of Iu mode to Iu mode handover, A/Gb mode to A/Gb mode handover, or inter-system change to A/Gb mode, the MS and the network shall continue to use the key from the old key set until a new valid SECURITY MODE COMMAND indicating CS domain in Iu mode, or a new valid CIPHERING MODE COMMAND in A/Gb mode, is received during the RR connection. In case of inter-system change to Iu mode, the MS and the network shall continue to use the keys from the old key set until the second valid SECURITY MODE COMMAND indicating CS domain is received during the RR connection.</p>
<p>NOTE&nbsp;1:&nbsp; If the MS received a valid SECURITY MODE COMMAND indicating CS domain in Iu mode or a valid CIPHERING MODE COMMAND in A/Gb mode before the inter-system change to Iu mode occurs, the first SECURITY MODE COMMAND message after the inter-system change, which indicates CS domain and includes only an Integrity protection mode IE, is initiated by the UTRAN without receipt of a corresponding RANAP security mode control procedure from the MSC/VLR. The only purpose of this SECURITY MODE COMMAND message is to activate the integrity protection, but not to load a new key set from the SIM/USIM (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]).</p>
<p>NOTE&nbsp;2:&nbsp; If the MS did not receive any valid SECURITY MODE COMMAND indicating CS domain in Iu mode or any valid CIPHERING MODE COMMAND in A/Gb mode before the inter-system change to Iu mode occurs, the first SECURITY MODE COMMAND message after the inter-system change, which indicates CS domain, is initiated by the UTRAN on receipt of a RANAP security mode control procedure from the MSC/VLR. The purpose of this SECURITY MODE COMMAND message is to load a key set from the SIM/USIM and to activate either integrity protection or ciphering and integrity protection (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]).</p>
<h4><a name="_Toc171523862"></a>4.3.2.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of keys at intersystem change from A/Gb mode to Iu mode</h4>
<p>At inter-system change from A/Gb mode to Iu mode, ciphering and integrity may be started (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) without any new authentication procedure. Deduction of the appropriate security keys for ciphering and integrity check in Iu mode, depends on the current GSM/UMTS security context stored in the MS and the network.</p>
<p>The ME shall handle the UMTS ciphering key and the UMTS integrity key according to table&nbsp;4.3.2.8.1.</p>
<p>Table 4.3.2.8.1/3GPP TS 24.008: Inter-system change from A/Gb mode to Iu mode</p>
<table>
<tbody>
<tr>
<td width="243">
<p>Security context established in MS and network in A/Gb mode</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>At inter-system change to Iu mode:</p>
</td>
</tr>
<tr>
<td width="243">
<p>GSM security context</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall derive the UMTS ciphering key and the UMTS integrity key from the stored GSM ciphering key that was provided by the SIM/USIM during the latest successful ciphering mode setting or security mode control procedure before the inter-system change. The conversion functions named "c4" and "c5" in 3GPP TS 33.102 [5a] are used for this purpose.</p>
<p>&nbsp;</p>
</td>
</tr>
<tr>
<td width="243">
<p>UMTS security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall apply the stored UMTS ciphering key and the stored UMTS integrity key that were received from the UMTS security context residing in the USIM during the latest successful ciphering mode setting or security mode control procedure before the inter-system change.</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A USIM with UMTS security context, passes the UMTS ciphering key, the UMTS integrity key and the derived GSM ciphering key to the ME independent on the current radio access being UTRAN or GERAN.</p>
<h4><a name="_Toc171523863"></a>4.3.2.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Void</h4>
<h4><a name="_Toc171523864"></a>4.3.2.10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Derivation of keys at SRVCC or vSRVCC handover from S1 mode</h4>
<h5><a name="_Toc171523865"></a>4.3.2.10.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; General</h5>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The keys CK<sub>SRVCC </sub>and IK<sub>SRVCC </sub>apply for both SRVCC and vSRVCC.</p>
<h5><a name="_Toc171523866"></a>4.3.2.10.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PDN connection with integrity protection</h5>
<p>At PS to CS domain change from S1 mode due to SRVCC or vSRVCC handover of a PDN connection for which the "null integrity protection algorithm" EIA0 has not been used (see 3GPP&nbsp;TS&nbsp;23.216&nbsp;[126]), when the MS receives the command to perform handover, the MS shall derive a UMTS security context for the CS domain from the current EPS security context.</p>
<p>The MS shall set the CKSN of the derived UMTS security context to the value of the eKSI of the EPS security context and derive security keys CK<sub>SRVCC</sub> and IK<sub>SRVCC</sub> as specified in 3GPP&nbsp;TS&nbsp;33.401&nbsp;[123]. The ME shall also derive the security key GSM ciphering key Kc from CK<sub>SRVCC</sub> and IK<sub>SRVCC</sub> using the conversion function c3 as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. The MS shall apply these derived security keys, handle the START<sub>CS</sub> value as specified in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and replace an already established UMTS security context for the CS domain, if any, in the USIM, when the SRVCC or vSRVCC handover from S1 mode has been completed successfully.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Because of deriving a new UMTS security context for the CS domain, a new GSM ciphering key needs also to be derived from the new derived UMTS security keys for the CS domain (i.e. CK<sub>SRVCC</sub> and IK<sub>SRVCC</sub>). Note that the new GSM ciphering key is also part of the new UMTS security context for the CS domain as well, as any old GSM ciphering key stored in the USIM and in the ME, belongs to an old UMTS security context for the CS domain and can no longer be used.</p>
<p>The network shall replace an already established UMTS security context for the CS domain, if any, when the SRVCC or vSRVCC handover from S1 mode has been completed successfully.</p>
<p>&nbsp;</p>
<p>If the SRVCC or vSRVCC handover from S1mode has not been completed successfully, the MS and the network shall delete the new derived GSM or UMTS security context for the CS domain. Additionally, the network shall delete the already established GSM or UMTS security context for the CS domain, if the CKSN of the already established GSM or UMTS security context is equal to the CKSN of the new derived GSM or UMTS security context for the CS domain.</p>
<h5><a name="_Toc171523867"></a>4.3.2.10.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PDN connection without integrity protection</h5>
<p>At PS to CS domain change from S1 mode due to SRVCC handover of a PDN connection for emergency bearer services for which the "null integrity protection algorithm" EIA0 has been used while in S1 mode, the MS and the network shall not perform key derivation.</p>
<h4><a name="_Toc171523868"></a>4.3.2.11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Derivation of keys at SRVCC handover from Iu mode to Iu mode</h4>
<h5><a name="_Toc171523869"></a>4.3.2.11.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PDN connection with integrity protection</h5>
<p>At PS to CS domain change from Iu mode to Iu mode due to SRVCC handover of a PDN connection for which integrity protection has been activated, ciphering and integrity may be started (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) without any new authentication procedure. Deduction of the appropriate security keys for ciphering and integrity check in Iu mode, depends on the current GSM or UMTS security context for the PS domain stored in the MS and the network.</p>
<p>The ME shall handle the UMTS ciphering key and the UMTS integrity key according to table&nbsp;4.3.2.11.1.</p>
<p>Table 4.3.2.11.1/3GPP TS 24.008: SRVCC handover from Iu mode to Iu mode</p>
<table>
<tbody>
<tr>
<td width="243">
<p>Security context for the PS domain established in MS and network in Iu mode</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>At inter-system change to Iu mode:</p>
</td>
</tr>
<tr>
<td width="243">
<p>GSM security context</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall derive the GSM ciphering key (Kc&rsquo;) from the stored GPRS GSM ciphering key, which was provided by the SIM/USIM during the latest successful authentication, and the NONCE received in the command to perform handover (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) using the key derivation function specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. The ME shall use the derived GSM ciphering key (Kc&rsquo;) to derive the UMTS security keys UMTS ciphering key (CK&rsquo;) and UMTS integrity key (IK&rsquo;). The conversion functions named "c4" and "c5" in 3GPP TS 33.102 [5a] are used for this purpose. The MS shall set the CKSN of the derived GSM security context for the CS domain to the value of the GPRS CKSN of the GSM security context for PS domain. Furthermore, the ME shall apply the new derived UMTS security keys and replace an already established GSM security context for the CS domain, if any, in the SIM/USIM, when the SRVCC handover from Iu mode has been completed successfully. Furthermore, the MS shall handle the START<sub>CS</sub> value as specified in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<p>&nbsp;</p>
</td>
</tr>
<tr>
<td width="243">
<p>UMTS security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall derive the UMTS security keys UMTS ciphering key (CK&rsquo;) and UMTS integrity key (IK&rsquo;) from the GPRS UMTS ciphering key and the GPRS UMTS integrity key, which were received from the UMTS security context for the PS domain residing in the USIM, and the NONCE received in the command to perform handover (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. The ME shall use the derived UMTS security keys to derive the GSM ciphering key (Kc&rsquo;) using the "c3" conversion function as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. The MS shall set the CKSN of the derived UMTS security context for the CS domain to the value of the KSI of the UMTS security context for PS domain. Furthermore, the ME shall apply the derived UMTS security keys and replace an already established UMTS security context for the CS domain, if any, in the USIM, when the SRVCC handover from Iu mode has been completed successfully. Furthermore, the MS shall handle the START<sub>CS</sub> value as specified in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>NOTE&nbsp;1:&nbsp; For the case of an established UMTS security context for the PS domain, because of deriving a new UMTS security context for the CS domain, a new GSM ciphering key needs to be derived from the new derived UMTS security keys (i.e. CK' and IK'). Note that the new GSM ciphering key is also part of the new UMTS security context for the CS domain, and therefore any old GSM ciphering key stored in the USIM and in the ME belongs to an old UMTS security context for the CS domain and can no longer be taken into use.</p>
<p>The network shall replace an already established GSM or UMTS security context for the CS domain, if any, when the SRVCC handover from Iu mode to Iu mode has been completed successfully.</p>
<p>If the SRVCC handover from Iu mode to Iu mode has not been completed successfully, the MS and the network shall delete the new derived GSM or UMTS security context for the CS domain. Additionally, the network shall delete the already established GSM or UMTS security context for the CS domain, if the CKSN of the already established GSM or UMTS security context is equal to the CKSN of the new derived GSM or UMTS security context for the CS domain.</p>
<h5><a name="_Toc171523870"></a>4.3.2.11.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PDN connection without integrity protection</h5>
<p>At PS to CS domain change from Iu mode to Iu mode due to SRVCC handover of a PDN connection for emergency bearer services for which integrity protection has not been activated before the SRVCC handover, the MS and the network shall not perform key derivation.</p>
<h4><a name="_Toc171523871"></a>4.3.2.12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Derivation of keys at SRVCC handover from Iu mode to A/Gb mode</h4>
<h5><a name="_Toc171523872"></a>4.3.2.12.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PDN connection with integrity protection</h5>
<p>At PS to CS domain change from Iu mode to A/Gb mode due to SRVCC handover of a PDN connection for which integrity protection has been activated, ciphering may be started (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84]) without any new authentication procedure. Deduction of the appropriate security key for ciphering in A/Gb mode, depends on the current GSM or UMTS security context for the PS domain stored in the MS and the network.</p>
<p>The ME shall handle the GSM ciphering key according to table&nbsp;4.3.2.12.1.</p>
<p>Table 4.3.2.12.1/3GPP TS 24.008: SRVCC handover from Iu mode to A/Gb mode</p>
<table>
<tbody>
<tr>
<td width="243">
<p>Security context for the PS domain established in MS and network in Iu mode</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>At inter-system change to A/Gb mode:</p>
</td>
</tr>
<tr>
<td width="243">
<p>GSM security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall derive the GSM ciphering key (Kc&rsquo;) from the stored GPRS GSM ciphering key, which was provided by the SIM/USIM during the latest successful authentication, and the NONCE received in the command to perform handover (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) using the key derivation function specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. The MS shall set the CKSN of the derived GSM security context for the CS domain to the value of the GPRS CKSN of the GSM security context for PS domain. Furthermore, the ME shall apply the new derived GSM ciphering key and replace an already established GSM security context for the CS domain, if any, in the SIM/USIM when the SRVCC handover from Iu mode has been completed successfully.</p>
</td>
</tr>
<tr>
<td width="243">
<p>UMTS security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall derive the UMTS security keys UMTS ciphering key (CK&rsquo;) and UMTS integrity key (IK&rsquo;) from the GPRS UMTS ciphering key and GPRS UMTS integrity key, which were received from the UMTS security context for the PS domain residing in the USIM, and the NONCE received in the command to perform handover (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. The ME shall use the derived UMTS security keys to derive the GSM ciphering key (Kc&rsquo;) using the "c3" conversion function as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. Furthermore, the MS shall set the CKSN of the derived UMTS security context for the CS domain to the value of the KSI of the UMTS security context for PS domain.</p>
<p>If an A5 algorithm is taken into use that requires a 64-bit long ciphering key, then the ME shall apply the new derived GSM ciphering key.</p>
<p>If an A5 algorithm is taken into use that requires a 128-bit long ciphering key, then the ME shall use the derived UMTS security keys CK' and IK' to derive a GSM Kc<sub>128</sub> (see 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]). After that, the ME shall apply the new derived GSM Kc<sub>128.</sub></p>
<p>Furthermore, the ME shall replace an already established UMTS security context for the CS domain, if any, in the USIM, when the SRVCC handover from Iu mode has been completed successfully.</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>The network shall replace an already established GSM or UMTS security context for the CS domain, if any, when the SRVCC handover from Iu mode to A/Gb mode has been completed successfully.</p>
<p>If the SRVCC handover from Iu mode to A/Gb mode has not been completed successfully, the MS and the network shall delete the new derived GSM or UMTS security context for the CS domain. Additionally, the network shall delete the already established GSM or UMTS security context for the CS domain, if the CKSN of the already established GSM or UMTS security context is equal to the CKSN of the new derived GSM or UMTS security context for the CS domain.</p>
<h5><a name="_Toc171523873"></a>4.3.2.12.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PDN connection without integrity protection</h5>
<p>At PS to CS domain change from Iu mode to A/Gb mode due to SRVCC handover of a PDN connection for emergency bearer services for which integrity protection has not been activated while in Iu mode, the MS and the network shall not perform key derivation.</p>
<h4><a name="_Toc171523874"></a>4.3.2.13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Derivation of keys at CS to PS SRVCC handover from A/Gb mode to Iu mode</h4>
<p>At change from A/Gb mode to Iu mode due to CS to PS SRVCC handover (see 3GPP&nbsp;TS&nbsp;23.216&nbsp;[126]), the MS shall derive a UMTS security context for the PS domain from the current GSM or UMTS security context for the CS domain.</p>
<p>At change from A/Gb mode to Iu mode due to CS to PS SRVCC handover, ciphering may be started and integrity protection shall be started (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) without any new authentication procedure. Derivation of the appropriate security keys for ciphering and integrity protection for the PS domain in Iu mode depends on the current GSM or UMTS security context for the CS domain stored in the MS and the network.</p>
<p>The ME shall handle the PS UMTS ciphering key and the PS UMTS integrity key according to table&nbsp;4.3.2.13.1.</p>
<p>Table 4.3.2.13.1/3GPP TS 24.008: CS to PS SRVCC handover from A/Gb mode to Iu mode</p>
<table>
<tbody>
<tr>
<td width="243">
<p>Security context for the CS domain established in MS and network in A/Gb mode</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>At inter-system change to Iu mode:</p>
</td>
</tr>
<tr>
<td width="243">
<p>GSM security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall derive the GPRS ciphering key (Kc') from the stored GSM ciphering key, which was provided by the SIM/USIM during the latest successful authentication, and the NONCE<sub>MSC</sub> received in the command to perform handover (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) using the key derivation function specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. The ME shall set the GPRS CKSN' of the derived GPRS security context (Kc') for the PS domain to the value of the GSM CKSN of the GSM security context for CS domain. The ME shall use the derived GPRS ciphering key (Kc') to derive the PS UMTS security keys PS UMTS ciphering key (CK') and PS UMTS integrity key (IK') for the PS domain. The conversion functions named "c4" and "c5" in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a] are used for this purpose. The ME shall associate the derived keys PS UMTS ciphering key (CK') and PS UMTS integrity key (IK') for the PS domain with a KSI' which shall be set to the value of the GPRS CKSN of the derived GPRS security context (Kc') for the PS domain. Furthermore, the ME shall apply the new derived PS UMTS security keys (CK', IK') and replace an already established GPRS security context for the PS domain, if any, by overwriting the stored GPRS Kc and GPRS CKSN with the derived GPRS Kc' and GPRS CKSN' in both the ME and the SIM/USIM, when the CS to PS SRVCC handover has been completed successfully. Furthermore, the MS shall handle the START<sub>PS</sub> value as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a] and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c].</p>
<p>&nbsp;</p>
</td>
</tr>
<tr>
<td width="243">
<p>UMTS security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall derive the PS UMTS security keys PS UMTS ciphering key (CK') and PS UMTS integrity key (IK') from the CS UMTS ciphering key and the CS UMTS integrity key, which were received from the UMTS security context for the CS domain residing in the USIM, and the NONCE<sub>MSC</sub> received in the command to perform handover (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. The ME shall set the KSI' of the derived PS UMTS security context (CK' and IK') for the PS domain to the value of the KSI of the CS UMTS security context for the CS domain. The ME shall use the derived PS UMTS security keys (CK' and IK') to derive the GPRS ciphering key (Kc') using the "c3" conversion function as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. The ME shall set the CKSN' associated with the derived GPRS ciphering key (Kc') to the value of the KSI of the derived PS UMTS security context (CK' and IK') for the PS domain. Furthermore, the ME shall apply the derived PS UMTS security keys (CK' and IK') and replace an already established UMTS security context for the PS domain, if any, by overwriting the stored UMTS PS CK, UMTS PS IK, UMTS PS KSI, GPRS Kc,and GPRS CKSN with the derived UMTS PS CK', UMTS PS IK', UMTS PS KSI', GPRS Kc' and GPRS CKSN', in both the ME and the USIM, when the CS to PS SRVCC handover has been completed successfully. Furthermore, the MS shall handle the START<sub>PS</sub> value as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a] and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c].</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>The network shall replace an already established GSM or UMTS security context for the PS domain, if any, when the CS to PS SRVCC handover from A/Gb mode to Iu mode has been completed successfully.</p>
<p>If the CS to PS SRVCC handover from A/Gb mode to Iu mode has not been completed successfully, the MS and the network shall delete the new derived GSM or UMTS security context for the PS domain. Additionally, the network shall delete the already established GSM or UMTS security context for the PS domain, if the GPRS CKSN of the already established GSM or UMTS security context is equal to the GPRS CKSN of the new derived GSM or UMTS security context for the PS domain.</p>
<h4><a name="_Toc171523875"></a>4.3.2.14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Derivation of keys at 5G-SRVCC from NG-RAN to UTRAN</h4>
<h5><a name="_Toc171523876"></a>4.3.2.14.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PDU session with integrity protection</h5>
<p>At 5G-SRVCC from NG-RAN to UTRAN handover of a PDU session for which the "null integrity protection algorithm" 5G-IA0 has not been used (see 3GPP&nbsp;TS&nbsp;23.216&nbsp;[126]), when the MS receives the command to perform handover, the MS shall derive a new K<sub>ASME_SRVCC</sub> from K<sub>AMF </sub>as specified in 3GPP&nbsp;TS&nbsp;33.501&nbsp;[170].</p>
<p>The MS shall set the CKSN of the derived UMTS security context to the value of the eKSI associated with the new K<sub>ASME_SRVCC</sub> and derive security keys CK<sub>SRVCC</sub> and IK<sub>SRVCC</sub> from the new K<sub>ASME_SRVCC</sub> as specified in 3GPP&nbsp;TS&nbsp;33.401&nbsp;[123]. The MS shall apply these derived security keys, handle the START<sub>CS</sub> value as specified in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and replace an already established UMTS security context for the CS domain, if any, in the USIM, when the 5G-SRVCC handover from NG-RAN to UTRAN has been completed successfully.</p>
<p>The network shall replace an already established UMTS security context for the CS domain, if any, when the 5G-SRVCC handover from NG-RAN to UTRAN has been completed successfully.</p>
<p>If the 5G-SRVCC handover from NG-RAN to UTRAN has not been completed successfully, the MS and the network shall delete the new derived UMTS security context for the CS domain. Additionally, the network shall delete the already established UMTS security context for the CS domain, if the CKSN of the already established UMTS security context is equal to the CKSN of the new derived UMTS security context for the CS domain.</p>
<h5><a name="_Toc171523877"></a>4.3.2.14.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PDU session without integrity protection</h5>
<p>At the 5G-SRVCC from NG-RAN to UTRAN handover of an emergency PDU connection for which the "null integrity protection algorithm" 5G-IA0 has been used while in N1 mode, the MS and the network shall not perform key derivation.</p>
<h3><a name="_Toc171523878"></a>4.3.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Identification procedure</h3>
<h4><a name="_Toc171523879"></a>4.3.3.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; General</h4>
<p>The identification procedure is used by the network to request a mobile station to provide specific identification parameters to the network e.g. International Mobile Subscriber Identity (IMSI), International Mobile Equipment Identity (IMEI). IMEI and IMSI definition and structure are specified in &nbsp;3GPP&nbsp;TS&nbsp;23.003&nbsp;[10].</p>
<h4><a name="_Toc171523880"></a>4.3.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Identity request by the network</h4>
<p>The network initiates the identification procedure by sending an IDENTITY REQUEST message to the mobile station and starting the timer T3270 (see figure&nbsp;4.3). The IDENTITY REQUEST message specifies the requested identification parameters in the Identity type information element.</p>
<h4><a name="_Toc171523881"></a>4.3.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Identification response by the mobile station</h4>
<p>The mobile station shall be ready to respond to an IDENTITY REQUEST message at any time whilst a RR connection exists.</p>
<p>Upon receipt of the IDENTITY REQUEST message the mobile station shall send an IDENTITY RESPONSE message. The IDENTITY RESPONSE message shall contain the identification parameters as requested by the network.</p>
<p>Upon receipt of the IDENTITY REQUEST message with the Identity type IE indicating that P-TMSI, RAI and P-TMSI signature are being requested, an MS that supports S1 mode shall handle the IDENTITY RESPONSE message as follows:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the TIN indicates "GUTI" and the MS holds a valid GUTI allocated by an MME, the MS shall map the GUTI into a P-TMSI, P‑TMSI signature and RAI as specified in 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10]. The MS shall indicate the P-TMSI in the Mobile identity IE. In addition, the MS shall include the mapped RAI in the Routing area identification IE and the mapped P-TMSI signature in the P-TMSI signature IE. In addition, the MS shall include the P-TMSI type IE with P-TMSI type set to "mapped P-TMSI".</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the TIN indicates "P-TMSI" or "RAT‑related TMSI" and the MS holds a valid P-TMSI and RAI, the MS shall indicate the P-TMSI in the Mobile identity IE and shall indicate the RAI in the Routing area identification IE. In addition, the MS shall include the P-TMSI type IE with P-TMSI type set to "native P-TMSI". If the MS holds a valid P-TMSI signature, it shall include it in the P-TMSI signature IE.</p>
<p>If the MS does not support S1 mode, it shall handle the IDENTITY RESPONSE message as follows:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS holds a valid P-TMSI and RAI, the MS shall indicate the P-TMSI in the Mobile identity IE and shall indicate the RAI in the Routing area identification IE. In addition, the MS shall include the P-TMSI type IE with P-TMSI type set to "native P-TMSI". If the MS holds a valid P-TMSI signature, it shall include it in the P-TMSI signature IE.</p>
<p>Upon receipt of the IDENTITY RESPONSE message, the network shall stop timer T3270.</p>
<h4><a name="_Toc171523882"></a>4.3.3.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases in the mobile station</h4>
<p>The following abnormal case can be identified:</p>
<ol>
<li>a) Requested identity is not available</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS cannot encode the requested identity in the IDENTITY RESPONSE message, e.g. because no valid SIM is available, then it shall encode the identity type as "no identity".</p>
<h4><a name="_Toc171523883"></a>4.3.3.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the network side</h4>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) RR connection failure:</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon detection of a RR connection failure before the IDENTITY RESPONSE message is received, the network shall release all MM connections (if any) and abort any ongoing MM specific procedure.</p>
<ol>
<li>b) Expiry of timer T3270:</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The identification procedure is supervised by the network by the timer T3270. At expiry of the timer T3270 the network may release the RR connection. In this case, the network shall abort the identification procedure and any ongoing MM specific procedure, release all MM connections if any, and initiate the RR connection release procedure as described in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;3.5, 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] (UTRAN Iu mode only), or in 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111] (GERAN Iu mode only).</p>
<p>Figure 4.3/3GPP TS 24.008: Identification sequence</p>
<h3><a name="_Toc171523884"></a>4.3.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IMSI detach procedure</h3>
<h4><a name="_Toc171523885"></a>4.3.4.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; General</h4>
<p>The IMSI detach procedure may be invoked by a mobile station if the mobile station is deactivated or if the Subscriber Identity Module (see 3GPP&nbsp;TS&nbsp;42.017&nbsp;[7] and 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) is detached from the mobile station or as part of the eCall inactivity procedure defined in subclause&nbsp;4.4.7.</p>
<p>In A/Gb mode and GERAN Iu mode, the network indicates whether the IMSI detach/attach procedures are required by using the ATT flag which is broadcast in the L3-RR SYSTEM INFORMATION TYPE 3 message on the BCCH (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;10.5.2.11). The mobile station shall use the value of the ATT flag that was broadcast when the mobile station was in the MM IDLE state.</p>
<p>In UTRAN Iu mode, the network indicates whether the IMSI detach/attach procedures are required by using the ATT flag which is included in the CS domain specific system information element (see subclause&nbsp;10.5.1.12.2). The mobile station shall use the latest received value of the ATT flag.</p>
<p>If a RR connection exists and the ATT flag indicates that the IMSI detach/attach procedures are not required, the MM sublayer will release locally any ongoing MM connections before releasing the RR connection. If an MM specific procedure is active, the release of the RR connection may be delayed until the MM specific procedure is complete.</p>
<p>The IMSI detach procedure causes the mobile station to be indicated as inactive in the network.</p>
<p>The mobile station is allowed to initiate the IMSI detach procedure even if the timer T3246 is running.</p>
<p>The network proceeds with the IMSI detach procedure even if NAS level mobility management congestion control is active.</p>
<h4><a name="_Toc171523886"></a>4.3.4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IMSI detach initiation by the mobile station</h4>
<p>The IMSI detach procedure consists only of the IMSI DETACH INDICATION message sent from the mobile station to the network. The mobile station then starts timer T3220 and enters the MM sublayer state IMSI DETACH INITIATED.</p>
<p>If no RR connection exists, the MM sublayer within the mobile station will request the RR sublayer to establish a RR connection. If establishment of the RR connection is not possible because a suitable cell is not (or not yet) available then, the mobile station shall try for a period of at least 5 seconds and for not more than a period of 20 seconds to find a suitable cell. If a suitable cell is found during this time then, the mobile station shall request the RR sublayer to establish an RR connection, otherwise the IMSI detach is aborted. For:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a shared GERAN in A/Gb mode, if the MS is a GERAN network sharing supporting MS, the chosen PLMN identity shall be indicated to the GERAN in the IMSI DETACH INDICATION message using the Skip Indicator IE as specified in subclause&nbsp;10.3.1 and;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a shared UTRAN, the chosen PLMN identity shall be indicated to the UTRAN in the RRC INITIAL DIRECT TRANSFER message (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<p>If a RR connection exists, the MM sublayer will release locally any ongoing MM connections before the IMSI DETACH INDICATION message is sent.</p>
<p>The IMSI detach procedure may not be started if a MM specific procedure is active. If possible, the IMSI detach procedure is then delayed until the MM specific procedure is finished, else the IMSI detach is omitted.</p>
<h4><a name="_Toc171523887"></a>4.3.4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IMSI detach procedure in the network</h4>
<p>When receiving an IMSI DETACH INDICATION message, the network may set an inactive indication for the IMSI. No response is returned to the mobile station. After reception of the IMSI DETACH INDICATION message the network shall release locally any ongoing MM connections, and start the normal RR connection release procedure (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;3.5 (A/Gb mode only), 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] (UTRAN Iu mode only), or in 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111] (GERAN Iu mode only)).</p>
<p>Only applicable for a network supporting VGCS: If an IMSI DETACH INDICATION message is received from the talking mobile station in a group call while the network is in service state MM CONNECTION ACTIVE (GROUP TRANSMIT MODE), the network shall release locally the ongoing MM connection and then go to the service state GROUP CALL ACTIVE.</p>
<h4><a name="_Toc171523888"></a>4.3.4.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IMSI detach completion by the mobile station</h4>
<p>Timer T3220 is stopped when the RR connection is released. The mobile station should, if possible, delay the local release of the channel to allow a normal release from the network side until T3220 timeout. If this is not possible (e.g. detach at power down) the RR sublayer on the mobile station side should be aborted.</p>
<h4><a name="_Toc171523889"></a>4.3.4.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases</h4>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) Lower layer failure</li>
</ol>
<p>If the establishment of an RR connection is unsuccessful, or the RR connection is lost, the IMSI detach is aborted by the mobile station.</p>
<ol>
<li>b) Access barred because of access class control or EAB</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The signalling procedure for IMSI detach shall not be started. The MS starts the signalling procedure as soon as possible and if still necessary, i.e. when the barred state is removed or because of a cell change, or performs a local detach immediately or after an implementation dependent time.</p>
<p>Figure 4.4/3GPP TS 24.008: IMSI detach sequence</p>
<h3><a name="_Toc171523890"></a>4.3.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abort procedure</h3>
<p>The abort procedure may be invoked by the network to abort any on-going MM connection establishment or already established MM connection. The mobile station shall treat ABORT message as compatible with current protocol state only if it is received when at least one MM connection exists or an MM connection is being established.</p>
<h4><a name="_Toc171523891"></a>4.3.5.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abort procedure initiation by the network</h4>
<p>The abort procedure consists only of the ABORT message sent from the network to the mobile station. Before the sending of the ABORT message the network shall locally release any ongoing MM connection. After the sending the network may start the normal RR connection release procedure.</p>
<p>The Cause information element indicates the reason for the abortion. The following cause values may apply:</p>
<p># 6:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Illegal ME</p>
<p>#17:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Network failure</p>
<h4><a name="_Toc171523892"></a>4.3.5.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abort procedure in the mobile station</h4>
<p>At the receipt of the ABORT message the mobile station shall abort any MM connection establishment or call re-establishment procedure and release all MM connections (if any). If cause value #6 is received the mobile station shall delete any TMSI, LAI and ciphering key sequence number stored in the SIM/USIM, set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause&nbsp;4.1.2.2) and consider the SIM/USIM invalid until switch off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value. As a consequence the mobile station enters state MM IDLE, substate NO IMSI after the release of the RR connection.</p>
<p>The mobile station shall then wait for the network to release the RR connection - see subclause&nbsp;4.5.3.1.</p>
<h3><a name="_Toc171523893"></a>4.3.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM information procedure</h3>
<p>The MM information message support is optional in the network.</p>
<p>The MM information procedure may be invoked by the network at any time during an RR connection.</p>
<h4><a name="_Toc171523894"></a>4.3.6.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM information procedure initiation by the network</h4>
<p>The MM information procedure consists only of the MM INFORMATION message sent from the network to the mobile station. During an RR connection, the network shall send none, one, or more MM INFORMATION messages to the mobile station. If more than one MM INFORMATION message is sent, the messages need not have the same content.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The network may be able to select particular instants where it can send the MM INFORMATION message without adding delay to, or interrupting, any CM layer transaction, e.g. immediately after the AUTHENTICATION REQUEST message.</p>
<h4><a name="_Toc171523895"></a>4.3.6.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM information procedure in the mobile station</h4>
<p>When the mobile station (supporting the MM information message) receives an MM INFORMATION message, it shall accept the message and optionally use the contents to update appropriate information stored within the mobile station.</p>
<p>If the mobile station does not support the MM information message the mobile station shall ignore the contents of the message and return an MM STATUS message with cause #97.</p>
<h2><a name="_Toc171523896"></a>4.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM specific procedures</h2>
<p>A MM specific procedure can only be started if no other MM specific procedure is running or no MM connection exists between the network and the mobile station. The end of the running MM specific procedure or the release of all MM connections have to be awaited before a new MM specific procedure can be started.</p>
<p>During the lifetime of a MM specific procedure, if a MM connection establishment is requested by a CM entity, this request will either be rejected or be delayed until the running MM specific procedure is terminated (this depends on the implementation).</p>
<p>Any MM common procedure (except IMSI detach) may be initiated during a MM specific procedure.</p>
<p>Unless it has specific permission from the network (follow-on proceed) the mobile station side should await the release of the RR connection used for a MM specific procedure before a new MM specific procedure or MM connection establishment is started.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The network side may use the same RR connection for MM connection management.</p>
<h3><a name="_Toc171523897"></a>4.4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Location updating procedure</h3>
<p>The location updating procedure is a general procedure which is used for the following purposes:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; normal location updating (described in this subclause);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; periodic updating (see subclause&nbsp;4.4.2); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; IMSI attach (see subclause&nbsp;4.4.3).</p>
<p>The normal location updating procedure is used to update the registration of the actual Location Area of a mobile station in the network. The location updating type information element in the LOCATION UPDATING REQUEST message shall indicate normal location updating. The conditions under which the normal location updating procedure is used by a mobile station in the MM IDLE state are defined for each service state in subclause&nbsp;4.2.2.</p>
<p>Only applicable for mobile stations supporting VGCS listening or VBS listening: A mobile station in RR group receive mode is in the MM IDLE state, substate RECEIVING GROUP CALL (NORMAL SERVICE) or RECEIVING GROUP CALL (LIMITED SERVICE). To perform a location updating, the MS in RR group receive mode shall leave the group receive mode, establish an independent dedicated RR connection to perform the location updating as described above and return to the RR group receive mode afterwards.</p>
<p>The MS shall also start the normal location updating procedure:</p>
<ol>
<li>a) if the network indicates that the mobile station is unknown in the VLR as a response to MM connection establishment request;</li>
<li>b) void</li>
<li>c) when the MS, configured to use CS fallback and SMS over SGs, or SMS over SGs only, enters a GERAN or UTRAN cell in network operation mode II and timer T3423 has expired or is in the GERAN or UTRAN cell in network operation mode II when timer T3423 expires;</li>
</ol>
<p>NOTE&nbsp;1:&nbsp; Timer T3423 is specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120].</p>
<ol>
<li>d) when the MS, configured to use CS fallback and SMS over SGs, or SMS over SGs only, enters a GERAN or UTRAN cell after intersystem change from S1 mode to Iu or A/Gb mode, if timer T3346 is running, and the location area of the current cell is the same as the stored location area;</li>
</ol>
<p>NOTE&nbsp;2:&nbsp; If inter-system change is due to a mobile originating CS call, the location updating procedure can be performed after the RR connection is released unless the MS moves back to E-UTRAN.</p>
<ol>
<li>e) when the MS is both IMSI attached for GPRS and non-GPRS services and enters a new routing area where the network operates in network operation mode I and timer T3346 is running.</li>
<li>f) when the network is operating in network operation mode&nbsp;I, timer T3346 is running, timer T3246 is not running, and due to manual CSG selection the MS has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the Allowed CSG list or in the Operator CSG list of the MS;</li>
<li>g) when due to a manual CSG selection the MS has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the MS's Allowed CSG list or in the MS's Operator CSG list;</li>
<li>h) when the network is operating in network operation mode I, T3346 is running, update status is not U1 UPDATED and the user manually selects the current PLMN; or</li>
<li>i) when the MS is configured to use CS fallback and SMS over SGs, or SMS over SGs only, and the TIN indicates "GUTI", enters a GERAN or UTRAN cell after intersystem change from S1 mode to Iu or A/Gb mode in NMO II and timer T3412 is not running.</li>
</ol>
<p>If the MS, configured to use CS fallback and SMS over SGs, enters a GERAN or UTRAN cell, after intersystem change from S1 mode to Iu or A/Gb mode due to CS fallback, and the location area of the current cell is not available, the MS may initiate the location updating procedure.</p>
<p>When the MS supporting N1 mode in MS operation modes A or B moves from NG-RAN coverage to GERAN coverage, or from NG-RAN coverage to UTRAN coverage, and the network operates in network operation mode II, the MS may intiate the normal location updating procedure.</p>
<p>To limit the number of consecutive unsuccessful location updating attempts made, an attempt counter is used. The detailed handling of the attempt counter is described in subclauses&nbsp;4.4.4.5 to 4.4.4.9.</p>
<p>The mobile equipment shall contain a list of "forbidden location areas for roaming", as well as a list of "forbidden location areas for regional provision of service". These lists shall be erased when the MS is switched off or when the SIM/USIM is removed, and periodically (with period in the range 12 to 24 hours). When the lists are erased, the MS performs a cell selection according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98]. The location area identification received on the BCCH that triggered the location updating request shall be added to the suitable list whenever a LOCATION AREA UPDATING REJECT message is received with the cause "Roaming not allowed in this location area", "Location Area not allowed", or "No suitable cells in Location Area". The lists shall accommodate each 10 or more location area identifications. When the list is full and a new entry has to be inserted, the oldest entry shall be deleted.</p>
<p>In a shared network, the MS shall choose one of the PLMN identities as specified in 3GPP TS 23.122 [14]. The MS shall construct the Location Area Identification of the cell from this chosen PLMN identity and the LAC received on the BCCH. If the constructed LAI is different from the stored LAI, the MS shall initiate the location updating procedure. For:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a shared GERAN, in A/Gb mode, the chosen PLMN identity shall be indicated to the GERAN in the LOCATION UPDATING REQUEST message using the Skip Indicator IE as specified in subclause&nbsp;10.3.1.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a shared UTRAN, the chosen PLMN identity shall be indicated to the UTRAN in the RRC INITIAL DIRECT TRANSFER message (see 3GPP TS 25.331 [23c]).</p>
<p>For GERAN Iu mode, network sharing is not supported.</p>
<p>Whenever a LOCATION UPDATING REJECT message with the cause "PLMN not allowed" is received by the MS, the PLMN identity used to construct the LAI which triggered the location updating procedure shall be stored in the "forbidden PLMN list" and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. Whenever a LOCATION UPDATING REJECT message is received by the MS with the cause "Roaming not allowed in this location area", "Location Area not allowed", or "No suitable cells in Location Area", the constructed LAI which triggered the location updating procedure shall be stored in the suitable list.</p>
<p>The cell selection processes in the different states are described in 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;45.008&nbsp;[34].</p>
<p>The location updating procedure is always initiated by the mobile station.</p>
<p>In the case that the mobile station is initiating an emergency call but, due to cell re-selection or redirection by the network, it moves to a different LAI then the mobile station may delay the location updating procedure in the new LA until after the emergency call is completed.</p>
<h3><a name="_Toc171523898"></a>4.4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Periodic updating</h3>
<p>Periodic updating may be used to notify periodically the availability of the mobile station to the network. Periodic updating is performed by using the location updating procedure. The location updating type information element in the LOCATION UPDATING REQUEST message shall indicate periodic updating.</p>
<p>The procedure is controlled by the timer T3212 in the mobile station. The MS indicates in the MS network feature support IE whether it supports the extended value for timer T3212. If the MS receives the <em>Per MS T3212</em> IE in the LOCATION UPDATING ACCEPT message, the MS shall use this IE to determine the value of T3212 instead of the value of T3212 that is broadcast. If the MS does not receive the <em>Per MS T3212</em> IE in the LOCATION UPDATING ACCEPT message, the MS shall use the value of T3212 that is broadcast . If the timer is not already started, the timer is started each time the mobile station enters the MM IDLE substate NORMAL SERVICE or ATTEMPTing TO UPDATE. When the MS leaves the MM Idle State the timer T3212 shall continue running until explicitly stopped.</p>
<p>The timer is stopped (shall be set to its initial value for the next start) when:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a LOCATION UPDATING ACCEPT or LOCATION UPDATING REJECT message is received;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; an AUTHENTICATION REJECT message is received;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the first MM message is received, or security mode setting is completed in the case of MM connection establishment, except when the most recent service state is LIMITED SERVICE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the mobile station has responded to paging and thereafter has received the first correct layer 3 message except RR message;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the mobile station is deactivated (i.e. equipment powered down or SIM/USIM removed).</p>
<p>When the timer T3212 expires, the location updating procedure is started and the timer shall be set to its initial value for the next start. If the mobile station is in other state than MM Idle when the timer expires the location updating procedure is delayed until the MM Idle State is entered.</p>
<p>The conditions under which the periodic location updating procedure is used by a mobile station in the MM IDLE state are defined for each service state in subclause&nbsp;4.2.2.</p>
<p>If the mobile station is in service state NO CELL AVAILABLE, LIMITED SERVICE, PLMN SEARCH or PLMN SEARCH-NORMAL SERVICE when the timer expires the location updating procedure is delayed until this service state is left.</p>
<p>In A/Gb mode and GERAN Iu mode, the (periodic) location updating procedure is not started if the BCCH information at the time the procedure is triggered indicates that periodic location shall not be used. The timeout value is broadcasted in the L3-RR SYSTEM INFORMATION TYPE 3 message on the BCCH, in the Control channel description IE, see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;10.5.2.11.</p>
<p>In UTRAN Iu mode, the (periodic) location updating procedure is not started if the information on BCCH or in the last received dedicated system information at the time the procedure is triggered indicates that periodic location shall not be used. The timeout value is included in the CS domain specific system information element.</p>
<p>The T3212 timeout value shall not be changed in the NO CELL AVAILABLE, LIMITED SERVICE, PLMN SEARCH and PLMN SEARCH-NORMAL SERVICE states.</p>
<p>If the MS, configured to use CS fallback and SMS over SGs, or SMS over SGs only, enters a GERAN or UTRAN cell after intersystem change from S1 mode to Iu or A/Gb mode in NMO II, the TIN indicates "GUTI", and the location area of the current cell is the same as the stored location area, the MS shall start timer T3212, with a value set to the shorter of the values of the remaining value of timer T3412, and the broadcast T3212 timeout value.</p>
<p>When the MS supporting N1 mode in MS operation modes A or B moves from NG-RAN coverage to GERAN coverage, or from NG-RAN coverage to UTRAN coverage, the network operates in network operation mode II, the location area of the current cell is the same as the stored location area, the broadcast value of T3212 does not indicate "deactivated" and the T3212 has expired, the MS may intiate the periodic location updating procedure.</p>
<p>When a change of the broadcast T3212 timeout value has to be taken into account and the timer is running (at change of the serving cell or, change of the broadcast value of T3212), the MS shall behave as follows: let t1 be the new T3212 timeout value and let t be the current timer value at the moment of the change to the new T3212 timeout value; then the timer shall be restarted with the value t&nbsp;modulo&nbsp;t1.</p>
<p>When the mobile station is activated, or when a change of the broadcast T3212 timeout value has to be taken into account and the timer is not running, the mobile station shall behave as follows: let t1 be the new T3212 timeout value, the new timer shall be started at a value randomly, uniformly drawn between 0 and t1.</p>
<h3><a name="_Toc171523899"></a>4.4.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IMSI attach procedure</h3>
<p>The IMSI attach procedure is the complement of the IMSI detach procedure (see subclause&nbsp;4.3.4). It is used to indicate the IMSI as active in the network.</p>
<p>In A/Gb mode and GERAN Iu mode, the network indicates whether the IMSI attach/detach procedures are required by using the ATT flag&nbsp; which is broadcast in the L3-RR SYSTEM INFORMATION TYPE 3 message (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;10.5.2.11).</p>
<p>In UTRAN Iu mode, the network indicates whether the IMSI attach/detach procedures are required by using the ATT flag&nbsp; which is included in the CS domain specific system information element (see subclause&nbsp;10.5.1.12.2).</p>
<p>The IMSI attach procedure is invoked if the ATT flag indicates that the IMSI detach/attach procedures are required and an IMSI is activated in a mobile station (i.e. activation of a mobile station with plug-in SIM/USIM, insertion of a card in a card-operated mobile station etc.) within coverage area from the network or a mobile station with an IMSI activated outside the coverage area enters the coverage area. The IMSI attach procedure is used only if the update status is U1 UPDATED and if the stored location area identification is the same as the one which is actually broadcasted on the BCCH of the current serving cell.</p>
<p>In a shared network, the MS shall choose one of the PLMN identities as specified in 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14]. The MS shall use the IMSI attach procedure only if the update status is U1 UPDATED and the stored location area identification is equal to the combination of the chosen PLMN identity and the LAC received on the BCCH. Otherwise a normal location updating procedure (see subclause&nbsp;4.4.1) is invoked independently of the ATT flag indication.</p>
<p>The IMSI attach procedure is performed by using the location updating procedure (see subclause&nbsp;4.4.1). The location updating type information element in the LOCATION UPDATING REQUEST message shall in this case indicate IMSI attach.</p>
<h3><a name="_Toc171523900"></a>4.4.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Generic Location Updating procedure</h3>
<h4><a name="_Toc171523901"></a>4.4.4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Location updating initiation by the mobile station</h4>
<p>Any timer used for triggering the location updating procedure (e.g. T3211, T3212) is stopped if running.</p>
<p>As no RR connection exists at the time when the location updating procedure has to be started, the MM sublayer within the mobile station will request the RR sublayer to establish a RR connection and enter state WAIT FOR RR CONNECTION (LOCATION UPDATE). The procedure for establishing an RR connection is described in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;3.3 and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c].</p>
<p>The mobile station initiates the location updating procedure by sending a LOCATION UPDATING REQUEST message to the network, starts the timer T3210 and enters state LOCATION UPDATING INITIATED. The location updating type information element shall indicate what kind of updating is requested.</p>
<p>If the MS is configured for "AttachWithIMSI" as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112] and the selected PLMN is neither the registered PLMN nor in the list of equivalent PLMNs, the MS shall include the IMSI in the Mobile identity IE in the LOCATION UPDATING REQUEST message.</p>
<p>If the mobile station is configured to use CS fallback and SMS over SGs, or SMS over SGs only, and TIN indicates "RAT-related TMSI" the mobile station shall set the TIN to "P-TMSI" unless the mobile station had already received the EMM cause #18 during a combined attach procedure (see subclause&nbsp;5.5.1.3.4.3 of 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120]) or a combined tracking area updating procedure (see subclause&nbsp;5.5.3.3.4.3 of 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120]) on the same PLMN, but not disabled the E-UTRAN capability.</p>
<h4><a name="_Toc171523902"></a>4.4.4.1a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Network Request for Additional mobile station Capability Information</h4>
<p>In A/Gb mode, the network may initiate the classmark interrogation procedure, for example, to obtain further information on the mobile station's encryption capabilities.</p>
<h4><a name="_Toc171523903"></a>4.4.4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Identification request from the network</h4>
<p>The network may initiate the identification procedure, e.g. if the network is unable to get the IMSI based on the TMSI and LAI used as identification by the mobile station (see subclause&nbsp;4.3.3).</p>
<h4><a name="_Toc171523904"></a>4.4.4.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication by the network</h4>
<p>The authentication procedure (see subclause&nbsp;4.3.2) may be initiated by the network upon receipt of the LOCATION UPDATING REQUEST message from the mobile station. (See the cases defined in 3GPP&nbsp;TS&nbsp;42.009&nbsp;[5]).</p>
<h4><a name="_Toc171523905"></a>4.4.4.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Security mode setting by the network</h4>
<p>In A/Gb mode, the security mode setting procedure (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;3.4.7) may be initiated by the network, e.g., if a new TMSI has to be allocated.</p>
<p>In Iu mode, the security mode control procedure (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]) may be initiated by the network, e.g., if a new TMSI has to be allocated.</p>
<h4><a name="_Toc171523906"></a>4.4.4.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Location Update Attempt Counter</h4>
<p>To limit the number of consecutive unsuccessful location updating attempts, an location update attempt counter is used. The location update attempt counter counts the number of consecutive unsuccessful location updating attempts.</p>
<p>The location update attempt counter shall be incremented as specified in subclause&nbsp;4.4.4.9.</p>
<p>The location update attempt counter shall be reset when:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the mobile station is powered on;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a SIM/USIM is inserted;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a location updating procedure is successfully completed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a location updating procedure is rejected with cause:</p>
<ol start="4">
<li>a) #11, #12, #13, #15 or #25 (see subclause&nbsp;4.4.4.7);</li>
<li>b) #22 and T3346 value IE indicating neither zero nor deactivated (see subclause&nbsp;4.4.4.7);</li>
</ol>
<p>-&nbsp; a normal or periodic routing area updating procedure or combined routing updating is not accepted by the network with cause #11, #12, #13, #15 or #25 (see subclause&nbsp;4.7.5.1.4 and 4.7.5.2.4);</p>
<p>-&nbsp; GPRS attach or combined GPRS attach procedure is not accepted by the network with cause #11, #12, #13, or #15 (see subclause&nbsp;4.7.3.1.4 and 4.7.3.2.4);</p>
<p>-&nbsp; service request procedure is not accepted by the network with cause #12, #13, or #15 (see subclause 4.7.13.4);</p>
<p>-&nbsp; network initiated GPRS detach procedure is completed with cause&nbsp; #12, #13, or #15 (see subclause&nbsp;4.7.4.2.2);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; combined GPRS attach or combined routing area updating procedure is successful for GPRS and non-GPRS services; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a new PLMN is selected.</p>
<p>and additionally when the mobile station is in the state MM IDLE sub-state ATTEMPTING to UPDATE:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a new location area is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; expiry of timer T3212;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a location updating procedure is triggered upon entering MM IDLE after the release of the last MM connection, as defined in subclause&nbsp;4.5.3.1;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a location updating procedure is triggered by CM sublayer requests; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; timer T3246 is started.</p>
<p>The location update attempt counter shall be used when deciding whether to re-attempt a location updating procedure after expiry of timer T3211 as specified in subclause&nbsp;4.4.4.9.</p>
<h4><a name="_Toc171523907"></a>4.4.4.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Location updating accepted by the network</h4>
<p>If the location updating is accepted by the network a LOCATION UPDATING ACCEPT message is transferred to the mobile station.</p>
<p>In case the identity confidentiality service is active (see subclauses&nbsp;4.3.1 and 4.4.4.4), the TMSI reallocation may be part of the location updating procedure. The TMSI allocated is then contained in the LOCATION UPDATING ACCEPT message together with the location area identifier LAI. The network shall in this case start the supervision timer T3250 as described in subclause&nbsp;4.3.1.</p>
<p>In a shared network, if the MS is a network sharing supporting MS, the network shall indicate in the LAI the PLMN identity of the CN operator that has accepted the location updating; if the MS is a network sharing non-supporting MS, the network shall indicate the PLMN identity of the common PLMN (see 3GPP&nbsp;TS&nbsp;23.251&nbsp;[109]).</p>
<p>In a multi-operator core network (MOCN) with common GERAN, the network shall indicate in the LAI the common PLMN identity (see 3GPP&nbsp;TS&nbsp;23.251&nbsp;[109]).</p>
<p>If the network wishes to prolong the RR connection to allow the mobile station to initiate MM connection establishment (for example if the mobile station has indicated in the LOCATION UPDATING REQUEST that it has a follow-on request pending) the network shall send "follow on proceed" in the LOCATION UPDATING ACCEPT and start timer T3255.</p>
<p>If the mobile station has indicated "CS fallback mobile terminating call" in the LOCATION UPDATING REQUEST message, the network shall maintain the RR connection for an implementation dependent duration to allow for mobile terminating call establishment. If the mobile station has also indicated in the LOCATION UPDATING REQUEST message that it has a follow-on request pending, it is implementation dependent whether the network proceeds with the mobile terminating call establishment or allows for a mobile initiated MM connection establishment.</p>
<p>The mobile station receiving a LOCATION UPDATING ACCEPT message shall store the received location area identification LAI, stop timer T3210, reset the location update attempt counter and set the update status in the SIM/USIM to UPDATED. If the message contains an IMSI, the mobile station is not allocated any TMSI, and shall delete any TMSI in the SIM/USIM accordingly. If the message contains a TMSI, the mobile station is allocated this TMSI, and shall store this TMSI in the SIM/USIM and a TMSI REALLOCATION COMPLETE shall be returned to the network. If neither IMSI nor TMSI is received in the LOCATION UPDATING ACCEPT message, the old TMSI if any available shall be kept.</p>
<p>If the MS has initiated the location updating procedure due to manual CSG selection and receives a LOCATION UPDATING ACCEPT message, and the MS sent the LOCATION UPDATING REQUEST message in a CSG cell, the MS shall check if the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list. If not, the MS shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the MS may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.</p>
<p>If the LAI or PLMN identity contained in the LOCATION UPDATING ACCEPT message is a member of the list of "forbidden location areas for regional provision of service", the list of "forbidden location areas for roaming" or the "forbidden PLMN list" then such entries shall be deleted.</p>
<p>If the MS receives the LOCATION UPDATING ACCEPT message from a PLMN for which a PLMN-specific attempt counter is maintained (see subclause&nbsp;4.1.1.6A), then the MS shall reset this counter. If the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall reset this counter.</p>
<p>The network may also send a list of "equivalent PLMNs" in the LOCATION UPDATING ACCEPT message. Each entry of the list contains a PLMN code (MCC+MNC). If the location updating procedure is initiated during a CS fallback procedure and the network is configured to support the return to the last registered E-UTRAN PLMN after CS fallback as specified in 3GPP&nbsp;TS&nbsp;23.272&nbsp;[133], and the PLMN identity which is provided as part of the RAI contained in the ROUTING AREA UPDATE ACCEPT message differs from the last registered E-UTRAN PLMN identity, the network shall include the last registered E-UTRAN PLMN identity in the list of "equivalent PLMNs" in the LOCATION UPDATING ACCEPT message.</p>
<p>NOTE&nbsp;1:&nbsp; The network can determine a location updating procedure is initiated during a CS fallback procedure as specified in 3GPP&nbsp;TS&nbsp;23.272&nbsp;[133].</p>
<p>NOTE&nbsp;2:&nbsp; The last registered E-UTRAN PLMN identity can be derived by the network as specified in 3GPP&nbsp;TS&nbsp;23.272&nbsp;[133].</p>
<p>The mobile station shall store the list, as provided by the network, except that any PLMN code that is already in the "forbidden PLMN list" shall be removed from the "equivalent PLMNs" list before it is stored by the mobile station. If the mobile station is supporting S1 mode, it shall also remove any PLMN code that is already in the list of "forbidden PLMNs for GPRS service" before storing the list. In addition the mobile station shall add to the stored list the PLMN code of the registered PLMN that sent the list. All PLMNs in the stored list shall be regarded as equivalent to each other for PLMN selection, cell selection/re-selection and handover. The stored list in the mobile station shall be replaced on each occurrence of the LOCATION UPDATING ACCEPT message. If no list is contained in the message, then the stored list in the mobile station shall be deleted. The list shall be stored in the mobile station while switched off so that it can be used for PLMN selection after switch on.</p>
<p>After that, the mobile station shall act according to the presence of the "Follow-on proceed" information element in the LOCATION UPDATING ACCEPT; if this element is present and the mobile station has a CM application request pending, it shall send a CM SERVICE REQUEST to the network and proceed as in subclause&nbsp;4.5.1.1. Otherwise, it shall start timer T3240 and enter state WAIT FOR NETWORK COMMAND.</p>
<p>Furthermore, the network may grant authorisation for the mobile station to use GSM-Cordless Telephony System (CTS) in the Location Area and its immediate neighbourhood. The mobile should memorise this permission in non-volatile memory. If the "CTS permission" IE is not present in the message, the mobile is not authorised to use GSM-CTS, and shall accordingly delete any memorised permission.</p>
<p>NOTE&nbsp;3:&nbsp; The interaction between CTS and GPRS procedures are not yet defined.</p>
<p>The network may also send a Local Emergency Numbers List with local emergency numbers in the LOCATION UPDATING ACCEPT, by including the Emergency Number List IE. The mobile equipment shall store the Local Emergency Numbers List, as provided by the network. The Local Emergency Numbers List stored in the mobile equipment shall be replaced on each receipt of the Emergency Number List IE. The received Local Emergency Numbers List shall be provided to the upper layers.</p>
<p>The emergency number(s) received in the Emergency Number List IE are valid only in networks in the same country as the cell on which this IE is received. If no list is contained in the LOCATION UPDATING ACCEPT message, then the stored Local Emergency Numbers List in the mobile equipment shall be kept, except if the mobile equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the Local Emergency Numbers List.</p>
<p>The mobile equipment shall use the stored Local Emergency Numbers Lt of emergency numbers received from the network in addition to the emergency numbers stored on the SIM/USIM or ME to detect that the number dialled is an emergency number.</p>
<p>NOTE&nbsp;4:&nbsp; The mobile equipment may use the Local Emergency Numbers List to assist the end user in determining whether the dialled number is intended for an emergency service or for another destination, e.g. a local directory service. The possible interactions with the end user are implementation specific.</p>
<p>NOTE&nbsp;5:&nbsp; An MS that supports procedures specified in 3GPP&nbsp;TS&nbsp;24.302&nbsp;[156], can get additional local emergency numbers through those procedures, which can be used based on operator policy (see 3GPP&nbsp;TS&nbsp;24.302&nbsp;[156]) to detect that the number dialled is an emergency number.</p>
<p>The Local Emergency Numbers List shall be deleted at switch off and removal of the SIM/USIM. The mobile equipment shall be able to store up to ten local emergency numbers received from the network.</p>
<h4><a name="_Toc171523908"></a>4.4.4.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Location updating not accepted by the network</h4>
<p>If the location updating cannot be accepted, the network sends a LOCATION UPDATING REJECT message to the mobile station. The mobile station receiving a LOCATION UPDATING REJECT message containing a reject cause other than MM cause value #25 or the message is integrity protected, shall stop the timer T3210, store the reject cause, start the timer T3240, enter state LOCATION UPDATING REJECTED, await the release of the RR connection triggered by the network, and for all causes except #12, #15, #22 and #25 deletes the list of "equivalent PLMNs".</p>
<p>If the LOCATION UPDATING REJECT message containing the MM cause value #25 was received without integrity protection, then the MS shall discard the message.</p>
<p>If the location updating is rejected due to general NAS level mobility management congestion control, the network shall set the MM cause value to #22 "congestion" and assign a back-off timer T3246 (see 3GPP&nbsp;TS&nbsp;23.012&nbsp;[140]).</p>
<p>Upon the release of the RR connection, the mobile station shall take the following actions depending on the stored reject cause:</p>
<p># 2:&nbsp;&nbsp;&nbsp;&nbsp; (IMSI unknown in HLR);</p>
<p># 3:&nbsp;&nbsp;&nbsp;&nbsp; (Illegal MS); or</p>
<p># 6:&nbsp;&nbsp;&nbsp;&nbsp; (Illegal ME).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause&nbsp;4.1.2.2), and delete any TMSI, stored LAI and ciphering key sequence number and shall consider the SIM/USIM as invalid for non-GPRS services until switch-off or the SIM/USIM is removed or the timer T3245 expires as described in subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p># 11:&nbsp;&nbsp; (PLMN not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall delete any LAI, TMSI and ciphering key sequence number stored in the SIM/USIM, reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause&nbsp;4.1.2.2). The mobile station shall store the PLMN identity in the "forbidden PLMN list" and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a PLMN-specific attempt counter for that PLMN, then the MS shall set this counter to the MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a PLMN selection when back to the MM IDLE state according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to performing a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p># 12:&nbsp;&nbsp; (Location Area not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall delete any LAI, TMSI and ciphering key sequence number stored in the SIM/USIM, reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause&nbsp;4.1.2.2).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall store the LAI in the list of "forbidden location areas for regional provision of service".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a cell selection when back to the MM IDLE state according to 3GPP TS&nbsp;43.022 [82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>NOTE&nbsp;1:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p># 13:&nbsp;&nbsp; (Roaming not allowed in this location area).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause&nbsp;4.1.2.2).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall perform a PLMN selection instead of a cell selection when back to the MM IDLE state according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to performing a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p># 15:&nbsp;&nbsp; (No Suitable Cells In Location Area).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall reset the location update attempt counter, set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause&nbsp;4.1.2.2).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall search for a suitable cell in another location area or a tracking area according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121].</p>
<p>NOTE&nbsp;2:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p># 22:&nbsp;&nbsp; (Congestion).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the T3246 value IE is present in the LOCATION UPDATING REJECT message and the value indicates that this timer is neither zero nor deactivated, the mobile station shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause&nbsp;4.4.4.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall abort the location updating procedure, reset the location update attempt counter, set the MM update status to U2 NOT UPDATED and change to state MM IDLE sub-state ATTEMPTING TO UPDATE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer T3246 if it is running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the LOCATION UPDATING REJECT message is integrity protected, the mobile station shall start timer T3246 with the value provided in the T3246 value IE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the LOCATION UPDATING REJECT message is not integrity protected, the mobile station shall start timer T3246 with a random value from the default range specified in table&nbsp;11.1.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station stays in the current serving cell and applies the normal cell reselection process. The MM connection establishment is started, if still necessary, when timer T3246 expires or is stopped.</p>
<p># 25:&nbsp;&nbsp; (Not authorized for this CSG ).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause&nbsp;4.4.4.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall reset the location update attempt counter, and set the update status to ROAMING NOT ALLOWED (and store it in the SIM/USIM according to subclause&nbsp;4.1.2.2).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the CSG ID and associated PLMN identity of the cell where the MS has sent the LOCATION UPDATING REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the CSG ID and associated PLMN identity of the cell where the MS has sent the LOCATION UPDATING REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP TS 23.122 [14] subclause&nbsp;3.1A.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall search for a suitable cell according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>Other values are considered as abnormal cases and the specification of the mobile station behaviour in those cases is given in subclause&nbsp;4.4.4.9.</p>
<h4><a name="_Toc171523909"></a>4.4.4.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Release of RR connection after location updating</h4>
<p>When the Location updating procedure is finished (see subclauses&nbsp;4.4.4.6 and 4.4.4.7) the mobile station shall (except in the case where the mobile has a follow-on CM application request pending and has received the follow-on proceed indication, see subclause&nbsp;4.4.4.6) set timer T3240 and enter the state WAIT FOR NETWORK COMMAND, expecting the release of the RR connection. The network may decide to keep the RR connection for network initiated establishment of a MM connection, or to allow for mobile initiated MM connection establishment.</p>
<p>Any release of the RR connection shall be initiated by the network according to subclause&nbsp;3.5 in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84], and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]. If the RR connection is not released within a given time controlled by the timer T3240, the mobile station shall abort the RR connection. In both cases, either after a RR connection release triggered from the network side or after a RR connection abort requested by the MS-side, the MS shall return to state MM IDLE.</p>
<p>At transition to state MM IDLE, substates NORMAL SERVICE or RECEIVING GROUP CALL (NORMAL SERVICE) or ATTEMPTING TO UPDATE either timer T3212 or timer T3211 is started as described in subclause&nbsp;4.4.4.9, or, timer T3246 is started as described in subclauses&nbsp;4.4.4.7, 4.4.4.9 and 4.5.1.1.</p>
<p>If the MS receives the "Extended wait time" for CS domain from the lower layers when no location updating or CM service request procedure is ongoing, the MS shall ignore the "Extended wait time".</p>
<h4><a name="_Toc171523910"></a>4.4.4.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the mobile station side</h4>
<p>The different abnormal cases that can be identified are the following:</p>
<ol>
<li>a) Access barred because of access class control or EAB</li>
</ol>
<p>The location updating procedure is not started. The mobile station stays in the current serving cell and applies normal cell reselection process. The procedure is started as soon as possible and if still necessary (when the barred state is ended or because of a cell change).</p>
<ol>
<li>b) The answer to random access is an IMMEDIATE ASSIGNMENT REJECT message (A/Gb mode only)</li>
</ol>
<p>The location updating is not started. The mobile station stays in the chosen cell and applies normal cell selection process. The waiting timer T3122 is reset when a cell change occurs. The procedure is started as soon as possible after T3122 timeout if still necessary.</p>
<ol>
<li>c) Random access failure (A/Gb mode only)</li>
</ol>
<p>Timer T3213 is started. When it expires the procedure is attempted again if still necessary.</p>
<p>NOTE&nbsp;1:&nbsp; As specified in 3GPP&nbsp;TS&nbsp;45.008&nbsp;[34], a cell reselection then takes place, with return to the cell inhibited for 5 seconds if there is at least one other suitable cell. Typically the selection process will take the mobile station back to the cell where the random access failed after 5&nbsp;seconds.</p>
<p>If at the expiry of timer T3213 a new cell has not been selected due to the lack of valid information (see 3GPP&nbsp;TS&nbsp;45.008&nbsp;[34]), the mobile station may as an option delay the repeated attempt for up to 8 seconds to allow cell re-selection to take place. In this case the procedure is attempted as soon as a new cell has been selected or the mobile station has concluded that no other cell can be selected.</p>
<p>If random access failure occurs for two successive random access attempts for location updating the mobile station proceeds as specified below.</p>
<ol>
<li>d) RR connection failure</li>
</ol>
<p>The procedure is aborted and the mobile station proceeds as specified below.</p>
<ol>
<li>e) T3210 timeout</li>
</ol>
<p>The procedure is aborted, the RR connection is aborted and the MS proceeds as specified below.</p>
<ol>
<li>f) RR release without "Extended Wait Time" received from lower layers before the normal end of procedure</li>
</ol>
<p>The procedure is aborted and the mobile station proceeds as specified below, except in the following implementation option case f.1.</p>
<p>f.1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RR release in Iu mode (i.e. RRC connection release) with, for example, cause "Normal", "User inactivity" or "Directed signalling connection re-establishment" (see 3GPP TS&nbsp;25.331&nbsp;[23c] and 3GPP TS&nbsp;44.118&nbsp;[111])</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The location updating procedure shall be initiated again, if the following conditions apply:</p>
<ol>
<li>i) The original location updating procedure was initiated over an existing RRC connection; and</li>
<li>ii) No SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the CS signalling connection (e.g. CS authentication procedures, see subclause&nbsp;4.3.2), were received after the LOCATION UPDATING REQUEST message was transmitted.</li>
</ol>
<p>NOTE&nbsp;2:&nbsp; The RRC connection release cause that triggers the re-initiation of the location updating procedure is implementation specific.</p>
<ol start="4">
<li>g) Location updating reject, other causes than those treated in subclause&nbsp;4.4.4.7, and cases of MM cause values #22 and #25, if considered as abnormal cases according to subclause&nbsp;4.4.4.7</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon reception of the cause codes #22, # 95, # 96, # 97, # 99 and # 111 the MS should set the location update attempt counter to 4. The MS waits for release of the RR connection as specified in subclause&nbsp;4.4.4.8.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall proceed as described below.</p>
<ol>
<li>h) RR connection establishment failure without "Extended Wait Time" received from lower layers (Iu mode only)</li>
</ol>
<p>The procedure is aborted and the mobile station proceeds as specified below.</p>
<p>NOTE&nbsp;3:&nbsp; Case h) covers all cases when the signalling connection cannot be established, including random access failure and access reject. As the RRC protocol has error specific retransmission mechanisms (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]), there is no need to distinguish between the different error cases within MM.</p>
<ol>
<li>i) "Extended wait time" for CS domain from the lower layers</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall abort the location updating procedure and stop timer T3210 if still running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the LOCATION UPDATING REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the MS shall start timer T3246 with the "Extended wait time" value and reset the location update attempt counter.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In other cases the MS shall ignore the "Extended wait time".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Additionally, the MS shall set the MM update status to U2 NOT UPDATED and change to state MM IDLE sub-state ATTEMPTING TO UPDATE. The MS stays in the current serving cell and applies normal cell reselection process. The location updating procedure is started, if still necessary, when timer T3246 expires or is stopped, and the MS proceeds as specified below.</p>
<ol>
<li>j) Timer T3246 is running</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The location updating procedure shall not be initiated unless the MS is establishing an emergency call or the MS is an MS configured to use AC11 &ndash; 15 in selected PLMN. The MS stays in the current serving cell and applies normal cell reselection process. The location updating procedure is started, if still necessary, when timer T3246 expires or is stopped.</p>
<p>In cases d) to i) (except in the case f.1 and except in the case i) when timer T3246 is started) above, and, for repeated failures as defined in c) above, the mobile station proceeds as follows. Timer T3210 is stopped if still running. The RR Connection is aborted in case of timer T3210 timeout. The location update attempt counter is incremented. The next actions depend on the Location Area Identities (stored and received from the BCCH of the current serving cell) and the value of the location update attempt counter.</p>
<p>&ndash;&nbsp;&nbsp;&nbsp; the update status is UPDATED, and the stored LAI is equal to the one received on the BCCH from the current serving cell and the location update attempt counter is smaller than 4:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall keep the update status to UPDATED, the MM IDLE sub-state after the RR connection release is NORMAL SERVICE. The mobile station shall memorize the location updating type used in the location updating procedure. It shall start timer T3211 &nbsp;when the RR connection is released. When timer T3211 or T3246 expires the location updating procedure is triggered again with the memorized location updating type;</p>
<p>&ndash;&nbsp;&nbsp;&nbsp; either the update status is different from UPDATED, or the stored LAI is different from the one received on the BCCH from the current serving cell, or the location update attempt counter is greater or equal to 4:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; When the RR connection is released the mobile station shall delete any LAI, TMSI, ciphering key sequence number stored in the SIM/USIM, and set the update status to NOT UPDATED. A mobile station which is not a GPRS MS shall also delete the list of equivalent PLMNs. The mobile station shall enter the MM IDLE sub-state ATTEMPTING TO UPDATE (see subclause&nbsp;4.2.2.2 for the subsequent actions) or optionally the MM IDLE sub-state PLMN SEARCH (see subclause&nbsp;4.2.1.2) in order to perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14]. If the location update attempt counter is smaller than 4, the mobile station shall memorize that timer T3211 &nbsp;is to be started when the RR connection is released, otherwise it shall memorize that timer T3212 &nbsp;is to be started when the RR connection is released.</p>
<h4><a name="_Toc171523911"></a>4.4.4.10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the network side</h4>
<ol>
<li>a) RR connection failure</li>
</ol>
<p>If a RR connection failure occurs during a common procedure integrated with the location updating procedure, the behaviour of the network should be according to the description of that common procedure.</p>
<p>If a RR connection failure occurs when a common procedure does not exist, the location updating procedure towards the mobile station should be aborted.</p>
<ol>
<li>b) protocol error</li>
</ol>
<p>If the LOCATION UPDATING REQUEST message is received with a protocol error, the network should, if possible, return a LOCATION UPDATING REJECT message with one of the following Reject causes:</p>
<p>#96:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mandatory information element error</p>
<p>#99:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Information element non-existent or not implemented</p>
<p>#100:&nbsp;&nbsp;&nbsp;&nbsp; Conditional IE error</p>
<p>#111:&nbsp;&nbsp;&nbsp;&nbsp; Protocol error, unspecified</p>
<p>Having sent the response, the network should start the channel release procedure (see subclause&nbsp;3.5).</p>
<p>Figure 4.5/3GPP TS 24.008: Location updating sequence</p>
<h3><a name="_Toc171523912"></a>4.4.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Void</h3>
<h3><a name="_Toc171523913"></a>4.4.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Void</h3>
<h3><a name="_Toc171523914"></a>4.4.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eCall inactivity procedure</h3>
<p>The eCall inactivity procedure is applicable only to an eCall only mobile station (as determined by information configured in USIM). The procedure shall be started when:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the mobile station is in any MM Idle state except NO IMSI, NO CELL AVAILABLE or PLMN SEARCH;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the mobile station is in GMM-NULL or GMM-DEREGISTERED state; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; one of the following conditions applies:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; timer T3242 expires or is found to have already expired and T3243 is not running;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; timer T3243 expires or is found to have already expired and T3242 is not running; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; timer T3242 and timer T3243 expire or are found to have already expired.</p>
<p>The mobile station shall then stop other running timers (e.g. T3211, T3212, T3213) and shall perform the IMSI detach procedure if required by the serving network and if the update state is U1. The mobile station then enters MM Idle eCALL INACTIVE state and the mobile station shall delete any LAI, TMSI, ciphering key sequence number stored in the SIM/USIM and set the update state to U4 Updating Disabled.</p>
<p>While in eCALL INACTIVE state, the mobile station maintains awareness of a potential serving cell in a potential serving network but initiates no MM signalling with the network and ignores any paging requests.</p>
<p>The mobile station shall leave eCALL INACTIVE state only when one of the following events occur:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the SIM or USIM is removed, the mobile station enters the NO IMSI state;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if coverage is lost, the mobile station enters PLMN SEARCH state;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the mobile station is deactivated (e.g. powered off) by the user: the mobile station enters the NULL state;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if there is a CM request for an emergency services call: the mobile station should follow the procedure for return to state MM-IDLE in subclause&nbsp;4.2.3 and attempt a location update. The MS then uses the MM and CM procedures to establish the emergency call at the earliest opportunity; or</p>
<p>NOTE&nbsp;1:&nbsp; If an eCall only device has not successfully completed a location update procedure, PSAP callback will not be possible due to its calling line identity being unavailable at the PSAP.</p>
<p>NOTE&nbsp;2:&nbsp; An eCall only device uses the CS domain to originate an emergency services call when in A/Gb or Iu mode, even if the device is capable of eCall over IMS.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if there is a CM request for a call to an HPLMN designated non-emergency MSISDN for the purpose of accessing test and terminal reconfiguration services: the mobile station follows the procedure for return to state MM-IDLE in subclause&nbsp;4.2.3 and attempts a normal location update. Once this is complete, further MM and CM procedures are used to establish the non-emergency call.</p>
<p>NOTE&nbsp;3:&nbsp; An eCall only device uses the CS domain to originate a call to an HPLMN designated non-emergency MSISDN for the purpose of accessing test and terminal reconfiguration services when in A/Gb or Iu mode, even if the device is capable of eCall over IMS.</p>
<h2><a name="_Toc171523915"></a>4.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Connection management sublayer service provision</h2>
<p>The concept of MM connection is introduced in this subclause. This concept is mainly a descriptive tool: The establishment of an MM connection by the network can be local (i.e. it is achieved by the transmission of the first CM layer message and without the transmission of any MM layer messages) or can be achieved by the transmission of a CM SERVICE PROMPT message (eg. in the case of certain ring back services). The release of an MM connection by the network or by the mobile station is always local, i.e. these purposes can be achieved without sending any MM messages over the radio interface. (On the contrary, establishment of an MM connection by the mobile station requires the sending of MM messages over the radio interface. An exception is VGCS, where an MM connection will be established as result of an uplink access procedure (see subclause&nbsp;3.7.2.1.1in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84]).)</p>
<p>The Mobility Management (MM) sublayer is providing connection management services to the different entities of the upper Connection management (CM) sublayer (see 3GPP&nbsp;TS&nbsp;24.007&nbsp;[20]). It offers to a CM entity the possibility to use an MM connection for the exchange of information with its peer entity. An MM connection is established and released on request from a CM entity. Different CM entities communicate with their peer entity using different MM connections. Several MM connections may be active at the same time.</p>
<p>An MM connection requires an RR connection. All simultaneous MM connections for a given mobile station use the same RR connection.</p>
<p>In the following subclauses, the procedures for establishing, re-establishing, maintaining, and releasing an MM connection are described, usually separately for the mobile station and the network side.</p>
<h3><a name="_Toc171523916"></a>4.5.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM connection establishment</h3>
<h4><a name="_Toc171523917"></a>4.5.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM connection establishment initiated by the mobile station</h4>
<p>Upon request of a CM entity to establish an MM connection the MM sublayer first decides whether to accept, delay, or reject this request:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; An MM connection establishment may only be initiated by the mobile station when the following conditions are fulfilled:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Its update status is UPDATED.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer is in one of the states MM IDLE, RR CONNECTION RELEASE NOT ALLOWED or MM connection active but not in MM connection active (Group call).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An exception from this general rule exists for emergency calls (see subclause&nbsp;4.5.1.5). A further exception is defined in the following clause.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If an MM specific procedure is running at the time the request from the CM sublayer is received, and the LOCATION UPDATING REQUEST message has been sent, the request will either be rejected or delayed, depending on implementation, until the MM specific procedure is finished and, provided that the network has not sent a "follow-on proceed" indication, the RR connection is released. If the LOCATION UPDATING REQUEST message has not been sent, the mobile station may include a "follow-on request" indicator in the message. The mobile station shall then delay the request until the MM specific procedure is completed, when it may be given the opportunity by the network to use the RR connection: see subclause&nbsp;4.4.4.6.</p>
<p>In order to establish an MM connection, the mobile station proceeds as follows:</p>
<ol>
<li>a) If no RR connection exists, the MM sublayer requests the RR sublayer to establish an RR connection and enters MM sublayer state WAIT FOR RR CONNECTION (MM CONNECTION). This request contains an establishment cause and a CM SERVICE REQUEST message. When the establishment of an RR connection is indicated by the RR sublayer, the MM sublayer of the mobile station starts timer T3230, gives an indication to the CM entity that requested the MM connection establishment, and enters MM sublayer state WAIT FOR OUTGOING MM CONNECTION.</li>
<li>b) If an RR connection is available, the MM sublayer of the mobile station sends a CM SERVICE REQUEST message to the network, starts timer T3230, stops and resets timer T3241, gives an indication to the CM entity that requested the MM connection establishment, and enters:</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; MM sublayer state WAIT FOR OUTGOING MM CONNECTION, if no MM connection is active;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; MM sublayer state WAIT FOR ADDITIONAL OUTGOING MM CONNECTION, if at least one MM connection is active;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If an RR connection exists but the mobile station is in the state WAIT FOR NETWORK COMMAND then any requests from the CM layer that are received will either be rejected or delayed until this state is left.</p>
<ol>
<li>c) Only applicable for mobile stations supporting VGCS talking:</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If a mobile station which is in the MM sublayer state MM IDLE, service state RECEIVING GROUP CALL (NORMAL SERVICE), receives a request from the GCC sublayer to perform an uplink access, the MM sublayer requests the RR sublayer to perform an uplink access procedure and enters MM sublayer state WAIT FOR RR CONNECTION (GROUP TRANSMIT MODE).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; When a successful uplink access is indicated by the RR sublayer, the MM sublayer of the mobile station gives an indication to the GCC sublayer and enters MM sublayer state MM CONNECTION ACTIVE (GROUP TRANSMIT MODE).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; When an uplink access reject is indicated by the RR sublayer, the MM sublayer of the mobile station gives an indication to the GCC sublayer and enters the MM sublayer state MM IDLE, service state RECEIVING GROUP CALL (NORMAL SERVICE).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In the network, if an uplink access procedure is performed, the RR sublayer in the network provides an indication to the MM sublayer together with the mobile subscriber identity received in the TALKER INDICATION message. The network shall then enter the MM sublayer state MM CONNECTION ACTIVE (GROUP TRANSMIT MODE).</p>
<ol start="24">
<li>d) When the MS is IMSI attached for CS services via EMM combined procedures, as described in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120], and the MS is camping on an E-UTRAN cell, and if T3246 is not running, the MM sublayer requests EMM to initiate a service request procedure for CS fallback. The MM connection establishment is delayed until the MS changes to a GERAN or UTRAN cell.</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS enters a GERAN or UTRAN cell, then the MS shall initiate the MM connection establishment and send a CM SERVICE REQUEST message. The MS shall include the Additional update parameters information element indicating "CS fallback mobile originating call". If the MS determines that it is in a different location area than the stored location area, the MS shall first initiate a normal location updating procedure regardless of Network Mode of Operation. If the location area of the current cell is not available, the MS may initiate a normal location updating procedure directly. The MM connection establishment is delayed until successful completion of the normal location updating procedure. Additionally the MS performs routing area updating as specified in subclause&nbsp;4.7.5. If the normal location updating procedure is initiated, the MS shall indicate the "follow-on request pending", shall include the Additional update parameters information element indicating"CS fallback mobile originating call", and shall not include the MS network feature support information element in the LOCATION UPDATING REQUEST message.</p>
<p>In case a, b and d, the CM SERVICE REQUEST message contains the:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; mobile identity according to subclause&nbsp;10.5.1.4;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; mobile station classmark 2;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ciphering key sequence number; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; CM service type identifying the requested type of transaction (e.g. mobile originating call establishment, emergency call establishment, short message service, supplementary service activation, location services).</p>
<p>A MS supporting eMLPP may optionally include a priority level in the CM SERVICE REQUEST message.</p>
<p>For MM connection establishment involving a shared GERAN network in A/Gb mode, if the MS is a GERAN network sharing supporting MS, the chosen PLMN identity shall be indicated to the GERAN in the CM SERVICE REQUEST message using the Skip Indicator IE as specified in subclause&nbsp;10.3.1.</p>
<p>A collision may occur when a CM layer message is received by the mobile station in MM sublayer state WAIT FOR OUTGOING MM CONNECTION or in WAIT FOR ADDITIONAL OUTGOING MM CONNECTION. In this case the MM sublayer in the MS shall establish a new MM connection for the incoming CM message as specified in subclause&nbsp;4.5.1.3.</p>
<p>Upon receiving a CM SERVICE REQUEST message, the network shall analyse its content. The type of semantic analysis may depend on other on going MM connection(s). Depending on the type of request and the current status of the RR connection, the network may start any of the MM common procedures and RR procedures.</p>
<p>In A/Gb mode, the network may initiate the classmark interrogation procedure, for example, to obtain further information on the mobile station's encryption capabilities.</p>
<p>The identification procedure (see subclause&nbsp;4.3.3) may be invoked for instance if a TMSI provided by the mobile station is not recognized.</p>
<p>The network may invoke the authentication procedure (see subclause&nbsp;4.3.2) depending on the CM service type.</p>
<p>In A/Gb mode, the network decides also if the ciphering mode setting procedure shall be invoked (see subclause&nbsp;3.4.7 in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84]).</p>
<p>In Iu mode, the network decides also if the security mode control procedure shall be invoked (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]).</p>
<p>NOTE&nbsp;1:&nbsp; If the CM_SERVICE_REQUEST message contains a priority level the network may use this to perform queuing and pre-emption as defined in 3GPP&nbsp;TS&nbsp;23.067&nbsp;[88].</p>
<p>In A/Gb mode, the MS shall consider the MM connection establishment to be completed when:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; receiving an indication from the RR sublayer that the ciphering mode setting procedure is completed; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; receiving a CM SERVICE ACCEPT message.</p>
<p>In Iu mode, the MS shall consider the MM connection establishment to be completed when</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; receiving an indication from the RR sublayer that the security mode control procedure is completed, except for the case when it is the first security mode control procedure after successful inter-system change received in MM sublayer state WAIT FOR ADDITIONAL OUTGOING MM CONNECTION; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; receiving a CM SERVICE ACCEPT message.</p>
<p>The procedures in subclause&nbsp;4.1.1.1.1 shall always have precedence over this subclause.</p>
<p>In Iu mode, during a MM connection establishment for all services, except for emergency call (see subclause&nbsp;4.1.1.1.1), the security mode control procedure with activation of integrity protection shall be invoked by the network unless integrity protection is already started (see subclause&nbsp;4.1.1.1.1).</p>
<p>The MM connection establishment is completed, timer T3230 shall be stopped, the CM entity that requested the MM connection shall be informed, and MM sublayer state MM CONNECTION ACTIVE is entered. The MM connection is considered to be active.</p>
<p>If the service request cannot be accepted, the network returns a CM SERVICE REJECT message to the mobile station.</p>
<p>The reject cause information element (see subclause&nbsp;10.5.3.6 and annex G) indicates the reason for rejection. The following cause values may apply:</p>
<p>#4: IMSI unknown in VLR</p>
<p>#6: Illegal ME</p>
<p>#17:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Network failure</p>
<p>#22:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Congestion</p>
<p>#25&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Not authorized for this CSG</p>
<p>#32:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service option not supported</p>
<p>#33:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Requested service option not subscribed</p>
<p>#34:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service option temporarily out of order</p>
<p>If the service request is rejected due to general NAS level mobility management congestion control, the network shall set the MM cause value to #22 "congestion" and assign a back-off timer T3246 (see 3GPP&nbsp;TS&nbsp;23.012&nbsp;[140]).</p>
<p>If no other MM connection is active, the network may start the RR connection release (see subclause&nbsp;3.5 of 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] (A/Gb mode only), 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] (UTRAN Iu mode only), or in 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111] (GERAN Iu mode only) when the CM SERVICE REJECT message is sent.</p>
<p>If a CM SERVICE REJECT message is received by the mobile station, timer T3230 shall be stopped, the requesting CM sublayer entity informed. Then the mobile station shall proceed as follows:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the cause value is not #4 or #6 or #25 received from a CSG cell and the MS is in UTRAN Iu mode, the MM sublayer returns to the previous state (the state where the request was received). Other MM connections shall not be affected by the CM SERVICE REJECT message.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If cause value #4 is received, the mobile station aborts any MM connection, deletes any TMSI, LAI and ciphering key sequence number in the SIM/USIM, changes the update status to NOT UPDATED (and stores it in the SIM/USIM according to subclause&nbsp;4.1.2.2), and enters the MM sublayer state WAIT FOR NETWORK COMMAND. If subsequently the RR connection is released or aborted, this will force the mobile station to initiate a normal location updating). Whether the CM request shall be memorized during the location updating procedure, is a choice of implementation.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If cause value #6 is received, the mobile station aborts any MM connection, deletes any TMSI, LAI and ciphering key sequence number in the SIM/USIM, changes the update status to ROAMING NOT ALLOWED (and stores it in the SIM/USIM according to subclause&nbsp;4.1.2.2), and enters the MM sublayer state WAIT FOR NETWORK COMMAND. The mobile station shall consider the SIM/USIM as invalid for non-GPRS services until switch-off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If cause value #22 is received, the T3246 value IE is present in the CM SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall check whether the CM SERVICE REJECT message with cause #22 is integrity protected and shall stop timer T3246 if it is running. If the message is integrity protected, the MS shall start timer T3246 with the value provided in the T3246 value IE. Otherwise, the MS shall start timer T3246 with a random value from the default range specified in table&nbsp;11.1.The MS stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started by CM layer, if it is still necessary, when timer T3246 expires or is stopped.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If cause value #22 is received, the T3246 value IE is not present in the CM SERVICE REJECT message or if the T3246 value IE the value indicates that this timer is zero or deactivated, the same actions as on timer expiry in subclause&nbsp;4.5.1.2 shall be taken by the mobile station.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If cause value #25 is received from a CSG cell and the MS is in UTRAN Iu mode, the MS shall check whether the CM SERVICE REJECT message with cause #25 is integrity protected. If the message is not integrity protected, the MS shall discard the message. Otherwise, the MS shall abort any MM connection, remove the entry corresponding to the CSG ID and associated PLMN identity of the cell where the MS has sent the CM SERVICE REQUEST message from the Allowed CSG list if the CSG ID and associated PLMN identity are contained in the Allowed CSG list, and enter the MM sublayer state WAIT FOR NETWORK COMMAND. If the CSG ID and associated PLMN identity of the cell where the MS has sent the CM SERVICE REQUEST message is contained in the Operator CSG list, the MS shall proceed as specified in 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14] subclause&nbsp;3.1A. Subsequently, after the RR connection is released or aborted, the MS applies normal cell reselection process.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If cause value #25 is received and the cell is not a CSG cell or the MS is not in UTRAN Iu mode, the MS shall discard the CM SERVICE REJECT message.</p>
<h4><a name="_Toc171523918"></a>4.5.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases</h4>
<p>Mobile station side:</p>
<ol>
<li>a) RR connection failure without "Extended Wait Time" received from lower layers or IMSI deactivation</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If an RR connection failure occurs, except in the following implementation option case a.1, or the IMSI is deactivated during the establishment of an MM connection, the MM connection establishment is aborted, timers T3230 is stopped, and an indication is given to the CM entity that requested the MM connection establishment. This shall be treated as a rejection for establishment of the new MM connection, and the MM sublayer shall release all active MM connections.</p>
<p>a.1)&nbsp;&nbsp;&nbsp;&nbsp; RR connection failure in Iu mode (i.e. RRC connection release) with, for example, cause "Normal", "User inactivity" or "Directed signalling connection re-establishment" (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111])</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM connection establishment procedure shall be initiated again, if the following conditions apply:</p>
<ol>
<li>i) The original MM connection establishment was initiated over an existing RRC connection; and</li>
<li>ii) No SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the CS signalling connection (e.g. CS authentication procedures, see subclause&nbsp;4.3.2), were received after the CM SERVICE REQUEST message was transmitted.</li>
</ol>
<p>NOTE 1:&nbsp; The RRC connection release cause that triggers the re-initiation of the MM connection establishment procedure is implementation specific.</p>
<ol>
<li>b) T3230 expiry</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If T3230 expires (i.e. no response is given but a RR connection is available) the MM connection establishment is aborted and the requesting CM sublayer is informed. If no other MM connection exists then the mobile station shall proceed as described in subclause&nbsp;4.5.3.1 for release of the RR connection. Otherwise the mobile station shall return to the MM sublayer state where the request of an MM connection was received, i.e. to MM sublayer state MM connection active. Other ongoing MM connections (if any) shall not be affected.</p>
<ol>
<li>c) Reject cause values #95, #96, #97, #99, #100, #111 received</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The same actions as on timer expiry shall be taken by the mobile station.</p>
<ol>
<li>d) Random access failure or RR connection establishment failure without "Extended Wait Time" received from lower layers</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the mobile station detects a random access failure or RR connection establishment failure during the establishment of an MM connection, it aborts the MM connection establishment and gives an indication to the CM entity that requested the MM connection establishment.</p>
<p>NOTE 2:&nbsp; Further actions of the mobile station depend on the RR procedures and MM specific procedures during which the abnormal situation has occurred and are described together with those procedures.</p>
<ol>
<li>e) Access barred because of access class control or EAB</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM connection establishment shall not be initiated. The MS stays in the current serving cell and applies normal cell reselection process. The MM connection establishment may be initiated by CM layer if it is still necessary, i.e. when access is granted or because of a cell change.</p>
<ol>
<li>f) Indication that a CS fallback to GERAN or UTRAN has failed</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If EMM indicates that the CS fallback to GERAN or UTRAN failed, the MM sublayer shall abort the MM connection establishment and inform the requesting CM sublayer.</p>
<ol>
<li>g) "Extended wait time" for CS domain from the lower layers</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall abort the MM connection establishment and stop timer T3230 if still running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the CM SERVICE REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the MS shall start timer T3246 with the "Extended wait time" value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In other cases the MS shall ignore the "Extended wait time".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM connection establishment is started, if still necessary, when timer T3246 expires or is stopped.</p>
<ol>
<li>h) Timer T3246 is running</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM connection establishment shall not be initiated unless the MS is establishing an emergency call or the MS is an MS configured to use AC11 &ndash; 15 in selected PLMN. The MS stays in the current serving cell and applies normal cell reselection process. The MM connection establishment is started, if still necessary, when timer T3246 expires or is stopped.</p>
<p>Network side:</p>
<ol>
<li>a) RR connection failure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The actions to be taken upon RR connection failure within a MM common procedure are described together with that procedure. A RR connection failure occurring outside such MM common procedures, shall trigger the release of all active MM connections if any.</p>
<ol>
<li>b) Invalid message or message content</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon reception of an invalid initial message or a CM SERVICE REQUEST message with invalid content, a CM SERVICE REJECT message shall be returned with one of the following appropriate Reject cause indications:</p>
<p>#&nbsp; 95:&nbsp;&nbsp; Semantically incorrect message</p>
<p>#&nbsp; 96:&nbsp;&nbsp; Mandatory information element error</p>
<p>#&nbsp; 97:&nbsp;&nbsp; Message type non-existent or not implemented</p>
<p>#&nbsp; 99:&nbsp;&nbsp; Information element non-existent or not implemented</p>
<p># 100:&nbsp;&nbsp;&nbsp; Conditional IE error</p>
<p># 111:&nbsp;&nbsp;&nbsp; Protocol error, unspecified</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; When the CM SERVICE REJECT message has been sent, the network may start RR connection release if no other MM connections exist or if the abnormal condition also has influence on the other MM connections.</p>
<h4><a name="_Toc171523919"></a>4.5.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM connection establishment initiated by the network</h4>
<h5><a name="_Toc171523920"></a>4.5.1.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mobile Terminating CM Activity</h5>
<p>When a CM sublayer entity in the network requests the MM sublayer to establish a MM connection, the MM sublayer will request the establishment of an RR connection to the RR sublayer if no RR connection to the desired mobile station exists. The MM sublayer is informed when the paging procedure is finished (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;3.3.2 and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) and the mobile station shall enter the MM state WAIT FOR NETWORK COMMAND and stop the timer T3246 if running.</p>
<p>In A/Gb mode, when an RR connection is established (or if it already exists at the time the request is received), the MM sublayer may initiate any of the MM common procedures (except IMSI detach); it may request the RR sublayer to perform the RR classmark interrogation procedure, and/or the security mode setting procedure.</p>
<p>In Iu mode, when an RR connection is established (or if it already exists at the time the request is received), the MM sublayer may initiate any of the MM common procedures (except IMSI detach); it may request the RR sublayer to perform the security mode control procedure.</p>
<p>When all MM and RR procedures are successfully completed which the network considers necessary, the MM sublayer will inform the requesting mobile terminating CM sublayer entity on the success of the MM connection establishment.</p>
<p>If an RR connection already exists and no MM specific procedure is running, the network may also establish a new mobile terminating MM connection by sending a CM message with a new PD/TI combination.</p>
<p>If the MS receives the first CM message in the MM states WAIT FOR NETWORK COMMAND or RR CONNECTION RELEASE NOT ALLOWED, the MS shall stop and reset the timers T3240 and T3241 and shall enter the MM state MM CONNECTION ACTIVE.</p>
<p>In A/Gb mode, if the establishment of an RR connection is unsuccessful, or if any of the MM common procedures or the security mode setting fail, this is indicated to the CM layer with an appropriate error cause.</p>
<p>In Iu mode, if the establishment of an RR connection is unsuccessful, or if any of the MM common procedures or the security mode control fail, this is indicated to the CM layer with an appropriate error cause.</p>
<p>If an RR connection used for a MM specific procedure exists to the mobile station, the CM request may be rejected or delayed depending on implementation. When the MM specific procedure has been completed, the network may use the same RR connection for the delayed CM request.</p>
<p>Only applicable in case of VGCS talking:</p>
<p>In the MM CONNECTION ACTIVE (GROUP TRANSMIT MODE) the mobile station is in RR Group transmit mode. There shall be only one MM connection active.</p>
<p>When in MM CONNECTION ACTIVE (GROUP TRANSMIT MODE) state, the MM sublayer in the network shall reject the request for the establishment of another MM connection by any CM layer.</p>
<p>If the RR sublayer in the network indicates a request to perform a transfer of the mobile station from RR connected mode to RR Group transmit mode which will result in a transition from MM CONNECTION ACTIVE state to MM CONNECTION ACTIVE (GROUP TRANSMIT MODE) state in the MM sublayer, the MM sublayer shall not allow the transition if more than one MM connection is active with the mobile station.</p>
<h5><a name="_Toc171523921"></a>4.5.1.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mobile Originating CM Activity $(CCBS)$</h5>
<p>When a CM sublayer entity in the network requests the MM sublayer to establish a MM connection, the MM sublayer will request the establishment of an RR connection to the RR sublayer if no RR connection to the desired mobile station exists. The MM sublayer is informed when the paging procedure is finished (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;3.3.2 and 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) and the mobile station shall enter the MM state WAIT FOR NETWORK COMMAND.</p>
<p>In A/Gb mode, when an RR connection is established (or if it already exists at the time the request is received), the MM sublayer may initiate any of the MM common procedures (except IMSI detach), it may request the RR sublayer to perform the RR classmark interrogation procedure and/or the security mode setting procedure.</p>
<p>In Iu mode, when an RR connection is established (or if it already exists at the time the request is received), the MM sublayer may initiate any of the MM common procedures (except IMSI detach), it may request the RR sublayer to perform the security mode control procedure.</p>
<p>The network should use the information contained in <em>the Mobile Station Classmark Type</em> 2 IE on the mobile station's support for "Network Initiated MO CM Connection Request" to determine whether to:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; not start this procedure (eg if an RR connection already exists), or,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; to continue this procedure, or,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; to release the newly established RR connection.</p>
<p>In the case of a "Network Initiated MO CM Connection Request" the network shall use the established RR connection to send a CM SERVICE PROMPT message to the mobile station.</p>
<p>If the mobile station supports "Network Initiated MO CM Connection Request", the MM sublayer of the MS gives an indication to the CM entity identified by the CM SERVICE PROMPT message and enters the MM sublayer state PROCESS CM SERVICE PROMPT. In the state PROCESS CM SERVICE PROMPT the MM sublayer waits for either the rejection or confirmation of the recall by the identified CM entity. Any other requests from the CM entities shall either be rejected or delayed until this state is left.</p>
<p>When the identified CM entity informs the MM sublayer, that it has send the first CM message in order to start the CM recall procedure the MM sublayer enters the state MM CONNECTION ACTIVE.</p>
<p>If the identified CM entity indicates that it will not perform the CM recall procedure and all MM connections are released by their CM entities the MS shall proceed according to subclause&nbsp;4.5.3.1.</p>
<p>If the CM SERVICE PROMPT message is received by the MS in MM sublayer states WAIT FOR OUTGOING MM CONNECTION or in WAIT FOR ADDITIONAL OUTGOING MM CONNECTION then the mobile station shall send an MM STATUS message with cause " Message not compatible with protocol state".</p>
<p>A mobile that does not support "Network Initiated MO CM Connection Request" shall return an MM STATUS message with cause #97 "message type non-existent or not implemented" to the network.</p>
<p>If the mobile station supports "Network Initiated MO CM Connection Request" but the identified CM entity in the mobile station does not provide the associated support, then the mobile station shall send an MM STATUS message with cause "Service option not supported". In the case of a temporary CM problem (eg lack of transaction identifiers) then the mobile station shall send an MM STATUS message with cause "Service option temporarily out of order".</p>
<p>If an RR connection already exists and no MM specific procedure is running, the network may use it to send the CM SERVICE PROMPT message.</p>
<p>In A/Gb mode, if the establishment of an RR connection is unsuccessful, or if any of the MM common procedures or the security mode setting fail, this is indicated to the CM layer in the network with an appropriate error cause.</p>
<p>In Iu mode, if the establishment of an RR connection is unsuccessful, or if any of the MM common procedures or the security mode control fail, this is indicated to the CM layer in the network with an appropriate error cause.</p>
<p>If an RR connection used for a MM specific procedure exists to the mobile station, the "Network Initiated MO CM Connection Request" may be rejected or delayed depending on implementation. When the MM specific procedure has been completed, the network may use the same RR connection for the delayed "Network Initiated MO CM Connection Request".</p>
<h5><a name="_Toc171523922"></a>4.5.1.3.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Paging response in Iu mode (Iu mode only)</h5>
<p>The network may initiate the paging procedure for CS services when the MS is IMSI attached for CS services. To initiate the procedure, the MM entity requests the RR sublayer to initiate paging (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c], 3GPP&nbsp;TS&nbsp;25.413&nbsp;[19c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]) for CS services.</p>
<p>At reception of a paging message, the RR sublayer in the MS shall deliver a paging indication to the MM sublayer if the paging was initiated by the MM entity in the network (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]) and the MS shall stop the timer T3246, if running. The MS shall respond with the PAGING RESPONSE message defined in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84], subclause&nbsp;9.1.25. For reasons of backward compatibility the paging response shall use the RR protocol discriminator.</p>
<p>If the MS receives a paging request for CS services during an ongoing MM procedure, and the MS has already requested the establishment of a radio connection, the MS shall ignore the paging request and the MS and the network shall continue the MM procedure.</p>
<h5><a name="_Toc171523923"></a>4.5.1.3.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Paging response for CS fallback</h5>
<p>The network may initiate the paging procedure for CS services when the MS is IMSI attached for CS services via EMM combined procedures, as described in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120].</p>
<p>At reception of an indication of paging for CS services from EMM, the MS shall stop timer T3246, if it is running. The MM sublayer in the MS requests EMM to perform the service request procedure for CS fallback.</p>
<p>After the MS changes to a GERAN or UTRAN cell, the MS shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; In A/Gb mode: ask for the establishment of an RR connection and proceed as if a paging has been received in the lower layers;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; In Iu mode: ask for the establishment of an RRC connection and respond with the PAGING RESPONSE message defined in 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84], subclause&nbsp;9.1.25. For reasons of backward compatibility the paging response shall use the RR protocol discriminator.</p>
<p>If the MS determines, before sending the response to paging, that it is in a different location area than the stored location area, the MS shall initiate a normal location updating procedure first, regardless of Network Mode of Operation. Additionally the MS performs routing area updating as specified in subclause&nbsp;4.7.5. If the location area of the current cell is not available, the MS may initiate a normal location updating procedure directly.</p>
<p>When initiating the location updating procedure, the MS shall indicate "CS fallback mobile terminating call" in the Additional update parameters IE and the MS shall not include the MS network feature support IE. The MM connection establishment is delayed until successful completion of the normal location updating procedure. After the completion of the normal location updating procedure, the MS shall not send the PAGING RESPONSE message.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For the race condition when the mobile station has a CM application request pending, the mobile station also indicates that it has a follow-on request pending.</p>
<h4><a name="_Toc171523924"></a>4.5.1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases</h4>
<p>The behaviour upon abnormal events is described together with the relevant RR procedure or MM common procedure.</p>
<p>In addition, the following abnormal events can be identified:</p>
<ol>
<li>a) Indication that a CS fallback to GERAN or UTRAN has failed</li>
</ol>
<p>If EMM indicates that the CS fallback to GERAN or UTRAN failed, the MM sublayer shall abort the paging response procedure.</p>
<ol>
<li>b) Paging message for an MS which is IMSI attached for GPRS and for non-GPRS services in order to obtain GPRS services and "SMS-only service"</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS that received the GPRS-SMS indicator set to "0" at the last combined GPRS attach or combined routing area updating procedure may ignore the paging for CS services.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS that requested "SMS-only service" in the combined GPRS attach procedure or combined routing area updating procedure may ignore the paging for CS services.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A network that is compliant with the earlier versions of the protocol will implicitly indicate to the MS that the delivery of SMS via GPRS is always supported, i.e. as GPRS-SMS indicator set to "0", even if it does not provide this support to the MS. The MS can&nbsp; learn&nbsp; whether SMS over GPRS is provided by using the mechanism defined in 3GPP&nbsp;TS&nbsp;24.011&nbsp;[22], subclause&nbsp;2.6. If the MS learns that SMS over GPRS is provided, the MS can ignore paging for CS services.</p>
<h4><a name="_Toc171523925"></a>4.5.1.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM connection establishment for emergency calls</h4>
<p>A MM connection for an emergency call may be established in all states of the mobility management sublayer which allow MM connection establishment for a normal originating call. In addition, establishment may be attempted in all service states where a cell is selected (see subclause&nbsp;4.2.2) but not in the MM CONNECTION ACTIVE state (GROUP TRANSMIT MODE) state. However, as a network dependent option, a MM connection establishment for emergency call may be rejected in some of the states.</p>
<p>When a user requests an emergency call establishment the mobile station will send a CM SERVICE REQUEST message to the network with a CM service type information element indicating emergency call establishment. If the network does not accept the emergency call request, e.g., because IMEI was used as identification and this capability is not supported by the network, the network will reject the request by returning a CM SERVICE REJECT message to the mobile station.</p>
<p>The reject cause information element indicates the reason for rejection. The following cause values may apply:</p>
<p>#3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Illegal MS"</p>
<p>#4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "IMSI unknown in VLR"</p>
<p>#5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "IMEI not accepted"</p>
<p>#6&nbsp; "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Illegal ME"</p>
<p>#17&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Network failure"</p>
<p>#22&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Congestion"</p>
<p>#25&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Not authorized for this CSG"</p>
<p>#32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Service option not supported"</p>
<p>#34&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Service option temporarily out of order"</p>
<p>With the above defined exceptions, the procedures described for MM connection establishment in subclauses&nbsp;4.5.1.1 and 4.5.1.2 shall be followed.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Normally, the mobile station will be identified by an IMSI or a TMSI. However, if none of these identifiers is available in the mobile station, then the mobile station shall use the IMEI for identification purposes. The network may in that case reject the request by returning a CM SERVICE REJECT message with reject cause: #5&nbsp;&nbsp;&nbsp; "IMEI not accepted".</p>
<h4><a name="_Toc171523926"></a>4.5.1.5a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM connection establishment for emergency calls for CS fallback</h4>
<p>When the MS is in NO CELL AVAILABLE state, camped on an E-UTRAN cell, and IMSI attached for CS services via EMM combined procedures, as described in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120], the MM sublayer requests EMM to initiate a service request procedure for mobile originating CS fallback emergency call, irrespective of whether timer T3246 is running. The MM connection establishment is delayed until the mobile station changes to a GERAN or UTRAN cell. After this point, the behaviour specified in subclause&nbsp;4.5.1.5 applies.</p>
<p>When the MS is not IMSI attached for CS services via EMM combined procedures, as described in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120], and the MS is camping on an E-UTRAN cell, the MS shall perform any cell selection to GERAN or UTRAN (see 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98]). The MM connection establishment is delayed until the MS changes to a GERAN or UTRAN cell. After this point, the behaviour specified in subclause&nbsp;4.5.1.5 applies.</p>
<h4><a name="_Toc171523927"></a>4.5.1.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Call re-establishment</h4>
<p>The re-establishment procedure allows a MS to resume a connection in progress after a radio link failure, possibly in a new cell and possibly in a new location area. The conditions in which to attempt call re-establishment or not depend on the call control state, see subclause&nbsp;5.5.4 and, whether or not a cell allowing call re-establishment has been found (as described in 3GPP&nbsp;TS&nbsp;45.008&nbsp;[34]). MM connections are identified by their protocol discriminators and transaction identifiers: these shall not be changed during call re-establishment.</p>
<p>The re-establishment takes place when a lower layer failure occurs and at least one MM connection is active (i.e. the mobile station's MM sublayer is either in state 6 "MM CONNECTION ACTIVE" or state 20 "WAIT FOR ADDITIONAL OUTGOING MM CONNECTION").</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; During a re-establishment attempt the mobile station does not return to the MM IDLE state; thus no location updating is performed even if the mobile is not updated in the location area of the selected cell.</p>
<p>No call re-establishment shall be performed for voice group and broadcast calls.</p>
<h5><a name="_Toc171523928"></a>4.5.1.6.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Call re-establishment, initiation by the mobile station</h5>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The network is unable to initiate call re-establishment.</p>
<p>If at least one request to re-establish an MM connection is received from a CM entity as a response to the indication that the MM connection is interrupted (see subclause&nbsp;4.5.2.3.) the mobile station initiates the call re-establishment procedure. If several CM entities request re-establishment only one re-establishment procedure is initiated. If any CM entity requests re-establishment, then re-establishment of all transactions belonging to all Protocol Discriminators that permit Call Re-establishment shall be attempted.</p>
<p>Upon request of a CM entity to re-establish an MM connection the MM sublayer requests the RR sublayer to establish an RR connection and enters MM sublayer state WAIT FOR REESTABLISH. This request contains an establishment cause and a CM RE-ESTABLISHMENT REQUEST message. When the establishment of an RR connection is indicated by the RR sublayer, the MM sublayer of the mobile station starts timer T3230, gives an indication to all CM entities that are being re-established, and remains in the MM sublayer state WAIT FOR REESTABLISH.</p>
<p>The CM RE-ESTABLISHMENT REQUEST message contains the</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; mobile identity according to subclause&nbsp;10.5.1.4;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; mobile station classmark 2;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ciphering key sequence number.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Whether or not a CM entity can request re-establishment depends upon the Protocol Discriminator. The specifications for Short Message Service (3GPP&nbsp;TS&nbsp;24.011&nbsp;[22]), Call Independent Supplementary Services (3GPP&nbsp;TS&nbsp;24.010&nbsp;[21]) and Location Services (3GPP&nbsp;TS&nbsp;44.071&nbsp;[23a]) do not currently specify any re-establishment procedures.</p>
<p>For a shared GERAN in A/Gb mode, if the MS is a GERAN network sharing supporting MS, the chosen PLMN identity shall be indicated to the GERAN in the CM RE-ESTABLISHMENT REQUEST message using the Skip Indicator IE as specified in subclause&nbsp;10.3.1.</p>
<p>Upon receiving a CM RE-ESTABLISHMENT REQUEST message, the network shall analyse its content. Depending on the type of request, the network may start any of the MM common procedures and RR procedures.</p>
<p>The network may initiate the classmark interrogation procedure, for example, to obtain further information on the mobile station's encryption capabilities.</p>
<p>The identification procedure (see subclause&nbsp;4.3.3) may be invoked.</p>
<p>The network may invoke the authentication procedure (see subclause&nbsp;4.3.2).</p>
<p>In A/Gb mode, the network decides if the security mode setting procedure shall be invoked (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] subclause&nbsp;3.4.7).</p>
<p>An indication from the RR sublayer that the security mode setting procedure is completed, or reception of a CM SERVICE ACCEPT message, shall be treated as a service acceptance indication by the mobile station.</p>
<p>In Iu mode, the network decides if the security mode control procedure shall be invoked (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]). An indication from the RR sublayer that the security mode control procedure is completed, or reception of a CM SERVICE ACCEPT message, shall be treated as a service acceptance indication by the mobile station.</p>
<p>The MM connection re-establishment is completed, timer T3230 shall be stopped, all CM entities associated with the re-establishment shall be informed, and MM sublayer state MM CONNECTION ACTIVE is re-entered. All the MM connections are considered to be active.</p>
<p>If the network cannot associate the re-establishment request with any existing call for that mobile station, a CM SERVICE REJECT message is returned with the reject cause:</p>
<p>#38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "call cannot be identified"</p>
<p>If call re-establishment cannot be performed for other reasons, a CM SERVICE REJECT is returned, the appropriate reject cause may be any of the following (see annex G):</p>
<p># 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "IMSI unknown in VLR";</p>
<p># 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "illegal ME";</p>
<p>#17&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "network failure";</p>
<p>#22&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "congestion";</p>
<p>#25&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "not authorized for this CSG";</p>
<p>#32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "service option not supported";</p>
<p>#34&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "service option temporarily out of order".</p>
<p>If the service request is rejected due to general NAS level mobility management congestion control, the network shall set the MM cause value to #22 "congestion" and assign a back-off timer T3246 (see 3GPP&nbsp;TS&nbsp;23.012&nbsp;[140]).</p>
<p>Whatever the reject cause a mobile station receiving a CM SERVICE REJECT as a response to the CM RE-ESTABLISHMENT REQUEST shall stop T3230, release all MM connections and proceed as described in subclause&nbsp;4.5.3.1. In addition:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if cause value #4 is received, the mobile station deletes any TMSI, LAI and ciphering key sequence number in the SIM/USIM, changes the update status to NOT UPDATED (and stores it in the SIM/USIM according to subclause&nbsp;4.1.2.2), and enters the MM sublayer state WAIT FOR NETWORK COMMAND. If subsequently the RR connection is released or aborted, this will force the mobile station to initiate a normal location updating. The CM re-establishment request shall not be memorized during the location updating procedure.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if cause value #6 is received, the mobile station deletes any TMSI, LAI and ciphering key sequence number in the SIM/USIM, changes the update status to ROAMING NOT ALLOWED (and stores it in the SIM/USIM according to subclause&nbsp;4.1.2.2), and enters the MM sublayer state WAIT FOR NETWORK COMMAND. The MS shall consider the SIM/USIM as invalid for non-GPRS services until switch-off or the SIM/USIM is removed.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If cause value # 22 is received, the T3246 value IE is present in the CM SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall abort the re-establishment, release any MM connections, and proceed as specified in subclause&nbsp;4.5.3.1. The MS shall stop timer T3246 if it is running. If the CM SERVICE REJECT message is integrity protected, the MS shall start timer T3246 with the value provided in the T3246 value IE. If the CM SERVICE REJECT message is not integrity protected, the MS shall start timer T3246 with a random value from the default range specified in table&nbsp;11.1. The MS stays in the current serving cell and applies the normal cell reselection process. The CM RE-ESTABLISHMENT REQUEST procedure should not be restarted when timer T3246 expires or is stopped.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If cause value #22 is received, the T3246 value IE is not present in the CM SERVICE REJECT message or if the value provided in the T3246 value IE indicates that this timer is zero or deactivated, the MS shall abort the re-establishment, release any MM connections, and proceed as specified in subclause&nbsp;4.5.3.1.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if cause value #25 is received from a CSG cell and the mobile station is in UTRAN Iu mode, the MS shall check whether the CM SERVICE REJECT message with cause #25 is integrity protected. If the message is not integrity protected, the MS shall discard the message. Otherwise, the MS shall remove the entry corresponding to the CSG ID and associated PLMN identity of the cell where the MS has sent the CM SERVICE REQUEST message from the Allowed CSG list if the CSG ID and associated PLMN identity are contained in the Allowed CSG list, and enter the MM sublayer state WAIT FOR NETWORK COMMAND. If the CSG ID and associated PLMN identity of the cell where the MS has sent the CM SERVICE REQUEST message is contained in the Operator CSG list, the MS shall proceed as specified in 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14] subclause&nbsp;3.1A.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If cause value #25 is received and the cell is not a CSG cell or the MS is not in UTRAN Iu mode, the MS shall discard the CM SERVICE REJECT message.</p>
<h5><a name="_Toc171523929"></a>4.5.1.6.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases</h5>
<p>Mobile station side:</p>
<ol>
<li>a) Random access failure or RR connection establishment failure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the mobile station detects a random access failure or RR connection establishment failure during the re-establishment of an MM connection, the re-establishment is aborted and all MM connections are released.</p>
<ol>
<li>b) RR connection failure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If a RR connection failure occurs, timer T3230 is stopped, the re-establishment is aborted and all active MM connections are released.</p>
<ol>
<li>c) IMSI deactivation</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the IMSI deactivated during the re-establishment attempt then timer T3230 is stopped, the re-establishment is aborted and all MM connections are released.</p>
<ol>
<li>d) T3230 expires</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If T3230 expires (i.e. no response is given but a RR connection is available) the re-establishment is aborted, all active MM connections are released and the mobile station proceeds as described in subclause&nbsp;4.5.3.1.</p>
<ol>
<li>e) Reject causes #96, #97, #99, #100, #111 received</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall perform the same actions as if timer T3230 had expired.</p>
<p>Network side:</p>
<ol>
<li>a) RR connection failure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If a RR connection failure occurs after receipt of the CM RE-ESTABLISHMENT REQUEST the network shall release all MM connections.</p>
<ol>
<li>b) Invalid message content</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon reception an invalid initial of message or a CM RE-ESTABLISHMENT REQUEST message with invalid content, a CM SERVICE REJECT message shall be returned with one of the following appropriate Reject cause indications:</p>
<p>#96:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mandatory information element error</p>
<p>#99:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Information element non-existent or not implemented</p>
<p>#100:&nbsp;&nbsp;&nbsp;&nbsp; Conditional IE error</p>
<p>#111:&nbsp;&nbsp;&nbsp;&nbsp; Protocol error, unspecified</p>
<p>When the CM SERVICE REJECT message has been sent, the network shall release the RR connection.</p>
<h4><a name="_Toc171523930"></a>4.5.1.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Forced release during MO MM connection establishment</h4>
<p>If the mobile station's CM layer initiated the MM connection establishment but the CM layer wishes to abort the establishment prior to the completion of the establishment phase, the mobile station shall send a CM SERVICE ABORT message any time after the completion of the RR connection and not after the first CM message (e.g. SETUP) is sent.</p>
<p>If the first CM message has already been sent, the normal release procedure defined by the appropriate CM protocol applies and the CM SERVICE ABORT shall not be sent.</p>
<p>Sending of the CM SERVICE ABORT message is only allowed during the establishment of the first MM connection, where no other MM connection exists in parallel. If parallel MM connections exist already, a new connection establishment cannot be aborted and normal MM connection release according to subclause&nbsp;4.5.3 applies after MM connection establishment.</p>
<p>Upon transmission of the CM SERVICE ABORT message the mobile station shall stop timer T3230 and shall follow the procedures specified in subclause&nbsp;4.5.3.1.</p>
<p>Upon receipt of the CM SERVICE ABORT message the network shall abort ongoing processes, release the appropriate resources, and unless another MM connection establishment is pending or an RRLP procedure (see 3GPP&nbsp;TS&nbsp;44.031&nbsp;[23b]) or LCS procedure over RRC (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) is ongoing, initiate a normal release of the RR connection.</p>
<h4><a name="_Toc171523931"></a>4.5.1.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM connection establishment due to SRVCC or vSRVCC handover</h4>
<p>An MM connection can be established locally in the MS due to an SRVCC or vSRVCC handover (see 3GPP&nbsp;TS&nbsp;23.216&nbsp;[126]), i.e. without dedicated MM signalling. That is the case when the MS has:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a voice media stream carried over the PS domain that is handed over to the CS domain in A/Gb mode or Iu mode via SRVCC;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a voice media stream and a video media stream of a single session carried over the PS domain in S1 mode that is handed over to the CS domain in Iu mode via vSRVCC;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a voice media stream and a video media stream of a single session carried over the PS domain in S1 mode but only the voice media stream is handed over to the CS domain in A/Gb mode via SRVCC; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a voice media stream carried over the PS domain in N1 mode that is handed over to the CS domain in Iu mode via 5G-SRVCC handover from NG-RAN to UTRAN.</p>
<p>An MS in MM state MM IDLE shall establish the MM connection locally when it receives an indication from lower layers that either a voice only SRVCC handover or a voice and video SRVCC handover was completed successfully.</p>
<p>After completing MM connection establishment, the MM layer shall indicate "MM connection establishment due to SRVCC handover" or "MM connection establishment due to vSRVCC handover" to the upper layer and shall enter state MM CONNECTION ACTIVE.</p>
<h4><a name="_Toc171523932"></a>4.5.1.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM connection establishment due to Dual Radio Voice Call Continuity (DRVCC) access transfer</h4>
<p>The MM Connection establishment procedures for a dual radio voice call continuity (DRVCC) access transfer follow the procedures described in subclause&nbsp;4.5.1.1 with the following additions:</p>
<p>Upon request from the upper layers to set up a DRVCC call, the MS shall initiate the MM connection establishment and send a CM SERVICE REQUEST message. The MS shall include the Additional update parameters information element indicating "DRVCC call". If the MS determines that it is in a different location area than the stored location area, the MS shall first initiate a normal location updating procedure regardless of Network Mode of Operation. The MS shall indicate "follow-on request pending", shall include the Additional update parameters information element indicating "DRVCC call", and shall not include the MS network feature support information element in the LOCATION UPDATING REQUEST message.</p>
<p>The network may use the "DRVCC call" indication to decide whether to initiate any of the MM common procedures.</p>
<p>If the MS and the network have an established GSM security context or UMTS security context, the MS and the network may take the key(s) of the established security context into use as specified in subclause 4.3.2.7a.</p>
<h3><a name="_Toc171523933"></a>4.5.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM connection information transfer phase</h3>
<p>After the MM connection has been established, it can be used by the CM sublayer entity for information transfer. According to the protocol architecture described in 3GPP&nbsp;TS&nbsp;24.007&nbsp;[20], each CM entity will have its own MM connection. These different MM connections are identified by the protocol discriminator PD and, additionally, by the transaction identifier TI.</p>
<p>All MM common procedures may be initiated at any time while MM connections are active. Except for Short Message Control which uses a separate layer 2 low priority data link, no priority mechanism is defined between the CM, MM and RR sublayer messages.</p>
<h4><a name="_Toc171523934"></a>4.5.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sending CM messages</h4>
<p>A CM sublayer entity, after having been advised that a MM connection has been established, can request the transfer of CM messages. The CM messages passed to the MM sublayer are then sent to the other side of the interface with the PD and TI set according to the source entity.</p>
<h4><a name="_Toc171523935"></a>4.5.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Receiving CM messages</h4>
<p>Upon receiving a CM message, the MM sublayer will distribute it to the relevant CM entity according to the PD value and TI value. However, if the received CM message is the first for the MM connection (identified by PD and TI), the MM sublayer will in addition indicate to the CM entity that a new MM connection has been established.</p>
<h4><a name="_Toc171523936"></a>4.5.2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases</h4>
<p>RR connection failure:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the RR connection failure occurs during a RR or MM common procedure, the consequent actions are described together with that procedure.</p>
<p>In other cases, the following applies:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Mobile station:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer shall indicate to all CM entities associated with active MM connections that the MM connection is interrupted, the subsequent action of the MM sublayer (call re-establishment, see 4.5.1.6, or local release) will then depend on the decisions by the CM entities.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Network:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MM sublayer shall locally release all active MM connections. As an option the network may delay the release of all or some of the MM connections to allow the mobile station to initiate call re-establishment.</p>
<h3><a name="_Toc171523937"></a>4.5.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MM connection release</h3>
<p>An established MM connection can be released by the local CM entity. The release of the CM connection will then be done locally in the MM sublayer, i.e. no MM message are sent over the radio interface for this purpose.</p>
<h4><a name="_Toc171523938"></a>4.5.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Release of associated RR connection</h4>
<p>If all MM connections are released by their CM entities, and no RRLP procedure (see 3GPP&nbsp;TS&nbsp;44.031&nbsp;[23b]) and no LCS procedure over RRC (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) is ongoing, the mobile station shall set timer T3240 and enter the state WAIT FOR NETWORK COMMAND, expecting the release of the RR connection.</p>
<p>If all MM connections are released by their CM entities and an RRLP procedure or LCS procedure over RRC is ongoing, the MS shall start the timer T3241 and enter the state RR CONNECTION RELEASE NOT ALLOWED.</p>
<p>If the MS is expecting the release of the RR connection in MM state WAIT FOR NETWORK COMMAND and an RRLP procedure or LCS procedure over RRC is started, the MS shall stop the timer T3240, start the timer T3241 and enter the state RR CONNECTION RELEASE NOT ALLOWED.</p>
<p>If the MS is in MM state RR CONNECTION RELEASE NOT ALLOWED and the ongoing RRLP procedure or LCS procedure over RRC is finished, the MS shall stop the timer T3241, reset and start the timer T3240 and shall enter the state WAIT FOR NETWORK COMMAND.</p>
<p>If the MS receives the "Extended wait time" for CS domain from the lower layers when no location updating or CM service request procedure is ongoing, the MS shall ignore the "Extended wait time".</p>
<p>In the network, if the last MM connection is released by its user, the MM sublayer may decide to release the RR connection. The RR connection may be maintained by the network, e.g. in order to establish another MM connection.</p>
<p>If the RR connection is not released within a given time controlled by the timer T3240 or T3241, the mobile station shall abort the RR connection. In both cases, either after a RR connection release triggered from the network side or after a RR connection abort requested by the MS-side, the MS shall return to MM IDLE state; the service state depending upon the current update status as specified in subclause&nbsp;4.2.3. If the UE determines a service state in which a Location Update procedure is required, the UE shall reset the location update attempt counter and immediately start the Location Updating procedure as specified in subclause&nbsp;4.4.4.</p>
<h4><a name="_Toc171523939"></a>4.5.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Uplink release in a voice group call</h4>
<p>(Only applicable for mobile stations supporting VGCS talking:)</p>
<p>If a mobile station which is in the MM sublayer state MM CONNECTION ACTIVE (GROUP TRANSMIT MODE) receives a request from the GCC sublayer to perform an uplink release, the MM sublayer requests the RR sublayer to perform an uplink release procedure and enters the MM sublayer state RECEIVING GROUP CALL (NORMAL SERVICE).</p>
<h2><a name="_Toc171523940"></a>4.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Receiving a MM STATUS message by a MM entity.</h2>
<p>If the MM entity of the mobile station receives a MM STATUS message no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible.</p>
<p>With the exceptions described for the responses to the CM SERVICE PROMPT message, the actions to be taken on receiving a MM STATUS message in the network are an implementation dependent option.</p>
<h2><a name="_Toc171523941"></a>4.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Elementary mobility management procedures for GPRS services</h2>
<h3><a name="_Toc171523942"></a>4.7.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; General</h3>
<p>This subclause describes the basic functions offered by the mobility management (GMM) sublayer at the radio interface (reference point Um/UU). The functionality is described in terms of timers and procedures. During GMM procedures, procedures of CM layer services via the PS domain, e.g. SM, SMS, and SS, are suspended.</p>
<h4><a name="_Toc171523943"></a>4.7.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Lower layer failure</h4>
<p>The lower layers shall indicate a logical link failure or an RR sublayer failure or an RRC sublayer failure to the GMM sublayer. The failure indicates an error that cannot be corrected by the lower layers.</p>
<h4><a name="_Toc171523944"></a>4.7.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ciphering of messages (A/Gb mode only)</h4>
<p>If ciphering is to be applied on a GMM context, all GMM messages shall be ciphered except the following messages:</p>
<p>--&nbsp;&nbsp; ATTACH REQUEST;</p>
<p>--&nbsp;&nbsp; ATTACH REJECT;</p>
<p>--&nbsp;&nbsp; AUTHENTICATION AND CIPHERING REQUEST;</p>
<p>--&nbsp;&nbsp; AUTHENTICATION AND CIPHERING RESPONSE;</p>
<p>--&nbsp;&nbsp; AUTHENTICATION AND CIPHERING FAILURE;</p>
<p>--&nbsp;&nbsp; AUTHENTICATION AND CIPHERING REJECT;</p>
<p>--&nbsp;&nbsp; IDENTITY REQUEST;</p>
<p>--&nbsp;&nbsp; IDENTITY RESPONSE;</p>
<p>--&nbsp;&nbsp; ROUTING AREA UPDATE REQUEST; and</p>
<p>--&nbsp;&nbsp; ROUTING AREA UPDATE REJECT.</p>
<h4><a name="_Toc171523945"></a>4.7.1.2a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Integrity protection of layer 3 signalling messages (A/Gb mode only and when integrity protection is required)</h4>
<h5><a name="_Toc171523946"></a>4.7.1.2a.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; General</h5>
<p>The requirements in subclause&nbsp;4.7.1.2a are only applicable for MSs and networks supporting EC-GSM-IoT (see 3GPP&nbsp;TS&nbsp;43.064&nbsp;[159]).</p>
<p>For the MS, integrity protected signalling is mandatory for the GMM messages and SM messagres once a valid UMTS security context exists and has been taken into use. For the network, integrity protected signalling is mandatory for the GMM messages and SM messages once authentication and ciphering procedure is initiated by the network. Integrity protection of all GMM signalling messages and SM messages is the responsibility of the LLC layer. In addition, the GMM layer protects the AUTHENTICATION AND CIPHERING REQUEST message and the AUTHENTICATION AND CIPHERING RESPONSE message by a message authentication code (MAC) calculated at the GMM layer when an authentication takes place in the Authentication and Ciphering procedure. This message authentication code is included in the AUTHENTICATION AND CIPHERING REQUEST message and the AUTHENTICATION AND CIPHERING RESPONSE message. The GMM layer is always using the new UMTS security context derived from the AKA taking place in the Authentication and Ciphering procedure when calculating the message authentication code (MAC) at GMM layer.</p>
<p>The GMM layer activates integrity protection in the LLC layer by providing an indication when integrity protection shall be started.</p>
<p>Integrity protection is initiated in the MS upon request from the network. This is done using the authentication and ciphering procedure at the GMM layer (3GPP&nbsp;TS&nbsp;43.020&nbsp;[13] and 3GPP&nbsp;TS&nbsp;44.064&nbsp;[78a]).</p>
<p>Details of the integrity protection and verification of GMM signalling messages are specified in 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13].</p>
<h5><a name="_Toc171523947"></a>4.7.1.2a.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Integrity checking of GMM signalling messages in the MS</h5>
<p>Except the messages listed below, no GMM signalling messages shall be processed by the receiving GMM entity in the MS or forwarded to the SM entity, unless the use of integrity protection has been successfully negotiated:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM messages:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; IDENTITY REQUEST (only if the requested identification parameter is IMSI)</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ATTACH REJECT (if the cause is not #25)</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; AUTHENTICATION AND CIPHERING REJECT</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ROUTING AREA UPDATE REJECT (if the cause is not #25)</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; DETACH ACCEPT (for non power-off)</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; These messages are accepted by the MS without integrity protection, as in certain situations they are sent by the network before integrity protection can be activated.</p>
<p>All SM messages shall be integrity protected.</p>
<p>Once the integrity protection has been successfully negotiated, the receiving GMM or SM entity in the MS shall not process any GMM signalling messages unless they have been successfully integrity checked by the LLC layer. If GMM signalling messages, having not successfully passed the integrity check, are received, then the LLC layer in the MS discards that message. The processing of the AUTHENTICATION AND CIPHERING REQUEST message, at authentication, that has not successfully passed the integrity check at GMM layer is specified in subclause&nbsp;4.7.7.2. If any GMM or SM signalling message is received without integrity protection even though integrity protection has been successfully negotiated, then the GMM layer shall discard this message.</p>
<h5><a name="_Toc171523948"></a>4.7.1.2a.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Integrity checking of layer 3 signalling messages in the network</h5>
<p>Except the messages listed below, no GMM signalling messages shall be processed by the receiving GMM entity in the network or forwarded to the SM entity, unless integrity protection has been successfully negotiated:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM messages:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ATTACH REQUEST;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; IDENTITY RESPONSE (if requested identification parameter is IMSI);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; AUTHENTICATION AND CIPHERING FAILURE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; DETACH REQUEST;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; DETACH ACCEPT.</p>
<p>All SM messages are integrity protected.</p>
<p>Once a valid UMTS security context exists, until integrity protection has been successfully negotiated, the receiving GMM entity in the network shall process the following GMM signalling messages, even if the MAC included in the LLC frame carrying the GMM message fails the integrity check or cannot be verified in the LLC layer, as the UMTS security context is not available in the network:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ATTACH REQUEST;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; IDENTITY RESPONSE (if requested identification parameter is IMSI);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; AUTHENTICATION AND CIPHERING FAILURE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; DETACH REQUEST (if sent before integrity protection has been activated);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; DETACH ACCEPT;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ROUTING AREA UPDATE REQUEST;</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; These messages are processed by the GMM layer even when the MAC fails the integrity check or cannot be verified, as in certain situations they can be sent by the MS protected with an UMTS security context that is no longer available in the network.</p>
<p>If an ATTACH REQUEST message fails the integrity check, the network shall authenticate the subscriber before processing the attach request any further.</p>
<p>If a ROUTING AREA UPDATE REQUEST message fails the integrity check, the network shall initiate an re-authentication of the subscriber by initiating an authentication and ciphering procedure.</p>
<p>Once integrity protection has been successfully negotiated, the receiving GMM or SM entity in the network shall not process any GMM or SM signalling messages unless they have been successfully integrity checked by the LLC layer. If any GMM or SM signalling message, having not successfully passed the integrity check, is received, then the LLC layer in the network discards that message. The processing of the AUTHENTICATION AND CIPHERING RESPONSE message when authentication is taking place, that has not successfully passed the integrity check at GMM layer is specified in subclause&nbsp;4.7.7.3. If any GMM or SM signalling message is received, as not integrity protected even though integrity protection has been successfully negotiated, then the GMM layer shall discard this message.</p>
<h5><a name="_Toc171523949"></a>4.7.1.2a.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Establishment of integrity protection of layer 3 signalling messages</h5>
<p>Establishment of integrity protection of layer 3 signalling messages and optionally user plane data is done during the attach procedure. The MS shall indicate support for integrity protection in the MS network capability IE included in the ATTACH REQUEST message and the ROUTING AREA UPDATE REQUEST message to the network.</p>
<p>When an MS sends an ATTACH REQUEST message or a ROUTING AREA UPDATE REQUEST message, then if the MS has no UMTS security context, it shall send the ATTACH REQUEST or the ROUTING AREA UPDATE REQUEST message without integrity protection to the network. If the network supports integrity protection, then the network activates integrity protection by initiating an authentication and ciphering procedure. The network selects an integrity algorithm among the supported integrity algorithms indicated by the MS in the MS network capability IE. After successful completion of the authentication and ciphering procedure, all layer 3 signalling messages sent between the MS and network are integrity protected in the LLC layer using the new UMTS security context.</p>
<p>When an MS sends an ATTACH REQUEST message or a ROUTING AREA UPDATE REQUEST message, then if the MS has a UMTS security context, it shall send the ATTACH REQUEST or the ROUTING AREA UPDATE REQUEST message integrity protected with the current UMTS security context to the network. The MS shall include the CKSN indicating the current UMTS security context value in the initial ATTACH REQUEST message or a ROUTING AREA UPDATE REQUEST message. The MS shall use the integrity algorithm identified by the stored integrity algorithm identifier. The network shall check whether the CKSN included in the initial ATTACH REQUEST message or the ROUTING AREA UPDATE REQUEST message belongs to an UMTS security context available in the network, and if yes, then the network re-establishes integrity protection of layer 3 signalling messages in the LLC layer:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; by replying with a GMM message (ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT) that is integrity protected in LLC layer by using the current UMTS security context. From this time onward, all layer&nbsp;3 signalling messages exchanged between the MS and the network are sent integrity protected, except for the messages specified in subclause&nbsp;4.7.1.2a; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; by initiating an authentication and ciphering procedure. This procedure can be used by the network to select a new integrity algorithm different from the one currently used by the MS.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Even if the message authentication code protecting the ATTACH REQUEST or the ROUTING AREA UPDATE message in the LLC layer cannot be verified in the network due to the integrity key and the integrity algorithm in the LLC layer at the network not having been configured yet for this MS, the network progresses the attach procedure and the routing atra updating procedure at the GMM layer anyway without having to run a new authentication and ciphering procedure if the network decides to re-use the same encryption- and integrity keys and the same ciphering and integrity algorithms and not run a re-authentication.</p>
<h5><a name="_Toc171523950"></a>4.7.1.2a.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Optional establishment of integrity protection in the user plane</h5>
<p>If an MS supports integrity protection of user plane data, then the MS shall indicate in the MS network capability IE to the network that it supports integrity protection of user plane data when it sends an ATTACH REQUEST message or a ROUTING AREA UPDATE REQUEST message. If the network supports integrity protection of the user plane data, then the network shall indicate in the ATTACH ACCEPT message or the ROUTING AREA UPDATE ACCEPT message to the MS that integrity protection of user plane data shall be used.</p>
<h5><a name="_Toc171523951"></a>4.7.1.2a.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Change of security keys</h5>
<p>When the network initiates a re-authentication to create a new UMTS security context, the AUTHENTICATION AND CIPHERING REQUEST message and AUTHENTICATION AND CIPHERING RESPONSE message exchanged during the authentication and ciphering procedure are integrity protected with the new UMTS security context at GMM layer by including a MAC. The AUTHENTICATION AND CIPHERING REQUEST message and AUTHENTICATION AND CIPHERING RESPONSE message may be also integrity protected at the LLC layer using the current UMTS security context, if any. Both UE and network shall continue to use the current UMTS security context, until the network initiates a re-authentication in the authentication and ciphering procedure. The AUTHENTICATION AND CIPHERING REQUEST message sent by the network includes the CKSN of the new UMTS security context to be used. The SGSN shall send the AUTHENTICATION AND CIPHERING REQUEST message integrity protected with the new UMTS security context at GMM layer by including a MAC, but unciphered. When the UE responds with an AUTHENTICATION AND CIPHERING RESPONSE message, it shall send the message integrity protected with the new UMTS security context at GMM layer by including a MAC, but unciphered.</p>
<p>The UE shall take the new UMTS security context and the indicated integrity algorithm and encryption algorithm received in the AUTHENTICATION AND CIPHERING REQUEST message, into use in the LLC layer after sending the AUTHENTICATION AND CIPHERING RESPONSE message. The network shall take the new UMTS security context and the indicated integrity algorithm and encryption algorithm sent in the AUTHENTICATION AND CIPHERING REQUEST message, into use in the LLC layer in the network after receiving the AUTHENTICATION AND CIPHERING RESPONSE message and a successful check of the RES.</p>
<h4><a name="_Toc171523952"></a>4.7.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P-TMSI signature</h4>
<p>The network may assign a P-TMSI signature to an MS in an attach, routing area update, or P-TMSI reallocation procedure. Only in combination with a valid P-TMSI, this P-TMSI signature is used by the MS for authentication and identification purposes in the subsequent attach, routing area update or detach procedure. If the MS has no valid P-TMSI it shall not use the P-TMSI signature in the subsequent attach, routing area update or detach procedure. Upon successful completion of the subsequent attach or routing area update procedure, the used P-TMSI signature shall be deleted. Upon completion of an MS initiated detach procedure, the used P-TMSI signature shall be deleted. Upon completion of a network initiated detach procedure the P-TMSI signature shall be kept, unless explicitly specified otherwise in subclause&nbsp;4.7.4.2.2.</p>
<h4><a name="_Toc171523953"></a>4.7.1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Radio resource sublayer address handling</h4>
<p>In A/Gb mode, while a packet TMSI (P-TMSI) is used in the GMM sublayer for identification of an MS, a temporary logical link identity (TLLI) is used for addressing purposes at the RR sublayer.</p>
<p>In Iu mode a Radio Network Temporary Identity (RNTI) identifies a user between the MS and the UTRAN or GERAN. The relationship between RNTI and IMSI is known only in the MS and in the UTRAN, see 3GPP&nbsp;TS&nbsp;25.301&nbsp;[128].</p>
<h5><a name="_Toc171523954"></a>4.7.1.4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Radio resource sublayer address handling (A/Gb mode only)</h5>
<p>This subclause describes how the RR addressing is managed by GMM. For the detailed coding of the different TLLI types and how a TLLI can be derived from a P-TMSI, see 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10].</p>
<p>If the MS is configured for "AttachWithIMSI" as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112] and is entering a new PLMN which is neither the registered PLMN nor in the list of equivalent PLMNs, the MS should proceed as specified for case ii) below and use a randomly selected random TLLI for the transmission of the ATTACH REQUEST message.</p>
<p>For all other cases, the MS shall determine the TLLI as follows:</p>
<p>For an MS not supporting S1 mode, two cases can be distinguished:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a valid P-TMSI is available in the MS; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no valid P-TMSI is available in the MS.</p>
<ol>
<li>i) valid P-TMSI available</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS has stored a valid P-TMSI, the MS shall derive a foreign TLLI from that P-TMSI and shall use it for transmission of the:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ATTACH REQUEST message of any GPRS combined/non-combined attach procedure; other GMM messages sent during this procedure shall be transmitted using the same foreign TLLI until the ATTACH ACCEPT message or the ATTACH REJECT message is received; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ROUTING AREA UPDATE REQUEST message of a combined/non-combined RAU procedure if the MS has entered a new routing area, or if the GPRS update status is not equal to GU1 UPDATED. Other GMM messages sent during this procedure shall be transmitted using the same foreign TLLI, until the ROUTING AREA UPDATE ACCEPT message or the ROUTING AREA UPDATE REJECT message is received.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; After a successful GPRS attach or routing area update procedure, independent of whether a new P-TMSI is assigned, if the MS has stored a valid P-TMSI then the MS shall derive a local TLLI from the stored P-TMSI and shall use it for addressing at lower layers.</p>
<p>NOTE 1:&nbsp; Although the MS derives a local TLLI for addressing at lower layers, the network should not assume that it will receive only LLC frames using a local TLLI. Immediately after the successful GPRS attach or routing area update procedure, the network must be prepared to continue accepting LLC frames from the MS still using the foreign TLLI.</p>
<ol>
<li>ii) no valid P-TMSI available</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; When the MS has not stored a valid P-TMSI, i.e. the MS is not attached to GPRS, the MS shall use a randomly selected random TLLI for transmission of the:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ATTACH REQUEST message of any combined/non-combined GPRS attach procedure.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The same randomly selected random TLLI value shall be used for all message retransmission attempts and for the cell updates within one attach attempt.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon receipt of an ATTACH REQUEST message, the network shall assign a P-TMSI to the MS. The network derives a local TLLI from the assigned P-TMSI, and transmits the assigned P-TMSI to the MS.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon receipt of the assigned P-TMSI, the MS shall derive the local TLLI from this P-TMSI and shall use it for addressing at lower layers.</p>
<p>NOTE 2:&nbsp; Although the MS derives a local TLLI for addressing at lower layers, the network should not assume that it will receive only LLC frames using a local TLLI. Immediately after the successful GPRS attach, the network must be prepared to continue accepting LLC frames from the MS still using the random TLLI.</p>
<p>In both cases the MS shall acknowledge the reception of the assigned P-TMSI to the network. After receipt of the acknowledgement, the network shall use the local TLLI for addressing at lower layers.</p>
<p>For an MS supporting S1 mode, the following five cases can be distinguished:</p>
<ol>
<li>a) the TIN indicates "P-TMSI" or "RAT‑related TMSI" and the MS holds a valid P-TMSI and a RAI;</li>
<li>b) the TIN indicates "GUTI" and the MS holds a valid GUTI allocated by an MME;</li>
<li>c) the TIN is deleted and the MS holds a valid P-TMSI and RAI;</li>
<li>d) the TIN is deleted and the MS holds a valid GUTI allocated by an MME, but no valid P-TMSI and RAI; or</li>
<li>e) none of the previous cases is fulfilled.</li>
</ol>
<p>In case a) the MS shall derive a foreign TLLI from the P-TMSI and proceed as specified for case i) above.</p>
<p>In case b), the MS shall derive a P-TMSI from the GUTI and then a foreign TLLI from this P-TMSI and proceed as specified for case i) above.</p>
<p>NOTE 3:&nbsp; The mapping of the GUTI to the P-TMSI is specified in 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10].</p>
<p>In case c) the MS shall derive a foreign TLLI from the P-TMSI and proceed as specified for case i) above.</p>
<p>In case d) the MS shall derive a P-TMSI from the GUTI and then a foreign TLLI from this P-TMSI and proceed as specified for case i) above.</p>
<p>In case e) the MS shall proceed as as specified for case ii) above.</p>
<p>For transmission of an ATTACH REQUEST message, or a ROUTING AREA UPDATE REQUEST message after a routing area change, the MS also provides the lower layers with the DCN-ID according to the following rules:</p>
<ol>
<li>a) if a DCN-ID for the PLMN code of the selected PLMN is available in the MS, the MS shall provide this DCN-ID to the lower layers; or</li>
<li>b) if no DCN-ID for the PLMN code of the selected PLMN is available but a Default_DCN_ID value is available in the MS, as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or in USIM file NAS<sub>CONFIG</sub> as specified in 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112], the MS shall provide the Default_DCN_ID value to the lower layers.</li>
</ol>
<h4><a name="_Toc171523955"></a>4.7.1.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P-TMSI handling</h4>
<h5><a name="_Toc171523956"></a>4.7.1.5.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P-TMSI handling in A/Gb mode</h5>
<p>If a new P-TMSI is assigned by the network the MS and the network shall handle the old and the new P-TMSI as follows:</p>
<p>Upon receipt of a GMM message containing a new P-TMSI the MS shall consider the new P-TMSI and new RAI and also the old P-TMSI and old RAI as valid in order to react to paging requests and downlink transmission of LLC frames. For uplink transmission of LLC frames the new P-TMSI shall be used.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For the case of multiple consecutive P-TMSI REALLOCATION COMMAND messages, the old P-TMSI is the latest P-TMSI included by the network in a previous message different from the multiple consecutive P-TMSI REALLOCATION COMMAND messages.</p>
<p>The MS shall consider the old P-TMSI and old RAI as invalid as soon as an LLC frame is received with the local TLLI derived from the new P-TMSI.</p>
<p>Upon the transmission of a GMM message containing a new P-TMSI the network shall consider the new P-TMSI and new RAI and also the old P-TMSI and old RAI as valid in order to be able to receive LLC frames from the MS.</p>
<p>The network shall consider the old P-TMSI and old RAI as invalid as soon as an LLC frame is received with the local TLLI derived from the new P-TMSI.</p>
<h5><a name="_Toc171523957"></a>4.7.1.5.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P-TMSI handling in Iu mode</h5>
<p>If a new P-TMSI is assigned by the network the MS and the network shall handle the old and the new P-TMSI as follows:</p>
<p>Upon receipt of a GMM message containing a new P-TMSI the MS shall consider the new P-TMSI and new RAI as valid. Old P-TMSI and old RAI are regarded as invalid.</p>
<p>The network shall consider the old P-TMSI and old RAI as invalid as soon as an acknowledge message (e.g. ATTACH COMPLETE, ROUTING AREA UPDATE COMPLETE and P-TMSI REALLOCATION COMPLETE) is received.</p>
<h5><a name="_Toc171523958"></a>4.7.1.5.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Void</h5>
<h5><a name="_Toc171523959"></a>4.7.1.5.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Void</h5>
<h4><a name="_Toc171523960"></a>4.7.1.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Change of network mode of operation</h4>
<p>In the following tables below the abbreviations 'A/Gb mode I' and 'A/Gb mode II' are used for network operation mode I and II in A/Gb mode.</p>
<p>In the following tables below the abbreviations 'Iu mode I' and 'Iu mode II' are used for network operation modes I and II in Iu mode.</p>
<h5><a name="_Toc171523961"></a>4.7.1.6.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Change of network mode of operation in A/Gb mode (A/Gb mode only)</h5>
<p>Whenever an MS moves to a new RA, the procedures executed by the MS depend on the network mode of operation in the old and new routing area.</p>
<p>In case the MS is in state GMM REGISTERED or GMM ROUTING AREA UPDATING INITIATED and is in operation mode A or B, the MS shall execute according to table&nbsp;4.7.1.6.1-1:</p>
<p>Table 4.7.1.6.1-1/3GPP TS 24.008: Mode A or B</p>
<p>&nbsp;</p>
<table>
<tbody>
<tr>
<td width="149">
<p>Network operation mode change</p>
</td>
<td width="416">
<p>Procedure to execute</p>
</td>
</tr>
<tr>
<td width="149">
<p>I &reg; II (***)</p>
</td>
<td width="416">
<p>Normal Location Update(*),<br /> followed by a Normal Routing Area Update</p>
</td>
</tr>
<tr>
<td width="149">
<p>II &reg; I</p>
</td>
<td width="416">
<p>Combined Routing Area Update with IMSI attach(**)</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>(*)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Intended to remove the Gs association in the MSC/VLR.</p>
<p>(**)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Intended to establish the Gs association in the MSC/VLR.</p>
<p>(***)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS that needs only GPRS services and "SMS-only service" moves to a new routing area, see subclause&nbsp;4.1.1.2.2.</p>
<p>Further details are implementation issues.</p>
<h5><a name="_Toc171523962"></a>4.7.1.6.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Change of network mode of operation in Iu mode (Iu mode only)</h5>
<p>Whenever an MS moves to a new RA, the procedures executed by the MS depend on the network mode of operation in the old and new routing area.</p>
<p>In case the MS is in state GMM-REGISTERED or GMM-ROUTING-AREA-UPDATING-INITIATED and is in operation mode A, the MS shall execute:</p>
<p>Table 4.7.1.6.4/3GPP TS 24.008: Mode A</p>
<table>
<tbody>
<tr>
<td width="149">
<p>Network operation mode change</p>
</td>
<td width="416">
<p>Procedure to execute</p>
</td>
</tr>
<tr>
<td width="149">
<p>I &reg; II (***)</p>
</td>
<td width="416">
<p>Normal Location Update(*),<br /> followed by a Normal Routing Area Update</p>
</td>
</tr>
<tr>
<td width="149">
<p>II &reg; I</p>
</td>
<td width="416">
<p>Combined Routing Area Update with IMSI attach(**)</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>(*)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Intended to remove the Gs association in the MSC/VLR.</p>
<p>(**)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Intended to establish the Gs association in the MSC/VLR.</p>
<p>(***)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS that needs only GPRS services and "SMS-only service" moves to a new routing area, see subclause 4.1.1.2.2.</p>
<p>Further details are implementation issues.</p>
<h5><a name="_Toc171523963"></a>4.7.1.6.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Change of network mode of operation at Iu mode to A/Gb mode inter-system change</h5>
<p>Whenever an MS moves to a new RA supporting the A/Gb mode radio interface, the procedures executed by the MS depend on the network mode of operation in the old and new routing area.</p>
<p>In case the MS is in state GMM-REGISTERED or GMM-ROUTING-AREA-UPDATING-INITIATED and is in operation mode:</p>
<ol>
<li>a) A in Iu mode, an MS that changes to GPRS operation mode A or B in A/Gb mode shall execute:</li>
</ol>
<p>Table 4.7.1.6.5/3GPP TS 24.008: Mode A in Iu mode changing to GPRS mode A or B in A/Gb mode</p>
<table>
<tbody>
<tr>
<td width="149">
<p>Network operation mode change</p>
</td>
<td width="416">
<p>Procedure to execute</p>
</td>
</tr>
<tr>
<td width="149">
<p>Iu mode I &reg; A/Gb mode I</p>
</td>
<td width="416">
<p>Combined Routing Area Update</p>
</td>
</tr>
<tr>
<td width="149">
<p>Iu mode II &reg; A/Gb mode I</p>
</td>
<td width="416">
<p>Combined Routing Area Update with IMSI attach(**)</p>
</td>
</tr>
<tr>
<td width="149">
<p>Iu mode I &reg; A/Gb mode II (***)<br /> </p>
</td>
<td width="416">
<p>Normal Location Update(*),<br /> followed by a Normal Routing Area Update</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<ol>
<li>b) C in Iu mode, the MS shall change to GPRS operation mode C in A/Gb mode and shall execute the normal Routing Area Update procedure.</li>
<li>c) CS in Iu mode, the MS shall execute the normal Location Update procedure.</li>
</ol>
<p>(*)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Intended to remove the Gs association in the MSC/VLR.</p>
<p>(**)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Intended to establish the Gs association in the MSC/VLR.</p>
<p>(***)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS that needs only GPRS services and "SMS-only service" moves to a new routing area, see subclause 4.1.1.2.2.</p>
<p>Further details are implementation issues.</p>
<h5><a name="_Toc171523964"></a>4.7.1.6.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Change of network mode of operation at A/Gb mode to Iu mode inter-system change</h5>
<p>Whenever an MS moves to a new RA supporting the Iu mode radio interface, the procedures executed by the MS depend on the network mode of operation in the old and new routing area.</p>
<p>In case the MS is in state GMM-REGISTERED or GMM-ROUTING-AREA-UPDATING-INITIATED and is in operation mode:</p>
<ol>
<li>a) A or B in A/Gb mode, the MS shall change to operation mode A in Iu mode and shall execute:</li>
</ol>
<p>Table 4.7.1.6.8/3GPP TS 24.008: Mode A or B in A/Gb mode changing to mode A in Iu mode</p>
<table>
<tbody>
<tr>
<td width="156">
<p>Network operation mode change</p>
</td>
<td width="408">
<p>Procedure to execute</p>
</td>
</tr>
<tr>
<td width="156">
<p>A/Gb mode I &reg; Iu mode I</p>
</td>
<td width="408">
<p>Combined Routing Area Update</p>
</td>
</tr>
<tr>
<td width="156">
<p>A/Gb mode II &reg; Iu mode I</p>
</td>
<td width="408">
<p>Combined Routing Area Update with IMSI attach(**)</p>
</td>
</tr>
<tr>
<td width="156">
<p>A/Gb mode I &reg; Iu mode II (***)<br /> </p>
</td>
<td width="408">
<p>Normal Location Update(*),<br /> followed by a Normal Routing Area Update</p>
</td>
</tr>
<tr>
<td width="156">
<p>A/Gb mode II &reg; Iu mode II (***)<br /> </p>
</td>
<td width="408">
<p>Normal Location Update if a new LA is entered,</p>
<p>followed by a Normal Routing Area Update</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<ol>
<li>b) C in A/Gb mode, an MS that changes to operation mode C in Iu mode shall execute a Normal Routing Area Update.</li>
</ol>
<p>&nbsp;</p>
<p>(*)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Intended to remove the Gs association in the MSC/VLR.</p>
<p>(**)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Intended to establish the Gs association in the MSC/VLR.</p>
<p>(***)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS that needs only GPRS services and "SMS-only service" moves to a new routing area, see subclause 4.1.1.2.2.</p>
<p>Further details are implementation issues.</p>
<h4><a name="_Toc171523965"></a>4.7.1.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Intersystem change between A/Gb mode and Iu mode</h4>
<p>For the Iu mode to A/Gb mode and A/Gb mode to Iu mode intersystem change the following cases can be distinguished:</p>
<ol>
<li>a) Intersystem change between cells belonging to different RA's:</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The procedures executed by the MS depends on the network mode of operation in the old and new RA. If a change of the network operation mode has occurred in the new RA, then the MS shall behave as specified in subclause&nbsp;4.7.1.6. If no change of the network operation mode has occurred in the new RA, then the MS shall initiate the normal or combined routing area updating procedure depending on the network operation mode in the current RA.</p>
<ol>
<li>b) Intersystem change between cells belonging to the same RA:</li>
</ol>
<p>1)&nbsp; If the READY timer is running in the MS in A/Gb mode before or after the inter-system change occurs,or the MS is in PMM-CONNECTED mode in Iu mode, before the inter-system change occurs then the MS shall perform a normal or combined routing area updating procedure depending on the network mode of operation in the current RA.</p>
<p>2)&nbsp; If the READY timer is not running in the MS in A/Gb mode before the inter-system change occurs, or the MS is in PMM-IDLE mode in Iu mode before the inter-system change and the READY timer is not running in the MS in A/Gb mode after the intersystem change, then, unless a routing area updating procedure is required according to case c) or case b)&nbsp;3) below or according to subclause&nbsp;4.7.5.1 and 4.7.5.2.1, the MS shall not perform a routing area updating procedure until uplink user data or signalling information needs to be sent from the MS to the network.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is in the same access network(i.e. A/Gb mode or Iu mode), as when it last sent user data or signalling messages, the procedures defined for that access system shall be followed. This shall be sending of an LLC PDU in an A/Gb mode cell or initiating the service request procedure in an Iu mode cell.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is in a different access network (i.e. A/Gb mode or Iu mode), as when it last sent user data or signalling messages, the normal or combined routing area updating procedure shall be performed depending on the network operation mode in the current RA, before the sending of user data or signalling messages. If the signalling message is a DETACH REQUEST indicating "power off", the routing area updating procedure need not to be performed.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the periodic routing area update timer expires the MS shall initiate the periodic routing area updating procedure.</p>
<p>3)&nbsp; If the READY timer is not running in the MS in A/Gb mode or the MS is in PMM-IDLE mode in Iu mode, then the MS shall perform a normal or combined routing area updating procedure depending on the network mode of operation in the current RA if the MS is required to perform routing area updating for IMS voice termination as specified in annex&nbsp;P.3.</p>
<p>4)&nbsp; If the READY timer is not running in the network in A/Gb mode or the network is in PMM-IDLE mode in Iu mode, then the network shall page the MS if downlink user data or signalling information needs to be sent from the network to the MS. This shall include both A/Gb mode and Iu mode cells.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives the paging indication in the same access network (i.e. A/Gb mode or Iu mode), as when it last sent user data or signalling information, the MS shall send any LLC PDU in a A/Gb mode cell or shall initiate the service request procedure indicating service type "paging response" in an Iu mode cell.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives the paging indication in a different access network (i.e. A/Gb mode or Iu mode), as when it last sent user data or signalling information, the MS shall perform a normal or combined routing area updating procedure depending on the network operation mode in the current RA.</p>
<ol>
<li>c) Intersystem handover from A/Gb mode to Iu mode during a CS connection:</li>
</ol>
<p>After the successful completion of the handover from an A/Gb mode cell to an Iu mode cell, an MS which has performed the GPRS suspension procedure in Gb mode (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84]) (i.e. an MS in MS operation mode B or an DTM MS in a A/Gb mode cell that does not support DTM) shall perform a normal routing area updating procedure in the Iu mode cell in order to resume the GPRS services in the network, before sending any other signalling messages or user data.</p>
<h4><a name="_Toc171523966"></a>4.7.1.7a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Intersystem change from S1 mode to A/Gb mode or S1 mode to Iu mode with ISR activated</h4>
<p>If ISR is activated and the MS returns from S1 mode to a cell belonging to a RA which is different from the RA where the MS is registered, the MS initiates a normal or combined routing area updating procedure depending on the network operation mode in the current RA.</p>
<p>If ISR is activated and the MS returns from S1 mode to a cell belonging to the RA where the MS is registered, the following cases can be distinguished:</p>
<ol>
<li>a) Inter-system change due to PS handover:</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the PS handover is to A/Gb mode, the MS initiates a normal or combined routing area updating procedure depending on the network operation mode in the current RA.</p>
<ol>
<li>b) Inter-system change not due to PS handover:</li>
</ol>
<p>1)&nbsp; If the READY timer is running in the MS after the inters-ystem change occurs, then the MS shall perform a normal or combined routing area updating procedure depending on the network mode of operation in the current RA.</p>
<p>2)&nbsp; If the READY timer is not running in the MS in A/Gb mode or the MS is in PMM-IDLE mode in Iu mode after the intersystem change occurs, unless a routing area updating procedure is required according to subclause&nbsp;4.7.5.1 and 4.7.5.2.1, the MS shall not perform a routing area updating procedure until uplink user data or signalling information needs to be sent from the MS to the network.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is in the same access network, (i.e. A/Gb mode or Iu mode), as when it last sent user data or signalling messages in a cell belonging to the RA where the MS is registered, the procedures defined for that access system shall be followed. This shall be sending of an LLC PDU in a A/Gb mode cell or initiating the SERVICE REQUEST procedure in an Iu mode cell.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is in a different access network (i.e. A/Gb mode or Iu mode), as when it last sent user data or signalling messages in a cell belonging to the RA where the MS is registered, the normal or combined RA update procedure shall be performed depending on the network operation mode in the current RA, before the sending of user data or signalling messages. If the signalling message is a DETACH REQUEST indicating "power off", the routing area updating procedure need not be performed.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the periodic routing area update timer expires the MS shall initiate the periodic RA update procedure.</p>
<p>3)&nbsp; If the READY timer is not running in the network in A/Gb mode or the network is in PMM-IDLE mode in Iu mode, then the network shall page the MS if downlink user data or signalling information needs to be sent from the network to the MS. This shall include both A/Gb mode and Iu mode cells.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives the paging indication in the same access network (i.e. A/Gb mode or Iu mode), as when it last sent user data or signalling information in a cell belonging to the RA where the MS is registered, the MS shall send any LLC PDU in a A/Gb mode cell or shall initiate the service request procedure indicating service type "paging response" in an Iu mode cell.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives the paging indication in a different access network (i.e. A/Gb mode or Iu mode), as when it last sent user data or signalling information in a cell belonging to the RA where the MS is registered, the MS shall perform normal or combined routing area updating procedure shall be performed depending on the network operation mode in the current RA.</p>
<h4><a name="_Toc171523967"></a>4.7.1.7b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Intersystem change from S1 or N1 mode to A/Gb mode or S1 or N1 mode to Iu mode for eCall only MS capable of eCall over IMS</h4>
<p>If an eCall only MS (as determined by information configured in USIM) capable of eCall over IMS returns from S1 or N1 mode to A/Gb or Iu mode, the MS shall:</p>
<ol>
<li>a) if timer T3444 is running, start timer T3242 with the time left on timer T3444, and stop timer T3444;</li>
<li>b) if timer T3445 is running, start timer T3243 with the time left on timer T3445, and stop timer T3445;</li>
<li>c) if the MS returns from S1 mode to A/Gb or Iu mode is attached for GPRS services only and timer T3444 or timer T3445 is running:</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform a combined routing area updating procedure with IMSI attach if the network operates in network operation mode I; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform a routing area updating procedure and a location area updating procedure if the network operates in network operation mode II;</p>
<ol>
<li>d) if the MS returns from S1 mode to A/Gb or Iu mode is attached for both GPRS services and non-GPRS services and timer T3444 or timer T3445 is running:</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform a combined routing area updating procedure if the network operates in network operation mode I; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform a routing area updating procedure and a location are updating procedure if the network operates in network operation mode II; and</p>
<ol>
<li>e) if the MS returns from N1 mode to A/Gb or Iu mode is not attached for GPRS services and timer T3444 or timer T3445 is running:</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform a combined GPRS attach procedure if the network operates in network operation mode I; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; perform the GPRS attach procedure and a location area updating procedure if the network operates in network operation mode II.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Timers T3444 and T3445 are specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120].</p>
<h4><a name="_Toc171523968"></a>4.7.1.7c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return to packet idle mode for eCall only MS capable of eCall over IMS</h4>
<p>If an eCall only MS (as determined by information configured in USIM) capable of eCall over IMS returns to packet idle mode following the release of a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service which was handed over from S1 mode and timer T3243 is not running, the MS shall start timer T3243.</p>
<h4><a name="_Toc171523969"></a>4.7.1.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List of forbidden PLMNs for GPRS service</h4>
<p>The Mobile Equipment shall contain a list of "forbidden PLMNs for GPRS service". This lists shall be erased when the MS is switched off or when the SIM/USIM is removed or upon the expiry of the timer T3245 as described in subclause&nbsp;4.1.1.6. The PLMN identification received on the BCCH shall be added to the list whenever a GPRS attach or routing area update is rejected by the network with the cause "GPRS services not allowed in this PLMN" or whenever a GPRS detach is initiated by the network with the cause "GPRS services not allowed in this PLMN".</p>
<p>In a shared network, the MS shall choose one of the PLMN identities as specified in 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14]. The PLMN identity selected for a GPRS attach procedure, or the PLMN identity used to construct the RAI that triggered the routing area updating procedure shall be added to the list of "forbidden PLMNs for GPRS service" whenever such a procedure is rejected by the network with the cause "GPRS services not allowed in this PLMN". Whenever a GPRS detach is initiated by the network with the cause "GPRS services not allowed in this PLMN", the PLMN identity that was selected for GPRS attach procedure or routing area update procedure shall be added to the list of "forbidden PLMNs for GPRS service".</p>
<p>The maximum number of possible entries in this list is implementation dependent, but must be at least one entry. When the list is full and a new entry has to be inserted, the oldest entry shall be deleted.</p>
<h4><a name="_Toc171523970"></a>4.7.1.8a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Establishment of the PS signalling connection (Iu mode only)</h4>
<p>In order to route the NAS message to an appropriate SGSN, the MS NAS provides the lower layers with the routing parameter according to the following rules:</p>
<ol>
<li>a) if the TIN indicates "P-TMSI" or "RAT-related TMSI", and the MS holds a valid P-TMSI, the MS NAS shall provide the lower layers with the P-TMSI;</li>
<li>b) if the TIN indicates "GUTI" and the MS holds a valid GUTI allocated by an MME, the MS NAS shall provide the lower layers with the P-TMSI mapped from the GUTI (see 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10]);</li>
<li>c) if the TIN is not available and the MS holds a valid P-TMSI, the MS NAS shall provide the lower layers with the P-TMSI; or</li>
<li>d) if the TIN is not available and the MS holds a valid GUTI allocated by an MME, but no valid P-TMSI, the MS NAS shall provide the lower layers with the P-TMSI mapped from the GUTI (see 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10]).</li>
</ol>
<p>When an ATTACH REQUEST message, or a ROUTING AREA UPDATE REQUEST message after a routing area change, is sent to establish a PS signalling connection, the MS NAS also provides the lower layers with the DCN-ID according to the following rules:</p>
<ol>
<li>a) if a DCN-ID for the PLMN code of the selected PLMN is available in the MS, this DCN-ID the MS NAS shall provide this DCN-ID to the lower layers; or</li>
<li>b) if no DCN-ID for the PLMN code of the selected PLMN is available but a Default_DCN_ID value is available in the MS, as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or in USIM file NAS<sub>CONFIG</sub> as specified in 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112], the Default_DCN_ID value MS NAS shall provide the Default_DCN_ID value to the lower layers.</li>
</ol>
<h4><a name="_Toc171523971"></a>4.7.1.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Release of the PS signalling connection (Iu mode only)</h4>
<p>In Iu mode, to allow the network to release the PS signalling connection (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]) the MS:</p>
<ol>
<li>a) shall start the timer T3340 if the MS receives any of the reject cause values #11, #12, #13, #15 or #25;</li>
<li>b) shall start the timer T3340 if the network indicates "no follow-on proceed" in the ROUTING AREA UPDATE ACCEPT or ATTACH ACCEPT message and user plane radio access bearers have not been setup;</li>
<li>c) shall start the timer T3340 if the MS receives a DETACH ACCEPT message and the MS has set the detach type to "IMSI detach" in the DETACH REQUEST message and user plane radio access bearers have not been set up; or</li>
<li>d) may start the timer T3340 if the MS receives any of the reject cause values #3, #6, #7 or #8 or if it receives an AUTHENTICATION AND CIPHERING REJECT message.</li>
</ol>
<p>Upon expiry of T3340, the MS shall release the established PS signalling connection (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]).</p>
<p>Upon release of the established PS signalling connection, if timer T3243 is not running, the MS shall start timer T3243 when:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is an eCall only MS (as determined by information configured in USIM);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is capable of eCall over IMS; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the PS signalling connection that was released had been established for a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service which was handed over from S1 mode.</p>
<p>In case b, if the MS has signalling pending, then it shall request a new PS signalling connection for further signalling.</p>
<p>In case b and c,</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; upon an indication from the lower layers that radio accesss bearer(s) is set up, the MS shall stop timer T3340 and may send uplink signalling via the existing PS signalling connection or user data via radio access bearer(s). If the MS is establishing a PDN connection for emergency bearer services or the MS is initiating a service request procedure to send user data for emergency bearer services, the MS shall send the uplink signalling via the existing PS signalling connection;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; upon receipt of a REQUEST PDP CONTEXT ACTIVATION message, MODIFY PDP CONTEXT REQUEST message, DEACTIVATE PDP CONTEXT REQUEST message, REQUEST SECONDARY PDP CONTEXT ACTIVATION message or REQUEST MBMS CONTEXT ACTIVATION message, the MS shall stop timer T3340 and may send uplink signalling via the existing PS signalling connection. If the MS is establishing a PDN connection for emergency bearer services or the MS is initiating a service request procedure to send user data for emergency bearer services, the MS shall send the uplink signalling via the existing PS signalling connection; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; upon receipt of a DETACH REQUEST message, the MS shall stop timer T3340 and respond to the network initiated GPRS detach as specified in subclause&nbsp;4.7.4.2.</p>
<p>If the MS receives the "Extended wait time" for PS domain from the lower layers when no attach, routing area updating or service request procedure is ongoing, the MS shall ignore the "Extended wait time".</p>
<p>If the MS needs to perform PLMN selection, the MS may release the established PS signalling connection (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]).</p>
<h4><a name="_Toc171523972"></a>4.7.1.10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of 3GPP PS data off</h4>
<p>An MS, which supports 3GPP PS data off (see 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74]), can be configured with up to two lists of 3GPP PS data off exempt services as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or in the EF<sub>3GPPPSDATAOFF</sub> USIM file as specified in 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present); and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a list of 3GPP PS data off exempt services to be used in the VPLMN.</p>
<p>If only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present) is configured at the MS, this list shall be also used in the VPLMN.</p>
<p>If the MS supports 3GPP PS data off, the MS shall provide the 3GPP PS data off UE status in the protocol configuration options IE during PDP context activation procedure (see subclause&nbsp;6.1.3.1).</p>
<p>The network informs the MS about the support of 3GPP PS data off during PDP context activation procedure as specified in subclause&nbsp;6.1.3.1. If 3GPP data off support is not indicated in the protocol configuration options IE in the ACTIVATE PDP CONTEXT ACCEPT message, the MS shall not indicate any change of 3GPP PS data off UE status for the PDN connection established by the PDP context activation procedure; otherwise the MS shall indicate change of the 3GPP PS data off UE status for the PDN connection by using the PDP context modification procedure as specified in subclause&nbsp;6.1.3.3. If the network does not provide indication of support of 3GPP PS data off during PDP context activation procedure, the MS behaviour for non-exempt service requests from the network is implementation dependent.</p>
<p>When the 3GPP PS data off UE status is "activated":</p>
<ol>
<li>a) the MS does not send uplink IP packets except:</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present) as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] when the MS is in its HPLMN or EHPLMN (if the EHPLMN list is present);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present) when the MS is in the VPLMN, if only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present) is configured to the MS as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135];</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for those services indicated in the list of 3GPP PS data off exempt services to be used in the VPLMN when the MS is in the VPLMN, if the list of 3GPP PS data off exempt services to be used in the VPLMN is configured to the MS as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135];</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for those services indicated in the EF<sub>3GPPPSDATAOFF</sub> USIM file as specified in 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; any uplink traffic due to procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[13D]; and</p>
<ol>
<li>b) the MS does not send uplink non-IP user data packets.</li>
</ol>
<p>Otherwise the MS sends uplink user data packets without restriction.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS supports 3GPP PS data off, uplink IP packets are filtered as specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[13D] in subclause&nbsp;B.3.1.5.</p>
<h3><a name="_Toc171523973"></a>4.7.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS Mobility management timers and UMTS PS signalling connection control</h3>
<h4><a name="_Toc171523974"></a>4.7.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; READY timer behaviour</h4>
<h5><a name="_Toc171523975"></a>4.7.2.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; READY timer behaviour (A/Gb mode only)</h5>
<p>The READY timer, T3314 is used in the MS and in the network per each assigned P-TMSI to control the cell updating procedure.</p>
<p>When the READY timer is running or has been deactivated the MS shall perform cell update each time a new cell is selected (see 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82]). If a routing area border is crossed, a routing area updating procedure shall be performed instead of a cell update.</p>
<p>When the READY timer has expired:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall perform the routing area updating procedure when a routing area border is crossed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall not perform a cell update when a new cell is selected.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the network shall page the MS if down-link user data or signalling information needs to be sent to the MS.</p>
<p>All other GMM procedures are not affected by the READY timer.</p>
<p>The READY timer is started:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in the MS when the GMM entity receives an indication from lower layers that an LLC frame other than LLC NULL frame has been transmitted on the radio interface; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in the network when the GMM entity receives an indication from lower layers that an LLC frame other than LLC NULL frame has been successfully received by the network.</p>
<p>Within GMM signalling procedures the network includes a "force to standby" information element, in order to indicate whether or not the READY timer shall be stopped when returning to the GMM-REGISTERED state. If the "force to standby" information element is received within more than one message during a ongoing GMM specific procedure, the last one received shall apply. If the READY timer is deactivated and the network indicates "force to standby" with the "force to standby" information element, this shall not cause a modification of the READY timer.</p>
<p>The READY timer is not affected by state transitions to and from the GMM-REGISTERED.SUSPENDED sub-state.</p>
<p>The value of the READY timer may be negotiated between the MS and the network using the GPRS attach or GPRS routing area updating procedure.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS wishes to indicate its preference for a READY timer value it shall include the preferred values into the ATTACH REQUEST and/or ROUTING AREA UPDATE REQUEST messages. The preferred values may be smaller, equal to or greater than the default values or may be equal to the value requesting the READY Timer function to be deactivated.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Regardless of whether or not a timer value has been received by the network in the ATTACH REQUEST or ROUTING AREA UPDATE REQUEST messages, the network may include a timer value for the READY timer (different or not from the default value) into the ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT messages, respectively. If the READY Timer value was included, it shall be applied for the GMM context by the network and by the MS.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; When the MS proposes a READY Timer value and the Network does not include any READY Timer Value in its answer, then the value proposed by the MS shall be applied for the GMM context by the Network and by the MS.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; When neither the MS nor the Network proposes a READY Timer value into the ATTACH REQUEST/ATTACH ACCEPT or ROUTING AREA UPDATE REQUEST/ROUTING AREA UPDATE ACCEPT message, then the default value shall be used.</p>
<p>If the negotiated READY timer value indicates that the ready timer function is deactivated, the READY timer shall always run without expiry. If the negotiated READY timer value indicates that the ready timer function is deactivated, and within the same procedure the network indicates "force to standby" with the "force to standby" information element, the READY timer shall always run without expiry. If the negotiated READY timer value is set to zero, the READY timer shall be stopped immediately.</p>
<p>To account for the LLC frame uplink transmission delay, the READY timer value should be slightly shorter in the network than in the MS. This is a network implementation issue.</p>
<p>If a new READY timer value is negotiated, the MS shall upon the reception of the ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT message perform an initial cell update (either by transmitting a LLC frame or, if required, a ATTACH COMPLETE or ROUTING AREA UPDATE COMPLETE message), in order to apply the new READY timer value immediately. If both the network and the MS support the Cell Notification, the initial cell update shall use any LLC frame except the LLC NULL frame. If the new READY timer value is set to zero or if the network indicates "force to standby" with the "force to standby" IE, the initial cell update should not be done.</p>
<h5><a name="_Toc171523976"></a>4.7.2.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of READY timer in the MS in Iu mode and S1 mode</h5>
<p>The READY timer is not applicable for Iu mode in S1 mode.</p>
<p>Upon completion of a successful GPRS attach or routing area updating procedure in Iu mode, the MS shall stop the READY timer, if running.</p>
<p>Upon completion of a successful EPS attach or tracking area updating procedure, the MS shall stop the READY timer, if running.</p>
<p>In Iu mode, an MS may indicate a READY timer value to the network in the ATTACH REQUEST and the ROUTING AREA UPDATE REQUEST messages.</p>
<p>If a READY timer value is received by an MS capable of both Iu mode and A/Gb mode in the ATTACH ACCEPT or the ROUTING AREA UPDATE ACCEPT message, then the MS shall store the received value in order to use it at an intersystem change from Iu mode to A/Gb mode.</p>
<h5><a name="_Toc171523977"></a>4.7.2.1.2a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of READY timer in the network in Iu mode and S1 mode</h5>
<p>The READY timer is not applicable for Iu mode in S1 mode.</p>
<p>Upon completion of a successful GPRS attach or routing area updating procedure, the network shall stop the READY timer, if running.</p>
<p>When the SGSN is informed by the HLR/HSS that the MS performed an EPS attach or by the MME that the UE is performing a tracking area updating procedure, the SGSN shall stop the READY timer, if running.</p>
<h4><a name="_Toc171523978"></a>4.7.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Periodic routing area updating</h4>
<p>The periodic routing area updating procedure is used to periodically notify the availability of the MS to the network. The procedure is controlled in the MS by timer T3312. The value of timer T3312 is sent by the network to the MS in the messages ATTACH ACCEPT and ROUTING AREA UPDATE ACCEPT. The value of timer T3312 shall be unique within a RA.</p>
<p>If the value of timer T3312 received by the MS in A/Gb mode or received in Iu mode in a message with integrity protection contains an indication that the timer is deactivated or the timer value is zero, then timer T3312 is deactivated and the MS shall not perform the periodic routing area updating procedure.</p>
<p>In Iu mode, if the value of timer T3312 is received in a message without integrity protection and the indicated value is larger than the last received value, or the indicated value is "deactivated" or zero, the MS shall use the last received value. If there is no last received value, then the MS shall use the default value.</p>
<p>In A/Gb mode, the timer T3312 is reset and started with its initial value, when the READY timer is stopped or expires. Timer T3312 is stopped and shall be set to its initial value for the next start when the READY timer is started. If after a READY timer negotiation the READY timer value is set to zero, timer T3312 is reset and started with its initial value. If the initial READY timer value is zero, the timer T3312 is reset and started with its initial value, when the ROUTING AREA UPDATE REQUEST message is transmitted.</p>
<p>In Iu mode, timer T3312 is reset and started with its initial value, when the MS changes from PMM-CONNECTED to PMM-IDLE mode. Timer T3312 is stopped when the MS enters PMM-CONNECTED mode.</p>
<p>If the MS is attached for emergency bearer services, when timer T3312 expires, the MS shall not initiate a periodic routing area updating procedure, but shall locally detach from the network. When the MS is camping on a suitable cell, it may re-attach to regain normal service.</p>
<p>If the MS is not attached for emergency bearer services, when timer T3312 expires, the periodic routing area updating procedure shall be started and timer T3312 shall be set to its initial value for the next start.</p>
<p>If the MS is in a state other than GMM-REGISTERED.NORMAL-SERVICE when timer T3312 expires, the periodic routing area updating procedure is delayed until the MS returns to GMM-REGISTERED.NORMAL-SERVICE.</p>
<p>In A/Gb mode, if the MS in MS operation mode B is in the state GMM-REGISTERED.SUSPENDED when timer T3312 expires the periodic routing area updating procedure is delayed until the state is left.</p>
<p>If ISR is activated, the MS shall keep both timer&nbsp;T3412 and timer&nbsp;T3312. The two separate timers run in the MS for updating the MME and the SGSN independently. The MS shall start timer&nbsp;T3323 if timer T3312 expires, and timer T3346 is running or the MS is in one of the following states:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.NO-CELL-AVAILABLE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.PLMN-SEARCH;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.UPDATE-NEEDED; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.LIMITED-SERVICE.</p>
<p>The MS shall initiate the routing area updating procedure and stop timer&nbsp;T3323 when the MS enters the state GMM-REGISTERED.NORMAL-SERVICE before timer&nbsp;T3323 expires. After expiry of timer&nbsp;T3323 the MS shall deactivate ISR by setting its TIN to "GUTI".</p>
<p>If timer T3323 expires, the MS shall memorize that it has to initiate a routing area updating procedure when it returns to state GMM-REGISTERED.NORMAL-SERVICE.</p>
<p>The network supervises the periodic routing area updating procedure by means of the mobile reachable timer.</p>
<p>If the MS is not attached for emergency bearer services, the mobile reachable timer shall be longer than timer T3312. In this case, by default, the mobile reachable timer is 4 minutes greater than timer T3312.</p>
<p>NOTE&nbsp;1:&nbsp; According to subclause&nbsp;4.7.5.1.5, if a periodic routing area updating procedure fails repeatedly, it can take more than 7 minutes before the MS starts using MM specific procedures.</p>
<p>The network may include timer T3312 extended value IE in the ATTACH ACCEPT message or ROUTING AREA UPDATE ACCEPT message only if the MS indicates support of the timer T3312 extended value in the MS network feature support IE.</p>
<p>If the network includes the timer T3312 extended value IE in the ATTACH ACCEPT message or ROUTING AREA UPDATE ACCEPT message, the network shall use the timer T3312 extended value IE as the value of timer T3312.</p>
<p>If ISR is not activated, when the mobile reachable timer expires, typically the network stops sending paging messages to the mobile and may take other appropriate actions.</p>
<p>If the MS is attached for emergency bearer services, the SGSN shall set the mobile reachable timer with a value equal to timer T3312. When the mobile reachable timer expires, the SGSN shall locally detach the MS.</p>
<p>In A/Gb mode, the mobile reachable timer is reset and started with the value as indicated above, when the READY timer is stopped or expires. The mobile reachable timer is stopped when the READY timer is started.</p>
<p>In A/Gb mode, if after a READY timer negotiation the READY timer value is set to zero, the mobile reachable timer is reset and started with its initial value. If the initial READY timer value is zero, the mobile reachable timer is reset and started with its initial value, when the ROUTING AREA UPDATE REQUEST message is received.</p>
<p>In Iu mode, the mobile reachable timer is reset and started with the value as indicated above, when the MS changes from PMM-CONNECTED to PMM-IDLE mode. The mobile reachable timer is stopped when the MS enters PMM-CONNECTED mode.</p>
<p>If ISR is activated, upon expiry of the mobile reachable timer the network shall start the implicit detach timer. By default, the implicit detach timer is 4 minutes greater than timer&nbsp;T3323. If the implicit detach timer expires before the MS contacts the network, the network shall implicitly detach the MS and deactivate ISR.</p>
<p>If ISR is not activated, upon expiry of the mobile reachable timer the network may start the implicit detach timer. The value of the implicit detach timer is network dependent. If the implicit detach timer expires before the MS contacts the network, the network shall implicitly detach the MS.</p>
<p>If the network includes the T3324 value IE in the ATTACH ACCEPT message or ROUTING AREA UPDATE ACCEPT message and if the MS is not attached for emergency bearer services and has no PDN connection for emergency bearer services, the network shall set the active timer to a value equal to the value of timer T3324.</p>
<p>If the MS has established a PDN connection for emergency bearer services after receiving the timer T3324 value IE in the ATTACH ACCEPT message or ROUTING AREA UPDATE ACCEPT message, the active timer shall not be started.</p>
<p>When the active timer expires, typically the network stops sending paging messages to the mobile and may take other appropriate actions.</p>
<p>In A/Gb mode, the active timer is reset and started with the value as indicated above, when the READY timer is stopped or expires. The active timer is stopped when the READY timer is started.</p>
<p>In Iu mode, the active timer is reset and started with the value as indicated above, when the MS changes from PMM-CONNECTED to PMM-IDLE mode. The active timer is stopped when the MS enters PMM-CONNECTED mode.</p>
<p>NOTE&nbsp;2:&nbsp; ISR is not activated when the network includes the T3324 value IE in the ATTACH ACCEPT message or ROUTING AREA UPDATE ACCEPT message.</p>
<p>If the SGSN includes timer T3346 in the ROUTING AREA UPDATE REJECT message or the SERVICE REJECT message and timer T3346 is greater than timer T3312, the SGSN sets the mobile reachable timer and the implicit detach timer such that the sum of the timer values is greater than timer T3346.</p>
<p>NOTE&nbsp;3:&nbsp; According to subclause&nbsp;4.7.5.1.5, if a periodic routing area updating procedure fails repeatedly, it can take more than 7 minutes before the MS starts using MM specific procedures.</p>
<p>If the MS is both IMSI attached for GPRS and non-GPRS services, and if the MS lost coverage of the registered PLMN and timer&nbsp;T3312 expires or timer&nbsp;T3323 expires, then:</p>
<ol>
<li>a) if the MS returns to coverage in a cell that supports GPRS and that indicates that the network is in network operation mode I, then the MS shall either perform the combined routing area update procedure indicating "combined RA/LA updating with IMSI attach"; or</li>
<li>b) if the MS returns to coverage in a cell in the same RA that supports GPRS and that indicates that the network is in network operation mode II, then the MS shall perform the periodic routing area updating procedure indicating "Periodic updating"; or</li>
<li>c) if the MS was both IMSI attached for GPRS and non-GPRS services in network operation mode I and the MS returns to coverage in a cell in the same LA that does not support GPRS, then the MS shall perform the periodic location updating procedure. In addition, the MS shall perform a combined routing area update procedure indicating "combined RA/LA updating with IMSI attach" when the MS enters a cell that supports GPRS and that indicates that the network is in network operation mode I; or</li>
<li>d) if the MS returns to coverage in a new RA, the description given in subclause&nbsp;4.7.5 applies.</li>
</ol>
<p>If this subclause specifies that the MS shall perform a periodic routing area updating procedure, but subclause&nbsp;4.7.5 specifies the MS shall perform a normal or combined routing area updating procedure, the description in subclause&nbsp;4.7.5 takes precedence.</p>
<p>If the MS is both IMSI attached for GPRS and non-GPRS services in a network that operates in network operation mode I, and if the MS has camped on a cell that does not support GPRS, and timer&nbsp;T3312 expires or timer&nbsp;T3323 expires, then the MS shall start an MM location updating procedure. In addition, the MS shall perform a combined routing area update procedure indicating "combined RA/LA updating with IMSI attach" when the MS enters a cell that supports GPRS and indicates that the network is in operation mode I.</p>
<p>If timer&nbsp;T3312 expires or timer&nbsp;T3323 expires during an ongoing CS connection, then a MS operating in MS operation mode B shall treat the expiry of T3312 when the MM state MM-IDLE is entered, analogous to the descriptions for the cases when the timer expires out of coverage or in a cell that does not support GPRS.</p>
<p>In A/Gb mode, timer&nbsp;T3312 and timer&nbsp;T3323 shall not be stopped when a GPRS MS enters state GMM-REGISTERED.SUSPENDED.</p>
<h4><a name="_Toc171523979"></a>4.7.2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PMM-IDLE mode and PMM-CONNECTED mode (Iu mode only)</h4>
<p>An MS shall enter PMM-CONNECTED mode when a PS signalling connection for packet switched domain is established between the MS and the network. The MS shall not perform periodic routing area update in PMM-CONNECTED mode.</p>
<p>An MS shall enter PMM-IDLE mode when the PS signalling connection for packet switched domain between the MS and the network has been released. The MS shall perform periodic routing area update in PMM-IDLE mode.</p>
<h4><a name="_Toc171523980"></a>4.7.2.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of <em>Force to standby</em> in Iu mode (Iu mode only)</h4>
<p>Force to standby is not applicable for Iu mode.</p>
<p>The network shall always indicate <em>Force to standby not indicated</em> in the <em>Force to standby </em>information element.</p>
<p>The <em>Force to standby </em>information element shall be ignored by the MS.</p>
<h4><a name="_Toc171523981"></a>4.7.2.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RA Update procedure for Signalling Connection Re-establishment (Iu mode only)</h4>
<p>When the MS receives an indication from the lower layers that the RRC connection has been released with cause "Directed signalling connection re-establishment", see 3GPP TS 25.331 [23c] and 3GPP TS 44.118 [111], then the MS shall enter PMM-IDLE mode and initiate immediately a normal routing area update procedure (the use of normal or combined procedure depends on the network operation mode in the current serving cell) regardless whether the routing area has been changed since the last update or not. This routing area update procedure shall also be performed or continued if the MS has performed an inter-system change towards GSM, irrespective whether the READY timer is running or the MS is in PMM-IDLE or PMM-CONNECTED mode.</p>
<h4><a name="_Toc171523982"></a>4.7.2.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cell Update triggered by low layers</h4>
<p>A Cell Update may be requested by the low layers, see 3GPP&nbsp;TS&nbsp;44.060&nbsp;[76]. In this case the Cell Update shall be performed even if the READY timer is not running. If both the network and the MS support the Cell Notification, then the MS shall use the LLC NULL frame to perform the Cell Update.</p>
<h4><a name="_Toc171523983"></a>4.7.2.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of timer T3302</h4>
<p>The value of timer T3302 can be sent by the network to the MS in the ATTACH ACCEPT message, ROUTING AREA UPDATE ACCEPT message, ATTACH REJECT message, and ROUTING AREA UPDATE REJECT message. The MS shall apply this value, if the value is different from "deactivated" in the routing area registered by the MS, until a new value is received. The default value of this timer is used in the following cases:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ATTACH ACCEPT message, ATTACH REJECT message, or ROUTING AREA UPDATE REJECT message is received without a value specified;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; ROUTING AREA UPDATE ACCEPT message is received without a value specified, and the update type in the ROUTING AREA UPDATE REQUEST message is not set to "periodic updating";</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; In Iu mode, if the network provides a value in a non-integrity protected Iu mode GMM message and the MS is not attaching for emergency services or not attached for emergency services;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; In A/Gb mode and if the MS supports integrity protection, if the network provides a value in a non-integrity protected GMM message;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the network indicates that the timer is "deactivated";</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS does not have a stored value for this timer;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a new PLMN which is not in the list of equivalent PLMNs has been entered, the routing area updating fails and the routing area updating attempt counter is equal to 5; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a new PLMN which is not in the list of equivalent PLMNs has been entered, the attach procedure fails, and the attach attempt counter is equal to 5.</p>
<h4><a name="_Toc171523984"></a>4.7.2.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of timer T3324 (A/Gb mode, Iu mode and S1 mode)</h4>
<p>An MS supporting PSM may request the network to assign a value for T3324 by including a requested timer value in:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the ATTACH REQUEST or ROUTING AREA UPDATE REQUEST message (in A/Gb mode and Iu mode ); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message (in S1 mode).</p>
<p>The value of timer T3324 can be sent by the network to the MS in:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT message (in A/Gb mode and Iu mode ); and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message (in S1 mode).</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Besides the value requested by the MS, the network can take local configuration into account when selecting a value for T3324 (see 3GPP&nbsp;TS&nbsp;23.682&nbsp;[133A], subclause&nbsp;4.5.4).</p>
<p>In A/Gb mode and Iu mode, the MS shall apply the received T3324 value in the RA identified by the RAI contained in the ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT message, until a new value is received, T3324 is deactivated or a new PLMN is selected. The timer T3324 is deactivated if:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the last attach or routing area updating attempt was not completed successfully;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the network does not include a value for timer T3324 in the last ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT message received by the MS; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the indicated value of the timer is "deactivated".</p>
<p>In A/Gb mode and Iu mode, timer T3324 is reset and started with its initial value, when the MS changes from PMM-CONNECTED mode to PMM-IDLE mode (in Iu mode) or when the READY timer is stopped or expires (in A/Gb mode). Timer T3324 is stopped when the MS enters PMM-CONNECTED mode or GMM-DEREGISTERED state or the READY timer is started.</p>
<p>In S1 mode, the MS shall apply the received T3324 value in all tracking areas of the list of tracking areas assigned to the MS, until a new value is received, T3324 is deactivated or a new PLMN is selected. The timer T3324 is deactivated if:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the last attach or tracking area updating attempt was not completed successfully;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the network does not include a value for timer T3324 in the last ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message received by the MS; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the indicated value of the timer is "deactivated".</p>
<p>In S1 mode, timer T3324 is reset and started with its initial value, when the MS changes from EMM-CONNECTED mode to EMM-IDLE mode. Timer T3324 is stopped when the MS enters EMM-CONNECTED mode or EMM-DEREGISTERED state.In A/Gb mode and Iu mode, when timer T3324 expires the MS may activate PSM as specified in subclause&nbsp;4.7.2.9.</p>
<p>In S1 mode, when timer T3324 expires the MS may activate PSM as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120], subclause&nbsp;5.3.11.</p>
<p>In A/Gb mode and Iu mode, if timer&nbsp;T3324 expires during an ongoing CS connection, the MS shall take action on the expiry of timer T3324 as described in subclause&nbsp;4.7.2.9 when the MM state MM-IDLE is entered.</p>
<h4><a name="_Toc171523985"></a>4.7.2.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Power saving mode</h4>
<p>The MS can request the use of power saving mode (PSM) during an attach or routing area updating procedures (see 3GPP&nbsp;TS&nbsp;23.682&nbsp;[133A] and 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74]). The MS shall not request the use of PSM during:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; an attach for emergency bearer services procedure;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a routing area updating procedure for initiating a PDN connection for emergency bearer services; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a routing area updating procedure when the MS has a PDN connection established for emergency bearer services.</p>
<p>The network accepts the use of PSM by providing a specific value for timer T3324 when accepting the attach or routing area updating procedure. The MS may use PSM only if the network has provided the T3324 value IE during the last attach or routing area updating procedure with a value different from "deactivated".</p>
<p>Upon expiry of the timer T3324 or if the T3324 value provided by the network is zero, the MS may deactivate the AS layer and activate PSM by entering the state GMM-REGISTERED.NO-CELL-AVAILABLE if:</p>
<ol>
<li>a) the MS is not attached for emergency bearer services;</li>
<li>b) the MS has no PDN connection for emergency bearer services;</li>
<li>c) the MS is in PMM-IDLE mode (in Iu mode) or the READY timer is not running (in A/Gb mode);</li>
<li>d) the MS is in the GMM-REGISTERED.NORMAL-SERVICE state; and</li>
<li>e) no RR connection exists.</li>
</ol>
<p>If conditions a, b, c and e are fulfilled, but the MS is in a state other than GMM-REGISTERED.NORMAL-SERVICE when timer T3324 expires, the MS may activate PSM when the MS returns to state GMM-REGISTERED.NORMAL-SERVICE.</p>
<p>If conditions a, b, c and d are fulfilled, but an RR connection exists, the MS may activate PSM when the RR connection has been released.</p>
<p>An MS that has already been allocated timer T3324 with a value different from "deactivated" and the timer T3324 has expired, may activate PSM if it receives an "Extended wait time" from lower layers.</p>
<p>When PSM is activated all NAS timers are stopped and associated procedures aborted except for timers T3312, T3346, T3396, any backoff timers, and the timer T controlling the periodic search for HPLMN or EHPLMN (if the EHPLMN list is present) or higher prioritized PLMNs (see 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14]).</p>
<p>If the MS is attached for emergency bearer services or has a PDN connection for emergency bearer services, the MS shall not activate PSM.</p>
<p>The MS may deactivate PSM at any time (e.g. for transfer of mobile originated signalling or user data, or to initiate a mobile originated circuit-switched transaction), by activating the AS layer before initiating the necessary GMM or MM procedures (if any).</p>
<h4><a name="_Toc171523986"></a>4.7.2.10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Extended idle-mode DRX cycle</h4>
<p>The MS can request the use of extended idle mode DRX cycle (eDRX) during an attach or routing area updating procedure by including the extended DRX parameters IE (see 3GPP&nbsp;TS&nbsp;23.682&nbsp;[11A] and 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74]). The MS shall not request the use of eDRX during:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; an attach for emergency bearer services procedure; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a routing area updating procedure for the MS attached for emergency bearer services.</p>
<p>The MS and the network may negotiate eDRX parameters during a routing area updating procedure when the MS has a PDP context for emergency bearer services.</p>
<p>The network accepts the request to use eDRX by providing the extended DRX parameters IE when accepting the attach or the routing area updating procedure. The MS shall use extended idle mode DRX cycle only if it received the extended DRX parameters IE during the last attach or routing area updating procedure and the MS does not have a PDP context for emergency bearer services.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS wants to keep using eDRX, the MS includes the extended DRX parameters IE in each attach or routing area updating procedure.</p>
<p>If the MS received the extended DRX parameters IE during the last attach or routing area updating procedure, upon the successful completion of the PDP context deactivation procedure for a PDP context for emergency bearer services, the MS shall resume eDRX.</p>
<p>If the network has provided the extended DRX parameters IE during the last attach or routing area updating procedure, upon the successful completion of the PDP context deactivation procedure for a PDP context for emergency bearer services, the network shall resume eDRX.</p>
<p>If the MS or the network locally deactivates the PDP context for emergency bearer service, the MS or the network shall not use eDRX until the MS receives eDRX parameters during a routing area updating procedure with PDP context synchronization or upon successful completion of a service request procedure.</p>
<p>If the MS did not receive the extended DRX parameters IE, or if the MS has a PDP context for emergency bearer services, the MS shall use the stored DRX parameters, if available.</p>
<p>If the network did not accept the request to use eDRX, or if the MS has a PDP context for emergency bearer services, the network shall use the stored DRX parameters, if available.</p>
<h4><a name="_Toc171523987"></a>4.7.2.11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Interaction between power saving mode and extended idle mode DRX cycle</h4>
<p>The MS can request the use of both PSM and eDRX during an attach or routing area update procedure but it is up to the network to decide to enable none, one of them or both (see 3GPP&nbsp;TS&nbsp;23.682&nbsp;[133A] and 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74]).</p>
<p>If the network accepts the use of both PSM (see subclause&nbsp;4.7.2.9) and eDRX (see subclause&nbsp;4.7.2.10), the extended DRX parameters IE provided to the MS should allow for multiple paging occasions before the active timer expires.</p>
<h4><a name="_Toc171523988"></a>4.7.2.12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Extended coverage for GSM</h4>
<p>The MS can support and use the extended coverage in GSM for IoT (EC-GSM-IoT) feature (see 3GPP&nbsp;TS&nbsp;43.064&nbsp;[159]). A GPRS MS using EC-GSM-IoT may operate in MS operation mode C only. If the MS uses one of the four coverage classes of EC-GSM-IoT as defined in 3GPP&nbsp;TS&nbsp;43.064&nbsp;[159], the MS shall calculate the value of the applicable NAS timers as indicated in tables&nbsp;11.3, 11.3A and 11.2c using a multiplier of 3, unless the timer is deactivated. The NAS timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.</p>
<p>The usage of one of the four coverage classes of EC-GSM-IoT by an MS is indicated to the SGSN by lower layers. When a SGSN that supports EC-GSM-IoT performs NAS signaling with an MS that is using EC-GSM-IoT, the SGSN shall calculate the value of the applicable NAS timers as indicated in tables&nbsp;11.4, 11.4a and 11.2d using a multiplier of 3. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.</p>
<p>In order to deal with use of extensive resources from the network, the operator may prevent specific subscribers from using enhanced coverage (see 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74]). When in A/Gb mode, the MS supporting EC-GSM-IoT shall indicate support for restriction on use of enhanced coverage. The MS supporting restriction on use of enhanced coverage indicates "Mobile station supports restriction on use of enhanced coverage" in the MS network capability information element in the ATTACH REQUEST and ROUTING AREA UPDATE REQUEST message. If the MS supports restriction on use of enhanced coverage, the SGSN indicates whether the use of enhanced coverage is restricted or not in the ATTACH ACCEPT message and ROUTING AREA UPDATE ACCEPT message (see subclause&nbsp;4.7.3.1 and subclause&nbsp;4.7.5.1). If the use of enhanced coverage is restricted the MS shall not use enhanced coverage in the registered PLMN and in any PLMN which is in the list of equivalent PLMNs.</p>
<h3><a name="_Toc171523989"></a>4.7.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS attach procedure</h3>
<p>The GPRS attach procedure is used for the following purposes:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; normal GPRS attach, performed by the MS to IMSI attach for GPRS services only. The normal GPRS attach procedure shall be used:</p>
<p>-&nbsp;&nbsp;&nbsp; by GPRS MSs in MS operation mode C, independent of the network operation mode;</p>
<p>-&nbsp;&nbsp;&nbsp; by GPRS MSs in MS operation modes A or B if the network operates in network operation mode II; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; by GPRS MSs in MS operation mode A, independent of the network operation mode, if a circuit-switched transaction is ongoing;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; combined GPRS attach procedure, used by GPRS MSs in MS operation modes A or B to attach the IMSI for GPRS and non-GPRS services provided that the network operates in network operation mode I.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GPRS attach for emergency bearer services, performed by the MS to IMSI or IMEI attach to emergency bearer services.</p>
<p>The lower layers indicate to NAS that the network does not support emergency bearer services for the MS in limited service state (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]). This information is taken into account when deciding whether to initiate attach for emergency bearer services.</p>
<p>With a successful GPRS attach procedure a GMM context is established.</p>
<p>When the timer T3346 is running, MS is allowed to initiate an attach procedure if:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is an MS configured to use AC11 &ndash; 15 in selected PLMN;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is attaching for emergency bearer services; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS has timer T3346 running because a request from an MS with the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected, and the MS needs to attach without the low priority indicator, or with the low priority indicator set to "MS is not configured for NAS signalling low priority".</p>
<p>An eCall only mobile station that is not capable of eCall over IMS shall not perform a normal or combined GPRS attach procedure.</p>
<p>An eCall only mobile station that is capable of eCall over IMS may perform a normal or combined GPRS attach procedure only upon failure of a routing area updating procedure following intersystem change from S1 mode to A/Gb or Iu mode.</p>
<p>When the MS moves from NG-RAN coverage to GERAN coverage, or from NG-RAN coverage to UTRAN coverage, the MS shall perform a normal or combined GPRS attach procedure, if the following applies:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS initiated a registration procedure while in N1 mode; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; since then the MS did not perform a successful EPS attach or tracking area updating procedure in S1 mode or GPRS attach or routing area updating procedure in A/Gb mode or Iu mode.</p>
<p>Subclause 4.7.3.1 describes the GPRS attach procedure to attach the IMSI only for GPRS services. The combined GPRS attach procedure used to attach the IMSI for both GPRS and non-GPRS services is described in subclause&nbsp;4.7.3.2. GPRS attach for emergency bearer services is described as part of subclause&nbsp;4.7.3.1.</p>
<p>If an IMSI attach for non-GPRS services is requested and a GMM context exists, the routing area updating procedure shall be used as described in subclause&nbsp;4.7.5.2.</p>
<p>To limit the number of consecutive rejected attach attempts, a GPRS attach attempt counter is introduced. The GPRS attach attempt counter shall be incremented as specified in subclause&nbsp;4.7.3.1.5. Depending on the value of the GPRS attach attempt counter, specific actions shall be performed. The GPRS attach attempt counter shall be reset when:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is powered on;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a SIM/USIM is inserted;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS attach or combined GPRS attach procedure is successfully completed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; an attach or combined attach procedure is successfully completed in S1 mode;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a combined GPRS attach procedure is completed for GPRS services only with cause #2, #16, #17, #22 or #28;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS attach or combined GPRS attach procedure is rejected with cause #11, #12, #13, #14 ,#15 or #25;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a network initiated detach procedure is completed with cause #11, #12, #13, #14, #15 or #25; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a new PLMN is selected;</p>
<p>and additionally when the MS is in substate ATTEMPTING-TO-ATTACH:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; expiry of timer T3302;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a new routing area is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; an attach is triggered by CM sublayer requests;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; timer T3346 is started.</p>
<p>The mobile equipment shall contain a list of "forbidden location areas for roaming", as well as a list of "forbidden location areas for regional provision of service". The handling of these lists is described in subclause&nbsp;4.4.1; the same lists are used by GMM and MM procedures.</p>
<p>In a shared network, the MS shall choose one of the PLMN identities as specified in 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14]. The MS shall construct the Routing Area Identification of the cell from this chosen PLMN identity, and the LAC and the RAC received on the BCCH. For:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a shared GERAN, in A/Gb mode, the chosen PLMN identity is indicated to the GERAN in the first RLC data block of an upper layer PDU (see 3GPP&nbsp;TS&nbsp;44.060&nbsp;[76]) when a foreign TLLI or a random TLLI is used by the network sharing supporting MS for the transmission.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a shared UTRAN, the chosen PLMN identity shall be indicated to the UTRAN in the RRC INITIAL DIRECT TRANSFER message (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<p>For GERAN Iu mode, network sharing is not supported.</p>
<p>Whenever an ATTACH REJECT message with the cause "PLMN not allowed" is received by the MS, the chosen PLMN indentity shall be stored in the "forbidden PLMN list" and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. Whenever an ATTACH REJECT message is received by the MS with the cause "Roaming not allowed in this location area", "Location Area not allowed", or "No suitable cells in Location Area", the LAI that is part of the constructed RAI shall be stored in the suitable list.</p>
<p>The network informs the MS about the support of specific features, such as LCS-MOLR, MBMS, IMS voice over PS session, emergency bearer services in Iu mode in the Network feature supporti nformation element. The information is either explicitly given by sending the Network feature support IE or implicitly by not sending it. The handling in the network is described in subclause&nbsp;9.4.2.9. The network can also use the Additional network feature support IE in order to inform the MS about the support of specific features such as the delivery of SMS via GPRS (GPRS-SMS) or implicitly by not sending it. The MS may use the support indications for LCS-MOLR, MBMS and GPRS-SMS to inform the user about the availability of the appropriate services. The MS shall not request the LCS-MOLR or MBMS services, if the service has not been indicated as available. The indication for MBMS is defined in subclause "MBMS feature support indication" in 3GPP&nbsp;TS&nbsp;23.246&nbsp;[106]. In an MS with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP&nbsp;TS&nbsp;23.221&nbsp;[131], subclause&nbsp;7.2a and subclause&nbsp;7.2b, when selecting the access domain for voice sessions or calls in Iu mode. When initiating an emergency call in Iu mode, the upper layers also take the emergency bearer services indicator into account for the access domain selection. The MS may use the GPRS-SMS indication in order to obtain SMS.</p>
<h4><a name="_Toc171523990"></a>4.7.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS attach procedure for GPRS services</h4>
<p>The GPRS attach procedure is a GMM procedure used by GPRS MSs to IMSI attach for GPRS services. The procedure is also used by GPRS MSs to IMSI or IMEI attach for emergency bearer services.</p>
<p>The attach type information element shall indicate "GPRS attach". For an MS attaching for emergency bearer services the attach type information element shall indicate "Emergency attach".</p>
<h5><a name="_Toc171523991"></a>4.7.3.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS attach procedure initiation</h5>
<p>In state GMM-DEREGISTERED, the MS initiates the GPRS attach procedure by sending an ATTACH REQUEST message to the network, starts timer T3310 and enters state GMM-REGISTERED-INITIATED. If timer T3302 is currently running, the MS shall stop timer T3302. If timer T3311 is currently running, the MS shall stop timer T3311.</p>
<p>If the MS is configured for "AttachWithIMSI" as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112] and the selected PLMN is neither the registered PLMN nor in the list of equivalent PLMNs, the MS shall include the IMSI in the Mobile identity IE in the ATTACH REQUEST message.</p>
<p>For all other cases:</p>
<p>If the MS does not support S1 mode:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS capable of both Iu mode and A/Gb mode or only of A/Gb mode shall include a valid P-TMSI, if any is available, the P-TMSI signature associated with the P-TMSI and the routing area identity associated with the P-TMSI in the ATTACH REQUEST message. In addition, the MS shall include P-TMSI type IE with P-TMSI type set to "native P-TMSI". If there is no valid P-TMSI available, the IMSI shall be included instead of the P-TMSI and P-TMSI signature.</p>
<p>If the MS supports S1 mode:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the TIN indicates "GUTI" and the MS holds a valid GUTI allocated by an MME, the MS shall map the GUTI into the Mobile identity IE, P‑TMSI signature IE and Old routing area identification IE. The MS shall also include P-TMSI type IE with P-TMSI type set to "mapped P-TMSI". Additionally, if the MS holds a valid P-TMSI and RAI, the MS shall indicate the P-TMSI in the Additional mobile identity IE and the RAI in the Additional old routing area identification IE.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mapping of the GUTI to the P-TMSI, P-TMSI signature and RAI is specified in 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10].</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the TIN indicates "P-TMSI" or "RAT‑related TMSI" and the MS holds a valid P-TMSI and a RAI, the MS shall indicate the P-TMSI in the Mobile identity IE and the RAI in the Old routing area identification IE. The MS shall also include P-TMSI type IE with P-TMSI type set to "native P-TMSI". If a P-TMSI signature is associated with the P-TMSI, the MS shall include it in the Old P-TMSI signature IE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the TIN is deleted and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS holds a valid P-TMSI and a RAI, the MS shall indicate the P-TMSI in the Mobile identity IE and the RAI in the Old routing area identification IE. The MS shall also include P-TMSI type IE with P-TMSI type set to "native P-TMSI". If a P-TMSI signature is associated with the P-TMSI, the MS shall include it in the Old P-TMSI signature IE; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS does not hold a valid P-TMSI and RAI, but holds a valid GUTI allocated by an MME, the MS shall map the GUTI into the Mobile identity IE, P‑TMSI signature IE and Old routing area identification IE. The MS shall also include P-TMSI type IE with P-TMSI type set to "mapped P-TMSI"; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS does not hold a valid P-TMSI, RAI or GUTI, the MS shall include the IMSI in the Mobile identity IE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Otherwise the MS shall include the IMSI in the Mobile identity IE.</p>
<p>In the cases when the MS maps a GUTI into the Mobile identity IE, P‑TMSI signature IE and Old routing area identification IE, then:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If a current EPS security exists, the P-TMSI signature shall include a truncated NAS token as specified in 3GPP&nbsp;TS&nbsp;33.401&nbsp;[123]. In the GPRS ciphering key sequence number IE, the MS shall indicate the value of the eKSI associated with the current EPS security context. The MS shall derive CK' and IK' from the K<sub>ASME</sub> and the NAS uplink COUNT value corresponding to the NAS token derived and handle the START value as specified in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]. Then, the MS shall store the mapped UMTS security context replacing the established UMTS security context for the PS domain.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If a current EPS security does not exist, the MS shall set the truncated NAS token included in the P-TMSI signature to all zeros and the GPRS ciphering key sequence number to "No key is available".</p>
<p>If the MS is attaching for emergency bearer services and does not hold a valid GUTI, P-TMSI or IMSI as described above, the IMEI shall be included in the Mobile identity IE.</p>
<p>The MS shall also indicate within the DRX parameters whether it supports the split pg cycle option on CCCH. The optional support of the split pg cycle on CCCH by the network is indicated in SI13 or PSI1. Split pg cycle on CCCH is applied by both the network and the MS when the split pg cycle option is supported by both (see 3GPP&nbsp;TS&nbsp;45.002&nbsp;[32]).</p>
<p>If the MS supports eDRX and requests the use of eDRX, the MS shall include the extended DRX parameters IE in the ATTACH REQUEST message.</p>
<p>In Iu mode, if the MS wishes to prolong the established PS signalling connection after the GPRS attach procedure (for example, the MS has any CM application request pending), it may set a follow-on request pending indicator on (see subclause&nbsp;4.7.13).</p>
<p>An MS attaching for emergency bearer services shall set the follow-on request pending indicator.</p>
<p>If the MS supports PSM and requests the use of PSM, then the MS shall include the T3324 value IE with a requested timer value in the ATTACH REQUEST message. When the MS includes the T3324 value IE and the MS indicates support for extended periodic timer value in the MS network feature support IE, it may also include the T3312 extended value IE to request a particular T3312 value to be allocated.</p>
<p>In A/Gb mode, if the MS supports the restriction on use of enhanced coverage, then the MS shall set the Restriction on use of enhanced coverage capability bit to "Mobile station supports restriction of use of enhanced coverage" in the MS network capability IE of the ATTACH REQUEST message.</p>
<p>If the MS supports dual connectivity of E-UTRA with New Radio (NR), then the MS shall set the Dual connectivity of E-UTRA with NR capability bit to "Mobile station supports dual connectivity of E-UTRA with NR" in the MS network capability IE of the ATTACH REQUEST message.</p>
<p>In A/Gb mode, if a UMTS security context is available and if the MS indicates support of integrity protection in the MS network capability IE included in the ATTACH REQUEST message, then the MS shall derive a GPRS GSM Kint key as described in subclause&nbsp;4.7.7.3b and a GPRS GSM Kc<sub>128</sub> key as described in subclause&nbsp;4.7.7.3a. The MS shall then assign the GPRS GSM Kint key, the GPRS GSM Kc<sub>128</sub> key, the GPRS GSM integrity algorithm and the GPRS GSM ciphering algorithm (identified by the information in the Ciphering Algorithm IE and Integrity Algorithm IE stored in the non-volatile ME memory) to the LLC layer, and indicate to the LLC layer that it shall start integrity protection. This shall be done so that the LLC layer can integrity protect, but not cipher, the ATTACH REQUEST message. The MS shall include the CKSN in the CKSN IE in the ATTACH REQUEST message. If the MS has no UMTS security context available, then the MS shall not integrity protect the ATTACH REQUEST message in the LLC layer. In this case the MS shall set the CKSN IE to the value "no key is available" and send the ATTACH REQUEST unprotected.</p>
<h5><a name="_Toc171523992"></a>4.7.3.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM common procedure initiation</h5>
<p>If the network receives an ATTACH REQUEST message containing the P-TMSI type IE and the Mobile identity IE with type of identity indicating "TMSI/P-TMSI/M-TMSI", and the network does not follow the use of the most significant bit of the LAC as specified in 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10] subclause&nbsp;2.8.2.2.2, the network shall use the P-TMSI type IE to determine whether the mobile identity included in the Mobile identity IE is a native P‑TMSI or a mapped P‑TMSI.</p>
<p>The network may initiate GMM common procedures, e.g. the GMM identification and GMM authentication and ciphering procedure, depending on the received information such as IMSI, CKSN, old RAI, P-TMSI and P-TMSI signature.</p>
<h5><a name="_Toc171523993"></a>4.7.3.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS attach accepted by the network</h5>
<p>During an attach for emergency bearer services, if not restricted by local regulations, the network shall not check for mobility and access restrictions, regional restrictions, subscription restrictions, or perform CSG access control when processing the ATTACH REQUEST message. The network shall not apply subscribed APN based congestion control during an attach procedure for emergency bearer services.</p>
<p>If the GPRS attach request is accepted by the network, an ATTACH ACCEPT message is sent to the MS.</p>
<p>In A/Gb mode, if the MS indicates support of integrity protection in the MS network capability IE in the ATTACH REQUEST message, and if the network supports integrity protection, then the network shall store all octets received from the MS in the MS network capability IE and in the MS Radio Access Capability IE, up to the maximum length defined for the respective information element.</p>
<p>NOTE&nbsp;1:&nbsp; The network needs to store the MS network capability IE and the MS Radio Access Capability IE exactly as received from the MS and network is not allowed to ignore the "higher" octets sent by the MS even if the network does not support any features indicated in the higher octets. Otherwise the replay check of the MS network capability and the MS Radio Access Capability will fail in the MS.</p>
<p>In A/Gb mode, if a UMTS security context is available in the network and if the MS indicates support of integrity protection in the ATTACH REQUEST message and the network supports integrity protection, and if integrity protection of the ATTACH REQUEST message is successfully verified in the LLC layer in the network, then if the network decides to re-authenticate the MS or select a new integrity algorithm or ciphering algorithm, the network shall initiate an authentication and ciphering procedure.</p>
<p>In A/Gb mode, if a UMTS security context is available in the network and if the MS indicates support of integrity protection in the ATTACH REQUEST message and the network supports integrity protection if integrity protection of the ATTACH REQUEST message is successfully verified in the LLC layer in the network , the network may decide to continue using the stored: GPRS GSM Kint integrity key, the GPRS GSM Kc<sub>128</sub> ciphering key, the GPRS GSM ciphering algorithm and the GPRS GSM integrity algorithm in the LLC layer without initiating an authentication and ciphering procedure. If the MS and network continue to use the same ciphering mode as when the MS was previously attached to the network, ciphering or no ciphering, the ciphering mode is re-established without the need to run an authentication and ciphering procedure. The network shall replay the MS network capability IE and the MS radio access capability IE received from the MS in the ATTACH REQUEST message, by including the MS network capability IE and the MS radio access capability IE in the ATTACH ACCEPT message to the MS. The GMM layer in the network shall assign the stored GPRS GSM Kint key, the GPRS GSM Kc<sub>128</sub> key, the GPRS GSM integrity algorithm and the GPRS GSM ciphering algorithm to the LLC layer. The GMM layer in the network shall then indicate to the LLC layer that it shall start integrity protection and ciphering in the LLC layer before sending the ATTACH ACCEPT message to the MS. If the integrity protection of the ATTACH REQUEST message is not successfully verified in the LLC layer or if the ATTACH REQUEST message is received without integrity protection, then the network shall progress the ATTACH REQUEST message and initiate an authentication and ciphering procedure in order to authenticate the MS and activate integrity protection and ciphering in the MS.</p>
<p>In A/Gb mode, if a UMTS security context is available in the network and if the MS indicates support of integrity protection in the ATTACH REQUEST message and the network supports integrity protection, and if the network is not able to verify the message authentication code in the LLC layer protecting the ATTACH REQUEST message, due to the LLC layer at the network not having been configured yet with the integrity key and integrity algorithm for this MS, then the network shall progress the ATTACH REQUEST message at GMM layer anyway. If the CKSN included in the ATTACH REQUEST message belongs to an UMTS security context available in the network, then the network may re-establish integrity protection and ciphering of layer 3 signalling messages in the LLC layer without initiating an authentication and ciphering procedure.</p>
<p>In A/Gb mode, if the MS indicates support of integrity protection of user plane data in the MS network capability IE in the ATTACH REQUEST message, and if the network supports and accepts integrity protection of user plane data, then the network shall indicate integrity protection of user plane data to the MS in the ATTACH ACCEPT message. The MS shall indicate to the LLC layer to start integrity protection of user plane data after the reception of the ATTACH ACCEPT message. The same GPRS GSM Kint key and the same GPRS GSM integrity algorithm used for integrity protection of layer 3 signalling messages shall be used for integrity protection of user plane data in the LLC layer. The network shall indicate to the LLC layer to start integrity protection of user plane data after sending off the ATTACH ACCEPT message to the MS. If the network does not indicate to the MS in the ATTACH ACCEPT message that it accepts the use of integrity protection of user plane, and if the MS does not accept such a network, then the MS shall detach from the network.</p>
<p>The P-TMSI reallocation may be part of the GPRS attach procedure. When the ATTACH REQUEST includes the IMSI or IMEI, the SGSN shall allocate the P-TMSI. The P-TMSI that shall be allocated is then included in the ATTACH ACCEPT message together with the routing area identifier. The network shall, in this case, change to state GMM-COMMON-PROCEDURE-INITIATED and shall start timer T3350 as described in subclause&nbsp;4.7.6. Furthermore, the network may assign a P-TMSI signature for the GMM context which is then also included in the ATTACH ACCEPT message. If the LAI or PLMN identity that has been transmitted in the ATTACH ACCEPT message is a member of any of the "forbidden" lists, any such entry shall be deleted. If the attach procedure is for emergency bearer services, the "forbidden" lists shall remain unchanged. Additionally, the network shall include the radio priority level to be used by the MS for mobile originated SMS transfer in the ATTACH ACCEPT message.</p>
<p>In a shared network, if the MS is a network sharing supporting MS, the network shall indicate the PLMN identity of the CN operator that has accepted the GPRS attach request in the RAI contained in the ATTACH ACCEPT message; if the MS is a network sharing non-supporting MS, the network shall indicate the PLMN identity of the common PLMN (see 3GPP&nbsp;TS&nbsp;23.251&nbsp;[109]). If the PLMN identity of the common PLMN included in the RAI does not identify the CN operator that has accepted the GPRS attach request, the network may include the PLMN identity of the CN operator that has accepted the GPRS attach request in the ATTACH ACCEPT message.</p>
<p>In a multi-operator core network (MOCN) with common GERAN, the network shall indicate in the RAI the common PLMN identity (see 3GPP&nbsp;TS&nbsp;23.251&nbsp;[109]).</p>
<p>If the common PLMN identity included in the RAI does not identify the CN operator that has accepted the GPRS attach request, the network may include the PLMN identity of the CN operator that has accepted the GPRS attach request in the ATTACH ACCEPT message.</p>
<p>If the MS has indicated in the ATTACH REQUEST message that it supports PS inter-RAT handover from GERAN to UTRAN Iu mode, the network may include in the ATTACH ACCEPT message a request to provide the Inter RAT information container.</p>
<p>If the MS has included the MS network capability IE or the UE network capability IE or both in the ATTACH REQUEST message, the network shall store all octets received from the MS, up to the maximum length defined for the respective information element.</p>
<p>NOTE&nbsp;2:&nbsp; This information is forwarded to the new SGSN during inter-SGSN handover or to the new MME during intersystem handover to S1&nbsp;mode.</p>
<p>If the DRX parameter was included in the DRX Parameter IE in the ATTACH REQUEST message, the network shall replace any stored DRX parameter with the received parameter and use it for the downlink transfer of signalling and user data.</p>
<p>The network shall include the extended DRX parameters IE in the ATTACH ACCEPT message only if the extended DRX parameters IE was included in the ATTACH REQUEST message, and the network supports and accepts the use of eDRX.</p>
<p>In A/Gb mode, the Cell Notification information element shall be included in the ATTACH ACCEPT message by the network which indicates that the Cell Notification is supported by the network.</p>
<p>In Iu mode, the network should prolong the PS signalling connection if the mobile station has indicated a follow-on request pending in ATTACH REQUEST. The network may also prolong the PS signalling connection without any indication from the mobile terminal.</p>
<p>The MS, receiving an ATTACH ACCEPT message, stores the received routing area identification, stops timer T3310, resets the GPRS attach attempt counter, resets the routing area updating attempt counter, resets the service request attempt counter, enters state GMM-REGISTERED and sets the GPRS update status to GU1 UPDATED.</p>
<p>If the message contains a P-TMSI, the MS shall use this P-TMSI as the new temporary identity for GPRS services. In this case, an ATTACH COMPLETE message is returned to the network. The MS shall delete its old P-TMSI and shall store the new one. If no P-TMSI has been included by the network in the ATTACH ACCEPT message, the old P-TMSI, if any available, shall be kept.</p>
<p>If the message contains a P-TMSI signature, the MS shall use this P-TMSI signature as the new temporary signature for the GMM context. The MS shall delete its old P-TMSI signature, if any is available, and shall store the new one. If the message contains no P-TMSI signature, the old P-TMSI signature, if available, shall be deleted.</p>
<p>If the network supports delivery of SMS via GPRS (3GPP&nbsp;TS&nbsp;23.060&nbsp;[74]) and this delivery is enabled (see 3GPP&nbsp;TS&nbsp;29.272&nbsp;[150]), then the network shall include the Additional network feature support IE in the ATTACH ACCEPT message and set the GPRS-SMS indicator.</p>
<p>If the network supports the extended protocol configuration options IE and the MS indicated support of the extended protocol configuration options IE, then the network shall include the Additional network feature support IE in the ATTACH ACCEPT message and set the ePCO IE indicator to "extended protocol configuration options IE supported".</p>
<p>Upon receiving the ATTACH ACCEPT message an MS supporting S1 mode shall set the TIN to "P-TMSI".</p>
<p>If the network has requested the provision of Inter RAT handover information, the MS shall return an ATTACH COMPLETE message including the Inter RAT handover information IE to the network.</p>
<p>The network may also send a list of "equivalent PLMNs" in the ATTACH ACCEPT message. Each entry of the list contains a PLMN code (MCC+MNC). The mobile station shall store the list, as provided by the network, and if the GPRS attach procedure is not for emergency bearer services, any PLMN code that is already in the "forbidden PLMN" list shall be removed from the "equivalent PLMNs" list before it is stored by the mobile station. If the mobile station is operating in MS operation mode C or the mobile station is supporting S1 mode, it shall also remove any PLMN code that is already in the list of "forbidden PLMNs for GPRS service" before storing the list. In addition the mobile station shall add to the stored list the PLMN code of the registered PLMN that sent the list. All PLMNs in the stored list shall be regarded as equivalent to each other for PLMN selection, cell selection/re-selection and handover. The stored list in the mobile station shall be replaced on each occurrence of the ATTACH ACCEPT message. If no list is contained in the message, then the stored list in the mobile station shall be deleted. An MS attached for emergency bearer services shall delete the stored list when the MS enters the state GMM-DEREGISTERED. The list shall be stored in the mobile station while switched off so that it can be used for PLMN selection after switch on.</p>
<p>The network shall include the T3324 value IE in the ATTACH ACCEPT message only if the T3324 value IE was included in the ATTACH REQUEST message, and the network supports and accepts the use of PSM.</p>
<p>If the network supports and accepts the use of PSM, and the MS included the T3312 extended value IE in the ATTACH REQUEST message, then the network shall take into account the T3312 value requested when providing the Periodic RA update timer IE and the T3312 extended value IE in the ATTACH ACCEPT message.</p>
<p>NOTE&nbsp;3:&nbsp; Besides the value requested by the MS, the network can take local configuration into account when selecting a value for T3312 (see 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74] subclause&nbsp;5.3.13.54).</p>
<p>In A/Gb mode, if the MS indicates support for restriction on use of enhanced coverage in the ATTACH REQUEST message, and the network restricts enhanced coverage for the MS, then the network shall set the RestrictEC bit to "Enhanced coverage restricted" in the Additional network feature support IE of the ATTACH ACCEPT message.</p>
<p>In Iu mode, if the network wishes to prolong the PS signalling connection (for example, if the mobile station has indicated "follow-on request pending" in ATTACH REQUEST message) the network shall indicate the "follow-on proceed" in the ATTACH ACCEPT message. If the network wishes to release the PS signalling connection, the network shall indicate "no follow-on proceed" in the ATTACH ACCEPT message.</p>
<p>After that in Iu mode, the mobile station shall act according to the follow-on proceed flag included in the Attach result information element in the ATTACH ACCEPT message (see subclause&nbsp;4.7.13).</p>
<p>In A/Gb mode, if the ATTACH ACCEPT message contains the Cell Notification information element, then the MS shall start to use the LLC NULL frame to perform cell updates. The network receiving an ATTACH COMPLETE message stops timer T3350, changes to GMM-REGISTERED state and considers the P-TMSI sent in the ATTACH ACCEPT message as valid.</p>
<p>If the ATTACH ACCEPT message contains the T3312 extended value IE, then the MS shall use the value in T3312 extended value IE as periodic routing area update timer (T3312). If the ATTACH ACCEPT message does not contain T3312 extended value IE, then the MS shall use the value in the Periodic RA update timer IE as periodic routing area update timer (T3312).</p>
<p>If the ATTACH ACCEPT message contains the T3324 value IE, then the MS shall use the included timer value for T3324 as specified in subclause&nbsp;4.7.2.8.</p>
<p>If the ATTACH ACCEPT message contains the DCN-ID IE, then the MS shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as described in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120], annex&nbsp;C.</p>
<p>In a shared network or in a multi-operator core network (MOCN) with common GERAN, if the ATTACH ACCEPT message contains the DCN-ID IE and the PLMN identity of the CN operator IE, the MS shall store the included DCN-ID value with the PLMN identity indicated in the PLMN identity of the CN operator IE, and the included DCN-ID value with the PLMN identity indicated in the RAI in a DCN-ID list in a non-volatile memory in the ME as described in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120], annex C.</p>
<p>If the MS receives the ATTACH ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see subclause&nbsp;4.1.1.6A), then the MS shall reset these counters. If the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall reset this counter.</p>
<p>The network may also send a Local Emergency Numbers List with local emergency numbers in the ATTACH ACCEPT, by including the Emergency Number List IE. The mobile equipment shall store the Local Emergency Numbers List, as provided by the network. The Local Emergency Numbers List stored in the mobile equipment shall be replaced on each receipt of the Emergency Number List IE. The received Local Emergency Numbers List shall be provided to the upper layers.</p>
<p>The emergency number(s) received in the Emergency Number List IE are valid only in networks in the same country as the cell on which this IE is received. If no list is contained in the ATTACH ACCEPT message, then the stored Local Emergency Numbers List in the mobile equipment shall be kept, except if the mobile equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the Local Emergency Numbers List.</p>
<p>The mobile equipment shall use the stored Local Emergency Numbers List of emergency numbers received from the network in addition to the emergency numbers stored on the SIM/USIM or ME to detect that the number dialled is an emergency number.</p>
<p>NOTE&nbsp;4:&nbsp; The mobile equipment may use the Local Emergency Numbers List to assist the end user in determining whether the dialled number is intended for an emergency service or for another destination, e.g. a local directory service. The possible interactions with the end user are implementation specific.</p>
<p>NOTE&nbsp;5:&nbsp; An MS that supports procedures specified in 3GPP&nbsp;TS&nbsp;24.302&nbsp;[156], can get additional local emergency numbers through those procedures, which can be used based on operator policy (see 3GPP&nbsp;TS&nbsp;24.302&nbsp;[156]) to detect that the number dialled is an emergency number.</p>
<p>The Local Emergency Numbers List shall be deleted at switch off and removal of the SIM/USIM. The mobile equipment shall be able to store up to ten local emergency numbers received from the network.</p>
<p>If the MS has initiated the attach procedure due to manual CSG selection and receives an ATTACH ACCEPT message, and the MS sent the ATTACH REQUEST message in a CSG cell, the MS shall check if the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list. If not, the MS shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the MS may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.</p>
<p>In A/Gb mode, if a UMTS security context is available, if the MS indicates support of integrity protection in the ATTACH REQUEST message and the network supports integrity protection, then if the MS receives replayed capabilities IE&rsquo;s in ATTACH ACCEPT, then the MS shall check if the replayed MS network capability IE and replayed MS Radio Access Capability IE received in the ATTACH ACCEPT message has not been altered compared to the MS network capability IE and the MS Radio Access Capability IE that the MS sent to the network in ATTACH REQUEST message. If the replayed MS network capability IE and the replayed MS Radio Access Capability IE are not the same, then the MS shall ignore the ATTACH ACCEPT message.</p>
<h5><a name="_Toc171523994"></a>4.7.3.1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS attach not accepted by the network</h5>
<p>If the attach request cannot be accepted by the network, an ATTACH REJECT message is transferred to the MS. The MS receiving the ATTACH REJECT message containing a reject cause other than GMM cause value #25 or the message is integrity protected, shall stop the timer T3310 and for all causes except #7, #12, #14, #15, #22 and #25 deletes the list of "equivalent PLMNs".</p>
<p>If the ATTACH REJECT message containing GMM cause value cause #25 was received without integrity protection, then the MS shall discard the message.</p>
<p>If the attach request is rejected due to NAS level mobility management congestion control, the network shall set the GMM cause value to #22 "congestion" and assign a back-off timer T3346.</p>
<p>The MS shall then take one of the following actions depending upon the reject cause:</p>
<p># 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Illegal MS);</p>
<p># 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Illegal ME);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED.NO-IMSI. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed or the timer T3245 expires as described in subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the attach procedure is rejected with the EMM cause with the same value.</p>
<p># 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GPRS services not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new state is GMM-DEREGISTERED. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>NOTE&nbsp;1:&nbsp; Optionally the MS starts the timer T3340 as described in subclause&nbsp;4.7.1.9</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the attach procedure is rejected with the EMM cause with the same value.</p>
<p># 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GPRS services and non-GPRS services not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED.NO-IMSI.</p>
<p>NOTE&nbsp;2:&nbsp; Optionally the MS starts the timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the attach procedure is rejected with the EMM cause with the same value.</p>
<p># 11&nbsp;&nbsp;&nbsp; (PLMN not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2), shall reset the GPRS attach attempt counter and shall change to state GMM-DEREGISTERED.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the PLMN identity in the "forbidden PLMN list" and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a PLMN-specific attempt counter for that PLMN, then the MS shall set this counter to the MS implementation-specific maximum value.</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when attach procedure is rejected with the EMM cause with the same value.</p>
<p># 12&nbsp;&nbsp;&nbsp; (Location area not allowed);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>The mobile station shall store the LAI in the list of "forbidden location areas for regional provision of service".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a cell selection according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>NOTE&nbsp;3:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the attach procedure is rejected with the EMM cause with the same value.</p>
<p># 13&nbsp;&nbsp;&nbsp; (Roaming not allowed in this location area);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE or optionally to GMM-DEREGISTERED.PLMN-SEARCH.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the attach procedure is rejected with the EMM cause with the same value.</p>
<p># 14&nbsp;&nbsp;&nbsp; (GPRS services not allowed in this PLMN);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) , shall reset the GPRS attach attempt counter and shall change to state GMM-DEREGISTERED.</p>
<p>The MS shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. A GPRS MS operating in MS operation mode C shall perform a PLMN selection instead of a cell selection. If the message has been successfully integrity checked by the lower layers and the MS maintains a PLMN-specific PS-attempt counter for that PLMN, then the MS shall set this counter to the MS implementation-specific maximum value.</p>
<p>A GPRS MS operating in MS operation mode A or B in network operation mode II, is still IMSI attached for CS services in the network.</p>
<p>As an implementation option, a GPRS MS operating in operation mode A or B may perform the following additional action. If no RR connection exists the MS may perform the action immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS may only perform the action when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS may perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>If an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>The MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; On the "User Controlled PLMN Selector with Access Technology" list;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; On the "Operator Controlled PLMN Selector with Access Technology" list;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; On the "PLMN Selector" list for an MS using a SIM/USIM without access technology information storage (i.e. the "User Controlled PLMN Selector with Access Technology" and the "Operator Controlled PLMN Selector with Access Technology" data files are not present); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; A PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the attach procedure is rejected with the EMM cause with the same value.</p>
<p># 15&nbsp;&nbsp;&nbsp; (No Suitable Cells In Location Area);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>The MS shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall search for a suitable cell in another location area or a tracking area according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121].</p>
<p>NOTE&nbsp;4:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the attach procedure is rejected with the EMM cause with the same value.</p>
<p># 22&nbsp;&nbsp;&nbsp; (Congestion);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause&nbsp;4.7.3.1.5.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall abort the attach procedure, reset the GPRS attach attempt counter, set the GPRS update status to GU2 NOT UPDATED and enter state GMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer T3346 if it is running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the ATTACH REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the ATTACH REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table&nbsp;11.3a.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the attach procedure is rejected with the EMM cause with the same value.</p>
<p># 25&nbsp;&nbsp;&nbsp; (Not authorized for this CSG);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause&nbsp;4.7.3.1.5.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2), reset the GPRS attach attempt counter and enter the state GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the CSG ID and associated PLMN identity of the cell where the MS has sent the ATTACH REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the CSG ID and associated PLMN identity of the cell where the MS has sent the ATTACH REQUEST message are contained in the Operator CSG list stored in the MS, the MS shall proceed as specified in 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14] subclause&nbsp;3.1A.</p>
<p>The MS shall start timer&nbsp;T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>The MS shall search for a suitable cell according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the attach procedure is rejected with the EMM cause with the same value.</p>
<p>Other values are considered as abnormal cases. The specification of the MS behaviour in those cases is specified in subclause&nbsp;4.7.3.1.5.</p>
<h5><a name="_Toc171523995"></a>4.7.3.1.4a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS attach for emergency bearer services not accepted by the network (UTRAN Iu mode only)</h5>
<p>If the attach request for emergency bearer services cannot be accepted by the network, an ATTACH REJECT message is transferred to the MS. The ATTACH REJECT message includes GMM cause #5 "IMEI not accepted" or one of the GMM cause values as described in subclause&nbsp;4.7.3.1.4.</p>
<p>NOTE&nbsp;1:&nbsp; If GMM cause #11 is sent to a MS of a roaming subscriber attaching for emergency bearer services and the MS is in automatic network selection mode, it cannot obtain normal service provided by this PLMN.</p>
<p>Upon receiving the ATTACH REJECT message including GMM cause #5, the MS shall enter the state GMM-DEREGISTERED.NO-IMSI.</p>
<p>Upon receiving the ATTACH REJECT message including one of the other GMM cause values, the MS shall perform the actions as described in subclause&nbsp;4.7.3.1.4 with the following addition: the MS shall inform the upper layers of the failure of the procedure.</p>
<p>NOTE&nbsp;2:&nbsp; This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[13D] can result in the emergency call being attempted to another IP-CAN.</p>
<p>If the attach request for emergency bearer services fails due to abnormal case a) in subclause&nbsp;4.7.3.1.5, the MS shall perform the actions as described in subclause&nbsp;4.7.3.1.5 and inform the upper layers of the failure to access the network.</p>
<p>NOTE&nbsp;3:&nbsp; This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[13D] can result in the emergency call being attempted to another IP-CAN.</p>
<p>If the attach request for emergency bearer services fails due to abnormal cases b), c) or d) in subclause&nbsp;4.7.3.1.5, the MS shall perform the actions as described in subclause&nbsp;4.7.3.1.5 with the following addition: the MS shall inform the upper layers of the failure of the procedure.</p>
<p>NOTE&nbsp;4:&nbsp; This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[13D] can result in the emergency call being attempted to another IP-CAN.</p>
<p>In a shared network, upon receiving the ATTACH REJECT message, the MS shall perform the actions as described in subclause&nbsp;4.7.3.1.4, and shall:</p>
<ol>
<li>a) inform the upper layers of the failure of the procedure; or</li>
</ol>
<p>NOTE&nbsp;5:&nbsp; This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[13D] can result in the emergency call being attempted to another IP-CAN.</p>
<ol>
<li>b) attempt the attach for emergency bearer services to another PLMN in the shared network.</li>
</ol>
<p>In a shared network, if the attach request for emergency bearer services fails due to abnormal case a) in subclause&nbsp;4.7.3.1.5, the MS shall perform the actions as described in subclause&nbsp;4.7.3.1.5 and shall:</p>
<ol>
<li>a) inform the upper layers of the failure to access the network; or</li>
</ol>
<p>NOTE&nbsp;6:&nbsp; This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[13D] can result in the emergency call being attempted to another IP-CAN.</p>
<ol>
<li>b) attempt the attach for emergency bearer services to another PLMN in the shared network.</li>
</ol>
<p>In a shared network, if the attach request for emergency bearer services fails due to abnormal cases b), c) or d) in subclause&nbsp;4.7.3.1.5, the MS shall perform the actions as described in subclause&nbsp;4.7.3.1.5, and shall:</p>
<ol>
<li>a) inform the upper layers of the failure of the procedure; or</li>
</ol>
<p>NOTE&nbsp;7:&nbsp; This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[13D] can result in the emergency call being attempted to another IP-CAN.</p>
<ol>
<li>b) attempt the attach for emergency bearer services to another PLMN in the shared network.</li>
</ol>
<h5><a name="_Toc171523996"></a>4.7.3.1.4b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Attach for initiating a PDN connection for emergency bearer services not accepted by the network (UTRAN Iu mode only)</h5>
<p>If the network cannot accept the attach request for initiating a PDN connection for emergency bearer services with attach type not set to "emergency attach", the MS shall perform the procedures as described in subclause&nbsp;4.7.3.1.4. Then if the MS is in the same selected PLMN where the last attach request was attempted, the MS shall:</p>
<ol>
<li>a) inform the upper layers of the failure of the procedure; or</li>
</ol>
<p>NOTE&nbsp;1:&nbsp; This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[95] that can result in the emergency call being attempted to another IP-CAN.</p>
<ol>
<li>b) attempt GPRS attach for emergency bearer services.</li>
</ol>
<p>If the attach request for initiating a PDN connection for emergency bearer services with attach type not set to "emergency attach" fails due to abnormal case a) in subclause&nbsp;4.7.3.1.5, the MS shall perform the procedures as described in subclause&nbsp;4.7.3.1.5 and inform the upper layers of the failure to access the network.</p>
<p>NOTE&nbsp;2:&nbsp; This can result in the MS attempting a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[95] that can result in the emergency call being attempted to another IP-CAN.</p>
<p>If the attach request for initiating a PDN connection for emergency bearer services with attach type not set to "emergency attach" fails due to abnormal cases b), c) or d) in subclause&nbsp;4.7.3.1.5, the MS shall perform the procedures as described in subclause&nbsp;4.7.3.1.5. Then if the MS is in the same selected PLMN where the last attach request was attempted, the MS shall:</p>
<ol>
<li>a) inform the upper layers; or</li>
</ol>
<p>NOTE&nbsp;3:&nbsp; This can result in the MS attempting a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[95] that can result in the emergency call being attempted to another IP-CAN.</p>
<ol>
<li>b) attempt GPRS attach for emergency bearer services.</li>
</ol>
<h5><a name="_Toc171523997"></a>4.7.3.1.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases in the MS</h5>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) Access barred because of access class control, EAB or ACDC</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The GPRS attach procedure shall not be started. The MS stays in the current serving cell and applies normal cell reselection process. The GPRS attach procedure is started as soon as possible, i.e. when access is granted or because of a cell change.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If access is barred because of access class control, ACDC is applicable to the request from the upper layers and the MS supports ACDC, then the GPRS attach procedure shall be started.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If access is barred for a certain ACDC category, a request with a higher ACDC category is received from the upper layers and the MS supports ACDC, then the GPRS attach procedure shall be started.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If an access request for an uncategorized application is barred due to ACDC, a request with a certain ACDC category is received from the upper layers and the MS supports ACDC, then the GPRS attach procedure shall be started.</p>
<ol>
<li>b) Lower layer failure without "Extended Wait Time" received from lower layers before the ATTACH ACCEPT or ATTACH REJECT message is received</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The procedure shall be aborted and the MS shall proceed as described below, except in the following implementation option cases b.1 and b.2.</p>
<p>b.1)&nbsp;&nbsp;&nbsp;&nbsp; Release of PS signalling connection in Iu mode before the completion of the GPRS attach procedure</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the release of the PS signalling connection occurs before completion of the GPRS attach procedure, then the GPRS attach procedure shall be initiated again, if the following conditions apply:</p>
<ol>
<li>i) The original GPRS attach procedure was initiated over an existing PS signalling connection; and</li>
<li>ii) The GPRS attach procedure was not due to timer T3310 expiry; and</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iii)&nbsp;&nbsp;&nbsp; No SECURITY MODE COMMAND message and no Non-Access Startum (NAS) messages relating to the PS signalling connection (e.g. PS authentication procedure, see subclause&nbsp;4.7.7) were received after the ATTACH REQUEST message was transmitted.</p>
<p>b.2)&nbsp;&nbsp;&nbsp;&nbsp; RR release in Iu mode (i.e. RRC connection release) with, for example, cause "Normal", or "User inactivity" (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111])</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The GPRS attach procedure shall be initiated again, if the following conditions apply:</p>
<ol>
<li>i) The original GPRS attach procedure was initiated over an existing RRC connection; and</li>
<li>ii) The GPRS attach procedure was not due to timer T3310 expiry; and</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iii)&nbsp;&nbsp;&nbsp; No SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the PS signalling connection (e.g. PS authentication procedure, see subclause&nbsp;4.7.7) were received after the ATTACH REQUEST message was transmitted.</p>
<p>NOTE&nbsp;1:&nbsp; The RRC connection release cause that triggers the re-initiation of the GPRS attach procedure is implementation specific.</p>
<ol>
<li>c) T3310 time-out</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; On the first expiry of the timer, the MS shall reset and restart timer T3310 and shall retransmit the ATTACH REQUEST message. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3310, the MS shall abort the GPRS attach procedure and, in Iu mode, release the PS signalling connection (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]). The MS shall proceed as described below.</p>
<ol start="4">
<li>d) ATTACH REJECT, other causes than those treated in subclause&nbsp;4.7.3.1.4, and cases of GMM cause values #22 and #25, if considered as abnormal cases according to subclause&nbsp;4.7.3.1.4</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "emergency attach", upon reception of the cause codes # 95, # 96, # 97, # 99 and # 111 the MS should set the GPRS attach attempt counter to 5.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall proceed as described below.</p>
<ol>
<li>e) Change of cell within the same RA (A/Gb mode only)</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If a cell change occurs within the same RA when the MS is in state GMM-REGISTERED-INITIATED, then the cell update procedure shall be performed before completion of the attach procedure.</p>
<ol>
<li>f) Change of cell into a new routing area</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If a cell change into a new routing area occurs before an ATTACH ACCEPT or ATTACH REJECT message has been received, the GPRS attach procedure shall be aborted and re-initiated immediately. If a routing area border is crossed when the ATTACH ACCEPT message is received but before an ATTACH COMPLETE message is sent, the GPRS attach procedure shall be aborted and the routing area updating procedure shall be initiated. If a P-TMSI was allocated during the GPRS attach procedure, this P-TMSI shall be used in the routing area updating procedure. If a P-TMSI signature was allocated together with the P-TMSI during the GPRS attach procedure, this P-TMSI signature shall be used in the routing area updating procedure.</p>
<ol>
<li>g) Mobile originated detach required</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS is in state GMM-REGISTERED-INITIATED, the GPRS attach procedure shall be aborted and the GPRS detach procedure shall be performed (see subclause&nbsp;4.7.4.1).</p>
<ol>
<li>h) Detach procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a DETACH REQUEST message from the network in state GMM-REGISTERED-INITIATED with detach type "re-attach not required" and no cause code, or "re-attach not required"' and the cause code is not #2 "IMSI unknown in HLR", the GPRS detach procedure shall be progressed and the GPRS attach procedure shall be aborted. Otherwise the GPRS attach procedure shall be progressed and the DETACH REQUEST message shall be ignored.</p>
<ol>
<li>i) "Extended wait time" for PS domain from the lower layers</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the ATTACH REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the MS shall start timer T3346 with the "Extended wait time" value and reset the attach attempt counter.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In other cases the MS shall ignore the "Extended wait time".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall abort the attach procedure, stay in the current serving cell, change the state to GMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and apply the normal cell reselection process.</p>
<ol>
<li>j) Timer T3346 is running</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall not start the GPRS attach procedure unless the MS needs to attach for emergency bearer services or the MS is an MS configured to use AC11 &ndash; 15 in selected PLMN or the MS needs to attach without the NAS signalling low priority indication and if the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, ROUTING AREA UPDATE REQUEST or SERVICE REQUEST) which contained the&nbsp; low priority indicator set to "MS is configured for NAS signalling low priority". The MS stays in the current serving cell and applies normal cell reselection process.</p>
<p>NOTE&nbsp;2:&nbsp; It is considered an abnormal case if the MS needs to initiate an attach procedure while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non successful case.</p>
<p>In cases b, c, d, i and j, the MS shall proceed as follows:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Timer T3310 shall be stopped if still running.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; For the cases b, c, d, and i when the "Extended wait time" is ignored, if the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "emergency attach", the GPRS attach attempt counter shall be incremented.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the GPRS attach attempt counter is less than 5:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for the cases i and j, the GPRS attach procedure is started, if still necessary, when timer T3346 expires or is stopped.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for the cases b, c, d, and i when the "Extended wait time" is ignored, if the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "emergency attach", timer T3311 is started and the state is changed to GMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the GPRS attach attempt counter is greater than or equal to 5:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall delete any RAI, P-TMSI, P-TMSI signature, list of equivalent PLMNs, and GPRS ciphering key sequence number, shall set the GPRS update status to GU2 NOT UPDATED, shall start timer T3302. The state is changed to GMM-DEREGISTERED. ATTEMPTING-TO-ATTACH or optionally to GMM-DEREGISTERED.PLMN-SEARCH (see subclause&nbsp;4.2.4.1.2) in order to perform a PLMN selection according to 3GPP TS&nbsp;23.122 [14].</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported by the MS, the MS shall in addition handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the abnormal case when a normal attach procedure fails and the attach attempt counter is equal to 5.</p>
<h5><a name="_Toc171523998"></a>4.7.3.1.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the network side</h5>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) Lower layer failure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If a low layer failure occurs before the message ATTACH COMPLETE has been received from the MS and a new P-TMSI (or a new P-TMSI and a new P-TMSI signature) has been assigned, the network shall consider both the old and new P-TMSI each with its corresponding P-TMSI-signature as valid until the old P-TMSI can be considered as invalid by the network (see subclause&nbsp;4.7.1.5) or the GMM context which has been marked as detached in the network is released, and shall not resent the message ATTACH ACCEPT. During this period the network may:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; use the identification procedure followed by a P-TMSI reallocation procedure if the old P-TMSI is used by the MS in a subsequent message.</p>
<ol>
<li>b) Protocol error</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the ATTACH REQUEST message is received with a protocol error, the network shall return an ATTACH REJECT message with one of the following reject causes:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #96:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mandatory information element error;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #99:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Information element non-existent or not implemented;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #100:&nbsp;&nbsp;&nbsp;&nbsp; Conditional IE error;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #111:&nbsp;&nbsp;&nbsp;&nbsp; Protocol error, unspecified.</p>
<ol>
<li>c) T3350 time-out</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; On the first expiry of the timer, the network shall retransmit the ATTACH ACCEPT message and shall reset and restart timer T3350.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This retransmission is repeated four times, i.e. on the fifth expiry of timer T3350, the GPRS attach procedure shall be aborted. If a new P-TMSI or a new P-TMSI together with a new P-TMSI signature were allocated in the ATTACH ACCEPT message, the network shall consider both the old and new P-TMSI each together with the corresponding P-TMSI signatures as valid until the old P-TMSI can be considered as invalid by the network (see subclause&nbsp;4.7.1.5) or the GMM context which has been marked as detached in the network is released. During this period the network acts as specified for case a.</p>
<p>d.1)&nbsp;&nbsp;&nbsp;&nbsp; ATTACH REQUEST received after the ATTACH ACCEPT message has been sent and before the ATTACH COMPLETE message is received</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If one or more of the information elements in the ATTACH REQUEST message differ from the ones received within the previous ATTACH REQUEST message, the previously initiated GPRS attach procedure shall be aborted if the ATTACH COMPLETE message has not been received and the new GPRS attach procedure shall be progressed, or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the information elements do not differ, then the ATTACH ACCEPT message shall be resent and the timer T3350 shall be restarted if an ATTACH COMPLETE message is expected. In that case, the retransmission counter related to T3350 is not incremented.</p>
<p>d.2)&nbsp;&nbsp;&nbsp;&nbsp; More than one ATTACH REQUEST received and no ATTACH ACCEPT or ATTACH REJECT message has been sent</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If one or more of the information elements in the ATTACH REQUEST message differs from the ones received within the previous ATTACH REQUEST message, the previously initiated GPRS attach procedure shall be aborted and the new GPRS attach procedure shall be progressed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the information elements do not differ, then the network shall continue with the previous attach procedure and shall not treat any further this ATTACH REQUEST message.</p>
<ol>
<li>e) ATTACH REQUEST received in state GMM-REGISTERED</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If an ATTACH REQUEST message is received in state GMM-REGISTERED the network may initiate the GMM common procedures; if it turned out that the ATTACH REQUEST message was send by an MS that has already been attached, the GMM context, PDP contexts and MBMS contexts, if any, are deleted and the new ATTACH REQUEST is progressed.</p>
<ol>
<li>f) ROUTING AREA UPDATE REQUEST message received before ATTACH COMPLETE message.</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Timer T3350 shall be stopped. The allocated P-TMSI shall be considered as valid and the routing area updating procedure shall be progressed as described in subclause&nbsp;4.7.5.</p>
<ol>
<li>g) DETACH REQUEST message received before ATTACH COMPLETE message.</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The network shall abort the attach procedure and shall progress the detach procedure as described in subclause&nbsp;4.7.4.1.</p>
<p>Figure 4.7.3/1 3GPP TS 24.008: GPRS attach procedure and combined GPRS attach procedure</p>
<h4><a name="_Toc171523999"></a>4.7.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combined GPRS attach procedure for GPRS and non-GPRS services</h4>
<p>The combined GPRS attach procedure is a GMM procedure used by a GPRS MS operating in MS operation modes A or B for IMSI attach for GPRS and non-GPRS services if the network operates in network operation mode I.</p>
<p>If a GPRS MS operating in MS operation modes A or B is already attached for non-GPRS services by use of the MM specific IMSI attach procedure, but additionally wishes to perform an IMSI attach for GPRS services, the combined GPRS attach procedure shall also be used.</p>
<p>The attach type information element shall indicate "combined GPRS/IMSI attach". In this case, the messages ATTACH ACCEPT, ATTACH COMPLETE, and ATTACH REJECT used by the combined GPRS attach procedure carry information for both the GPRS and the non-GPRS services.</p>
<p>A GPRS MS in MS operation mode A shall perform the normal GPRS/IMSI attach procedure during an ongoing circuit-switched transaction.</p>
<h5><a name="_Toc171524000"></a>4.7.3.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combined GPRS attach procedure initiation</h5>
<p>If the MS is in GMM state GMM-DEREGISTERED and in MM state MM IDLE, the MS initiates the combined GPRS attach procedure by sending an ATTACH REQUEST message to the network, starts timer T3310 and enters state GMM-REGISTERED-INITIATED and MM LOCATION UPDATING PENDING. If timer T3302 is currently running, the MS shall stop timer T3302. If timer T3311 is currently running, the MS shall stop timer T3311.</p>
<p>The MS shall set the Mobile identity IE, old RAI and P-TMSI signature in the ATTACH REQUEST message as specified in subclause 4.7.3.1.1. Furthermore the MS shall include the TMSI status IE if no valid TMSI is available.</p>
<p>If the MS initiates a combined GPRS attach procedure for GPRS services and "SMS-only service", the MS shall indicate "SMS only" in the Additional update type IE.</p>
<p>If the MS has stored a valid LAI and the MS supports EMM combined procedures, the MS shall include it in the Old location area identification IE in the ATTACH REQUEST message.</p>
<p>If the MS has stored a valid TMSI, the MS shall include the TMSI based NRI container IE in the ATTACH REQUEST message.</p>
<p>In Iu mode, if the MS wishes to prolong the established PS signalling connection after the GPRS attach (for example, the MS has any CM application request pending), it may set a follow-on request pending indicator on (see subclause&nbsp;4.7.13).</p>
<h5><a name="_Toc171524001"></a>4.7.3.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM Common procedure initiation</h5>
<p>The network may initiate GMM common procedures, e.g. the GMM identification and GMM authentication and ciphering procedure, depending on the received information such as IMSI, CKSN, old RAI, P-TMSI and P-TMSI signature.</p>
<h5><a name="_Toc171524002"></a>4.7.3.2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combined GPRS attach accepted by the network</h5>
<p>Depending on the value of the attach result IE received in the ATTACH ACCEPT message, two different cases can be distinguished:</p>
<p>Case 1)&nbsp;&nbsp;&nbsp;&nbsp; The attach result IE value indicates "combined GPRS attach": IMSI attach for GPRS and non-GPRS services have been successful.</p>
<p>Case 2)&nbsp;&nbsp;&nbsp;&nbsp; The attach result IE value indicates "GPRS only": IMSI attach for GPRS services has been successful but IMSI attach for non-GPRS services has not been successful.</p>
<p>In Iu mode, if the network wishes to prolong the PS signalling connection (for example, if the mobile station has indicated "follow-on request pending" in ATTACH REQUEST message) the network shall indicate the "follow-on proceed" in the ATTACH ACCEPT message. If the network wishes to release the PS signalling connection, the network shall indicate "no follow-on proceed" in the ATTACH ACCEPT message.</p>
<p>After that in Iu mode, the mobile station shall act according to the follow-on proceed flag included in the Attach result information element in the ATTACH ACCEPT message (see subclause&nbsp;4.7.13).</p>
<p>&nbsp;</p>
<p>4.7.3.2.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combined attach successful for GPRS and non-GPRS services</p>
<p>The description for IMSI attach for GPRS services as specified in subclause&nbsp;4.7.3.1.3 shall be followed. In addition, the following description for IMSI attach for non-GPRS services applies.</p>
<p>The TMSI reallocation may be part of the combined GPRS attach procedure. The TMSI allocated is then included in the ATTACH ACCEPT message together with the location area identification (LAI). The network shall, in this case, change to state GMM-COMMON-PROCEDURE-INITIATED and shall start timer T3350 as described in subclause&nbsp;4.7.6.</p>
<p>The MS, receiving an ATTACH ACCEPT message, stores the received location area identification, stops timer T3310, reset the location update attempt counter and sets the update status to U1 UPDATED. If the message contains an IMSI, the mobile station is not allocated any TMSI, and shall delete any TMSI accordingly. If the message contains a TMSI, the MS shall use this TMSI as the new temporary identity. The MS shall delete its old TMSI and shall store the new TMSI. In this case, an ATTACH COMPLETE message is returned to the network. If neither a TMSI nor an IMSI has been included by the network in the ATTACH ACCEPT message, the old TMSI, if any available, shall be kept. The new MM state is MM IDLE, the new GMM state is GMM-REGISTERED.</p>
<p>If the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events (see subclause&nbsp;4.1.1.6A), then the MS shall reset this counter.</p>
<p>If the network has requested the provision of Inter RAT handover information, the MS shall return an ATTACH COMPLETE message including the Inter RAT handover information IE to the network.</p>
<p>If the MS is not configured for NAS signalling low priority then the MS may stop timer T3246 if running.</p>
<p>Any timer used for triggering the location update procedure (e.g T3211, T3212) shall be stopped if running.</p>
<p>The network receiving an ATTACH COMPLETE message stops timer T3350, changes to state GMM-REGISTERED.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon receiving an ATTACH COMPLETE message, the SGSN sends a BSSAP+-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP&nbsp;TS&nbsp;29.018&nbsp;[149].</p>
<p>4.7.3.2.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combined attach successful for GPRS services only</p>
<p>Apart from the actions on the routing area updating attempt counter, the description for IMSI attach for GPRS services as specified in subclause&nbsp;4.7.3.1.3 shall be followed. In addition, the following description for IMSI attach for non-GPRS services applies.</p>
<p>The SGSN shall use GMM cause #28 "SMS provided via GPRS in this routing area" in the ATTACH ACCEPT message only if the MS requested "SMS-only service" by including the Additional update type IE in the ATTACH REQUEST message.</p>
<p>The MS receiving the ATTACH ACCEPT message takes one of the following actions depending on the GMM cause:</p>
<p># 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (IMSI unknown in HLR)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer&nbsp;T3310 if still running and shall reset the routing area updating attempt counter. The MS shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The MS shall enter state GMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The SIM/USIM shall be considered as invalid for non-GPRS services until switching off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p># 16&nbsp;&nbsp;&nbsp; (MSC temporarily not reachable); or</p>
<p># 17&nbsp;&nbsp;&nbsp; (Network failure)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer&nbsp;T3310 if still running, and shall enter state MM-IDLE. The routing area updating attempt counter shall be incremented.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the routing area updating attempt counter is less than 5, and the stored RAI is equal to the RAI of the current serving cell and the GMM update status is equal to GU1 UPDATED:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall keep the GMM update status GU1 UPDATED and changes state to GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. The MS shall start timer T3311. When timer T3311 expires the combined routing area update procedure indicating "combined RA/LA updating with IMSI attach" is triggered again.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the routing area updating attempt counter is greater than or equal to 5:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall start timer T3302 and shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS MS operating in MS operation mode A shall then proceed with appropriate MM specific procedure; a GPRS MS operating in MS operation mode B may then proceed with appropriate MM specific procedures. The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered.</p>
<p># 22&nbsp;&nbsp;&nbsp; (Congestion)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, shall stop timer&nbsp;T3310 if still running, and shall enter state MM-IDLE. The MS shall set the routing area updating attempt counter to 5 and shall start the timer T3302.</p>
<p>&nbsp;</p>
<p># 28&nbsp;&nbsp;&nbsp; (SMS provided via GPRS in this routing area);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer&nbsp;T3310 if still running and shall reset the routing area updating attempt counter. The MS shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The MS shall enter state GMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS stays in the current serving cell and applies the normal cell reselection process.</p>
<p>Other GMM causevalues and the case that no GMM cause IE was received are considered as abnormal cases. The combined attach procedure shall be considered as failed for non-GPRS services. The behaviour of the MS in those cases is specified in subclause&nbsp;4.7.3.2.5.</p>
<h5><a name="_Toc171524003"></a>4.7.3.2.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combined GPRS attach not accepted by the network</h5>
<p>If the attach request can neither be accepted by the network for GPRS nor for non-GPRS services, an ATTACH REJECT message is transferred to the MS. The MS receiving the ATTACH REJECT message containing a reject cause other than GMM cause value #25 or the message is integrity protected, shall stop the timer T3310, and for all causes except #7, #12, #14, #15, #22 and #25 deletes the list of "equivalent PLMNs".</p>
<p>If the ATTACH REJECT message containing GMM cause value #25 was received without integrity protection, then the MS shall discard the message.</p>
<p>If the attach request is rejected due to NAS level mobility management congestion control, the network shall set the GMM cause value to #22 "congestion" and assign a back-off timer T3346.</p>
<p>The MS shall then take one of the following actions depending upon the reject cause:</p>
<p># 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Illegal MS);</p>
<p># 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Illegal ME), or</p>
<p># 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GPRS services and non-GPRS services not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED.NO-IMSI. The new MM state is MM IDLE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed or the timer T3245 expires as described in subclause&nbsp;4.1.1.6.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>NOTE&nbsp;1:&nbsp; Optionally the MS starts the timer T3340 as described in subclause&nbsp;4.7.1.9 for reject cause #8</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.</p>
<p># 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GPRS services not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new GMM state is GMM-DEREGISTERED; the MM state is MM IDLE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>NOTE&nbsp;2:&nbsp; Optionally the MS starts the timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B shall proceed with the appropriate MM specific procedure according to the MM service state.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.</p>
<p># 11&nbsp;&nbsp;&nbsp; (PLMN not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2), shall reset the GPRS attach attempt counter and changes to state GMM-DEREGISTERED.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the update status to U3 ROAMING NOT ALLOWED, reset the location update attempt counter and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the PLMN identity in the "forbidden PLMN list" and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a PLMN-specific attempt counter for that PLMN, then the MS shall set this counter to the MS implementation-specific maximum value.</p>
<p>The MS shall start timer&nbsp;T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.</p>
<p># 12&nbsp;&nbsp;&nbsp; (Location area not allowed);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the update status to U3 ROAMING NOT ALLOWED, reset the location update attempt counter and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE.</p>
<p>The MS shall store the LAI in the list of "forbidden location areas for regional provision of service".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>The MS shall perform a cell selection according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>NOTE&nbsp;3:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.</p>
<p># 13&nbsp;&nbsp;&nbsp; (Roaming not allowed in this location area);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE or optionally to GMM-DEREGISTERED.PLMN-SEARCH.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the update status to U3 ROAMING NOT ALLOWED, reset the location update attempt counter and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>The MS shall start timer&nbsp;T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.</p>
<p># 14&nbsp;&nbsp;&nbsp; (GPRS services not allowed in this PLMN);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2), shall reset the GPRS attach attempt counter and shall change to state GMM-DEREGISTERED.</p>
<p>The MS shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a PLMN-specific PS-attempt counter for that PLMN, then the MS shall set this counter to the MS implementation-specific maximum value.</p>
<p>As an implementation option, a GPRS MS operating in operation mode A or B may perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>If an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; On the "User Controlled PLMN Selector with Access Technology";</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; On the "Operator Controlled PLMN Selector with Access Technology" list;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; On the "PLMN Selector" list for an MS using a SIM/USIM without access technology information storage (i.e. the "User Controlled PLMN Selector with Access Technology" and the "Operator Controlled PLMN Selector with Access Technology" data files are not present); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; A PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.</p>
<p>If the MS does not perform a PLMN selection then a GPRS MS operating in MS operation mode A or B which is not yet IMSI attached for CS services in the network shall then perform an IMSI attach for non-GPRS services according to the conditions for the MM IMSI attach procedure (see subclause&nbsp;4.4.3).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B shall proceed with the appropriate MM specific procedure according to the MM service state.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.</p>
<p># 15&nbsp;&nbsp;&nbsp; (No Suitable Cells In Location Area);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>The MS shall set the update status to U3 ROAMING NOT ALLOWED, reset the location update attempt counter and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE.</p>
<p>The MS shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>The MS shall start timer&nbsp;T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>The MS shall search for a suitable cell in another location area or a tracking area according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121].</p>
<p>NOTE&nbsp;4:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.</p>
<p># 22&nbsp;&nbsp;&nbsp; (Congestion);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause&nbsp;4.7.3.1.5.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall abort the attach procedure, reset the GPRS attach attempt counter, set the GPRS update status to GU2 NOT UPDATED and enter state GMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer T3346 if it is running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the ATTACH REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the ATTACH REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table&nbsp;11.3a.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started, if still necessary, when timer T3346 expires or is stopped.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the attach procedure is rejected with the EMM cause with the same value.</p>
<p># 25&nbsp;&nbsp;&nbsp; (Not authorized for this CSG)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause&nbsp;4.7.3.2.5.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the CSG ID and associated PLMN identity of the cell where the MS has sent the ATTACH REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the CSG ID and associated PLMN identity of the cell where the MS has sent the ATTACH REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14] subclause&nbsp;3.1A.</p>
<p>The MS shall start timer&nbsp;T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If the MS is IMSI attached for non-GPRS services, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall search for a suitable cell according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined attach procedure is rejected with the EMM cause with the same value.</p>
<p>Other values are considered as abnormal cases. The specification of the MS behaviour in those cases is specified in subclause&nbsp;4.7.3.2.5.</p>
<h5><a name="_Toc171524004"></a>4.7.3.2.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases in the MS</h5>
<p>The MS shall proceed as follows:</p>
<p>1)&nbsp;&nbsp; If the combined attach was successful for GPRS services only and the ATTACH ACCEPT message contained a cause value not treated in subclause&nbsp;4.7.3.2.3.2 or the GMM Cause IE is not included in the message, the MS shall proceed as follows:</p>
<ol>
<li>a) The MS shall stop timer&nbsp;T3310 if still running, and shall enter state MM IDLE. The routing area updating attempt counter shall be incremented;</li>
<li>b) If the routing area updating attempt counter is less than 5, and the stored RAI is equal to the RAI of the current serving cell and the GMM update status is equal to GU1 UPDATED:</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall keep the GMM update status GU1 UPDATED and changes state to GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. The MS shall start timer T3311. When timer T3311 expires the combined routing area update procedure indicating "combined RA/LA updating with IMSI attach" is triggered again; and</p>
<ol>
<li>c) If the routing area updating attempt counter is greater than or equal to 5:</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall start timer T3302 and shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS MS operating in MS operation mode A shall then proceed with appropriate MM specific procedure; a GPRS MS operating in MS operation mode B may then proceed with appropriate MM specific procedures. The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered; and</p>
<p>2)&nbsp;&nbsp; Otherwise, the abnormal cases specified in subclause&nbsp;4.7.3.1.5 apply with the following modification.</p>
<p>If the GPRS attach attempt counter is incremented according to subclause&nbsp;4.7.3.1.5 the next actions depend on the Location Area Identities (stored on SIM/USIM and the one of the current serving cell) and the value of the attach attempt counter:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the update status is U1 UPDATED, and the stored LAI is equal to the one of the current serving cell and the attach attempt counter is smaller than 5, then the mobile station shall keep the update status to U1 UPDATED, the new MM state is MM IDLE substate NORMAL SERVICE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the attach attempt counter is smaller than 5 and, additionally, the update status is different from U1 UPDATED or the stored LAI is different from the one of the current serving cell, then the mobile station shall delete any LAI, TMSI, ciphering key sequence number stored in the SIM/USIM and list of equivalent PLMNs and set the update status to U2 NOT UPDATED. The MM state remains MM LOCATION UPDATING PENDING; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the attach attempt counter is greater or equal to 5, then the mobile station shall delete any LAI, TMSI, ciphering key sequence number stored in the SIM/USIM and list of equivalent PLMNs and set the update status to U2 NOT UPDATED.<br /> A GPRS MS operating in MS operation mode A shall then proceed with appropriate MM specific procedure; a GPRS MS operating in MS operation mode B may then proceed with appropriate MM specific procedures. <br /> The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered. The new MM state is MM IDLE substate ATTEMPTING TO UPDATE or optionally MM IDLE substate PLMN SEARCH in order to perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<h5><a name="_Toc171524005"></a>4.7.3.2.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the network side</h5>
<p>The abnormal cases specified in subclause&nbsp;4.7.3.1.6 apply.</p>
<h3><a name="_Toc171524006"></a>4.7.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach procedure</h3>
<h4><a name="_Toc171524007"></a>4.7.4.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; General</h4>
<p>The GPRS detach procedure is used:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; to detach the IMSI for GPRS services only. Independent of the network operation mode, this procedure is used by all kind of GPRS MSs;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; as a combined GPRS detach procedure used by GPRS MSs operating in MS operation mode A or B to detach the IMSI for GPRS and non-GPRS services or for non-GPRS services only, if the network operates in network operation mode I and no circuit-switched transaction is ongoing;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in the case of a network failure condition to indicate to the MS that a re-attach with successive activation of previously active PDP contexts shall be performed. In this case, the MS may also perform the procedures needed in order to activate any previously active multicast service(s); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; to detach the IMSI or IMEI for emergency bearer services.</p>
<p>After completion of a GPRS detach procedure or combined GPRS detach procedure for GPRS and non-GPRS services the GMM context is released.</p>
<p>An eCall only mobile station that is not capable of eCall over IMS shall not perform any kind of GPRS detach procedure.</p>
<p>The GPRS detach procedure shall be invoked by the MS if the MS is switched off, the SIM/USIM card is removed from the MS or if the GPRS or non-GPRS capability of the MS is disabled. The procedure may be invoked by the network to detach the IMSI for GPRS services. The GPRS detach procedure causes the MS to be marked as inactive in the network for GPRS services, non-GPRS services or both services.</p>
<p>If the detach procedure is triggered due to SIM/USIM removal, the MS shall indicate "switch off" in the detach type IE.</p>
<p>If a detach is requested by the HLR for an MS that has a PDP context for emergency services, the SGSN shall not send a DETACH REQUEST message to the MS, and shall follow the procedure described in subclause&nbsp;6.1.3.4.2 for an MS that has PDP contexts for emergency bearer services.</p>
<p>When upper layers indicates that emergency bearer services are no longer required, the MS if still attached for emergency bearer services, may perform a detach followed by a re-attach to regain normal services, if the MS is in or moves to a suitable cell.</p>
<p>In A/Gb mode, if the GPRS detach procedure is performed, the PDP contexts and the MBMS contexts, if any, are deactivated locally without peer to peer signalling between the SM and LLC entities in the MS and the network.</p>
<p>In Iu mode, if the GPRS detach procedure is performed, the PDP contexts and the MBMS contexts, if any, are deactivated locally without peer to peer signalling between the SM entities in the MS and the network.</p>
<p>If the MS supports S1 mode, the MS shall store the TIN in the non-volatile memory in the ME, as described in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120], annex&nbsp;C, for a subsequent attach procedure.</p>
<p>The MS is allowed to initiate the GPRS detach procedure even if the timer T3346 is running.</p>
<p>The network proceeds with the GPRS detach procedure even if NAS level mobility management congestion control is active.</p>
<h4><a name="_Toc171524008"></a>4.7.4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MS initiated GPRS detach procedure</h4>
<h5><a name="_Toc171524009"></a>4.7.4.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MS initiated GPRS detach procedure initiation</h5>
<p>The GPRS detach procedure is initiated by the MS by sending a DETACH REQUEST message. The detach type information element may indicate "GPRS detach with switching off", "GPRS detach without switching off", "IMSI detach", "GPRS/IMSI detach with switching off" or "GPRS/IMSI detach without switching off".</p>
<p>If the MS has a valid P-TMSI, the MS shall include the P-TMSI in the DETACH REQUEST message. The MS shall also include a valid P-TMSI signature, if available.</p>
<p>If the MS is not switched off and the MS is in the state GMM_REGISTERED, timer T3321 shall be started after the DETACH REQUEST message has been sent. If the detach type information element value indicates "IMSI Detach" the MS shall enter GMM-REGISTERED.IMSI-DETACH_INITIATED, otherwise the MS shall enter the state GMM-DEREGISTERED-INITIATED. If the detach type information element value indicates "IMSI Detach" or "GPRS/IMSI Detach", state MM IMSI DETACH PENDING is entered. If the MS to be switched off is not a MS using any of the coverage classes of EC-GSM-IoT, the MS shall try for a period of 5 seconds to send the DETACH REQUEST message. If the MS to be switched off is a MS using any of the coverage classes of EC-GSM-IoT, that MS should try for at least a period of 10 seconds to send the DETACH REQUEST message. If the MS is able to send the DETACH REQUEST message during this time the MS may be switched off.</p>
<p>If the detach type information element value indicates "GPRS detach without switching off " and the MS is attached for GPRS and non-GPRS services and the network operates in network operation mode I, then if in the MS the timer T3212 is not already running, the timer T3212 shall be set to its initial value and restarted after the DETACH REQUEST message has been sent.</p>
<h5><a name="_Toc171524010"></a>4.7.4.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MS initiated GPRS detach procedure completion for GPRS services only</h5>
<p>When the DETACH REQUEST message is received by the network, the network shall send a DETACH ACCEPT message to the MS, if the detach type IE value indicates that the detach request has not been sent due to switching off. If switching off was indicated, the procedure is completed when the network receives the DETACH REQUEST message. The network and the MS shall deactivate the PDP contexts, the MBMS contexts and deactivate the logical link(s), if any.</p>
<p>The MS is marked as inactive in the network for GPRS services; state GMM-DEREGISTERED is entered in the MS and the network.</p>
<p>In Iu mode, if the detach has been sent due to switching off, then the network shall release the resources in the lower layers for this MS (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; When the DETACH REQUEST message is received by the network, and if the detach type IE value indicates that the detach is not due to power off, the authentication and ciphering procedure as well as the identification procedure may be performed.</p>
<p>If the MS supports S1 mode and operates in MS operation mode A or B , the MS shall disable the E‑UTRA capability (see 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120]).</p>
<h5><a name="_Toc171524011"></a>4.7.4.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MS initiated combined GPRS detach procedure completion</h5>
<p>When the DETACH REQUEST message is received by the network, a DETACH ACCEPT message shall be sent to the MS, if the detach type IE value indicates that the detach request has not been sent due to switching off. Depending on the value of the detach type IE the following applies:</p>
<p>GPRS/IMSI detach:<br /> The MS is marked as inactive in the network for GPRS and for non-GPRS services. The network and the MS shall deactivate the PDP contexts, the MBMS contexts and deactivate the logical link(s), if any. The States GMM-DEREGISTERED and MM NULL are entered in both the MS and the network.</p>
<p>In Iu mode, if the detach has been sent due to switching off, then the network shall release the resources in the lower layers for this MS (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<p>IMSI detach:<br /> The MS is marked as inactive in the network for non-GPRS services. State MM NULL is entered in the MS and the network.</p>
<h5><a name="_Toc171524012"></a>4.7.4.1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases in the MS</h5>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) T3321 time-out</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; On the first expiry of the timer, the MS shall retransmit the DETACH REQUEST message and shall reset and restart timer T3321. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3321, the GPRS detach procedure shall be aborted, the MS shall change to state:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; MM-NULL if "IMSI detach" was requested;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.NORMAL-SERVICE if "IMSI Detach" was requested;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED if "GPRS detach" was requested;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED and MM-NULL if "GPRS/IMSI" detach was requested.</p>
<ol>
<li>b) Lower layer failure before reception of DETACH ACCEPT message</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The detach procedure is aborted and the MS shall change to one of the following states, except in the following implementation option cases b.1, b.2 and b3:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; MM-NULL if "IMSI detach" was requested;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM-REGISTERED.NORMAL-SERVICE if "IMSI Detach" was requested;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED if "GPRS detach" was requested;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; GMM-DEREGISTERED and MM-NULL if "IMSI/GPRS" detach was requested.</p>
<p>b.1)&nbsp;&nbsp;&nbsp;&nbsp; Release of PS signalling connection before the completion of the GPRS detach procedure</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The release of the PS signalling connection before completion of the GPRS detach procedure shall result in the GPRS detach procedure being initiated again, if the following conditions apply:</p>
<ol>
<li>i) The original GPRS detach procedure was initiated over an existing PS signalling connection; and</li>
<li>ii) No SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the PS signalling connection (e.g. PS authentication procedure, see subclause&nbsp;4.7.7) were received after the DETACH REQUEST message was transmitted.</li>
</ol>
<p>b.2)&nbsp;&nbsp;&nbsp;&nbsp; RR release in Iu mode (i.e. RRC connection release) with cause different than "Directed signalling connection re-establishment", for example, "Normal", or"User inactivity" (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111])</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The GPRS detach procedure shall be initiated again, if the following conditions apply:</p>
<ol>
<li>i) The original GPRS detach procedure was initiated over an exisiting RRC connection; and</li>
<li>ii) No SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the PS signalling connection (e.g. PS authentication procedure, see subclause&nbsp;4.7.7) were received after the DETACH REQUEST message was transmitted.</li>
</ol>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The RRC connection release cause different than "Directed signalling connection re-establishment" that triggers the re-initiation of the GPRS detach procedure is implementation specific.</p>
<p>b.3)&nbsp;&nbsp;&nbsp;&nbsp; RR release in Iu mode (i.e. RRC connection release) with cause "Directed signalling connection re-establishment" (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111])</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The routing area updating procedure shall be initiated followed by completion of the GPRS detach procedure if the following conditions apply:</p>
<ol>
<li>i) The original GPRS detach procedure was not due to SIM removal; and</li>
<li>ii) The original GPRS detach procedure was not due to a rerun of the procedure due to "Directed signalling connection reestablishment".</li>
<li>c) Detach procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing cause "power off":</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a DETACH REQUEST message before the MS initiated GPRS detach procedure has been completed, this message shall be ignored and the MS initiated GPRS detach procedure shall continue.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing other causes than "power off":</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a DETACH REQUEST message before the MS initiated GPRS detach procedure has been completed, the MS shall treat the message as specified in subclause&nbsp;4.7.4.2.2 with the following modifications:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the DETACH REQUEST message received by the MS contains detach type "re-attach required", and the MS initiated detach procedure is with detach type "GPRS detach" or "Combined GPRS/IMSI detach", the MS need not initiate the GPRS attach or combined GPRS attach procedure.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the DETACH REQUEST message received by the MS contains detach type "IMSI detach", and the MS initiated detach procedure is with detach type "IMSI detach", the MS in operation mode A or B in network operation mode I need not re-attach to non-GPRS services.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the DETACH REQUEST message received by the MS contains detach type "IMSI detach", and the MS initiated detach procedure is with detach type "GPRS detach" or "combined GPRS/IMSI detach", the MS shall progress both procedures. The MS in operation mode A or B in network operation mode I need not re-attach to non-GPRS services.</p>
<ol>
<li>d) Detach and GMM common procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing cause "power off":</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a message used in a GMM common procedure before the GPRS detach procedure has been completed, this message shall be ignored and the GPRS detach procedure shall continue.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing other causes than "power off" and containing detach type "IMSI detach":</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a message used in a GMM common procedure before the GPRS detach procedure has been completed, both the GMM common procedure and the GPRS detach procedure shall continue.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing other causes than "power off" and containing other detach types than "IMSI detach":</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a P-TMSI REALLOCATION COMMAND, a GMM STATUS, or a GMM INFORMATION message before the GPRS detach procedure has been completed, this message shall be ignored and the GPRS detach procedure shall continue.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives an AUTHENTICATION AND CIPHERING REQUEST or IDENTITY REQUEST message, before the GPRS detach procedure has been completed, the MS shall respond to it as described in subclauses&nbsp;4.7.7 and 4.7.8 respectively.</p>
<ol>
<li>e) Change of cell within the same RA (A/Gb mode only)</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If a cell change occurs within the same RA before a DETACH ACCEPT message has been received, then the cell update procedure shall be performed before completion of the detach procedure.</p>
<ol>
<li>f) Change of cell into a new routing area</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If a cell change into a new routing area occurs before a DETACH ACCEPT message has been received, the GPRS detach procedure shall be aborted and re-initiated after successfully performing a routing area updating procedure. If the detach procedure is performed due to the removal of the SIM/USIM or the MS is to be switched off, the MS shall abort the detach procedure and enter the state GMM-DEREGISTERED.</p>
<ol>
<li>g) Access barred because of access class control or EAB</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The signalling procedure for GPRS detach shall not be started. The MS starts the signalling procedure as soon as possible and if still necessary, i.e. when the barred state is removed or because of a cell change, or performs a local detach immediately or after an implementation dependent time.</p>
<ol>
<li>h) Detach and paging for non-GRPS services procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a paging for non-GPRS services before the MS initiated combined GPRS detach procedure with detach type "IMSI detach" or "GPRS/IMSI detach" has been completed, then the paging for non-GPRS services shall be ignored and the MS initiated combined GPRS detach procedure shall continue.</p>
<p>Figure 4.7.4/1 3GPP TS 24.008: MS initiated GPRS detach procedure</p>
<p>For the cases b and f:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Timer T3321 shall be stopped if still running.</p>
<h5><a name="_Toc171524013"></a>4.7.4.1.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the network side</h5>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) Detach request received in a CSG cell for which the MS has no valid CSG subscription</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS initiates a detach procedure in a CSG cell the CSG ID of which is not valid for the MS and the detach procedure is not due to "switch off", the network shall proceed as follows:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the detach type is "IMSI detach" and the MS has a PDN connection for emergency bearer services active, the SGSN shall send a DETACH ACCEPT message and deactivate all non-emergency PDP contexts, if any, by initiating a PDP context deactivation procedure;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; otherwise, the network shall initiate the detach procedure. The network shall send a DETACH REQUEST message including the GMM cause value #25 "not authorized for this CSG".</p>
<h4><a name="_Toc171524014"></a>4.7.4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Network initiated GPRS detach procedure</h4>
<h5><a name="_Toc171524015"></a>4.7.4.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Network initiated GPRS detach procedure initiation</h5>
<p>The network initiates the GPRS detach procedure by sending a DETACH REQUEST message to the MS. The DETACH REQUEST message shall include a detach type IE. In addition, the network may include a cause IE to specify the reason for the detach request. The network shall start timer T3322. If the detach type IE indicates "re-attach required", or "re-attach not required" and the cause code is not #2 "IMSI unknown in HLR", the network shall deactivate the PDP contexts, the MBMS contexts and deactivate the logical link(s), if any, and shall change to state GMM-DEREGISTERED-INITIATED.</p>
<h5><a name="_Toc171524016"></a>4.7.4.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Network initiated GPRS detach procedure completion by the MS</h5>
<p>When receiving the DETACH REQUEST message and the detach type indicates "re-attach required", the MS shall deactivate the PDP context(s), the MBMS context(s) and deactivate the logical link(s), if any. The MS shall stop the timer T3346, if it is running. The MS shall also stop timer(s) T3396, if it is running. The MS shall send a DETACH ACCEPT message to the network and shall enter the state GMM-DEREGISTERED. The MS shall, after the completion of the GPRS detach procedure, initiate a GPRS attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).</p>
<p>NOTE&nbsp;1:&nbsp; When the detach type indicates "re-attach required", user interaction is necessary in some cases when the MS cannot re-activate the PDP/MBMS context(s) automatically.</p>
<p>A GPRS MS operating in MS operation mode A or B in network operation mode I, which receives an DETACH REQUEST message with detach type indicating "re-attach required" or "re-attach not required" and no cause code, is only detached for GPRS services in the network.</p>
<p>When receiving the DETACH REQUEST message and the detach type IE indicates "IMSI detach", the MS shall not deactivate the PDP/MBMS contexts. The MS shall set the MM update status to U2 NOT UPDATED. An MS in operation mode A or B in network operation mode I may send a DETACH ACCEPT message to the network, and shall re-attach to non-GPRS service by performing the combined routing area updating procedure according to subclause&nbsp;4.7.5.2, sending a ROUTING AREA UPDATE REQUEST message with Update type IE indicating "combined RA/LA updating with IMSI attach". An MS in operation mode A that is in an ongoing circuit-switched transaction shall initiate the combined routing area updating after the circuit-switched transaction has been released. An MS in operation mode C, or in MS operation mode A or B in network operation mode II, shall send a DETACH ACCEPT message to the network.</p>
<p>If the detach type IE indicates "IMSI detach", or "re-attach required" then the MS shall ignore the cause code if received.</p>
<p>If the MS is attached for GPRS and non-GPRS services and the network operates in network operation mode I, then if in the MS the timer T3212 is not already running, the timer T3212 shall be set to its initial value and restarted if:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the detach type IE indicates "re-attach required"; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the detach type IE indicates "re-attach not required" and no cause code is included.</p>
<p>When receiving the DETACH REQUEST message and the detach type IE indicates "re-attach not required" and no cause code, or "re-attach not required" and the cause code is not #2 "IMSI unknown in HLR", the MS shall deactivate the PDP contexts, the MBMS contexts and deactivate the logical link(s), if any. The MS shall then send a DETACH ACCEPT message to the network and shall change state to GMM-DEREGISTERED.</p>
<p>If the detach type IE indicates "re-attach not required" and no cause code is included,&nbsp;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall set the GPRS update status to GU2 NOT UPDATED, delete the GMM parameters P-TMSI, P-TMSI signature, RAI, and GPRS ciphering key sequence number, and start timer T3302. If the MS is operating in MS operation mode C, it may enter the state GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[6]; otherwise the MS shall enter the state GMM-DEREGISTERED.ATTEMPTING-TO-ATTACH; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI, as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when a DETACH REQUEST is received with the no EMM cause included and with detach type set to "re-attach not required".</p>
<p>If the detach type IE indicates "re-attach not required" and a cause code is included, then, depending on the received cause code, the MS shall act as follows:</p>
<p># 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (IMSI unknown in HLR);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE. The SIM/USIM shall be considered as invalid for non-GPRS services until switching off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B in network operation mode I, is still IMSI attached for GPRS services in the network.</p>
<p># 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Illegal MS);</p>
<p># 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Illegal ME);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The MS shall delete the list of equivalent PLMNs. The new GMM state is GMM-DEREGISTERED.NO-IMSI. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required".</p>
<p>NOTE&nbsp;2:&nbsp; The possibility to configure an MS so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the MS, is out of scope of the present specification.</p>
<p># 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GPRS services not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new state is GMM-DEREGISTERED. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services is still IMSI attached for CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B in network operation mode I shall then proceed with the appropriate MM specific procedure.</p>
<p>NOTE&nbsp;3:&nbsp; Optionally the MS starts the timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required".</p>
<p># 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GPRS services and non-GPRS services not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The MS shall delete the list of equivalent PLMNs. The new GMM state is GMM-DEREGISTERED.NO-IMSI.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>NOTE&nbsp;4:&nbsp; Optionally the MS starts the timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required".</p>
<p># 11&nbsp;&nbsp;&nbsp; (PLMN not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall delete any RAI or LAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall reset the GPRS attach attempt counter. The MS shall delete the list of equivalent PLMNs. The new GMM state is GMM-DEREGISTERED.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the PLMN identity in the "forbidden PLMN list" and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a PLMN-specific attempt counter for that PLMN, then the MS shall set this counter to the MS implementation-specific maximum value.</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required".</p>
<p># 12&nbsp;&nbsp;&nbsp; (Location area not allowed);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>The MS shall store the LAI in the list of "forbidden location areas for regional provision of service".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a cell selection according to 3GPP TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>NOTE&nbsp;5:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required".</p>
<p># 13&nbsp;&nbsp;&nbsp; (Roaming not allowed in this location area);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The MS shall delete the list of equivalent PLMNs. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE or optionally to GMM-DEREGISTERED.PLMN-SEARCH.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a PLMN selection according to 3GPP TS&nbsp;23.122 [14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP TS&nbsp;44.318 [76b]) prior to perform a PLMN selection from this list according to 3GPP TS&nbsp;23.122 [14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required".</p>
<p># 14&nbsp;&nbsp;&nbsp; (GPRS services not allowed in this PLMN);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2), shall reset the GPRS attach attempt counter and shall change to state GMM-DEREGISTERED.</p>
<p>The MS shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a PLMN-specific PS-attempt counter for that PLMN, then the MS shall set this counter to the MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode C shall delete the list of equivalent PLMNs and perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services is still IMSI attached for CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B in network operation mode I shall then proceed with the appropriate MM specific procedure.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required".</p>
<p># 15&nbsp;&nbsp;&nbsp; (No Suitable Cells In Location Area);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED(and shall store it according to clause 4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>The MS shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall search for a suitable cell in another location area or a tracking area according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121].</p>
<p>NOTE&nbsp;6:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 25 (Not authorized for this CSG)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and store it according to subclause&nbsp;4.1.3.2) and shall reset the GPRS attach attempt counter. The state is changed to GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the cell where the MS has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list stored in the MS, the MS shall remove the CSG ID and associated PLMN identity from the Allowed CSG list.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the cell where the MS has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14] subclause&nbsp;3.1A.</p>
<p>The MS shall start timer&nbsp;T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If the MS is IMSI attached for non-GPRS services, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall search for a suitable cell according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status, GUTI, last visited registered TAI, TAI list, KSI and attach attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to "re-attach not required".</p>
<p>NOTE&nbsp;7:&nbsp; CSG is applicable only for UMTS.</p>
<p>Other cause values shall not impact the update status. Further actions of the MS are implementation dependent.</p>
<h5><a name="_Toc171524017"></a>4.7.4.2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Network initiated GPRS detach procedure completion by the network</h5>
<p>The network shall, upon receipt of the DETACH ACCEPT message, stop timer T3322. If the detach type IE included in the DETACH REQUEST message indicates "IMSI detach", or "re-attach not required" and the cause code is #2 "IMSI unknown in HLR", the network shall not change the current GMM state; otherwise the network shall change state to GMM-DEREGISTERED.</p>
<h5><a name="_Toc171524018"></a>4.7.4.2.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the network side</h5>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) T3322 time-out</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; On the first expiry of the timer, the network shall retransmit the DETACH REQUEST message and shall start timer T3322. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3322, the GPRS detach procedure shall be aborted. If the detach type indicates "IMSI detach", or "re-attach not required" and the cause code is #2 "IMSI unknown in HLR", the network shall not change the current GMM state; otherwise the network shall change state to GMM-DEREGISTERED.</p>
<ol>
<li>b) Low layer failure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The GPRS detach procedure is aborted. If the detach type indicates "IMSI detach", or "re-attach not required" and the cause code is #2 "IMSI unknown in HLR", the network shall not change the current GMM state; otherwise the network shall change state to GMM-DEREGISTERED.</p>
<ol>
<li>c) GPRS detach procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a DETACH REQUEST message with "switching off" indicated, before the network initiated GPRS detach procedure has been completed, both procedures shall be considered completed.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a DETACH REQUEST message without "switching off" indicated, before the network initiated GPRS detach procedure has been completed, the network shall send a DETACH ACCEPT message to the MS.</p>
<ol>
<li>d) GPRS detach and GPRS attach procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives an ATTACH REQUEST message before the network initiated GPRS detach procedure with type of detach 're-attach not required' has been completed, the network shall ignore the ATTACH REQUEST message. If the detach type IE value, sent in the DETACH REQUEST message, indicates "re-attach required" the detach procedure is aborted and the GPRS attach procedure shall be progressed after the PDP contexts and MBMS contexts, if any, have been deleted. If the detach type IE value, sent in the DETACH REQUEST message, indicates "IMSI detach" the detach procedure is aborted and the GPRS attach procedure shall be progressed.</p>
<ol>
<li>e) GPRS detach and routing area updating procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing detach type "re-attach required" or "re-attach not required":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a ROUTING AREA UPDATE REQUEST message before the network initiated GPRS detach procedure has been completed, the detach procedure shall be progressed, i.e. the ROUTING AREA UPDATE REQUEST message shall be ignored. If the DETACH REQUEST message contains detach type "re-attach not required" and GMM cause #2 "IMSI unknown in HLR", the network will follow the procedure as described below for the detach type "IMSI detach".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing detach type "IMSI detach":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a ROUTING AREA UPDATE REQUEST message before the network initiated GPRS detach procedure has been completed, the network shall abort the detach procedure, shall stop T3322 and shall progress the routing area update procedure.</p>
<ol>
<li>f) GPRS detach and service request procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing detach type "re-attach required" or "re-attach not required":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a SERVICE REQUEST message before the network initiated GPRS detach procedure has been completed, the network shall progress the detach procedure. If the GPRS Detach Request message contains detach type "re-attach not required" and GMM cause #2 "IMSI unknown in HLR", the network will follow the procedure as described below for the detach type "IMSI detach".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing detach type "IMSI detach":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a SERVICE REQUEST message before the network initiated GPRS detach procedure has been completed, the network shall progress both procedures.</p>
<p>Figure 4.7.4/2 3GPP TS 24.008: Network initiated GPRS detach procedure</p>
<h3><a name="_Toc171524019"></a>4.7.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Routing area updating procedure</h3>
<p>This procedure is used for:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; normal routing area updating to update the registration of the actual routing area of an MS in the network. This procedure is used by GPRS MSs in MS operation mode C and by GPRS MSs in MS operation modes A or B that are IMSI attached for GPRS and non-GPRS services if the network operates in network operation mode II;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; combined routing area updating to update the registration of the actual routing and location area of an MS in the network. This procedure is used by GPRS MSs in MS operation modes A or B that are IMSI attached for GPRS and non-GPRS services provided that the network operates in network operation mode I;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; periodic routing area updating. This procedure is used by GPRS MSs in MS operation mode C and by GPRS MSs in MS operation modes A or B that are IMSI attached for GPRS or for GPRS and non-GPRS services independent of the network operation mode;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; IMSI attach for non-GPRS services when the MS is IMSI attached for GPRS services. This procedure is used by GPRS MSs in MS operation modes A or B, if the network operates in network operation mode I;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, resuming GPRS services when the RR sublayer indicated a resumption failure after dedicated mode was left, see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84];</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, updating the network with the new MS Radio Access Capability IE when the content of the IE has changed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; updating the network with the new DRX parameter IE when the content of the IE has changed;</p>
<p>NOTE 1:&nbsp; Such changes can be used e.g. when the MS activates a PDP context with service requirements that cannot be met with the current DRX parameter. As PDP context(s) are activated and deactivated, the GMM context will be updated with an appropriate DRX parameter;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; re-negotiation of the READY timer value;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Iu mode to A/Gb mode and for A/Gb mode to Iu mode intersystem change, see subclause&nbsp;4.7.1.7;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, re-synchronizing the PMM mode of MS and network after RRC connection release with cause "Directed signalling connection re-establishment", see subclause&nbsp;4.7.2.5;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode and A/Gb mode after intersystem change from S1 mode, and the GMM receives an indication of "RRC connection failure" from lower layers due to lower layer failure while in S1 mode;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; S1 mode to Iu mode or S1 mode to A/Gb mode intersystem change and ISR is not activated;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; S1 mode to Iu mode or S1 mode to A/Gb mode intersystem change and ISR is activated, but the MS changes to a routeing area it has not previously registered with the network;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; indicating to the network that due to a manual CSG selection the MS has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the MS's Allowed CSG list or in the MS's Operator CSG list;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; indicating to the network that the mobile station classmark 2, mobile station classmark 3 or the supported codecs have changed for a MS supporting SRVCC; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; indicating the current radio access technology to the network for the support of terminating access domain selection for voice calls or voice sessions (for details see subclause&nbsp;4.7.5.1 and subclause&nbsp;4.7.5.2.1).</p>
<p>While an MS has a PDN connection for emergency bearer services, the MS shall not perform manual CSG selection.</p>
<p>The routing area updating procedure shall also be used by a MS which is attached for GPRS services if a new PLMN is entered (see 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14]), unless the MS is configured for "AttachWithIMSI" as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112] and the new PLMN is neither the registered PLMN nor in the list of equivalent PLMNs.</p>
<p>An eCall only mobile station that is not capable of eCall over IMS shall not perform a normal or combined routing area updating procedure.</p>
<p>Subclause&nbsp;4.7.5.1 describes the routing area updating procedures for updating the routing area only. The combined routing area updating procedure used to update both the routing and location area is described in subclause&nbsp;4.7.5.2.</p>
<p>The routing area updating procedure is always initiated by the MS. It is only invoked in state GMM-REGISTERED.</p>
<p>To limit the number of consecutive rejected routing area update attempts, a routing area updating attempt counter is introduced. The routing area updating attempt counter shall be incremented as specified in subclause&nbsp;4.7.5.1.5. Depending on the value of the routing area updating attempt counter, specific actions shall be performed. The routing area updating attempt counter shall be reset when:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS attach or combined GPRS attach procedure is successfully completed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a normal or periodic routing area updating or combined routing area updating procedure is successfully completed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a combined GPRS attach procedure or a combined routing area updating procedure is completed for GPRS services only with cause #2 or #28;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a normal or periodic routing area updating or combined routing updating procedure is rejected with cause #11, #12, #13, #14, #15 or #25;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a new PLMN is selected.</p>
<p>and additionally when the MS is in substate ATTEMPTING-TO-UPDATE:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a new routing area is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; expiry of timer T3302;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; at request from registration function; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; timer T3346 is started.</p>
<p>The mobile equipment shall contain a list of "forbidden location areas for roaming", as well as a list of "forbidden location areas for regional provision of service". The handling of these lists is described in subclause&nbsp;4.4.1.</p>
<p>In a shared network, the MS shall choose one of the PLMN identities as specified in 3GPP TS 23.122 [14]. The MS shall construct the Routing Area Identification of the cell from this chosen PLMN identity, and the LAC and the RAC received on the BCCH. If the constructed RAI is different from the stored RAI, the MS shall initiate the routing area updating procedure. For:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a shared GERAN, in A/Gb mode, the chosen PLMN identity is indicated to the GERAN in the first RLC data block of an upper layer PDU (see 3GPP&nbsp;TS&nbsp;44.060&nbsp;[76]) when a foreign TLLI is used by the network sharing supporting MS for the transmission.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a shared UTRAN, the chosen PLMN identity shall be indicated to the UTRAN in the RRC INITIAL DIRECT TRANSFER message (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<p>For GERAN Iu mode, network sharing is not supported.</p>
<p>Whenever a ROUTING AREA UPDATE REJECT message with the cause "PLMN not allowed" is received by the MS, the chosen PLMN identity shall be stored in the "forbidden PLMN list" and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. Whenever a ROUTING AREA UPDATE REJECT message is received by the MS with the cause "Roaming not allowed in this location area", "Location Area not allowed", or "No suitable cells in Location Area", the LAI that is part of the constructed RAI which triggered the routing area updating procedure shall be stored in the suitable list.</p>
<p>In A/Gb mode, user data transmission in the MS shall be suspended during the routing area updating procedure, except if the routing area updating procedure is triggered by a PS handover procedure as described in 3GPP&nbsp;TS&nbsp;43.129&nbsp;[113]; user data reception shall be possible. User data transmission in the network may be suspended during the routing area updating procedure.</p>
<p>In Iu mode, user data transmission and reception in the MS shall not be suspended during the routing area updating procedure. User data transmission in the network shall not be suspended during the routing area updating procedure.</p>
<p>In Iu mode, when a ROUTING AREA UPDATE REQUEST is received by the SGSN over a new PS signalling connection while there is an ongoing PS signalling connection (network is already in mode PMM-CONNECTED) for this MS, the network shall progress the routing area updating procedure as normal and release the previous PS signalling connection when the routing area updating procedure has been accepted by the network.</p>
<p>NOTE&nbsp;2:&nbsp; The re-establishment of the radio bearers of active PDP contexts is done as described in subclause "Service Request procedure".</p>
<p>The network informs the MS about the support of specific features, such as LCS-MOLR, MBMS, IMS voice over PS session, emergency bearer services in Iu mode in the Network feature support information element. The information is either explicitly given by sending the Network feature support IE or implicitly by not sending it. The handling in the network is described in subclause&nbsp;9.4.15.11The network can also use the Additional network feature support IE in order to inform the MS about the support of specific features such as the delivery of SMS via GPRS (GPRS-SMS) or implicitly by not sending it. The MS may use the support indications for LCS-MOLR, MBMS and GPRS-SMS to inform the user about the availability of the appropriate services. The MS shall not request the LCS-MOLR or MBMSservices, if the service has not been indicated as available. The indication for MBMS is defined in subclause "MBMS feature support indication" in 3GPP&nbsp;TS&nbsp;23.246&nbsp;[106]. In an MS with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP&nbsp;TS&nbsp;23.221&nbsp;[131], subclause&nbsp;7.2a and subclause&nbsp;7.2b, when selecting the access domain for voice sessions or calls in Iu mode. When initiating an emergency call in Iu mode, the upper layers also take the emergency bearer services indicator into account for the access domain selection. The MS may use the GPRS-SMS indication in order to obtain SMS.</p>
<h4><a name="_Toc171524020"></a>4.7.5.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Normal and periodic routing area updating procedure</h4>
<p>Periodic routing area updating is used to periodically notify the availability of the MS to the network. The value of the update type IE in the ROUTING AREA UPDATE REQUEST message shall indicate "periodic updating". The procedure is controlled in the MS by timer T3312. When timer T3312 expires, the periodic routing area updating procedure is started. Start and reset of timer T3312 is described in subclause&nbsp;4.7.2.2.</p>
<p>The normal routing area updating procedure is initiated:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS detects a change of the routing area in state GMM-REGISTERED;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS determines that GPRS resumption shall be performed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS needs to update the network with the new MS Radio Access Capability IE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS needs to update the network with the new DRX parameter IE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, to re-synchronize the PMM mode of MS and network after RRC connection release with cause "Directed signalling connection re-establishment", see subclause&nbsp;4.7.2.5;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, to re-synchronize the PMM mode of MS and network after inter-system change not due to PS handover from PMM-CONNECTED mode in Iu mode to A/Gb mode or S1 mode, if the MS performs an inter - system change back to Iu mode without sending a ROUTING AREA UPDATE REQUEST message while in A/Gb mode or a TRACKING AREA UPDATE REQUEST message while in S1 mode;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode and A/Gb mode, after intersystem change from S1 mode, and the GMM receives an indication of "RRC connection failure" from lower layers due to lower layer failure while in S1 mode. In this case, if the TIN indicates "RAT-related TMSI", the MS shall set the TIN to "GUTI" before initiating the routing area updating procedure;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, after intersystem change from S1 mode if the TIN indicates "RAT-related TMSI", but the MS is required to perform routing area updating for IMS voice termination as specified in annex P.4;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS enters GMM-REGISTERED.NORMAL-SERVICE and the TIN indicates "GUTI";</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the Allowed CSG list;or in the Operator CSG list;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS supports SRVCC and changes the mobile station classmark 2, mobile station classmark 3 or the supported codecs;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS changes the MS network capability information;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the UE's usage setting or the voice domain preference for E-UTRAN change in the MS;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS activates mobility management for IMS voice termination as specified in annex&nbsp;P.2 and the TIN indicates "RAT-related TMSI";</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; upon reception of a paging indication, using P-TMSI, if the timer T3346 is running and the MS is in state GMM-REGISTERED.ATTEMPTING-TO-UPDATE and the RAI of the current cell is same as the stored RAI;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, after intersystem change from S1 mode via cell change order procedure not due to CS fallback, if the TIN indicates "RAT-related TMSI"; in this case the MS shall set the TIN to "GUTI" before initiating the routing area updating procedure;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb or Iu mode in NMO I, after intersystem change from S1 mode due to CS fallback, if the TIN indicates "GUTI" or if the routing area the MS is in is different from the registered routing area;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, after Inter RAT handover from S1 mode or Iu mode;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS needs to request the use of PSM or needs to stop the use of PSM;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS needs to request the use of eDRX or needs to stop the use of eDRX;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when a change in the PSM usage conditions at the MS requires a different timer T3312 value or different timer T3324 value;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when a change in the eDRX usage conditions at the MS requires different extended DRX parameters; or</p>
<p>NOTE&nbsp;1:&nbsp; A change in the PSM or eDRX usage conditions at the MS can include e.g. a change in the MS configuration, a change in requirements from upper layers or the battery running low at the MS.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the Default_DCN_ID value changes, as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or in USIM file NAS<sub>CONFIG</sub> as specified in 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112].</p>
<p>NOTE&nbsp;2:&nbsp; The routing area updating procedure is initiated after deleting the DCN-ID list as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120], annex&nbsp;C.</p>
<p>The ROUTING AREA UPDATE REQUEST message shall always be the first data sent by the MS when a routing area border is crossed. The routing area identification is broadcast on the broadcast channel(s).</p>
<p>A normal routing area updating shall abort any ongoing GMM procedure. Aborted GMM procedures may be repeated after the normal routing area updating procedure has been successfully performed. The value of the update type IE included in the message shall indicate "RA updating".</p>
<p>If the normal routing area updating procedure is initiated due to the reception of the paging indication while timer T3346 is running, the "follow-on request pending" indication shall be set to 1.</p>
<h5><a name="_Toc171524021"></a>4.7.5.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Normal and periodic routing area updating procedure initiation</h5>
<p>To initiate the normal routing area updating procedure, the MS sends the message ROUTING AREA UPDATE REQUEST to the network, starts timer T3330 and changes to state GMM-ROUTING-AREA-UPDATING-INITIATED. If timer T3302 is currently running, the MS shall stop timer T3302. If timer T3311 is currently running, the MS shall stop timer T3311.</p>
<p>If the MS supports S1 mode, the MS shall handle the P-TMSI IE as follows:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the TIN indicates "GUTI" and the MS holds a valid GUTI allocated by an MME, the MS shall map the GUTI into a P-TMSI, P‑TMSI signature and RAI as specified in 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10]. The MS shall include the mapped RAI in the Old routing area identification IE and the mapped P-TMSI signature in the P-TMSI signature IE. In addition, the MS shall include the P-TMSI type IE with P-TMSI type set to "mapped P-TMSI". When the routing area updating procedure is initiated in Iu mode, the MS shall also include the mapped P-TMSI in the P‑TMSI IE. Additionally, in Iu mode and A/Gb mode, if the MS holds a valid P-TMSI and RAI, the MS shall indicate the P-TMSI in the Additional mobile identity IE and the RAI in the Additional old routing area identification IE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the TIN indicates "P-TMSI" or "RAT‑related TMSI" and the MS holds a valid P-TMSI and RAI, the MS shall indicate the RAI in the Old routing area identification IE. In addition, the MS shall include the P-TMSI type IE with P-TMSI type set to "native P-TMSI". When the routing area updating procedure is initiated in Iu mode, the MS shall also include the P-TMSI in the P‑TMSI IE.</p>
<p>If the MS does not support S1 mode, the MS shall include the P-TMSI type IE with P-TMSI type set to "native P-TMSI".</p>
<p>If the MS supports PSM and requests the use of PSM, the MS shall include the T3324 value IE with a requested timer value in the ROUTING AREA UPDATE REQUEST message. When the MS includes the T3324 value IE and the MS indicates support for extended periodic timer value in the MS network feature support IE, it may also include the T3312 extended value IE to request a particular T3312 value to be allocated.</p>
<p>If the routing area updating procedure is not initiated by the MS due to an S1 mode to Iu mode or S1 mode to A/Gb mode intersystem change, or if it is initiated due to such an intersystem change and the TIN indicates "RAT‑related TMSI", the MS shall use the existing UMTS security context for the PS domain. The ROUTING AREA UPDATE REQUEST message shall contain the P-TMSI signature when received in a previous ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT message. If the MS has a valid UMTS security context, the MS shall indicate it in the GPRS ciphering key sequence number IE.</p>
<p>If the routing area updating procedure is initiated by the MS due to an S1 mode to Iu mode or S1 mode to A/Gb mode inter-system change in idle mode, or if it is initiated by the MS due to PS&nbsp; to CS domain change from S1 mode due to SRVCC or vSRVCC handover, and the TIN indicates "GUTI", the MS shall derive a UMTS security context for the PS domain from the current EPS security context as described in the subclause&nbsp;4.7.7.10. The ROUTING AREA UPDATE REQUEST message shall include a P-TMSI signature filled with a NAS token as specified in 3GPP&nbsp;TS&nbsp;33.401&nbsp;[123]. Furthermore, the MS shall indicate the eKSI value, which is associated with the derived UMTS security keys, in the CKSN field of the GPRS GSM ciphering key sequence number IE in the ROUTING AREA UPDATE REQUEST message.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; When the MS includes a P-TMSI signature filled with a NAS token, 8 bits of the NAS token will be filled with bits from the M‑TMSI (see 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10]).</p>
<p>If the routing area updating procedure is initiated by the MS due to the S1 mode to Iu mode or S1 mode to A/Gb mode inter-system change in connected mode, the MS shall derive a UMTS security context for the PS domain from the current EPS security context as described in the subclause&nbsp;4.7.7.10. Furthermore, the MS shall indicate the eKSI value, which is associated with the derived UMTS security keys, in the CKSN field of the GPRS GSM ciphering key sequence number IE in the ROUTING AREA UPDATE REQUEST message.</p>
<p>In Iu mode, if the MS wishes to prolong the established PS signalling connection after the normal routing area updating procedure (for example, the MS has any CM application request pending), it may set a follow-on request pending indicator on (see subclause&nbsp;4.7.13).</p>
<p>In order to indicate the new DRX parameter while in GERAN or UTRAN coverage, the MS shall send the ROUTING AREA UPDATE REQUEST message containing the DRX parameter in the DRX parameter IE to the network, with the exception of the case if the MS had indicated its MS specific DRX parameter (3GPP&nbsp;TS&nbsp;24.301&nbsp;[120]) to the network while in E-UTRAN coverage. In this case, when the MS enters GERAN or UTRAN coverage and initiates a routing area updating procedure, the MS shall not include the DRX parameter in the DRX parameter IE in the ROUTING AREA UPDATE REQUEST message.</p>
<p>If the MS supports eDRX and &nbsp;requests the use of eDRX, the MS shall include the extended DRX parameters IE in the ROUTING AREA UPDATE REQUEST message.</p>
<p>In A/Gb mode, if the MS supports the restriction on use of enhanced coverage, then the MS shall set the Restriction on use of enhanced coverage capability bit to "Mobile station supports restriction on use of enhanced coverage" in the MS network capability IE of the ROUTING AREA UPDATE REQUEST message</p>
<p>If the MS supports dual connectivity of E-UTRA with NR, then the MS shall set the Dual connectivity of E-UTRA with NR capability bit to "Mobile station supports dual connectivity of E-UTRA with NR" in the MS network capability IE of the ROUTING AREA UPDATE REQUEST message.</p>
<p>In A/Gb mode, if a UMTS security context is available and if the MS indicates support of integrity protection in the MS network capability IE included in the ROUTING AREA UPDATE REQUEST message, then the MS shall use the current GPRS GSM Kint key and the current GPRS GSM integrity algorithm to integrity protect the ROUTING AREA UPDATE REQUEST message in the LLC layer. If LLC layer has not yet been configured, then the GMM layer in the MS shall assign the GPRS GSM Kint key, the GPRS GSM Kc<sub>128</sub> key, the GPRS GSM integrity algorithm and the GPRS GSM ciphering algorithm to the LLC layer, and indicates to the LLC layer that it shall start integrity protection. This shall be done so that the LLC layer can integrity protect, but not cipher, the ROUTING AREA UPDATE REQUEST message. The MS shall include the CKSN in the CKSN IE in the ROUTING AREA UPDATE REQUEST message. If the MS has no UMTS security context available, then the MS shall not integrity protect the ROUTING AREA UPDATE REQUEST message in the LLC layer. The MS shall in this case set the CKSN IE to the value "no key is available" and send the ROUTING AREA UPDATE REQUEST message unprotected.</p>
<h5><a name="_Toc171524022"></a>4.7.5.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM Common procedure initiation</h5>
<p>If the network receives a ROUTING AREA UPDATE REQUEST message containing the P-TMSI type IE, and the network does not follow the use of the most significant bit of the &lt;LAC&gt; to distinguish the node type as specified in 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10] subclause&nbsp;2.8.2.2.2, the network shall use the P-TMSI type IE to determine whether the mobile identity included in the P-TMSI IE, if any, or the mobile identity used by the MS to derive a foreign TLLI (see subclause&nbsp;4.7.1.4.1) is a native P‑TMSI or a mapped P‑TMSI.</p>
<p>The network may initiate GMM common procedures, e.g. the GMM authentication and ciphering procedure.</p>
<h5><a name="_Toc171524023"></a>4.7.5.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Normal and periodic routing area updating procedure accepted by the network</h5>
<p>If the routing area updating request has been accepted by the network, a ROUTING AREA UPDATE ACCEPT message shall be sent to the MS. The network may assign a new P-TMSI and/or a new P-TMSI signature for the MS. If a new P-TMSI and/or P-TMSI signature have been assigned to the MS, it/they shall be included in the ROUTING AREA UPDATE ACCEPT message together with the routing area identification.</p>
<p>In a shared network, if the MS is a network sharing supporting MS, the network shall indicate the PLMN identity of the CN operator that has accepted the routing area updating request in the RAI contained in the ROUTING AREA UPDATE ACCEPT message; if the MS is a network sharing non-supporting MS, the network shall indicate the PLMN identity of the common PLMN (see 3GPP&nbsp;TS&nbsp;23.251&nbsp;[109]). If the PLMN identity of the common PLMN included in the RAI does not identify the CN operator that has accepted the routing area updating request, the network may include the PLMN identity of the CN operator that has accepted the routing area updating request in the ROUTING AREA UPDATE ACCEPT message.</p>
<p>In a multi-operator core network (MOCN) with common GERAN, the network shall indicate in the RAI the common PLMN identity (see 3GPP&nbsp;TS&nbsp;23.251&nbsp;[109]). If the common PLMN identity included in the RAI does not identify the CN operator that has accepted the routing area updating request, the network may include the PLMN identity of the CN operator that has accepted the routing area updating request in the ROUTING AREA UPDATE ACCEPT message.</p>
<p>In A/Gb mode, if the MS indicates support of integrity protection in the MS network capability IE in the ROUTING AREA UPDATE REQUEST message, and if the network supports integrity protection, then the network shall store all octets received from the MS in the MS network capability IE and in the MS Radio Access Capability IE, up to the maximum length defined for the respective information element.</p>
<p>NOTE&nbsp;1:&nbsp; The network needs to store the MS network capability and MS Radio Access Capability exactly as received from the MS and network is not allowed to ignore the "higher" octets sent by the MS even if the network does not support any features indicated in the higher octetst. Otherwise the replay check of the MS network capability and MS Radio Access Capability will fail in the MS.</p>
<p>In A/Gb mode, if a UMTS security context is available in the network and if the MS indicates support of integrity protection in the ROUTING AREA UPDATE REQUEST message and the network supports integrity protection, and if integrity protection of the ROUTING AREA UPDATE REQUEST message is successfully verified in the LLC layer in the network, then if the network decides to re-authenticate the MS or select a new integrity algorithm or ciphering algorithm, the network shall initiate an authentication and ciphering procedure.</p>
<p>In A/Gb mode, if a UMTS security context is available in the network and if the MS indicates support of integrity protection in the ROUTING AREA UPDATE REQUEST message and the network supports integrity protection if integrity protection of the ROUTING AREA UPDATE REQUEST message is successfully verified in the LLC layer in the network, the network may decide to continue using the stored GPRS GSM Kint integrity key, GPRS GSM Kc<sub>128</sub> encryption key, GPRS GSM ciphering algorithm and GPRS GSM integrity algorithm in the LLC layer without initiating an authentication and ciphering procedure. If the MS and network continue to use the same ciphering mode, ciphering or no ciphering, the ciphering mode is re-established without the need to run an authentication and ciphering procedure. The network shall replay the MS network capability IE and the MS radio access capability IE received from the MS in the ROUTING AREA UPDATE REQUEST message, by including the MS network capability IE and the MS radio access capability IE in the ROUTING AREA UPDATE ACCEPT message to the MS. The GMM layer in the network shall assign the stored GPRS GSM Kint key, the GPRS GSM Kc<sub>128</sub> key, the GPRS GSM integrity algorithm and the GPRS GSM ciphering algorithm to the LLC layer. The MS shall then indicate to the LLC layer that it shall start integrity protection and ciphering in the LLC layer before sending the ROUTING AREA UPDATE ACCEPT message to the MS. If the integrity protection of the ROUTING AREA UPDATE REQUEST message is not successfully verified in the LLC layer or if the ROUTING AREA UPDATE REQUEST message is received without integrity protection, then the network shall progress the routing area updating procedure and initiate an authentication and ciphering procedure to authenticate the MS and activate integrity protection and ciphering in the MS.</p>
<p>In A/Gb mode, if a UMTS security context is available in the network and if the MS indicates support of integrity protection in the ROUTING AREA UPDATE REQUEST message and the network supports integrity protection, and if the network is not able to verify the message authentication code in the LLC layer protecting the ROUTING AREA UPDATE REQUEST message, due to the LLC layer at the network not having been configured yet with the integrity key and integrity algorithm for this MS, then the network shall progress the ROUTING AREA UPDATE REQUEST message at GMM layer anyway. If the CKSN included in the ROUTING AREA UPDATE REQUEST message belongs to an UMTS security context available in the network, then the network may re-establish integrity protection and ciphering of layer 3 signalling messages in the LLC layer without initiating an authentication and ciphering procedure.</p>
<p>In A/Gb mode, if the MS indicates support of integrity protection of user plane data in the MS network capability IE in the ROUTING AREA UPDATE REQUEST message, and if the network supports and accepts integrity protection of user plane data, then the network shall indicate integrity protection of user plane data to the MS in the ROUTING AREA UPDATE ACCEPT message. The MS shall indicate to the LLC layer to start integrity protection of user plane data after the reception of the ROUTING AREA UPDATE ACCEPT message, if indicated. The same GPRS GSM Kint key and the same GPRS GSM integrity algorithm used for integrity protection of layer 3 signalling messages shall be used for integrity protection of user plane data in the LLC layer. The network shall indicate to the LLC layer to start integrity protection of user plane data after sending the ROUTING AREA UPDATE ACCEPT message to the MS. If the network does not indicate to the MS in the ROUTING AREA UPDATE ACCEPT message that it accepts the use of integrity protection of user plane data, and if the MS does not accept such a network, then the MS shall detach from the network.</p>
<p>If a new DRX parameter was included in the ROUTING AREA UPDATE REQUEST message, the network shall store the new DRX parameter and use it for the downlink transfer of signalling and user data.</p>
<p>The network shall include the extended DRX parameters IE in the ROUTING AREA UPDATE ACCEPT message only if the extended DRX parameters IE was included in the ROUTING AREA UPDATE REQUEST message, and the network supports and accepts the use of eDRX.</p>
<p>If the MS has indicated in the ROUTING AREA UPDATE REQUEST message that it supports PS inter-RAT handover from GERAN to UTRAN Iu mode, the network may include in the ROUTING AREA UPDATE ACCEPT message a request to provide the Inter RAT information container.</p>
<p>If the MS has included the MS network capability IE or the UE network capability IE or both in the ROUTING AREA UPDATE REQUEST message, the network shall store all octets received from the MS, up to the maximum length defined for the respective information element. In case the UE network capability IE indicated new information to the network, the MS shall set the TIN to "P-TMSI".</p>
<p>NOTE&nbsp;2:&nbsp; This information is forwarded to the new SGSN during inter-SGSN handover or to the new MME during intersystem handover to S1&nbsp;mode.</p>
<p>In A/Gb mode the Cell Notification information element shall be included in the ROUTING AREA UPDATE ACCEPT message in order to indicate the ability of the network to support the Cell Notification.</p>
<p>The network shall change to state GMM-COMMON-PROCEDURE-INITIATED and shall start the supervision timer T3350 as described in subclause&nbsp;4.7.6.</p>
<p>If the LAI or PLMN identity contained in the ROUTING AREA UPDATE ACCEPT message is a member of any of the "forbidden" lists and the MS is not attached for emergency bearer services, then any such entry shall be deleted.</p>
<p>In Iu mode, the network should prolong the PS signalling connection if the mobile station has indicated a follow-on request pending in ROUTING AREA UPDATE REQUEST. The network may also prolong the PS signalling connection without any indication from the mobile terminal (for example, if user plane radio access bearers have been established for the MS).</p>
<p>If the PDP context status information element is included in ROUTING AREA UPDATE REQUEST message, then the network shall deactivate all those PDP contexts locally (without peer to peer signalling between the MS and the network), which are not in SM state PDP-INACTIVE on network side but are indicated by the MS as being in state PDP-INACTIVE.</p>
<p>If the MBMS context status information element is included in the ROUTING AREA UPDATE REQUEST message, then the network shall deactivate all those MBMS contexts locally (without peer to peer signalling between the MS and network) which are not in SM state PDP-INACTIVE on the network side, but are indicated by the MS as being in state PDP-INACTIVE. If no MBMS context status information element is included, then the network shall deactivate all MBMS contexts locally which are not in SM state PDP-INACTIVE on the network side.</p>
<p>If a ROUTING AREA UPDATE REQUEST message is received from an MS with a LIPA PDN connection, and if:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a L-GW Transport Layer Address is provided by the lower layer together with the ROUTING AREA UPDATE REQUEST message, and the GGSN address associated with the PDP context of the LIPA PDN connection is different from the provided L-GW Transport Layer Address (see 3GPP&nbsp;TS&nbsp;25.413&nbsp;[19c]); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no L-GW Transport Layer Address is provided together with the ROUTING AREA UPDATE REQUEST message by the lower layer,</p>
<p>then the SGSN locally deactivates all PDP contexts associated with the LIPA PDN connection. If the ROUTING AREA UPDATE REQUEST request message is accepted, the SGSN informs the MS via the PDP context status IE in the ROUTING AREA UPDATE ACCEPT message that PDP contexts were locally deactivated.</p>
<p>If a ROUTING AREA UPDATE REQUEST message is received from an MS with a SIPTO at the local network PDN connection, the following different cases can be distinguished:</p>
<p>1)&nbsp;&nbsp; If the PDN connection is a SIPTO at the local network PDN connection with collocated L-GW and if:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a SIPTO L-GW Transport Layer Address is provided by the lower layer together with the ROUTING AREA UPDATE REQUEST message, and the GGSN address associated with the PDP context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address (see 3GPP&nbsp;TS&nbsp;25.413&nbsp;[19c]); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no SIPTO L-GW Transport Layer Address is provided together with the ROUTING AREA UPDATE REQUEST message by the lower layer,</p>
<p>2)&nbsp;&nbsp; If the PDN connection is a SIPTO at the local network PDN connection with stand-alone GW and if:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a LHN-ID value is provided by the lower layer together with the ROUTING AREA UPDATE REQUEST message, and the LHN-ID stored in the PDP context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP&nbsp;TS&nbsp;25.413&nbsp;[19c]); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no LHN-ID value is provided together with the ROUTING AREA UPDATE REQUEST message by the lower layer,</p>
<p>then the SGSN locally deactivates all PDP contexts associated with the SIPTO at the local network PDN connection. If the ROUTING AREA UPDATE REQUEST request message is accepted, the SGSN informs the MS via the PDP context status IE in the ROUTING AREA UPDATE ACCEPT message that PDP contexts were locally deactivated.</p>
<p>For a SIPTO at the local network PDN connection with stand-alone GW, the conditions to deactivate ISR are specified in 3GPP&nbsp;TS&nbsp;23.401&nbsp;[122], subclause&nbsp;4.3.5.6.</p>
<p>If due to regional subscription restrictions or access restrictions the MS is not allowed to access the routing area, but the MS has a PDN connection for emergency bearer services established, the network may accept the ROUTING AREA UPDATE REQUEST message and deactivate all non-emergency PDP contexts by initiating an PDP context deactivation procedure when the routing area updating procedure is initiated in PMM-CONNECTED mode. When the routing area updating procedure is initiated in PMM-IDLE mode, the network locally deactivates all non-emergency PDP contexts and informs the MS via the PDP context status IE in the ROUTING AREA UPDATE ACCEPT message. The network shall not deactivate the PDP contexts for emergency bearer services. The network shall consider the MS to be attached for emergency bearer services only.</p>
<p>If the network supports delivery of SMS via GPRS (see 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74]) and this delivery is enabled (see 3GPP&nbsp;TS&nbsp;29.272&nbsp;[150]), then the network shall include the Additional network feature support IE in the ROUTING AREA UPDATE ACCEPT message and set the GPRS-SMS indicator.</p>
<p>If the network supports the extended protocol configuration options IE and the MS indicated support of the extended protocol configuration options IE, then the network shall include the Additional network feature support IE in the ROUTING AREA UPDATE ACCEPT message and set the ePCO IE indicator to "extended protocol configuration options IE supported".</p>
<p>The network shall indicate "combined RA/LA updated" or "combined RA/LA updated and ISR activated" in the update result IE in the ROUTING AREA UPDATE ACCEPT message, if the following conditions apply:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the update type IE included in the ROUTING AREA UPDATE REQUEST message indicates "periodic updating" and the MS was previously successfully attached for GPRS and non-GPRS services; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; location area updating for non-GPRS services as specified in 3GPP&nbsp;TS&nbsp;29.018&nbsp;[149] is successful.</p>
<p>The network shall include the T3324 value IE in the ROUTING AREA UPDATE ACCEPT message only if the T3324 value IE was included in the ROUTING AREA UPDATE REQUEST message, and the network supports and accepts the use of PSM.</p>
<p>If the network supports and accepts the use of PSM, and the MS included the T3312 extended value IE in the ROUTING AREA UPDATE REQUEST message, then the network shall take into account the T3312 value requested when providing the Periodic RA update timer IE and the T3312 extended value IE in the ROUTING AREA UPDATE ACCEPT message.</p>
<p>NOTE&nbsp;3:&nbsp; Besides the value requested by the MS, the network can take local configuration into account when selecting a value for T3312 (see 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74] subclause&nbsp;5.3.13.54).</p>
<p>In A/Gb mode, if the MS indicates support for restriction on use of enhanced coverage in the ROUTING AREA UPDATE REQUEST message, and the network restricts enhanced coverage for the MS, then the network shall set the RestrictEC bit to "Enhanced coverage restricted" in the Additional network feature support IE of the ROUTING AREA UPDATE ACCEPT message.</p>
<p>If the network includes the T3324 value IE indicating a value other than deactivated in the ROUTING AREA UPDATE ACCEPT message, the network shall indicate in the Update result IE in the ROUTING AREA UPDATE ACCEPT message that ISR is not activated.</p>
<p>Upon receipt of a ROUTING AREA UPDATE ACCEPT message, the MS shall store the received routing area identification, stops timer T3330, reset the routing area updating attempt counter, reset the service request attempt counter and set the GPRS update status to GU1 UPDATED. If the message contains a P-TMSI, the MS shall use this P-TMSI as new temporary identity for GPRS services and shall store the new P-TMSI. If no P-TMSI was included by the network in the ROUTING AREA UPDATE ACCEPT message, the old P-TMSI shall be kept. Furthermore, the MS shall store the P-TMSI signature if received in the ROUTING AREA UPDATE ACCEPT message. If no P-TMSI signature was included in the message, the old P-TMSI signature, if available, shall be deleted.</p>
<p>Upon receipt of a ROUTING AREA UPDATE ACCEPT message with update result IE indicating "combined RA/LA updated" or "combined RA/LA updated and ISR activated" during the periodic routing area updating procedure, the MS shall behave as follows:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the ROUTING AREA UPDATE ACCEPT message contains an IMSI, the MS is not allocated any TMSI. The MS shall delete any old TMSI accordingly;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the ROUTING AREA UPDATE ACCEPT message contains a TMSI, the MS shall use this TMSI as new temporary identity. The MS shall delete its old TMSI and shall store the new TMSI. In this case, a ROUTING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if neither a TMSI nor an IMSI has been included by the network in the ROUTING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.</p>
<p>Upon receiving a ROUTING AREA UPDATE COMPLETE message, the SGSN shall stop timer T3350 and change to state GMM-REGISTERED. The P-TMSI, if sent in the ROUTING AREA UPDATE ACCEPT message, shall be considered as valid.</p>
<p>NOTE&nbsp;4:&nbsp; Upon receiving a ROUTING AREA UPDATE COMPLETE message, if a new TMSI is included in the ROUTING AREA UPDATE ACCEPT message, the SGSN sends a BSSAP+-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP&nbsp;TS&nbsp;29.018&nbsp;[149].</p>
<p>If the PDP context status information element is included in ROUTING AREA UPDATE ACCEPT message, then the MS shall deactivate all those PDP contexts locally (without peer to peer signalling between the MS and network), which are not in SM state PDP-INACTIVE in the MS but are indicated by the network as being in state PDP-INACTIVE. If there is a default PDP context among the PDP contexts to be deactivated, an MS supporting S1 mode shall locally deactivate all PDP contexts associated to the same PDP address and APN as the default PDP context without peer-to-peer SM signalling to the network; an MS not supporting S1 mode may apply the same behaviour. If only the PDN connection for emergency bearer services remains established, the MS shall consider itself attached for emergency bearer services only.</p>
<p>If the MBMS context status information element is included in the ROUTING AREA UPDATE ACCEPT message, then the MS shall deactivate all those MBMS contexts locally (without peer to peer signalling between the MS and network) which are not in SM state PDP-INACTIVE in the MS, but are indicated by the network as being in state PDP-INACTIVE. If no MBMS context status information element is included, then the MS shall deactivate all those MBMS contexts locally which are not in SM state PDP-INACTIVE in the MS.</p>
<p>If the ROUTING AREA UPDATE ACCEPT message contains the T3312 extended value IE, then the MS shall use the T3312 extended value IE as periodic routing area update timer (T3312). If the ROUTING AREA UPDATE ACCEPT message does not contain the T3312 extended value IE, then the MS shall use value in the Periodic RA update timer IE as periodic routing area update timer (T3312).</p>
<p>If the MS receives the ROUTING AREA UPDATE ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see subclause&nbsp;4.1.1.6A), then the MS shall reset these counters. If the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall reset this counter.</p>
<p>If the ROUTING AREA UPDATE ACCEPT message contains the T3324 value IE, then the MS shall use the timer value for T3324 as specified in subclause&nbsp;4.7.2.8.</p>
<p>If the ROUTING AREA UPDATE ACCEPT message contains the DCN-ID IE, then the MS shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as described in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120], annex&nbsp;C.</p>
<p>In a shared network or in a multi-operator core network (MOCN) with common GERAN, if the ROUTING AREA UPDATE ACCEPT message contains the DCN-ID IE and the PLMN identity of the CN operator IE, the MS shall store the included DCN-ID value with the PLMN identity indicated in the PLMN identity of the CN operator IE, and the included DCN-ID value with the PLMN identity indicated in the RAI in a DCN-ID list in a non-volatile memory in the ME as described in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120], annex C.</p>
<p>In A/Gb mode, if the ROUTING AREA UPDATE ACCEPT message contains the Cell Notification information element, then the MS shall start to use the LLC NULL frame to perform cell updates.</p>
<p>If the MS has initiated the routing area updating procedure due to manual CSG selection and receives a ROUTING AREA UPDATE ACCEPT message, and the MS sent the ROUTING AREA UPDATE REQUEST message in a CSG cell, the MS shall check if the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list. If not, the MS shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the MS may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.</p>
<p>The network may also send a list of "equivalent PLMNs" in the ROUTING AREA UPDATE ACCEPT message. Each entry of the list contains a PLMN code (MCC+MNC). If the routing area updating procedure is initiated during a CS fallback procedure and the network is configured to support the return to the last registered E-UTRAN PLMN after CS fallback as specified in 3GPP&nbsp;TS&nbsp;23.272&nbsp;[133], and the PLMN identity which is provided as part of the RAI contained in the ROUTING AREA UPDATE ACCEPT message differs from the last registered E-UTRAN PLMN identity, the network shall include the last registered E-UTRAN PLMN identity in the list of "equivalent PLMNs" in the ROUTING AREA UPDATE ACCEPT message.</p>
<p>NOTE&nbsp;5:&nbsp; The network can determine a routing area updating procedure is initiated during a CS fallback procedure as specified in 3GPP&nbsp;TS&nbsp;23.272&nbsp;[133].</p>
<p>NOTE&nbsp;6:&nbsp; The last registered E-UTRAN PLMN identity can be derived by the network as specified in 3GPP&nbsp;TS&nbsp;23.272&nbsp;[133].</p>
<p>The mobile station shall store the list, as provided by the network, and further handle the list as follows:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if there is no PDN connection for emergency bearers established, the mobile station shall remove from the list of "equivalent PLMNs" any PLMN code that is already in the "forbidden PLMN" list. If the mobile station is operating in MS operation mode C or the mobile station is supporting S1 mode, it shall also remove any PLMN code that is already in the list of "forbidden PLMNs for GPRS service";</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the MS is not attached for emergency bearer services and there is a PDN connection for emergency bearer services established, the MS shall remove from the list of "equivalent PLMNs" any PLMN code present in the "forbidden PLMN" list when the PDN connection for emergency bearer services is released. If the mobile station is operating in MS operation mode C or the mobile station is supporting S1 mode, it shall also remove any PLMN code present in the list of "forbidden PLMNs for GPRS service" when the PDN connection for emergency bearer services is released; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in addition, for all cases the mobile station shall add to the stored list the PLMN code of the registered PLMN that sent the list.</p>
<p>All PLMNs in the stored list shall be regarded as equivalent to each other for PLMN selection, cell selection/re-selection and handover. The stored list in the mobile station shall be replaced on each occurrence of the ROUTING AREA UPDATE ACCEPT message. If no list is contained in the message, then the stored list in the mobile station shall be deleted. An MS attached for emergency bearer services only shall delete the stored list when the MS enters the state GMM-DEREGISTERED. The list shall be stored in the mobile station while switched off so that it can be used for PLMN selection after switch on.</p>
<p>A ROUTING AREA UPDATE COMPLETE message shall be returned to the network if the ROUTING AREA UPDATE ACCEPT message contained any of:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a P-TMSI;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a TMSI;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; receive N‑PDU Numbers (see 3GPP&nbsp;TS&nbsp;44.065&nbsp;[78] and 3GPP&nbsp;TS&nbsp;25.322&nbsp;[19b]); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a request for the provision of Inter RAT handover information.</p>
<p>If Receive N‑PDU Numbers were included, the Receive N‑PDU Numbers values valid in the MS, shall be included in the ROUTING AREA UPDATE COMPLETE message.</p>
<p>If the network has requested the provision of Inter RAT handover information, the MS shall return a ROUTING AREA UPDATE COMPLETE message including the Inter RAT handover information IE to the network.</p>
<p>NOTE&nbsp;7:&nbsp; In Iu mode, after a routing area updating procedure, the mobile station can initiate Service Request procedure to request the resource reservation for the active PDP contexts if the resources have been released by the network or send upper layer message (e.g. ACTIVATE PDP CONTEXT REQUEST) to the network via the existing PS signalling connection.</p>
<p>In Iu mode, if the network wishes to prolong the PS signalling connection (for example, if the mobile station has indicated "follow-on request pending" in ROUTING AREA UPDATE REQUEST message or if user plane radio access bearers have been established for the MS) the network shall indicate the "follow-on proceed" in the ROUTING AREA UPDATE ACCEPT message. If the network wishes to release the PS signalling connection, the network shall indicate "no follow-on proceed" in the ROUTING AREA UPDATE ACCEPT message.</p>
<p>After that in Iu mode, the mobile station shall act according to the follow-on proceed flag included in the Update result information element in the ROUTING AREA UPDATE ACCEPT message (see subclause&nbsp;4.7.13).</p>
<p>The network may also send a Local Emergency Numbers List with local emergency numbers in the ROUTING AREA UPDATE ACCEPT, by including the Emergency Number List IE. The mobile equipment shall store the Local Emergency Numbers List, as provided by the network. The Local Emergency Numbers List stored in the mobile equipment shall be replaced on each receipt of the Emergency Number List IE. The received Local Emergency Numbers List shall be provided to the upper layers.</p>
<p>The emergency number(s) received in the Emergency Number List IE are valid only in networks in the same country as the cell on which this IE is received. If no list is contained in the ROUTING AREA UPDATE ACCEPT message, then the stored Local Emergency Numbers List in the mobile equipment shall be kept, except if the mobile equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the Local Emergency Numbers List.</p>
<p>The mobile equipment shall use the stored Local Emergency Numbers List of emergency numbers received from the network in addition to the emergency numbers stored on the SIM/USIM or ME to detect that the number dialled is an emergency number.</p>
<p>NOTE&nbsp;8:&nbsp; The mobile equipment may use the Local Emergency Numbers List to assist the end user in determining whether the dialled number is intended for an emergency service or for another destination, e.g. a local directory service. The possible interactions with the end user are implementation specific.</p>
<p>NOTE&nbsp;9:&nbsp; An MS that supports procedures specified in 3GPP&nbsp;TS&nbsp;24.302&nbsp;[156], can get additional local emergency numbers through those procedures, which can be used based on operator policy (see 3GPP&nbsp;TS&nbsp;24.302&nbsp;[156]) to detect that the number dialled is an emergency number.</p>
<p>The Local Emergency Numbers List shall be deleted at switch off and removal of the SIM/USIM. The mobile equipment shall be able to store up to ten local emergency numbers received from the network.</p>
<p>In order to indicate to the MS that the GUTI and TAI list assigned to the MS remain registered with the network and are valid in the MS, the network shall indicate in the Update result IE in the ROUTING AREA UPDATE ACCEPT message that ISR is activated.</p>
<p>If the MS is attached for emergency bearer services or if the network has deactivated all non-emergency PDP contexts, the network shall indicate in the update result IE in the ROUTING AREA UPDATE ACCEPT message that ISR is not activated.</p>
<p>If the ROUTING AREA UPDATE ACCEPT message contains:</p>
<ol>
<li>i) no indication that ISR is activated, an MS supporting S1 mode shall set the TIN to "P-TMSI" and shall stop the periodic tracking area update timer T3412 or T3423, if running; or</li>
<li>ii) an indication that ISR is activated, then:</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the MS is required to perform tracking area updating for IMS voice termination as specified in annex&nbsp;P.5, the MS shall set the TIN to "P-TMSI" and shall stop the periodic tracking area update timer T3412 or T3423, if running;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the MS had initiated the routing area updating procedure due to a change in DRX parameters, the MS shall set the TIN to "P-TMSI" and shall stop the periodic tracking area update timer T3412 or T3423 if running;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the MS had initiated the routing area updating procedure due to a change in the UE's usage setting or the voice domain preference for E-UTRAN, the MS shall set the TIN to "P-TMSI" and shall stop the periodic tracking area update timer T3412 or T3423, if running; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall regard the available GUTI and TAI list as valid and registered with the network. If the TIN currently indicates "GUTI" and the periodic tracking area update timer T3412 is running or is deactivated, the MS shall set the TIN to "RAT-related TMSI". If the TIN currently indicates "GUTI" and the periodic tracking area update timer T3412 has already expired, the MS shall set the TIN to "P-TMSI".</p>
<p>In A/Gb mode, if a UMTS security context is available, if the MS indicates support of integrity protection in the ROUTING AREA UPDATE REQUEST message and the network supports integrity protection, then if the MS receives replayed capability IE&rsquo;s in ROUTING AREA UPDATE ACCEPT message, then the MS shall check if the replayed MS network capability IE and the replayed MS Radio Access Capability IE received in the ROUTING AREA UPDATE ACCEPT message has not been altered compared to the MS network capability IE and the MS Radio Access Capability IE that the MS sent to the network in ROUTING AREA UPDATE REQUEST message. If the replayed MS network capability IE and the replayed MS Radio Access Capability IE are not the same, then the MS shall ignore the ROUTING AREA UPDATE ACCEPT message.</p>
<h5><a name="_Toc171524024"></a>4.7.5.1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Normal and periodic routing area updating procedure not accepted by the network</h5>
<p>If the routing area updating cannot be accepted, the network sends a ROUTING AREA UPDATE REJECT message to the MS. An MS, which receives a ROUTING AREA UPDATE REJECT message with a reject cause other than GMM cause value #25 or the message is integrity protected, shall stop the timer T3330. If a ROUTING AREA UPDATE REJECT message containing a reject cause other than GMM cause value #25 is received or the message is integrity protected, the MS shall stop any ongoing transmission of user data.</p>
<p>If the ROUTING AREA UPDATE REJECT message containing GMM cause value cause #25 was received without integrity protection, then the MS shall discard the message.</p>
<p>If the routing area update request is rejected due to general NAS level mobility management congestion control, the network shall set the GMM cause value to #22 "congestion" and assign a back-off timer T3346.</p>
<p>The MS shall then take different actions depending on the received reject cause value:</p>
<p># 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Illegal MS);</p>
<p># 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Illegal ME);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The MS shall consider the SIM/USIM as invalid for GPRS services until switching off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value. The MS shall delete the list of equivalent PLMNs, and shall enter the state GMM-DEREGISTERED.NO-IMSI.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed or the timer T3245 expires as described in subclause&nbsp;4.1.1.6. If the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p>NOTE&nbsp;1:&nbsp; The possibility to configure a MS so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the MS, is out of scope of the present specification.</p>
<p># 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GPRS services not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2.9) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The MS shall enter the state GMM-DEREGISTERED. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the update type is "periodic updating", a GPRS MS operating in MS operation mode A or B in network operation mode I shall then proceed with the appropriate MM specific procedure.</p>
<p>NOTE&nbsp;2:&nbsp; Optionally the MS starts the timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GPRS services and non-GPRS services not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The MS shall delete the list of equivalent PLMNs, and shall enter the GMM state GMM-DEREGISTERED.NO-IMSI.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>NOTE&nbsp;3:&nbsp; Optionally the MS starts the timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area procedure is rejected with the EMM cause with the same value.</p>
<p># 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (MS identity cannot be derived by the network);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU2 NOT UPDATED (and shall store it according to subclause&nbsp;4.1.3.2), enter the state GMM-DEREGISTERED.NORMAL-SERVICE, and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the rejected request was not for initiating a PDN connection for emergency bearer services, then</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS MS operating in MS operation mode A in network operation mode I shall proceed with appropriate MM specific procedures. Additionally, the MS shall initiate a normal or combined GPRS attach procedure depending on whether it is in an ongoing circuit-switched transaction. If the MS is in an ongoing circuit-switched transaction, it shall initiate the appropriate MM specific procedure after the circuit-switched transaction has been released. The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the update type is "periodic updating", a GPRS MS operating in MS operation mode B in network operation mode I shall proceed with appropriate MM specific procedures. Additionally, the MS shall initiate a combined GPRS attach procedure. The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS MS operating in MS operation mode A or B in network operation mode II which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, and which did not perform a successful generic location updating procedure since the last intersystem change from S1 mode to A/Gb or Iu mode shall proceed with appropriate MM specific procedures. Additionally, a GPRS MS operating in MS operation mode A or B in network operation mode II shall initiate a GPRS attach procedure; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS MS operating in MS operation mode A or B in network operation mode II which is not configured to use CS fallback and SMS over SGs, or SMS over SGs only, and a GPRS MS operating in MS operation mode C may subsequently, automatically initiate the GPRS attach procedure.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 10&nbsp;&nbsp;&nbsp; (Implicitly detached);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the update type is "periodic updating", a GPRS MS operating in MS operation mode B in network operation mode I, is IMSI detached for both GPRS and CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A in network operation mode I is detached for GPRS services. If no RR connection exists then the MS is also IMSI detached for the CS services.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall enter the state GMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, then</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS MS operating in MS operation mode A or B in network operation mode II which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, and which did not perform a successful generic location updating procedure since the last intersystem change from S1 mode to A/Gb or Iu mode shall proceed with appropriate MM specific procedures;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; regardless of the MS operation mode and the network operation mode, the MS shall then perform a new attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s); and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; additionally, a GPRS MS operating in MS operation mode A in network operation mode I which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, and which is in an ongoing circuit-switched transaction shall initiate the appropriate MM specific procedure after the circuit-switched transaction has been released. The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM state as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p>NOTE&nbsp;4:&nbsp; In some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.</p>
<p># 11&nbsp;&nbsp;&nbsp; (PLMN not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2), shall reset the routing area updating attempt counter, shall delete the list of equivalent PLMNs, and enter the state GMM-DEREGISTERED.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the PLMN identity in the "forbidden PLMN list" and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a PLMN-specific attempt counter for that PLMN, then the MS shall set this counter to the MS implementation-specific maximum value.</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 12&nbsp;&nbsp;&nbsp; (Location area not allowed);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall store the LAI in the list of "forbidden location areas for regional provision of service".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a cell selection according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>NOTE&nbsp;5:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 13&nbsp;&nbsp;&nbsp; (Roaming not allowed in this location area);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2) and shall delete the list of equivalent PLMNs. The MS shall reset the routing area updating attempt counter, and shall enter the state GMM-REGISTERED.LIMITED-SERVICE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a PLMN selection according to 3GPP TS&nbsp;23.122 [14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP TS&nbsp;44.318 [76b]) prior to perform a PLMN selection from this list according to 3GPP TS&nbsp;23.122 [14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 14&nbsp;&nbsp;&nbsp; (GPRS services not allowed in this PLMN);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.</p>
<p>The MS shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. A GPRS MS operating in MS operation mode C shall perform a PLMN selection instead of a cell selection. If the message has been successfully integrity checked by the lower layers and the MS maintains a PLMN-specific PS-attempt counter for that PLMN, then the MS shall set this counter to the MS implementation-specific maximum value.</p>
<p>A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.</p>
<p>If the update type is "periodic updating" a GPRS MS operating in MS operation mode A or B in network operation mode I shall then proceed with the appropriate MM specific procedure.</p>
<p>As an implementation option, a GPRS MS operating in operation mode A or B may perform the following additional action. If no RR connection exists the MS may perform the action immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS may only perform the action when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS may perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>The MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; On the "User Controlled PLMN Selector with Access Technology " or,</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; On the "Operator Controlled PLMN Selector with Access Technology " list or,</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; A PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 15&nbsp;&nbsp;&nbsp; (No Suitable Cells In Location Area);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) shall reset the routing area updating attempt counter and shall change to state GMM-REGISTERED.LIMITED-SERVICE.</p>
<p>The MS shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall search for a suitable cell in another location area or a tracking area according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121].</p>
<p>NOTE&nbsp;6:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p>#22&nbsp;&nbsp;&nbsp;&nbsp; (Congestion);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the T3346 value IE is present in the ROUTING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause&nbsp;4.7.5.1.5.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall abort the routing area updating procedure, reset the routing area updating attempt counter and set the GPRS update status to GU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer T3346 if it is running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the ROUTING AREA UPDATE REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the ROUTING AREA UPDATE REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table&nbsp;11.3a.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS stays in the current serving cell and applies the normal cell reselection process. The routing area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B in network operation mode II which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, and which did not perform a successful generic location updating procedure since the last intersystem change from S1 mode to A/Gb or Iu mode shall proceed with appropriate MM specific procedures.</p>
<p># 25&nbsp;&nbsp;&nbsp; (Not authorized for this CSG)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause&nbsp;4.7.5.1.5.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and store it according to subclause&nbsp;4.1.3.2) and shall reset the routing area updating attempt counter. The state is changed to GMM-REGISTERED.LIMITED-SERVICE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14] subclause&nbsp;3.1A.</p>
<p>The MS shall start timer&nbsp;T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall search for a suitable cell according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p>Other values are considered as abnormal cases. The specification of the MS behaviour in those cases is described in subclause&nbsp;4.7.5.1.5.</p>
<h5><a name="_Toc171524025"></a>4.7.5.1.4a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Routing area updating procedure for initiating a PDN connection for emergency bearer services not accepted by the network (UTRAN Iu mode only)</h5>
<p>If the routing area updating request for initiating a PDN connection for emergency bearer services cannot be accepted by the network, the MS shall perform the procedures as described in subclause&nbsp;4.7.5.1.4. Then if the MS is in the same selected PLMN where the last routing area updating was attempted, the MS shall:</p>
<ol>
<li>a) inform the upper layers of the failure of the procedure; or</li>
</ol>
<p>NOTE&nbsp;1:&nbsp; This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[95] that can result in the emergency call being attempted to another IP-CAN.</p>
<ol>
<li>b) detach locally, if not detached already, attempt GPRS attach for emergency bearer services.</li>
</ol>
<p>If the routing area updating request for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in subclause&nbsp;4.7.5.1.5, the MS shall perform the procedures as described in subclause&nbsp;4.7.5.1.5 and inform the upper layers of the failure to access the network.</p>
<p>NOTE&nbsp;2:&nbsp; This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[95] that can result in the emergency call being attempted to another IP-CAN.</p>
<p>If the routing area updating request for initiating a PDN connection for emergency bearer services fails due to abnormal cases b), c) or d) in subclause&nbsp;4.7.5.1.5, the MS shall perform the procedures as described in subclause&nbsp;4.7.5.1.5. Then if the MS is in the same selected PLMN where the last routing area updating was attempted, the MS shall:</p>
<ol>
<li>a) inform the upper layers of the failure of the procedure; or</li>
</ol>
<p>NOTE&nbsp;3:&nbsp; This can result in the upper layers requesting&nbsp; establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[95] that can result in the emergency call being attempted to another IP-CAN.</p>
<ol>
<li>b) detach locally, if not detached already, attempt GPRS attach for emergency bearer services.</li>
</ol>
<h5><a name="_Toc171524026"></a>4.7.5.1.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases in the MS</h5>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) Access barred because of access class control, EAB or ACDC</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the routing area updating procedure is started in response to a paging request from the network, access class barring, EAB or ACDC is not applicable.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The routing area updating procedure shall not be started. The MS stays in the current serving cell and applies the normal cell reselection process. The procedure is started as soon as possible and if still necessary, i.e. when the barred state is removed or because of a cell change.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If access is barred because of access class control, the upper layers request PS signalling connection, ACDC is applicable to the request and the MS supports ACDC, then the routing area updating procedure shall be started according to subclause&nbsp;4.7.5.1.1.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If access is barred for a certain ACDC category, and if the upper layers request PS signalling connection for a higher ACDC category and the MS supports ACDC, then the routing area updating procedure shall be started according to subclause&nbsp;4.7.5.1.1.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If an access request for an uncategorized application is barred due to ACDC , and if the upper layers request PS signalling connection for a certain ACDC category and the MS supports ACDC, then the routing area updating procedure shall be started according to subclause&nbsp;4.7.5.1.1.</p>
<ol>
<li>b) Lower layer failure without "Extended Wait Time" received from lower layers before the ROUTING AREA UPDATE ACCEPT or ROUTING AREA UPDATE REJECT message is received</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The procedure shall be aborted and the MS shall proceed as described below, except in the following implementation option cases b.1 and b.2.</p>
<p>b.1)&nbsp;&nbsp;&nbsp;&nbsp; Release of PS signalling connection before the completion of the routing area updating procedure</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The routing area updating procedure shall be initiated again, if the following conditions apply:</p>
<ol>
<li>i) The original routing area update procedure was initiated over an existing PS signalling connection; and</li>
<li>ii) The routing area update procedure was not due to timer T3330 expiry; and</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iii)&nbsp;&nbsp;&nbsp; No SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the PS signalling connection were (e.g. PS authentication procedure, see subclause&nbsp;4.7.7) received after the ROUTING AREA UPDATE REQUEST message was transmitted.</p>
<p>b.2)&nbsp;&nbsp;&nbsp;&nbsp; RR release in Iu mode (i.e. RRC connection release) with, for example, cause "Normal", or "User inactivity" or "Direct signalling connection re-establishment" (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111])</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The routing area updating procedure shall be initiated again, if the following conditions apply:</p>
<ol>
<li>i) The original routing area update procedure was initiated over an existing RRC connection; and</li>
<li>ii) The routing area update procedure was not due to timer T3330 expiry; and</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iii)&nbsp;&nbsp;&nbsp; No SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the PS signalling connection (e.g. PS authentication procedure, see subclause&nbsp;4.7.7) were received after the ROUTING AREA UPDATE REQUEST message was transmitted.</p>
<p>NOTE&nbsp;1:&nbsp; The RRC connection release cause that triggers the re-initiation of the routing area update procedure is implementation specific.</p>
<ol>
<li>c) T3330 time-out</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The procedure is restarted four times, i.e. on the fifth expiry of timer T3330, the MS shall abort the procedure and, in Iu mode, release the PS signalling connection (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]). The MS shall proceed as described below.</p>
<ol start="4">
<li>d) ROUTING AREA UPDATE REJECT, other causes than those treated in subclause&nbsp;4.7.5.1.4, and cases of GMM cause values #22 and #25, if considered as abnormal cases according to subclause&nbsp;4.7.5.1.4</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the routing area updating request is not for initiating a PDN connection for emergency bearer services, upon reception of the cause codes # 95, # 96, # 97, # 99 and # 111 the MS should set the routing area updating attempt counter to 5.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall proceed as described below.</p>
<ol>
<li>e) If a routing area border is crossed, when the MS is in state GMM-ROUTING-AREA-UPDATE-INITIATED, the routing area updating procedure shall be aborted and re-initiated immediately. The MS shall set the GPRS update status to GU2 NOT UPDATED.</li>
<li>f) In A/Gb mode, if a cell change occurs within the same RA, when the MS is in state GMM-ROUTING-AREA-UPDATE-INITIATED, the cell update procedure is performed, before completion of the routing area updating procedure.</li>
<li>g) Routing area updating and detach procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing detach type "re-attach required" or "re-attach not required":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a DETACH REQUEST message before the routing area updating procedure has been completed, the routing area updating procedure shall be aborted and the GPRS detach procedure shall be progressed. If the DETACH REQUEST message contains detach type "re-attach not required" and GMM cause #2 "IMSI unknown in HLR", the MS will follow the procedure as described below for the detach type "IMSI detach".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing detach type "IMSI detach":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a DETACH REQUEST message before the routing area updating procedure has been completed, the routing area updating procedure shall be progressed, i.e. the DETACH REQUEST message shall be ignored.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall proceed as described below.</p>
<ol>
<li>h) Routing area updating and P-TMSI reallocation procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a P-TMSI REALLOCATION C0MMAND message before the routing area updating procedure has been completed, the P-TMSI reallocation procedure shall be aborted and the routing area updating procedure shall be progressed.</p>
<ol>
<li>i) "Extended wait time" for PS domain from the lower layers</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the ROUTING AREA UPDATE REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the MS shall start timer T3346 with the "Extended wait time" value and reset the routing area updating attempt counter.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In other cases the MS shall ignore the "Extended wait time".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall abort the routing area updating procedure, stay in the current serving cell, set the GPRS update status to GU2 NOT UPDATED, change the state to GMM-REGISTERED.ATTEMPTING-TO-UPDATE and apply the normal cell reselection process.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS had used eDRX before initiating routing area updating procedure, then the MS shall continue to use the eDRX with the extended DRX parameters IE received during the last attach or routing area updating procedure.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall proceed as described below.</p>
<ol>
<li>j) Timer T3346 is running</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall not start the routing area updating procedure unless:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is an MS configured to use AC11 &ndash; 15 in selected PLMN;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is in PMM-CONNECTED mode (Iu mode);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS receives a paging;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS has a PDN connection for emergency bearer services established;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is establishing a PDN connection for emergency bearer services; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS has a PDN connection established without the NAS signalling low priority indication or is establishing a PDN connection without the NAS signalling low priority indication and if the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, ROUTING AREA UPDATE REQUEST or SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority".</p>
<p>The MS stays in the current serving cell and applies the normal cell reselection process.</p>
<p>NOTE&nbsp;2:&nbsp; It is considered an abnormal case if the MS needs to initiate an routing area updating procedure while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non successful case.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the stored RAI is different to the RAI of the current serving cell or the TIN indicates "GUTI", the MS shall set the GPRS update status to GU2 NOT UPDATED and change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall proceed as described below.</p>
<ol>
<li>k) Mobile originated detach required</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach due to removal of the USIM or due to switch off:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS is in the state GMM-ROUTING-AREA-UPDATE-INITIATED, the routing area updating procedure shall be aborted and the GPRS detach procedure shall be performed (see subclause&nbsp;4.7.4.1).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach not due to removal of the USIM and not due to switch off:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall initiate the MS initiated detach procedure after successful completion of the routing area updating procedure.</p>
<ol>
<li>l) Routing area updating and paging for non-GPRS services procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If a GPRS MS in MS operation mode B receives a paging for non-GPRS services before the normal or periodic routing area updating procedure has been completed, the MS shall progress the routing area updating procedure and respond to the paging for non-GPRS services when it has completed the routing area updating procedure or aborted the procedure for other reasons.</p>
<p>In cases b, c, d, e, g with detach type "re-attach required" or "re-attach not required" with GMM cause other than #2 "IMSI unknown in HLR", and i, the MS shall stop any ongoing transmission of user data.</p>
<p>In cases b, c, d, i and j the MS shall proceed as follows:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Timer T3330 shall be stopped if still running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For the cases b, c, d, and i when the "Extended wait time" is ignored, if the routing area updating request is not for initiating a PDN connection for emergency bearer services, the routing area updating attempt counter shall be incremented.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the routing area updating attempt counter is less than 5, and the stored RAI is equal to the RAI of the current serving cell and the GPRS update status is equal to GU1 UPDATED and the TIN does not indicate "GUTI":</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall keep the GPRS update status to GU1 UPDATED and changes state to GMM-REGISTERED.NORMAL-SERVICE. The MS shall start timer T3311.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If in addition the ROUTING AREA UPDATE REQUEST message indicated "periodic updating", none of the other reasons for initiating the routing area updating procedure listed in subclause&nbsp;4.7.5.1 was applicable, and the ROUTING AREA UPDATE REQUEST message did not include a Requested READY timer value IE, T3324 value IE, T3312 extended value IE or Extended DRX parameters IE,</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, the timer T3311 may be stopped when the MS enters PMM-CONNECTED mode;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, the timer T3311 may be stopped when the READY timer is started.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If timer T3311 expires the routing area updating procedure is triggered again.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the routing area updating attempt counter is less than 5, and the stored RAI is different to the RAI of the current serving cell or the GPRS update status is different to GU1 UPDATED or the TIN indicates "GUTI":</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for the cases i and j, the routing area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; for the cases b, c, d, and i when the "Extended wait time" is ignored, if the routing area updating request is not for initiating a PDN connection for emergency bearer services, the MS shall start timer T3311, shall set the GPRS update status to GU2 NOT UPDATED and changes state to GMM-REGISTERED.ATTEMPTING-TO-UPDATE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported by the MS, the MS shall in addition handle the EPS update status as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the abnormal case when a normal or periodic tracking area updating procedure fails and the tracking area updating attempt counter is less than 5 and the EPS update status is different from EU1 UPDATED.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the routing area updating attempt counter is greater than or equal to 5:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall start timer T3302, and shall set the GPRS update status to GU2 NOT UPDATED. An MS which is a GPRS MS in MS operation modes C shall also delete the list of equivalent PLMNs. The MS shall also enter the state GMM-REGISTERED.ATTEMPTING-TO-UPDATE or optionally the GMM-REGISTERED.PLMN-SEARCH state (see subclause&nbsp;4.2.5.1.8) in order to perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported by the MS, the MS shall in addition handle the EPS update status as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the abnormal case when a normal or periodic tracking area updating procedure fails and the tracking area updating attempt counter is equal to 5.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS does not enter the state GMM-REGISTERED.PLMN-SEARCH, then</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS MS operating in MS operation mode A in network operation mode I shall proceed with appropriate MM specific procedures. If the MS operating in MS operation mode A is in an ongoing circuit-switched transaction, it shall initiate the appropriate MM specific procedure after the circuit-switched transaction has been released. The MM sublayer of the MS operating in MS operation mode A shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the update type is "periodic updating", a GPRS MS operating in MS operation mode B in network operation mode I shall proceed with appropriate MM specific procedures. The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS MS operating in MS operation mode A or B in network operation mode II which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, and which did not perform a successful generic location updating procedure since the last intersystem change from S1 mode to A/Gb or Iu mode shall proceed with appropriate MM specific procedures.</p>
<h5><a name="_Toc171524027"></a>4.7.5.1.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the network side</h5>
<p>The following abnormal cases can be identified:</p>
<ol start="4">
<li>a) If a lower layer failure occurs before the message ROUTING AREA UPDATE COMPLETE has been received from the MS and a P-TMSI and/or PTMSI signature has been assigned, the network shall abort the procedure and shall consider both, the old and new P-TMSI and the corresponding P-TMSI signatures as valid until the old P-TMSI can be considered as invalid by the network (see subclause&nbsp;4.7.1.5). During this period the network may use the identification procedure followed by a P-TMSI reallocation procedure if the old P-TMSI is used by the MS in a subsequent message.</li>
</ol>
<p>NOTE&nbsp;1:&nbsp; Optionally, paging with IMSI may be used if paging with old and new P-TMSI fails. Paging with IMSI causes the MS to re-attach as described in subclause&nbsp;4.7.9.1.</p>
<ol>
<li>b) Protocol error</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the ROUTING AREA UPDATE REQUEST message has been received with a protocol error, the network shall return a ROUTING AREA UPDATE REJECT message with one of the following reject causes:</p>
<p>#96:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mandatory information element error;</p>
<p>#99:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Information element non-existent or not implemented;</p>
<p>#100:&nbsp;&nbsp;&nbsp;&nbsp; Conditional IE error;</p>
<p>#111:&nbsp;&nbsp;&nbsp;&nbsp; Protocol error, unspecified.</p>
<ol>
<li>c) T3350 time-out</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; On the first expiry of the timer, the network shall retransmit the ROUTING AREA UPDATE ACCEPT message and shall reset and restart timer T3350. The retransmission is performed four times, i.e. on the fifth expiry of timer T3350, the routing area updating procedure is aborted. Both, the old and the new P-TMSI and the corresponding P-TMSI signatures shall be considered as valid until the old P-TMSI can be considered as invalid by the network(see subclause&nbsp;4.7.1.5). During this period the network acts as described for case a above.</p>
<p>Figure 4.7.5/1 3GPP TS 24.008: Routing and combined routing area updating procedure</p>
<p>d.1)&nbsp;&nbsp;&nbsp;&nbsp; ROUTING AREA UPDATE REQUEST received after the ROUTING AREA UPDATE ACCEPT message has been sent and before the ROUTING AREA UPDATE COMPLETE message is received</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If one or more of the information elements in the ROUTING AREA UPDATE REQUEST message differ from the ones received within the previous ROUTING AREA UPDATE REQUEST message, the previously initiated routing area updating procedure shall be aborted if the ROUTING AREA UPDATE COMPLETE message has not been received and the new routing area updating procedure shall be progressed, or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the information elements do not differ, then the ROUTING AREA UPDATE ACCEPT message shall be resent and the timer T3350 shall be restarted if an ROUTING AREA UPDATE COMPLETE message is expected. In that case, the retransmission counter related to T3350 is not incremented.</p>
<p>d.2)&nbsp;&nbsp;&nbsp;&nbsp; More than one ROUTING AREA UPDATE REQUEST received and no ROUTING AREA UPDATE ACCEPT or ROUTING AREA UPDATE REJECT message has been sent</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If one or more of the information elements in the ROUTING AREA UPDATE REQUEST message differs from the ones received within the previous ROUTING AREA UPDATE REQUEST message, the previously initiated routing area updating procedure shall be aborted and the new routing area updating procedure shall be progressed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the information elements do not differ, then the network shall continue with the previous routing area updating procedure and shall not treat any further this ROUTING AREA UPDATE REQUEST message.</p>
<ol>
<li>e) DETACH REQUEST message received before the ROUTING AREA UPDATE ACCEPT message is sent or before the ROUTING AREA UPDATE COMPLETE message (in case of P-TMSI and/or TMSI was allocated) is received.</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing cause "power off":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The network shall abort the signalling for the routing area updating procedure towards the MS and shall progress the detach procedure as described in subclause&nbsp;4.7.4.1.</p>
<p>NOTE&nbsp;2:&nbsp; Internally in the network, before processing the detach request, the SGSN can perform the necessary signalling procedures for the routing area updating procedure before progressing the detach procedure.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing other causes than "power off":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The network shall proceed with the routing area updating procedure and shall progress the detach procedure after successful completion of the routing area updating procedure.</p>
<ol>
<li>f) ROUTING AREA UPDATE REQUEST message with update type IE indicating "periodic updating" is received by the network, the network does not have the GMM context data related to the subscription, and the network operates in network operation mode I.</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The network may send the ROUTING AREA UPDATE REJECT message with GMM cause value #10 "Implicitly detached".</p>
<h4><a name="_Toc171524028"></a>4.7.5.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combined routing area updating procedure</h4>
<h5><a name="_Toc171524029"></a>4.7.5.2.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; General</h5>
<p>Within a combined routing area updating procedure the messages ROUTING AREA UPDATE ACCEPT and ROUTING AREA UPDATE COMPLETE carry information for the routing area updating and the location area updating.</p>
<h5><a name="_Toc171524030"></a>4.7.5.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combined routing area updating procedure initiation</h5>
<p>The combined routing area updating procedure is initiated only by a GPRS MS operating in MS operation modes A or B, if the MS is in state GMM-REGISTERED and MM-IDLE, and if the network operates in network operation mode I:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when a GPRS MS that is IMSI attached for GPRS and non-GPRS services detects a change of the routing area in state GMM-REGISTERED and MM-IDLE, unless the MS is configured for "AttachWithIMSI" as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112] and is entering a routing area in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when a GPRS MS that is IMSI attached for GPRS services wants to perform an IMSI attach for non-GPRS services;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; after termination of a non-GPRS service via non-GPRS channels to update the association if the MS has changed the RA during that non-GPRS service transaction;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; after termination of a non-GPRS service via non-GPRS channels to update the association if GPRS services were suspended during the non-GPRS service but no resume is received. See 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74] subclause&nbsp;16.2.1;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; after termination of a non-GPRS service via non-GPRS channels to update the association, if the GPRS MS in MS operation mode A performed a normal GPRS attach or a normal routing area updating procedure during the circuit-switched transaction;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; after a CM SERVICE REJECT message with cause value #4 is received by the mobile station (see subclause&nbsp;4.5.1.1); in this case the update type IE shall be set to "Combined RA/LA updating with IMSI attach";</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when a GPRS MS needs to update the network with the new MS Radio Access Capability IE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when a GPRS MS needs to update the network with a new DRX parameter IE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, to re-synchronize the PMM mode of MS and network after RRC connection release with cause "Directed signalling connection re-establishment", see subclause&nbsp;4.7.2.5;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode, to re-synchronize the PMM mode of MS and network after inter-system change not due to PS handover from PMM-CONNECTED mode in Iu mode to A/Gb mode or S1 mode, if the MS performed an inter - system change back to Iu mode without sending a ROUTING AREA UPDATE REQUEST message while in A/Gb mode or a TRACKING AREA UPDATE REQUEST message while in S1 mode;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in Iu mode and A/Gb mode, after intersystem change from S1 mode, and the GMM receives an indication of "RRC connection failure" from lower layers due to lower layer failure while in S1 mode. In this case, if the TIN indicates "RAT-related TMSI", the MS shall set the TIN to "GUTI" before initiating the routing area updating procedure;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, after intersystem change from S1 mode if the TIN indicates "RAT-related TMSI", but the MS is required to perform routing area updating for IMS voice termination as specified in annex P.4;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS enters GMM-REGISTERED.NORMAL-SERVICE and the TIN indicates "GUTI";</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS supports SRVCC and changes the mobile station classmark 2, mobile station classmark 3 or the supported codecs;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, enters a GERAN or UTRAN cell and timer T3423 has expired, or is in the GERAN or UTRAN cell when timer T3423 expires;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when due to a manual CSG selection the GPRS MS has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the MS's Allowed CSG list or in the MS's Operator CSG list;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS changes the MS network capability information;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the UE's usage setting or the voice domain preference for E-UTRAN change in the MS;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS activates mobility management for IMS voice termination as specified in annex P.2 and the TIN indicates "RAT-related TMSI";</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; upon reception of a paging indication using P-TMSI, if the timer T3346 is running and the MS is in state GMM-REGISTERED.ATTEMPTING-TO-UPDATE and the RAI of the current cell is same as the stored RAI;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS which is configured to use CS fallback and SMS over SGs, or SMS over SGs only, enters a GERAN or UTRAN cell, after intersystem change from S1 mode to Iu or A/Gb mode not due to CS fallback, and the location area of the current cell is different from the location area stored in the MS;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, after intersystem change from S1 mode via cell change order procedure not due to CS fallback, if the TIN indicates "RAT-related TMSI"; in this case the MS shall set the TIN to "GUTI" before initiating the combined routing area updating procedure;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; in A/Gb mode, after Inter RAT handover from S1 mode or Iu mode;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS needs to request the use of PSM or needs to stop the use of PSM;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the MS needs to request the use of eDRX or needs to stop the use of eDRX;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when a change in the eDRX usage conditions at the MS requires different extended DRX parameters;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when a change in the PSM usage conditions at the MS requires a different timer T3312 value or different timer T3324 value; or</p>
<p>NOTE&nbsp;1:&nbsp; A change in the PSM or eDRX usage conditions at the MS can include e.g. a change in the MS configuration, a change in requirements from upper layers or the battery running low at the MS.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; when the Default_DCN_ID value changes, as specified in 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or in USIM file NAS<sub>CONFIG</sub> as specified in 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112].</p>
<p>NOTE&nbsp;2:&nbsp; The routing area updating procedure is initiated after deleting the DCN-ID list as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120], annex&nbsp;C.</p>
<p>In A/Gb mode, the routing and location area identification are broadcast on the broadcast channel(s). A combined routing area updating procedure shall abort any ongoing GMM procedure. Aborted GMM procedures shall be repeated after the combined routing area updating procedure has been successfully performed. The ROUTING AREA UPDATE REQUEST message shall always be the first message sent from the MS in the new routing area after routing area change.</p>
<p>In Iu mode, the routing and location area identification are broadcast on the broadcast channel(s) or sent to the MS via the PS signalling connection. A combined routing area updating procedure shall abort any ongoing GMM procedure. Aborted GMM procedures may be repeated after the combined routing area updating procedure has been successfully performed. The ROUTING AREA UPDATE REQUEST message shall always be the first GMM message sent from the MS in the new routing area after routing area change.</p>
<p>To initiate a combined routing area updating procedure the MS sends the message ROUTING AREA UPDATE REQUEST to the network, starts timer T3330 and changes to state GMM-ROUTING-UPDATING-INITIATED and MM LOCATION UPDATING PENDING. The value of the Update type IE in the message shall indicate "combined RA/LA updating" unless explicitly specified otherwise. If for the last attempt to update the registration of the location area a MM specific procedure was performed, the value of the Update type IE in the ROUTING AREA UPDATE REQUEST message shall indicate "combined RA/LA updating with IMSI attach". Furthermore the MS shall include the TMSI status IE if no valid TMSI is available. If the MS has stored a valid LAI and the MS supports EMM combined procedures, the MS shall include it in the Old location area identification IE in the ROUTING AREA UPDATE REQUEST message. If timer T3302 is currently running, the MS shall stop timer T3302. If timer T3311 is currently running, the MS shall stop timer T3311.</p>
<p>If the MS has stored a valid TMSI, the MS shall include the TMSI based NRI container IE in the ROUTING AREA UPDATE REQUEST message.</p>
<p>A GPRS MS in MS operation modes B that is in an ongoing circuit-switched transaction, shall initiate the combined routing area updating procedure after the circuit-switched transaction has been released, if the MS has changed the RA during the circuit-switched transaction and if the network operates in network operation mode I.</p>
<p>A GPRS MS in MS operation mode A shall initiate the combined routing area updating procedure with IMSI attach after the circuit-switched transaction has been released, if a normal GPRS attach or a normal routing area updating procedure was performed during the circuit-switched transaction and provided that the network operates in network operation mode I.</p>
<p>A GPRS MS in MS operation mode A shall perform the normal routing area update procedure during an ongoing circuit-switched transaction.</p>
<p>If the MS initiates the combined routing area updating procedure for GPRS services and "SMS-only service", the MS shall indicate "SMS only" in the Additional update type IE.</p>
<p>In Iu mode, if the MS wishes to prolong the established PS signalling connection after the normal routing area updating procedure (for example, the MS has any CM application request pending), it may set a follow-on request pending indicator on (see subclause&nbsp;4.7.13).</p>
<p>In Iu mode, when a ROUTING AREA UPDATE REQUEST is received by the SGSN over a new PS signalling connection while there is an ongoing PS signalling connection (network is already in mode PMM-CONNECTED) for this MS, the network shall progress the routing area update procedure as normal and release the previous PS signalling connection when the routing area update procedure has been accepted by the network.</p>
<p>NOTE&nbsp;3:&nbsp; The re-establishment of the radio bearers of active PDP contexts is done as described in subclause "Service Request procedure".</p>
<p>If the combined routing area updating procedure is initiated due to the reception of the paging indication while T3346 is running, the "follow-on request pending" indication shall be set to 1.</p>
<h5><a name="_Toc171524031"></a>4.7.5.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM Common procedure initiation</h5>
<p>The network may initiate GMM common procedures, e.g. the GMM authentication and ciphering procedure.</p>
<h5><a name="_Toc171524032"></a>4.7.5.2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combined routing area updating procedure accepted by the network</h5>
<p>Depending on the value of the update result IE received in the ROUTING AREA UPDATE ACCEPT message, two different cases can be distinguished:</p>
<p>Case 1)&nbsp;&nbsp;&nbsp;&nbsp; The update result IE value indicates "combined RA/LA": Routing and location area&nbsp;&nbsp; updating is successful;</p>
<p>Case 2)&nbsp;&nbsp;&nbsp;&nbsp; The update result IE value indicates "RA only": Routing area updating is successful, but location area updating is not successful.</p>
<p>A ROUTING AREA UPDATE COMPLETE message shall be returned to the network if the ROUTING AREA UPDATE ACCEPT message containsany of:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a P-TMSI and/or a TMSI;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Receive N‑PDU Numbers (see 3GPP&nbsp;TS&nbsp;44.065&nbsp;[78] and 3GPP&nbsp;TS&nbsp;25.322&nbsp;[19b]); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a request for the provision of Inter RAT handover information.</p>
<p>If Receive N‑PDU Numbers were included, the Receive N‑PDU Numbers that are valid in the MS shall be included in the ROUTING AREA UPDATE COMPLETE message.</p>
<p>If the network has requested the provision of Inter RAT handover information the MS shall return a ROUTING AREA UPDATE COMPLETE message including the Inter RAT handover information IE, as applicable, to the network.</p>
<p>In Iu mode, if the network wishes to prolong the PS signalling connection (for example, if the mobile station has indicated "follow-on request pending" in ROUTING AREA UPDATE REQUEST message) the network shall indicate the "follow-on proceed" in the ROUTING AREA UPDATE ACCEPT message. If the network wishes to release the PS signalling connection, the network shall indicate "no follow-on proceed" in the ROUTING AREA UPDATE ACCEPT message.</p>
<p>After that in Iu mode, the mobile station shall act according to the follow-on proceed flag included in the Update result information element in the ROUTING AREA UPDATE ACCEPT message (see subclause&nbsp;4.7.13).</p>
<p>If the network supports CS Fallback, and the mobile station has indicated support of EMM combined procedures in MS network capability, the network shall indicate in the Update result IE in the ROUTING AREA UPDATE ACCEPT message that ISR is not activated.</p>
<p>4.7.5.2.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combined routing area updating successful</p>
<p>The description for normal routing area update as specified in subclause&nbsp;4.7.5.1.3 shall be followed. In addition, the following description for location area updating applies.</p>
<p>The handling at the receipt of the ROUTING AREA UPDATE ACCEPT depends on the value received in the update result IE as specified below.</p>
<p>The TMSI reallocation may be part of the combined routing area updating procedure. The TMSI allocated is then included in the ROUTING AREA UPDATE ACCEPT message together with the location area identification (LAI). The network shall, in this case, change to state GMM-COMMON-PROCEDURE-INITIATED and shall start the timer T3350 as described in subclause&nbsp;4.7.6.</p>
<p>The MS, receiving a ROUTING AREA UPDATE ACCEPT message, stores the received location area identification, stops timer T3330, enters state MM IDLE, reset the location update attempt counter and sets the update status to U1 UPDATED. If the ROUTING AREA UPDATE ACCEPT message contains an IMSI, the mobile station is not allocated any TMSI, and shall delete any TMSI accordingly. If the ROUTING AREA UPDATE ACCEPT message contains a TMSI, the MS shall use this TMSI as new temporary identity. The MS shall delete its old TMSI and shall store the new TMSI. In this case, an ROUTING AREA UPDATE COMPLETE message is returned to the network. If neither a TMSI nor an IMSI has been included by the network in the ROUTING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.</p>
<p>If the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events (see subclause&nbsp;4.1.1.6A), then the MS shall reset this counter.</p>
<p>If the MS is not configured for NAS signalling low priority, and any of the following conditions is fulfilled:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS initiated the combined routing area updating procedure due to a change of the registered location area;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the value of the Update type IE in the ROUTING AREA UPDATE REQUEST message indicated "combined RA/LA updating with IMSI attach"; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS indicated support of EMM combined procedures in the MS network capability;</p>
<p>then the MS may stop timer T3246 if running.</p>
<p>Any timer used for triggering the location updating procedure (e.g. T3211, T3212) shall be stopped if running.</p>
<p>The network receiving a ROUTING AREA UPDATE COMPLETE message stops timer T3350, changes to GMM-REGISTERED state</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon receiving a ROUTING AREA UPDATE COMPLETE message, the SGSN sends a BSSAP+-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP&nbsp;TS&nbsp;29.018&nbsp;[149].</p>
<p>4.7.5.2.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combined routing area updating successful for GPRS services only</p>
<p>Apart from the actions on the routing area updating attempt counter, the description for normal routing area update as specified in subclause&nbsp;4.7.5.1.3 shall be followed. In addition, the following description for location area updating applies.</p>
<p>The SGSN shall use GMM cause #28 "SMS provided via GPRS in this routing area" in the ROUTING AREA UPDATE ACCEPT message only if the MS requested "SMS-only service" by including the Additional update type IE in the ROUTING AREA UPDATE REQUEST message. The SGSN may indicate in the Update result IE in the ROUTING AREA UPDATE ACCEPT message that ISR is activated.</p>
<p>The MS receiving the ROUTING AREA UPDATE ACCEPT message takes one of the following actions depending on the GMM cause:</p>
<p>#2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (IMSI unknown in HLR);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer&nbsp;T3330 if still running and shall reset the routing area updating attempt counter. The MS shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The MS shall enter state GMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The SIM/USIM shall be considered as invalid for non-GPRS services until switching off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>#16&nbsp;&nbsp;&nbsp;&nbsp; (MSC temporarily not reachable); or</p>
<p>#17&nbsp;&nbsp;&nbsp;&nbsp; (Network failure)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer&nbsp;T3330 if still running, and shall enter state MM-IDLE. The routing area updating attempt counter shall be incremented.</p>
<p>If the routing area updating attempt counter is less than 5, and the stored RAI is equal to the RAI of the current serving cell and the GMM update status is equal to GU1 UPDATED:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall keep the GMM update status GU1 UPDATED and changes state to GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. The MS shall start timer T3311. When timer T3311 expires the combined routing area update procedure indicating "combined RA/LA updating with IMSI attach" is triggered again.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the routing area updating attempt counter is greater than or equal to 5:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall start timer T3302 and shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS MS operating in MS operation mode A shall then proceed with appropriate MM specific procedure; a GPRS MS operating in MS operation mode B may then proceed with appropriate MM specific procedures. <br /> The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered.</p>
<p># 22&nbsp;&nbsp;&nbsp; (Congestion);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, shall stop timer T3330 if still running, and shall enter state MM-IDLE. The MS shall set the routing area updating attempt counter to 5 and shall start timer T3302.</p>
<p># 28&nbsp;&nbsp;&nbsp; (SMS provided via GPRS in this routing area);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer&nbsp;T3330 if still running and shall reset the routing area updating attempt counter. The MS shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The MS shall enter state GMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS stays in the current serving cell and applies the normal cell reselection process.</p>
<p>Other GMM causevalues and the case that no GMM cause IE was received are considered as abnormal cases. The combined routing area updating shall be considered as failed for non-GPRS services. The specification of the MS behaviour in those cases is specified in subclause&nbsp;4.7.5.2.5.</p>
<h5><a name="_Toc171524033"></a>4.7.5.2.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combined routing area updating not accepted by the network</h5>
<p>If the combined routing area updating cannot be accepted, the network sends a ROUTING AREA UPDATE REJECT message to the MS. An MS that receives a ROUTING AREA UPDATE REJECT message containing a reject cause other than GMM cause value #25 or the message is integrity protected, shall stop the timer T3330, and shall enter the state MM IDLE. If a ROUTING AREA UPDATE REJECT message containing a reject cause other than GMM cause value #25 is received or the message is integrity protected, the MS shall stop any ongoing transmission of user data.</p>
<p>If the ROUTING AREA UPDATE REJECT message containing GMM cause value #25 was received without integrity protection, then the MS shall discard the message.</p>
<p>If the routing area update request is rejected due to general NAS level mobility management congestion control, the network shall set the GMM cause value to #22 "congestion" and assign a back-off timer T3346.</p>
<p>The MS shall then take different actions depending on the received reject cause:</p>
<p># 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Illegal MS);</p>
<p># 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Illegal ME), or</p>
<p># 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GPRS services and non GPRS services not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED and the update status to U3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, TMSI, RAI, LAI, ciphering key sequence number and GPRS ciphering key sequence number. The MS shall consider the SIM/USIM as invalid for GPRS and non GPRS services until switching off or the SIM/USIM is removed or the timer T3245 expires as described in subclause&nbsp;4.1.1.6. The MS shall delete the list of equivalent PLMNs, and shall enter the state GMM-DEREGISTERED.NO-IMSI.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>NOTE&nbsp;1:&nbsp; Optionally the MS starts the timer T3340 as described in subclause&nbsp;4.7.1.9 for reject cause #8.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GPRS services not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The MS shall enter the state GMM-DEREGISTERED.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services is still IMSI attached for CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B in network operation mode I shall then proceed with the appropriate MM specific procedure.</p>
<p>NOTE&nbsp;2:&nbsp; Optionally the MS starts the timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP TS 24.301 [120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (MS identity cannot be derived by the network);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU2 NOT UPDATED (and shall store it according to subclause&nbsp;4.1.3.2), enter the state GMM-DEREGISTERED.NORMAL-SERVICE, and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B in network operation mode I which is already IMSI attached for CS services in the network, is still IMSI attached for CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the rejected request was not for initiating a PDN connection for emergency bearer services, then</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS MS operating in MS operation mode A or B shall proceed with appropriate MM specific procedures. The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS may subsequently, automatically initiate the GPRS attach procedure.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 10&nbsp;&nbsp;&nbsp; (Implicitly detached);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B in network operation mode I, is IMSI detached for both GPRS and CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall enter the state GMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall then perform a new attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM state as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p>NOTE&nbsp;3:&nbsp; In some cases, user interaction may be required and then the MS cannot activate the PDP/MBMS context(s) automatically.</p>
<p># 11&nbsp;&nbsp;&nbsp; (PLMN not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED and the update status to U3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and enter the state GMM-DEREGISTERED. Furthermore, the MS shall delete any P-TMSI, P-TMSI signature, TMSI, RAI, LAI, ciphering key sequence number GPRS ciphering key sequence number, shall delete the list of equivalent PLMNs, and shall reset the routing area updating attempt counter and the location update attempt counter.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the PLMN identity in the "forbidden PLMN list" and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a PLMN-specific attempt counter for that PLMN, then the MS shall set this counter to the MS implementation-specific maximum value.</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall then perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP TS&nbsp;23.122 [14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 12&nbsp;&nbsp;&nbsp; (Location area not allowed);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>The MS shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>The mobile station shall store the LAI in the list of "forbidden location areas for regional provision of service".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>The MS shall perform a cell selection according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>NOTE&nbsp;4:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 13&nbsp;&nbsp;&nbsp; (Roaming not allowed in this location area);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2), and shall delete the list of equivalent PLMNs. The MS shall reset the routing area updating attempt counter, and shall enter the state GMM-REGISTERED.LIMITED-SERVICE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall in addition set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a PLMN selection according to 3GPP TS&nbsp;23.122 [14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall indicate the Update type IE "combined RA/LA updating with IMSI attach" when performing the routing area updating procedure following the PLMN selection.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 14&nbsp;&nbsp;&nbsp; (GPRS services not allowed in this PLMN);</p>
<p>The MS shall delete any RAI, P-TMSI, P-TMSI signature, and GPRS ciphering key sequence number stored, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-DEREGISTERED.</p>
<p>The MS shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a PLMN-specific PS-attempt counter for that PLMN, then the MS shall set this counter to the MS implementation-specific maximum value.</p>
<p>A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services is still IMSI attached for CS services in the network.</p>
<p>A GPRS MS operating in MS operation mode A or B in network operation mode I shall then proceed with the appropriate MM specific procedure.</p>
<p>As an implementation option, a GPRS MS operating in operation mode A or B may perform a PLMN selection according to 3GPP TS&nbsp;23.122 [14].</p>
<p>If an MS in GAN mode performs a PLMN selection, it shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>The MS shall not perform the optional PLMN selection in the case where the PLMN providing this reject cause is:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; On the "User Controlled PLMN Selector with Access Technology " or,</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; On the "Operator Controlled PLMN Selector with Access Technology " list or,</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; A PLMN identified as equivalent to any PLMN, within the same country, contained in the lists above.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list, KSI and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p># 15&nbsp;&nbsp;&nbsp; (No Suitable Cells In Location Area);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to clause 4.1.3.2), shall reset the routing area updating attempt counter and shall change to state GMM-REGISTERED.LIMITED-SERVICE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall in addition set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall search for a suitable cell in another location area according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>NOTE&nbsp;5:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall indicate the Update type IE "combined RA/LA updating with IMSI attach" when performing the routing area updating procedure.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p>#22&nbsp;&nbsp;&nbsp;&nbsp; (Congestion);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the T3346 value IE is present in the ROUTING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause&nbsp;4.7.5.2.5.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall abort the routing area updating procedure, reset the routing area updating attempt counter and set the GPRS update status to GU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer T3346 if it is running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the ROUTING AREA UPDATE REJECT message is integrity protected, the MS shall start timer with the value provided in the T3346 value IE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the ROUTING AREA UPDATE REJECT message is not integrity protected, the ME shall start timer T3346 with a random value from the default range specified in table&nbsp;11.3a.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS stays in the current serving cell and applies the normal cell reselection process. The routing area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p>#25&nbsp;&nbsp;&nbsp;&nbsp; (Not authorized for this CSG)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause&nbsp;4.7.5.2.5.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and store it according to subclause&nbsp;4.1.3.2) and shall reset the routing area updating attempt counter. The state is changed to GMM-REGISTERED.LIMITED-SERVICE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the CSG ID and associated PLMN identity of the cell where the MS has sent the ROUTING AREA UPDATE REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14] subclause&nbsp;3.1A.</p>
<p>The MS shall start timer&nbsp;T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall search for a suitable cell according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the combined tracking area update procedure is rejected with the EMM cause with the same value.</p>
<p>Other values are considered as abnormal cases. The specification of the MS behaviour in those cases is described in subclause&nbsp;4.7.5.2.5.</p>
<h5><a name="_Toc171524034"></a>4.7.5.2.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases in the MS</h5>
<p>The MS shall proceed as follows:</p>
<p>1)&nbsp;&nbsp; If the combined routing area update was successful for GPRS services only and the ROUTING AREA UPDATE ACCEPT message contained a cause value not treated in subclause&nbsp;4.7.5.2.3.2 or the GMM Cause IE is not included in the message, the MS shall proceed as follows:</p>
<ol>
<li>a) The MS shall stop timer T3330 if still running, and shall enter state MM IDLE. The routing area updating attempt counter shall be incremented;</li>
<li>b) If the routing area updating attempt counter is less than 5, and the stored RAI is equal to the RAI of the current serving cell and the GMM update status is equal to GU1 UPDATED:</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall keep the GMM update status GU1 UPDATED and changes state to GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. The MS shall start timer T3311. When timer T3311 expires the combined routing area update procedure indicating "combined RA/LA updating with IMSI attach" is triggered again; and</p>
<ol>
<li>c) If the routing area updating attempt counter is greater than or equal to 5:</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS shall start timer T3302 and shall change to state GMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a GPRS MS operating in MS operation mode A shall then proceed with appropriate MM specific procedure; a GPRS MS operating in MS operation mode B may then proceed with appropriate MM specific procedures. The MM sublayer shall act as in network operation mode II or as long as the combined GMM procedures are not successful and no new RA is entered;</p>
<p>2)&nbsp;&nbsp; Combined routing area updating and paging for non-GPRS services procedure collision</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a paging for non-GPRS services before the routing area updating procedure has been completed, the MS shall progress the routing area updating procedure and respond to the paging for non-GPRS services when the MS has completed the routing area updating procedure or aborted the procedure for other reasons. The MS shall return to MM state MM IDLE and proceed with the appropriate MM specific procedures to respond to the paging for non-GPRS services; and</p>
<p>3)&nbsp;&nbsp; otherwise, the abnormal cases specified in subclause&nbsp;4.7.5.1.5 apply with the following modification.</p>
<p>If the GPRS routing area updating attempt counter is incremented according to subclause&nbsp;4.7.5.1.5 the next actions depend on the Location Area Identities (stored on SIM/USIM and the one of the current serving cell) and the value of the routing area updating attempt counter.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the update status is U1 UPDATED, and the stored LAI is equal to the one of the current serving cell and the routing area updating attempt counter is smaller than 5, then the mobile station shall keep the update status to U1 UPDATED, the new MM state is MM IDLE substate NORMAL SERVICE;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the routing area updating attempt counter is smaller than 5 and, additionally, the update status is different from U1 UPDATED or the stored LAI is different from the one of the current serving cell, the mobile station shall delete any LAI, TMSI, ciphering key sequence number stored in the SIM/USIM and list of equivalent PLMNs and set the update status to U2 NOT UPDATED. The MM state remains MM LOCATION UPDATING PENDING; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the routing area updating attempt counter is greater or equal to 5, the mobile station shall delete any LAI, TMSI, ciphering key sequence number stored in the SIM/USIM and the list of equivalent PLMNs, and shall set the update status to U2 NOT UPDATED.<br /> A GPRS MS operating in MS operation mode A shall then proceed with appropriate MM specific procedure; a GPRS MS operating in MS operation mode B may then proceed with appropriate MM specific procedures. <br /> The MM sublayer shall act as in network operation mode II as long as the combined GMM procedures are not successful and no new RA is entered. The new MM state is MM IDLE substate ATTEMPTING TO UPDATE or optionally MM IDLE substate PLMN SEARCH in order to perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<h5><a name="_Toc171524035"></a>4.7.5.2.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the network side</h5>
<p>The abnormal cases specified in subclause&nbsp;4.7.5.1.6 apply.</p>
<h3><a name="_Toc171524036"></a>4.7.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P-TMSI reallocation procedure</h3>
<h4><a name="_Toc171524037"></a>4.7.6.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; General</h4>
<p>A temporary mobile station identity for GPRS services, the Packet-TMSI (P-TMSI), is used for identification within the radio interface signalling procedures. The structure of the P-TMSI is specified in 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10]. The P-TMSI has significance only within a routing area. Outside the routing area the P-TMSI has to be combined with the routing area identification (RAI) to provide for an unambiguous identity.</p>
<p>The purpose of the P-TMSI reallocation procedure is to provide identity confidentiality, i.e. to protect a user against being identified and located by an intruder (see 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13], 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74] and 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]).</p>
<p>Usually, P-TMSI reallocation is performed at least at each change of a routing area (Such choices are left to the network operator).</p>
<p>The reallocation of a P-TMSI is performed by the unique procedure defined in subclause&nbsp;4.7.6. This procedure can only be initiated by the network in state GMM-REGISTERED.</p>
<p>P-TMSI can also be implicitly reallocated in the attach or routing area updating procedures (see subclauses&nbsp;4.7.3.1 and 4.7.5). The implicit reallocation of a P-TMSI is described in the corresponding subclauses.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Normally, the P-TMSI reallocation will take place in conjunction with another GMM procedure, e.g. at routing area updating (see 3GPP&nbsp;TS&nbsp;29.002&nbsp;[37]).</p>
<h4><a name="_Toc171524038"></a>4.7.6.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P-TMSI reallocation initiation by the network</h4>
<p>The network shall initiate the P-TMSI reallocation procedure by sending a P-TMSI REALLOCATION COMMAND message to the MS and shall start the timer T3350.</p>
<p>The P-TMSI REALLOCATION COMMAND message shall contain a new combination of P-TMSI, RAI and optionally a P-TMSI signature or a DCN-ID or both allocated by the network.</p>
<p>The network may suspend the transmission of user data during the P-TMSI reallocation procedure.</p>
<h4><a name="_Toc171524039"></a>4.7.6.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P-TMSI reallocation completion by the MS</h4>
<p>Upon receipt of the P-TMSI REALLOCATION COMMAND message, the MS shall store the routing area identifier (RAI) and the P-TMSI. Furthermore, the MS shall send a P-TMSI REALLOCATION COMPLETE message to the network.</p>
<p>If a P-TMSI signature is present in the P-TMSI REALLOCATION COMMAND message, the MS shall store the new P-TMSI signature and shall if available delete the old P-TMSI signature. If no P-TMSI signature is present in the P-TMSI REALLOCATION COMMAND message, the old P-TMSI signature, if available, shall be kept.</p>
<p>If the P-TMSI REALLOCATION COMMAND message contains the DCN-ID IE, then the MS shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as described in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120], annex&nbsp;C.</p>
<h4><a name="_Toc171524040"></a>4.7.6.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P-TMSI reallocation completion by the network</h4>
<p>Upon receipt of the P-TMSI REALLOCATION COMPLETE message, the network shall stop the timer T3350 and shall consider both the old and the new P-TMSI and the corresponding P-TMSI signatures as valid until the old P-TMSI can be considered as invalid by the network (see subclause&nbsp;4.7.1.5).</p>
<p>In A/Gb mode, the GMM layer shall notify the LLC layer that the P-TMSI has been changed (see 3GPP&nbsp;TS&nbsp;44.064&nbsp;[78a]).</p>
<h4><a name="_Toc171524041"></a>4.7.6.3A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases in the MS</h4>
<p>The following abnormal cases can be identified:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If different new P-TMSIs are included in subsequent P-TMSI REALLOCATION COMMAND messages due to an aborted or repeated P-TMSI reallocation procedure, the MS shall behave as described in subclause&nbsp;4.7.6.2. Furthermore, the MS shall take action on the P-TMSI as described in subclause&nbsp;4.7.1.5.</p>
<h4><a name="_Toc171524042"></a>4.7.6.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the network side</h4>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) Lower layer failure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If a lower layer failure is detected before the P-TMSI REALLOCATION COMPLETE message is received, the network shall consider both the old and the new P-TMSI as occupied until the old P-TMSI can be considered as invalid (see subclause&nbsp;4.7.1.5).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; During this period the network:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may first use the old P-TMSI for paging for an implementation dependent number of paging attempts in the case of network-originated transactions. Upon response from the MS, the network may re-initiate the P-TMSI reallocation procedure. If no response is received to the paging attempts, the network may use the new P-TMSI for paging for an implementation dependent number of paging attempts. Upon response from the MS, the network shall consider the new P-TMSI as valid and the old P-TMSI as invalid. If no response is received to the paging attempts, the network may use the IMSI for paging for an implementation dependent number of paging attempts;</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Paging with IMSI causes the MS to re-attach as described in subclause&nbsp;4.7.9.1.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; shall consider the new P-TMSI as valid if it is used by the MS (see subclause&nbsp;4.7.1.5); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; may use the identification procedure followed by a new P-TMSI reallocation, if the MS uses the old P-TMSI.</p>
<ol>
<li>b) Expiry of timer T3350</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The P-TMSI reallocation procedure is supervised by the timer T3350 (see example in figure&nbsp;4.7.6/1). On the first expiry of timer T3350, the network shall reset and restart timer T3350 and shall retransmit the P-TMSI REALLOCATION COMMAND message. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3350, the network shall abort the P-TMSI reallocation procedure and shall follow the rules for case a as described above.</p>
<ol>
<li>c) P-TMSI reallocation and GPRS attach procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives an ATTACH REQUEST message before the ongoing P-TMSI reallocation procedure has been completed, the network shall proceed with the GPRS attach procedure after deletion of the GMM context.</p>
<ol>
<li>d) P-TMSI reallocation and an MS initiated GPRS detach procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a DETACH REQUEST message before the ongoing P-TMSI reallocation procedure has been completed, the network shall abort the P-TMSI reallocation procedure and shall progress the GPRS detach procedure.</p>
<ol>
<li>e) P-TMSI reallocation and a routing area updating procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a ROUTING AREA UPDATE REQUEST message before the ongoing P-TMSI reallocation procedure has been completed, the network shall abort the P-TMSI reallocation procedure and shall progress the routing area updating procedure. The network may then perform a new P-TMSI reallocation.</p>
<ol>
<li>f) P-TMSI reallocation and a service request procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a SERVICE REQUEST message before the ongoing P-TMSI reallocation procedure procedure has been completed, the network shall progress both procedures.</p>
<p>Figure 4.7.6/1 3GPP TS 24.008: P-TMSI reallocation procedure</p>
<h3><a name="_Toc171524043"></a>4.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication and ciphering procedure</h3>
<h4><a name="_Toc171524044"></a>4.7.7a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication and ciphering procedure used for UMTS authentication challenge.</h4>
<p>The purpose of the authentication and ciphering procedure is fivefold (see 3GPP TS 33.102 [5a] and 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13]):</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; to permit the network to check whether the identity provided by the MS is acceptable or not;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; to provide parameters enabling the MS to calculate a new GPRS UMTS ciphering key and a new GPRS UMTS integrity key;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; to let the network set the GSM ciphering mode (ciphering /no ciphering) and GSM ciphering algorithm;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; to permit the mobile station to authenticate the network; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; to let the network set GSM integrity protection and GSM integrity algorithm (for control plane and optionally for user plane).</p>
<p>In Iu mode, and in the case of a UMTS authentication challenge, the authentication and ciphering procedure can be used for authentication only.</p>
<p>The cases in which the authentication and ciphering procedure shall be used are defined in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a], 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13] and 3GPP&nbsp;TS&nbsp;42.009&nbsp;[5].</p>
<p>The authentication and ciphering procedure is always initiated and controlled by the network. However, in the case of a UMTS authentication challenge, there is the possibility for the MS to reject the network.</p>
<p>The MS shall support the UMTS authentication challenge, if a USIM is inserted.</p>
<p>The authentication and ciphering procedure can be used for any combination of the following:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; authentication;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; setting of the GSM ciphering mode and the GSM ciphering algorithm; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; setting of GSM integrity protection and the GSM integrity algorithm (for control plane and optionally for user plane).</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Setting of GSM integrity protection and the GSM integrity algorithm in the authentication and ciphering procedure is only applicable for an MS and a network supporting integrity protection in A/Gb mode.</p>
<p>In A/Gb mode, the network should not send any user data during the authentication and ciphering procedure.</p>
<p>A UMTS security context is established in the MS and the network when a UMTS authentication challenge is performed in A/Gb mode or in Iu mode. After a successful UMTS authentication, the GPRS UMTS ciphering key, the GPRS UMTS integrity key, the GPRS GSM ciphering key and the GPRS ciphering key sequence number, are stored both in the network and the MS. Furthermore, in A/Gb mode both the ME and the network may derive and store a GPRS GSM Kc<sub>128</sub> as part of the UMTS security context as described in the subclause&nbsp;4.7.7.3a. Furthermore, in A/Gb mode, if integrity protection is used, both the MS and the network shall derive and store a GPRS GSM Kint as part of the UMTS security context as described in the subclause&nbsp;4.7.7.3b.</p>
<h4><a name="_Toc171524045"></a>4.7.7b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication and ciphering procedure used for GSM authentication challenge</h4>
<p>The purpose of the authentication and ciphering procedure is threefold (see 3GPP TS 43.020 [13]):</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; to permit the network to check whether the identity provided by the MS is acceptable or not;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; to provide parameters enabling the MS to calculate a new GPRS GSM ciphering key; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; to let the network set the GSM ciphering mode (ciphering/no ciphering) and GSM ciphering algorithm.</p>
<p>The authentication and ciphering procedure can be used for either:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; authentication only;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; setting of the GSM ciphering mode and the GSM ciphering algorithm only; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; authentication and the setting of the GSM ciphering mode and the GSM ciphering algorithm.</p>
<p>The cases in which the authentication and ciphering procedure shall be used are defined in 3GPP&nbsp;TS&nbsp;42.009&nbsp;[5].</p>
<p>In A/Gb mode, the authentication and ciphering procedure is always initiated and controlled by the network. It shall be performed in a non ciphered mode because of the following reasons:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the network cannot decipher a ciphered AUTHENTICATION_AND_CIPHERING RESPONSE from an unauthorised MS and put it on the prohibited list; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; to be able to define a specific point in time from which on a new GPRS GSM ciphering key should be used instead of the old one.</p>
<p>GSM authentication challenge shall be supported by a ME supporting GERAN or UTRAN.</p>
<p>In A/Gb mode, the network should not send any user data during the authentication and ciphering procedure.</p>
<p>A GSM security context is established in the MS and the network when a GSM authentication challenge is performed in A/Gb mode or in Iu mode. However, in Iu mode the MS shall not accept a GSM authentication challenge, if a USIM is inserted. After a successful GSM authentication challenge, the GPRS GSM ciphering key and the GPRS ciphering key sequence number, are stored both in the network and the MS.</p>
<h4><a name="_Toc171524046"></a>4.7.7c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Change of the ciphering algorithm at PS Handover</h4>
<p>For PS handover to A/Gb mode (see subclause&nbsp;10.5.1.14 and 3GPP&nbsp;TS&nbsp;44.060&nbsp;[76]) the network shall either assign a GSM ciphering algorithm to be used in the target cell or deactivate ciphering in the target cell. The MS shall start to use the new GSM ciphering algorithm or deactivate ciphering upon an indication from the lower layers that the PS handover procedure has been successfully completed (see 3GPP&nbsp;TS&nbsp;44.060&nbsp;[76])</p>
<p>After PS handover to Iu mode (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]) the network shall activate integrity protection and shall either assign a ciphering algorithm to be used in the target cell or deactivate ciphering in the target cell, using the security mode control procedure (3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111]).</p>
<p>If the GSM ciphering algorithm is changed at PS handover and the routing area updating procedure triggered by the PS handover procedure is not accepted by the network, the MS shall delete any GPRS ciphering key sequence number and proceed as specified in subclauses&nbsp;4.7.5.1.4 and 4.7.5.2.4. If the routing area updating procedure fails, because the radio resources assigned in the new cell are released before the MS receives a ROUTING AREA UPDATE ACCEPT message, the MS shall delete any GPRS ciphering key sequence number and proceed as specified in subclauses&nbsp;4.7.5.1.5 item b and 4.7.5.2.5, respectively.</p>
<h4><a name="_Toc171524047"></a>4.7.7.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication and ciphering initiation by the network</h4>
<p>The network initiates the authentication and ciphering procedure by transferring an AUTHENTICATION_AND_CIPHERING REQUEST message across the radio interface and starts timer T3360. The AUTHENTICATION_AND_CIPHERING REQUEST message shall contain all parameters necessary to calculate the response parameters when authentication is performed (see 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13] and 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]).</p>
<p>If authentication is requested, then the AUTHENTICATION_AND_CIPHERING REQUEST message shall contain either:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; In a GSM authentication challenge, the GPRS ciphering key sequence number and the RAND, or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; In a UMTS authentication challenge, the GPRS ciphering key sequence number, the RAND and the AUTN.</p>
<p>In A/Gb mode, if authentication is not requested, then the AUTHENTICATION_AND_CIPHERING REQUEST message shall not contain neither the GPRS ciphering key sequence number, the RAND nor the AUTN.</p>
<p>In A/Gb mode, if ciphering is requested, in a GSM authentication challenge or in a UMTS authentication challenge, then the AUTHENTICATION_AND_CIPHERING REQUEST message shall indicate the GPRS GSM ciphering algorithm.</p>
<p>In A/Gb mode, an MS supporting integrity protection shall ignore a GSM authentication challenge from the network.</p>
<p>In A/Gb mode, in a UMTS authentication challenge, if the MS has indicated support for integrity protection in MS network capability IE included in the ATTACH REQUEST or ROUTING AREA UPDATE REQUEST message to the network, then if the network supports integrity protection then the network shall activate integrity protection in the MS (see subclause&nbsp;4.7.3.1.3 and subclause&nbsp;4.7.5.1.3). If the network does not activate integrity protection in the MS, then the MS shall detach from the network.</p>
<p>In A/Gb mode, if no UMTS security context is available in the network or if no common UMTS security context is available in the MS and the network, and if the MS has indicated support for integrity protection in MS network capability IE to the network, then an authentication and activation of integrity protection and setting of ciphering mode (enabled or disabled), shall take place in the same authentication and ciphering procedure. The network shall replay the MS network capability IE and the MS radio access capability IE received from the MS in the latest ATTACH REQUEST message or the latest ROUTING AREA UPDATE REQUEST message, by including the MS network capability IE and the MS radio access capability IE in the AUTHENTICATION AND CIPHERING REQUEST message to the MS. The network shall select one of the GPRS GSM integrity algorithms indicated in the MS network capability IE received from the MS in the latest ATTACH REQUEST message or ROUTING AREA UPDATE REQUEST message. The selected GPRS GSM integrity algorithm shall be included in the AUTHENTICATION AND CIPHERING REQUEST message. The network shall enable or disable ciphering and include the selected GPRS GSM ciphering algorithm if ciphering is enabled. If ciphering is enabled, then the network shall select one of the GPRS GSM ciphering algorithm indicated in the MS network capability IE received from the MS in the latest ATTACH REQUEST message or ROUTING AREA UPDATE REQUEST message.The network shall calculate a message authentication code for the AUTHENTICATION AND CIPHERING REQUEST message at the GMM layer with the new integrity key, GPRS GSM Kint key, indicated by the GPRS ciphering key sequence number included in the AUTHENTICATION AND CIPHERING REQUEST message. The new GPRS GSM Kint shall be calculated from the new UMTS security context established in the same procedure as described in the subclause&nbsp;4.7.7.3b. The AUTHENTICATION AND CIPHERING REQUEST message shall include the calculated message authentication code for integrity protection.</p>
<p>In A/Gb mode, if an established UMTS security context is available in the network and if the MS has indicated support for integrity protection in the MS network capability IE, when authentication takes place in the authentication and ciphering procedure (regardless whether a change of the integrity algorithm, ciphering algorithm or a change of ciphering mode takes place in the same procedure), then the network shall replay the MS network capability IE and the MS Radio Access Capability IE received from the MS in the latest ATTACH REQUEST message or the latest ROUTING AREA UPDATE REQUEST message, by including the MS network capability IE and the MS Radio Access Capability IE into the AUTHENTICATION AND CIPHERING REQUEST message to the MS. If a change of the GPRS GSM integrity algorithm takes place in the same procedure, then the network shall select one of the GPRS GSMintegrity algorithms indicated in the MS network capability IE received from the MS in the latest ATTACH REQUEST message or ROUTING AREA UPDATE REQUEST message. The selected GPRS GSM integrity algorithm shall be included into the AUTHENTICATION AND CIPHERING REQUEST message. If the network decides to change the ciphering mode or the ciphering algorithm or both, then if ciphering is enabled the network shall select one of the GPRS GSM ciphering algorithms indicated in the MS network capability IE received from the MS in the latest ATTACH REQUEST message or ROUTING AREA UPDATE REQUEST message. The network shall also include the ciphering mode or the selected GPRS GSM ciphering algorithm or both, if ciphering is enabled (Ciphering algorithm IE) in the AUTHENTICATION AND CIPHERING REQUEST message. The network calculates a message authentication code over the parameters included in the AUTHENTICATION AND CIPHERING REQUEST message at the GMM layer with the new integrity key GPRS GSM Kint indicated by the GPRS ciphering key sequence number included by the AUTHENTICATION AND CIPHERING REQUEST message. The new GPRS GSM Kint shall be calculated from the new UMTS security context established in the same procedure as described in the subclause&nbsp;4.7.7.3b. The AUTHENTICATION AND CIPHERING REQUEST message shall include the calculated message authentication code for integrity protection.</p>
<p>In A/Gb mode, if an established UMTS security context context is available in the network and if the MS has indicated support for integrity protection in the MS network capability IE to the network, and if integrity protection is in use, then if only a change of the integrity algorithm or ciphering algorithm or both, or a change of the ciphering mode, is requested in the authentication and ciphering procedure, then the AUTHENTICATION AND CIPHERING REQUEST message shall include the new GPRS GSM integrity algorithm or the new setting of the ciphering mode and the new GPRS GSM ciphering algorithm; that shall be taken into use.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The AUTHENTICATION AND CIPHERING REQUEST message is protected by a message authentication code in the LLC layer when no authentication takes place in the authentication and ciphering procedure.Therefore, no message authentication code shall be calculated and included by the GMM layer into this message when only an algorithm change takes place. In addition, there is no need to replay the MS network capability IE and the MS Radio Access Capability IE in the AUTHENTICATION AND CIPHERING REQUEST message when no authentication takes place as a valid UMTS security context is already established between the MS and network.</p>
<p>The network includes the A&amp;C reference number information element in the AUTHENTICATION AND CIPHERING REQUEST message. Its value is chosen in order to link an AUTHENTICATION AND CIPHERING REQUEST in a RA with its RESPONSE. The A&amp;C reference number value might be based on the RA Colour Code value.</p>
<p>Additionally, the network may request the MS to include its IMEISV in the AUTHENTICATION AND CIPHERING RESPONSE message.</p>
<h4><a name="_Toc171524048"></a>4.7.7.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication and ciphering response by the MS</h4>
<p>In A/Gb mode, an MS shall be ready to respond upon an AUTHENTICATION_AND_CIPHERING REQUEST message at any time.</p>
<p>In UMTS, an MS shall be ready to respond upon an AUTHENTICATION_AND_CIPHERING REQUEST message at any time whilst a PS signalling connection exists.</p>
<p>If a SIM is inserted in the MS, the MS shall ignore the Authentication Parameter AUTN IE if included in the AUTHENTICATION_AND_CIPHERING REQUEST message and perform the GSM authentication challenge. It shall not perform the authentication of the network described in subclause&nbsp;4.7.7.5.1.</p>
<p>In a GSM authentication challenge, if the AUTHENTICATION_AND_CIPHERING REQUEST message includes the authentication parameters RAND and GPRS CKSN, then upon receipt of the message, the MS processes the challenge information and sends an AUTHENTICATION_AND_CIPHERING RESPONSE message to the network. The value of the received A&amp;C reference number information element shall be copied into the A&amp;C reference number information element in the AUTHENTICATION_AND_CIPHERING RESPONSE message. A GSM authentication challenge will result in the SIM/USIM passing a SRES and a GPRS GSM ciphering key to the ME. The new GPRS GSM ciphering key calculated from the challenge information shall overwrite the previous one and any previously stored GPRS UMTS ciphering and GPRS UMTS integrity keys shall be deleted. The calculated GSM ciphering key shall be stored on the SIM/USIM together with the GPRS ciphering key sequence number before the AUTHENTICATION_AND_CIPHERING RESPONSE message is transmitted.</p>
<p>In a UMTS authentication challenge, if the AUTHENTICATION_AND_CIPHERING REQUEST message includes the UMTS authentication parameters GPRS CKSN, RAND and AUTN, then upon receipt of the message, the MS verifies the AUTN parameter and if this is accepted, the MS processes the challenge information and sends an AUTHENTICATION_AND_CIPHERING RESPONSE message to the network. The value of the received A&amp;C reference number information element shall be copied into the A&amp;C reference number information element in the AUTHENTICATION_AND_CIPHERING RESPONSE message. A UMTS authentication challenge will result in the USIM passing a RES, a GPRS UMTS ciphering key, a GPRS UMTS integrity key and a GPRS GSM ciphering key to the ME. The new GPRS UMTS ciphering key, GPRS UMTS integrity key and GPRS GSM ciphering key calculated from the challenge information shall overwrite the previous ones. The new GPRS UMTS ciphering key, GPRS UMTS integrity key and GPRS GSM ciphering key shall be stored on the USIM together with the GPRS ciphering key sequence number before the AUTHENTICATION_AND_CIPHERING RESPONSE message is transmitted. Furthermore, in A/Gb mode if a GEA ciphering algorithm that requires a 128-bit ciphering key is taken into use, then a new GPRS GSM Kc<sub>128</sub> shall also be calculated as described in the subclause&nbsp;4.7.7.3a.</p>
<p>In A/Gb mode, in a UMTS authentication challenge, if the MS supports integrity protection, then the MS shall ignore the GPRS GSM ciphering key received from the USIM and not store the GPRS GSM ciphering key in the ME or on the USIM.</p>
<p>In addition, in A/Gb mode, in a UMTS authentication challenge, if the MS has indicated support of integrity protection in the MS network capability IE to the network, and if an authentication takes place in the authentication and ciphering procedure, then a new GPRS GSM Kint shall also be calculated by the MS from the new UMTS security context derived from AKA as described in the subclause&nbsp;4.7.7.3b. The new GPRS GSM Kint shall be used by the MS to check and verify the message authentication code recived in the AUTHENTICATION AND CIPHERING REQUEST message as described in Annex H in 3GPP TS 43.020 [13]. If the integrity is successfully verified in the MS, then the MS shall check if the replayed MS network capability IE and replayed MS Radio Access Capability IE received in the AUTHENTICATION AND CIPHERING REQUEST message has not been altered compared to the latest MS network capability IE and the latest MS Radio Access Capability IE that the MS sent to the network. If the replayed MS network capability IE and the replayed MS Radio Access Capability IE received in the AUTHENTICATION AND CIPHERING REQUEST message are not the same as the latest MS network capability IE and the MS Radio Access Capability IE that the MS sent to the network, then the MS shall ignore the authentication and ciphering procedure. The network may in addition indicate a GPRS GSM integrity algorithm and a new setting of the ciphering mode and GPRS GSM ciphering algorithm, to be taken into use by the MS. If the integrity of the AUTHENTICATION AND CIPHERING REQUEST message is not successfully verified in the GMM layer, then the MS shall ignore the AUTHENTICATION AND CIPHERING REQUEST message.</p>
<p>In A/Gb mode, in a UMTS authentication challenge if the MS has no available UMTS security context and, if the MS has indicated support for integrity protection in MS network capability IE to the network, then if the network does not activate integrity protection by indicating a GPRS GSMintegrity algorithm or does not include a message authentication code to the MS in AUTHENTICATION AND CIPHERING REQUEST message, then the MS shall ignore the AUTHENTICATION AND CIPHERING REQUEST message.</p>
<p>In A/Gb mode, in a UMTS authentication challenge, if the MS has indicated support for integrity protection to the network and if the integrity of the AUTHENTICATION AND CIPHERING REQUEST message is successfully verified in the MS and the MS decides to reply by sending an AUTHENTICATION AND CIPHERING RESPONSE message to the network, then the MS shall integrity protect the AUTHENTICATION AND CIPHERING RESPONSE message by calculating an message authentication code at the GMM layer using the new integrity key GPRS GSM Kint calculated by the MS from the new UMTS security context derived from AKA as described in the subclause&nbsp;4.7.7.3b and as described in Annex H in 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13] and include the new message authentication code into the AUTHENTICATION AND CIPHERING RESPONSE message. When a successful authentication takes place on the USIM the GMM layer in the MS shall request the LLC layer to reset the IOV_updates counter to the value zero before sending the AUTHENTICATION AND CIPHERING RESPONSE message to the network.</p>
<p>In Iu mode, an MS not capable of A/Gb mode shall ignore the Ciphering Algorithm IE in the AUTHENTICATION_AND_CIPHERING REQUEST message. An MS capable of both Iu mode and A/Gb mode shall store the received value in the Ciphering Algorithm IE in the AUTHENTICATION_AND_CIPHERING REQUEST message until entering state GMM-DEREGISTERED, in order to use it at an inter system change to A/Gb mode. In A/Gb mode, an MS supporting integrity protection shall store the received value in the Ciphering Algorithm IE when entering GMM-DEREGISTERED and at MS power off as described in subclause&nbsp;4.7.7.3a.</p>
<p>If the AUTHENTICATION_AND_CIPHERING REQUEST message does not include neither the GSM authentication parameters (RAND and GPRS CKSN) nor the UMTS authentication parameters (RAND, AUTN and GPRS CKSN), then upon receipt of the message, the MS replies by sending an AUTHENTICATION_AND_CIPHERING RESPONSE message to the network.</p>
<p>In A/Gb mode, in the case of an established UMTS security context, if the MS has indicated support for integrity protection to the network, the network may only indicate a GPRS GSM integrity algorithm or a GPRS GSM ciphering algorithm or a change of ciphering mode setting in the AUTHENTICATION AND CIPHERING REQUEST message without re-authentication to the MS. The AUTHENTICATION AND CIPHERING REQUEST message shall include the new GPRS GSM integrity algorithm or the new GPRS GSM ciphering algorithm; or both, that shall be taken into use. When the MS receives this AUTHENTICATION AND CIPHERING REQUEST message without requiring a new authentication, then a new GPRS GSM Kint shall be calculated using the GPRS UMTS ciphering key and the GPRS UMTS integrity key from the already established UMTS security context stored in the ME as described in the subclause&nbsp;4.7.7.3b and a new GPRS GSM Kc<sub>128</sub> shall be calculated using the GPRS UMTS ciphering key and the GPRS UMTS integrity key from the already established UMTS security context stored in the ME as described in the subclause&nbsp;4.7.7.3a and the MS replies by sending an AUTHENTICATION AND CIPHERING RESPONSE message to the network.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If only a change of GPRS GSM integrity algorithm or GPRS GSM encryption algorithm or a change of both algorithms is included in the AUTHENTICATION AND CIPHERING RESPONSE message without authentication, then the MS shall not integrity protect the AUTHENTICATION AND CIPHERING RESPONSE message at GMM layer. The MS does therefore not calculate and include a message authentication code into the AUTHENTICATION AND CIPHERING RESPONSE message at GMM layer. These GMM messages are instead integrity protected at the LLC layer with current UMTS security context.</p>
<p>In A/Gb mode, the GMM layer shall notify the LLC layer if ciphering shall be used or not and if yes which GSM ciphering algorithm and GPRS GSM ciphering key that shall be used (see 3GPP TS 44.064 [78a]).</p>
<p>In A/Gb mode, if an established UMTS security context context is available in the network, if the MS has indicated support of integrity protection to the network, then the GMM layer in the MS shall assign the GPRS GSM integrity algorithm and the GPRS GSM Kint integrity key to the LLC layer after it has sent off the AUTHENTICATION AND CIPHERING RESPONSE message to the network (see 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13] and 3GPP&nbsp;TS&nbsp;44.064&nbsp;[78a]).</p>
<p>A ME supporting UMTS authentication challenge shall support the following procedure:</p>
<p>In order to avoid a synchronisation failure, when the mobile station receives an AUTHENTICATION AND CIPHERING REQUEST message, the mobile station shall store the received RAND together with the RES returned from the USIM in the volatile memory and associate it with the PS domain. When the MS receives a subsequent AUTHENTICATION AND CIPHERING REQUEST message, if the stored RAND value for the PS domain is equal to the new received value in the AUTHENTICATION AND CIPHERING REQUEST message, then the mobile station shall not pass the RAND to the USIM, but shall immediately send the AUTHENTICATION AND CIPHERING RESPONSE message with the stored RES for the PS domain. If, for the PS domain, there is no valid stored RAND in the mobile station or the stored RAND is different from the new received value in the AUTHENTICATION AND CIPHERING REQUEST message, the mobile station shall pass the RAND to the USIM, shall override any previously stored RAND and RES with the new ones and start, or reset and restart timer T3316.</p>
<p>The RAND and RES values stored in the mobile station shall be deleted and timer T3316, if running, shall be stopped:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; upon receipt of a SECURITY MODE COMMAND (Iu mode only),<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SERVICE ACCEPT (Iu mode only),<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SERVICE REJECT (Iu mode only),<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ROUTING AREA UPDATE_ACCEPT<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; or AUTHENTICATION AND CIPHERING REJECT message;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; upon expiry of timer T3316;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the mobile station enters the GMM states GMM-DEREGISTERED or GMM-NULL; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the mobile station enters PMM-IDLE mode (Iu mode only).</p>
<h4><a name="_Toc171524049"></a>4.7.7.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication and ciphering completion by the network</h4>
<p>Upon receipt of the AUTHENTICATION AND CIPHERING RESPONSE message, the network stops the timer T3360 and checks the validity of the response (see 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13] and 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]). For this, it may use the A&amp;C reference number information element within the AUTHENTICATION AND CIPHERING RESPONSE message to determine whether the response is correlating to the last request that was sent.</p>
<p>In A/Gb mode, in a UMTS authentication challenge if the MS has indicated support of integrity protection to the network and if the AUTHENTICATION AND CIPHERING REQUEST message authentication, then the network shall check and verify the message authentication code received in the AUTHENTICATION AND CIPHERING RESPONSE message from the MS by using the new integrity key GPRS GSM Kint derived from the new UMTS security context as described in subclause&nbsp;4.7.7.3b and annex&nbsp;H in 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13]. When a successful authentication takes place after a successful verification of the RES and the message authentication code received in the AUTHENTICATION AND CIPHERING RESPONSE message from the MS, the GMM layer in the network shall indicate this successful authentication to the LLC layer. If the check and verification of the message authentication code included in the AUTHENTICATION AND CIPHERING RESPONSE message fails in the network, then the network shall ignore the GMM message. If the AUTHENTICATION AND CIPHERING RESPONSE message is received in the network without a message authentication code then the network shall silently discard the GMM message.</p>
<p>In A/Gb mode, in the case of an established GSM security context, the GMM layer shall notify the LLC sublayer if ciphering shall be used or not. Furthermore, if ciphering shall be used, then the GMM layer shall also notify the LLC sublayer which GEA algorithm and GPRS GSM ciphering key that shall be used (see 3GPP&nbsp;TS&nbsp;44.064&nbsp;[78a]).</p>
<p>In A/Gb mode, in the case of an established UMTS security context, the GMM layer shall notify the LLC sublayer if ciphering shall be used or not. Furthermore, if ciphering shall be used, then the GMM layer shall also notify the LLC sublayer which GEA algorithm and which ciphering key (i.e. GPRS GSM ciphering key or GPRS GSM Kc<sub>128</sub>) that shall be used (see 3GPP&nbsp;TS&nbsp;44.064&nbsp;[78a]). If the network has selected a GEA ciphering algorithm that requires a 128-bit ciphering key, then the ME shall derive a GPRS GSM Kc<sub>128</sub> as described in the subclause&nbsp;4.7.7.3a.</p>
<p>In A/Gb mode, if an established UMTS security context context is available in the network, if the MS has indicated support of integrity protection to the network, the GMM layer in the network shall assign the GPRS GSM integrity algorithm and the GPRS GSM Kint integrity key to the LLC layer, after it has received the AUTHENTICATION AND CIPHERING RESPONSE message from the MS (see 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13] and 3GPP&nbsp;TS&nbsp;44.064[78a]).</p>
<p>Upon receipt of the AUTHENTICATION AND CIPHERING FAILURE message, the network stops the timer T3360. In Synch failure case, the core network may renegotiate with the HLR/AuC and provide the MS with new authentication parameters.</p>
<h4><a name="_Toc171524050"></a>4.7.7.3a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 128-bit packet-switched GSM ciphering key</h4>
<p>The ME and the network may derive and store a 128-bit packet-switched GSM key or GPRS GSM Kc<sub>128 </sub>from an established UMTS security context. If the GPRS GSM Kc<sub>128</sub> exits, then it is also part of the UMTS security context.</p>
<p>The ME with a USIM in use shall compute a new GPRS GSM Kc<sub>128</sub> using the GPRS UMTS ciphering key and the GPRS UMTS integrity key from an established UMTS security context as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. The new GPRS GSM Kc<sub>128</sub> shall be stored only in the ME. The ME shall overwrite the existing GPRS GSM Kc<sub>128</sub> with the new GPRS GSM Kc<sub>128</sub>. The ME shall delete the GPRS GSM Kc<sub>128</sub> at switch off, when the USIM is disabled as well as under the conditions identified in the subclause&nbsp;4.1.3.2&nbsp;and&nbsp;4.7.7.4. The ME with a USIM in use shall apply the GPRS GSM Kc<sub>128</sub> when in A/Gb mode a GEA ciphering algorithm that requires a 128-bit ciphering key is taken into use.</p>
<p>The network shall compute the GPRS GSM Kc<sub>128</sub> using the GPRS UMTS integrity key and the GPRS UMTS ciphering key from an established UMTS security context as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a] only when in A/Gb mode a GEA ciphering algorithm that requires a 128-bit ciphering key is to be used.</p>
<p>In A/Gb mode, if the MS supports integrity protection, the information in the Ciphering Algorithm IE together with the IMSI from the USIM shall be stored in a non-volatile memory in the ME at MS power off. The information stored in the Ciphering Algorithm IE can only be used if the IMSI from the USIM matches the IMSI stored in the ME non-volatile memory at MS power on; otherwise the MS shall delete the Ciphering Algorithm IE.</p>
<h4><a name="_Toc171524051"></a>4.7.7.3b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 128-bit packet-switched GSM integrity key (in A/Gb mode and only if MS supports integrity protection)</h4>
<p>The ME and the network may derive and store a 128-bit packet-switched GPRS GSM Kint from an established UMTS security context. If the GPRS GSM Kint exits, then it is also part of the UMTS security context.</p>
<p>The ME with a USIM in use shall compute a new GPRS GSM Kint using the GPRS UMTS ciphering key and the GPRS UMTS integrity key from an established UMTS security context as specified in 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13]. The new GPRS GSM Kint shall be stored only in the ME. The ME shall overwrite the existing GPRS GSM Kint with the new GPRS GSM Kint. The ME shall delete the GPRS GSM Kint at MS switch off, when the USIM is disabled as well as under the conditions identified in the subclause&nbsp;4.1.3.2&nbsp;and&nbsp;4.7.7.4. The ME with a USIM in use shall apply the GPRS GSM Kint when in A/Gb mode a GIA integrityg algorithm that requires a 128-bit integrity key is taken into use.</p>
<p>The network shall compute the GPRS GSM Kint using the GPRS UMTS integrity key and the GPRS UMTS ciphering key from an established UMTS security context as specified in 3GPP&nbsp;TS&nbsp;43.020&nbsp;[13]only when in A/Gb mode a GIA integrity algorithm that requires a 128-bit integrity key is to be used.</p>
<p>At MS power off, the information in the Integrity Algorithm IE shall be stored in a non-volatile memory in the ME together with the IMSI from the USIM. The information stored in the Integrity Algorithm IE can only be used if the IMSI from the USIM matches the IMSI stored in the ME non-volatile memory at MS power on; otherwise the MS shall delete the Integrity Algorithm IE.</p>
<h4><a name="_Toc171524052"></a>4.7.7.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS ciphering key sequence number</h4>
<p>The security parameters for authentication and ciphering are tied together in sets.</p>
<p>In a GSM authentication challenge, from a challenge parameter RAND both the authentication response parameter SRES and the GPRS GSM ciphering key can be computed given the secret key associated to the IMSI.</p>
<p>In a UMTS authentication challenge, from a challenge parameter RAND, the authentication response parameter RES and the GPRS UMTS ciphering key and the GPRS UMTS integrity key can be computed given the secret key associated to the IMSI. Furthermore, in the USIM a GPRS GSM ciphering key can be computed from the GPRS UMTS integrity key and the GPRS UMTS ciphering key by means of an unkeyed conversion function. Furthermore, in A/Gb mode if a GEA ciphering algorithm that requires a 128-bit ciphering key is taken into use, then a GPRS GSM Kc<sub>128</sub> shall also be calculated as described in the subclause&nbsp;4.7.7.3a. Furthermore, in A/Gb mode, if the MS and the network support integrity protection, when a GIA integrity algorithm that requires a 128-bit integrity key is taken into use, then a GPRS GSM Kint shall also be calculated as described in the subclause&nbsp;4.7.7.3b.</p>
<p>In order to allow start of ciphering on a logical link without authentication, GPRS ciphering key sequence numbers are introduced.</p>
<p>The GPRS ciphering key sequence number is managed by the network such that the AUTHENTICATION AND&nbsp;CIPHERING REQUEST message contains the GPRS ciphering key sequence number allocated to the GPRS GSM ciphering key (in case of a GSM authentication challenge) or the GPRS UMTS ciphering key and the GPRS UMTS integrity key (in case of a UMTS authentication challenge) which may be computed from the RAND parameter carried in that message.</p>
<p>If an authentication and ciphering procedure has been completed successfully and a GPRS ciphering key sequence number is stored in the network, the network shall include a different GPRS ciphering key sequence number in the AUTHENTICATION AND&nbsp;CIPHERING REQUEST message when it intiates a new authentication and ciphering procedure.</p>
<p>If a GPRS ciphering key sequence number is contained in the first message during a GMM procedure, the network shall include a different GPRS ciphering key sequence number in the AUTHENTICATION_AND_CIPHERING REQUEST message when it initiates an authentication and ciphering procedure.</p>
<p>The MS stores the GPRS ciphering key sequence number with the GPRS GSM ciphering key (in case of a GSM authentication challenge) and the GPRS UMTS ciphering key and the GPRS UMTS integrity key (in case of a UMTS authentication challenge), and includes the corresponding GPRS ciphering key sequence number in the ROUTING AREA UPDATE REQUEST, SERVICE REQUEST and ATTACH REQUEST messages.</p>
<p>If the GPRS ciphering key sequence number is deleted, the associated GPRS GSM ciphering key, GPRS UMTS ciphering key, GPRS UMTS integrity key, GPRS GSM Kc<sub>128</sub> and GPRS GSM Kint shall be deleted if any (i.e. the established GSM security context or the UMTS security context is no longer valid).</p>
<p>In Iu mode, the network may choose to start ciphering and integrity checking with the stored GPRS UMTS ciphering key and the stored GPRS UMTS integrity key (under the restrictions given in 3GPP&nbsp;TS&nbsp;42.009&nbsp;[5] and 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]) if the stored GPRS ciphering key sequence number and the one given from the MS are equal.</p>
<p>In A/Gb mode, the network may choose to start ciphering with the stored GPRS GSM ciphering key or GPRS GSM Kc<sub>128</sub> (under the restrictions given in 3GPP&nbsp;TS&nbsp;42.009&nbsp;[5]) if the stored GPRS ciphering key sequence number and the one given from the MS are equal and the previously negotiated ciphering algorithm is known and supported in the network. When ciphering is requested at GPRS attach, the authentication and ciphering procedure shall be performed since the MS does not store the ciphering algorithm after entering state GMM-DEREGISTERED.</p>
<p>NOTE 1:&nbsp; The decision of starting ciphering with the GPRS GSM ciphering key or the GPRS GSM Kc<sub>128</sub> depends on whether the network indicates in the AUTHENTICATION AND CIPHERING REQUEST message a GEA ciphering algorithm which requires a 64 or 128-bit ciphering key as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a].</p>
<p>In A/Gb mode, if MS indicates support of integrity protection in the MS network capability IE to the network, if the ME has a Integrity Algorithm IE and a Ciphering Algorithm IE stored in the ME non-volatile memory at MS power on, then the GMM layer shall calculate a GPRS GSM Kint key as described in subclause&nbsp;4.7.7.3b and a GPRS GSM Kc<sub>128 </sub>key as described in subclause&nbsp;4.7.7.3a and indicate to the LLC layer before sending the ATTACH REQUEST message that LLC layer shall start integrity protection with the indicated GPRS GSM Kint key and the integrity algorithm (indicated in the stored Integrity Algorithm IE). The GMM layer shall also assign the GPRS GSM Kc<sub>128 </sub>key and the ciphering algorithm (indicated in the stored Ciphering Algorithm IE) to the LLC layer. The network shall start integrity protection in the LLC layer after reception of the ATTACH REQUEST message with the stored GPRS GSM Kint and the integrity algorithm identified by the stored GPRS GSMintegrity algorithm used when UE was previously attached if the GPRS GSMintegrity algorithm is known and supported in the network, and if the stored GPRS ciphering key sequence number and the one given from the MS are equal.</p>
<p>Upon GPRS attach, if ciphering is to be used, an AUTHENTICATION AND CIPHERING REQUEST message shall be sent to the MS to start ciphering. In A/Gb mode, upon GPRS attach, if the MS and network supports integrity protection, then the network may choose to start ciphering with the stored GPRS GSM ciphering key or GPRS GSM Kc<sub>128</sub> (under the restrictions given in 3GPP&nbsp;TS&nbsp;42.009&nbsp;[5]) if the stored GPRS ciphering key sequence number and the one given from the MS in the ATTACH REQUEST message or ROUTING AREA UPDATE REQUEST message are equal and the previously negotiated ciphering algorithm is known and supported in the network, without initiating a authentication and ciphering procedure.</p>
<p>If the GPRS ciphering key sequence number stored in the network does not match the GPRS ciphering key sequence number received from the MS in the ATTACH REQUEST message, then the network should authenticate the MS.</p>
<p>In A/Gb mode, the MS starts ciphering after sending the AUTHENTICATION AND CIPHERING RESPONSE message. The network starts ciphering when a valid AUTHENTICATION AND CIPHERING RESPONSE is received from the MS.</p>
<p>In Iu mode, the MS starts ciphering and integrity checking according to the conditions specified in specification 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c].</p>
<p>In A/Gb mode, as an option, the network may decide to continue ciphering without sending an AUTHENTICATION AND CIPHERING REQUEST message after receiving a ROUTING AREA UPDATE REQUEST message with a valid GPRS ciphering key sequence number. Both the MS and the network shall use the latest ciphering parameters. The network starts ciphering when sending the ciphered ROUTING AREA UPDATE ACCEPT message to the MS. The MS starts ciphering after receiving a valid ciphered ROUTING AREA UPDATE ACCEPT message from the network.</p>
<p>NOTE 2:&nbsp; In some specifications the term KSI (Key Set Identifier) is used instead of the term GPRS ciphering key sequence number.</p>
<h4><a name="_Toc171524053"></a>4.7.7.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication not accepted by the network</h4>
<p>If the authentication response (RES or SRES) is not valid, the network response depends upon the type of identity used by the MS in the first message:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the P-TMSI has been used, the network may decide to initiate the identification procedure. If the IMSI given by the MS differs from the one the network had associated with the P-TMSI, the authentication should be restarted with the correct parameters. If the IMSI provided by the MS is the expected one (i.e. authentication has really failed), the network should send an AUTHENTICATION AND CIPHERING REJECT message to the mobile station.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the IMSI has been used, or the network decides not to try the identification procedure, an AUTHENTICATION AND CIPHERING REJECT message should be transferred to the MS.</p>
<p>Upon receipt of an AUTHENTICATION AND CIPHERING REJECT message,</p>
<ol>
<li>a) if the message has been successfully integrity checked by the lower layers, the MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number stored. If available, also the TMSI, LAI and ciphering key sequence number shall be deleted and the update status shall be set to U3 ROAMING NOT ALLOWED. The SIM/USIM shall be considered as invalid until switching off or the SIM/USIM is removed. If the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value. If the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported by the MS, the MS shall in addition handle the EMM parameters EMM state, EPS update status, last visited registered TAI, TAI list, GUTI and KSI<sub>ASME</sub> as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when an EPS authentication is not accepted by the network.</p>
<ol start="4">
<li>b) if the message is received without integrity protection, then the MS shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see subclause&nbsp;4.1.1.6A). Additionally, the MS shall:</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the MS maintains a counter for "SIM/USIM considered invalid for GPRS services" events and the counter has a value less than an MS implementation-specific maximum value, proceed as specified in subclause&nbsp;4.1.1.6A, list item 6.a) for the case an ATTACH REJECT or ROUTING AREA UPDATE REJECT message is received without integrity protection; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; otherwise proceed as specified under list item a) above for the case that the message has been successfully checked by the lower layers.</p>
<p>List item b) above is also applicable, if the message is received in A/Gb mode.</p>
<p>If the AUTHENTICATION AND CIPHERING REJECT message is received, the MS shall abort any GMM procedure, shall stop any of the retransmission timers that are running (e.g. T3310, T3317, T3330, T3321, T3318 or T3320 and shall enter state GMM-DEREGISTERED.</p>
<p>In UTRAN Iu mode, depending on local regulations or operator preference for emergency bearer services, if the MS has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services, the SGSN need not follow the procedures specified for the authentication failure in the present subclause, the SGSN can continue with the ongoing GMM specific procedure or Session Management procedure. Upon completion of the GMM procedure or Session management procedure, the SGSN shall deactivate all non-emergency PDP contexts, if any, by initiating a PDP context deactivation procedure. The network shall consider the MS to be attached for emergency bearer services only.</p>
<h5><a name="_Toc171524054"></a>4.7.7.5.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Authentication not accepted by the MS</h5>
<p>In a UMTS authentication challenge, the authentication procedure is extended to allow the MS to check the authenticity of the core network. Thus allowing, for instance, detection of false base station.</p>
<p>Following a UMTS authentication challenge, the MS may reject the core network, on the grounds of an incorrect AUTN parameter (see 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]). This parameter contains two possible causes for authentication failure:</p>
<ol>
<li>a) MAC code failure</li>
</ol>
<p>If the MS considers the MAC code (supplied by the core network in the AUTN parameter) to be invalid, it shall send a AUTHENTICATION AND CIPHERING FAILURE message to the network, with the GMM cause 'MAC failure'. The MS shall then follow the procedure described in subclause&nbsp;4.7.7.6 (f).</p>
<ol>
<li>b) SQN failure</li>
</ol>
<p>If the MS considers the SQN (supplied by the core network in the AUTN parameter) to be out of range, it shall send a AUTHENTICATION AND CIPHERING FAILURE message to the network, with the GMM cause 'Synch failure' and the re-synchronization token AUTS provided by the USIM (see 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]). The MS shall then follow the procedure described in subclause&nbsp;4.7.7.6 (g).</p>
<p>In Iu mode, an MSwith a USIM inserted shall reject the authentication challenge if no Authentication Parameter AUTN IE was present in the AUTHENTICATION REQUEST message (i.e. a GSM authentication challenge has been received when the MS expects a UMTS authentication challenge). In such a case, the MS shall send the AUTHENTICATION AND CIPHERING FAILURE message to the network, with the GMM cause 'GSM authentication unacceptable&rsquo;. The MS shall then follow the procedure described in subclause&nbsp;4.7.7.6 (f).</p>
<p>If the MS returns an AUTHENTICATION_AND_CIPHERING_FAILURE message to the network, the MS shall delete any previously stored RAND and RES and shall stop timer T3316, if running.</p>
<p>If the MS has a PDN connection for emergency bearer services established or is establishing such a PDN connection, additional MS requirements are specified in subclause&nbsp;4.7.7.6, under "for items f and g".</p>
<h4><a name="_Toc171524055"></a>4.7.7.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases</h4>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) Lower layer failure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon detection of a lower layer failure before the AUTHENTICATION AND CIPHERING RESPONSE message is received, the network shall abort the procedure.</p>
<ol>
<li>b) Expiry of timer T3360</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The network shall, on the first expiry of the timer T3360, retransmit the AUTHENTICATION AND CIPHERING REQUEST message and shall reset and start timer T3360. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3360, the procedure shall be aborted.</p>
<ol>
<li>c) Collision of an authentication and ciphering procedure with a GPRS attach procedure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives an ATTACH REQUEST message before the ongoing authentication procedure has been completed and no GPRS attach procedure is pending on the network (i.e. no ATTACH ACCEPT/REJECT message has to be sent as an answer to an ATTACH REQUEST message), the network shall abort the authentication and ciphering procedure and proceed with the new GPRS attach procedure.</p>
<ol>
<li>d) Collision of an authentication and ciphering procedure with a GPRS attach procedure when the authentication and ciphering procedure has been caused by a previous GPRS attach procedure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives an ATTACH REQUEST message before the ongoing authentication procedure has been completed and a GPRS attach procedure is pending (i.e. an ATTACH ACCEPT/REJECT message has still to be sent as an answer to an earlier ATTACH REQUEST message), then:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If one or more of the information elements in the ATTACH REQUEST message differs from the ones received within the previous ATTACH REQUEST message, the network shall not treat the authentication any further and proceed with the GPRS attach procedure; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the information elements do not differ, then the network shall not treat any further this new ATTACH REQUEST message.</p>
<p>d1) Collision of an authentication and ciphering procedure with a GPRS detach procedure</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing cause "power off":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a DETACH REQUEST message before the ongoing authentication and ciphering procedure has been completed, the network shall abort the authentication and ciphering procedure and shall progress the GPRS detach procedure.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing other causes than "power off":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a DETACH REQUEST message before the ongoing authentication and ciphering procedure has been completed, the network shall complete the authentication and ciphering procedure and shall respond to the GPRS detach procedure as described in subclause&nbsp;4.7.4.</p>
<ol>
<li>e) Collision of an authentication and ciphering procedure with a routing area updating procedure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a ROUTING AREA UPDATE REQUEST message before the ongoing authentication procedure has been completed, the network shall progress both procedures.</p>
<p>Figure 4.7.7/1 3GPP TS 24.008: Authentication and ciphering procedure</p>
<p>(f)&nbsp; Authentication failure (GMM cause #18 "MAC failure" or #21 "GSM authentication unacceptable")</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall send an AUTHENTICATION AND CIPHERING FAILURE message, with GMM cause 'MAC failure&rsquo; or 'GSM authentication unacceptable&rsquo; according to subclause&nbsp;4.7.7.5.1, to the network and start timer T3318. Furthermore, the MS shall stop any of the retransmission timers that are running (e.g. T3310, T3321, T3330 or T3317). Upon the first receipt of an AUTHENTICATION AND CIPHERING FAILURE message from the MS with GMM cause 'MAC failure&rsquo; or 'GSM authentication unacceptable&rsquo; the network may initiate the identification procedure described in subclause&nbsp;4.7.8. This is to allow the network to obtain the IMSI from the MS. The network may then check that the P-TMSI originally used in the authentication challenge corresponded to the correct IMSI. Upon receipt of the IDENTITY REQUEST message from the network, the MS shall send the IDENTITY RESPONSE message.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon receipt of an AUTHENTICATION AND CIPHERING FAILURE message from the MS with reject cause "MAC failure" or "GSM authentication unacceptable", the network may also terminate the authentication procedure (see subclause&nbsp;4.7.7.5).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the P-TMSI/IMSI mapping in the network was incorrect, the network should respond by sending a new AUTHENTICATION AND CIPHERING REQUEST message to the MS. Upon receiving the new AUTHENTICATION AND CIPHERING REQUEST message from the network, the MS shall stop timer T3318, if running, and then process the challenge information as normal. If the P-TMSI/IMSI mapping in the network was correct, the network should terminate the authentication and ciphering procedure by sending an AUTHENTICATION AND CIPHERING REJECT message.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network is validated successfully (an AUTHENTICATION AND CIPHERING REQUEST message that contains a valid SQN and MAC is received), the MS shall send the AUTHENTICATION AND CIPHERING RESPONSE message to the network and shall start any retransmission timers (e.g. T3310, T3321, T3330 or T3317), if they were running and stopped when the MS received the first failed AUTHENTICATION AND CIPHERING REQUEST message.</p>
<p>If the MS receives the second AUTHENTICATION AND CIPHERING REQUEST message while T3318 is running and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MAC value cannot be resolved; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the message was received in UMTS and contains a GSM authentication challenge,</p>
<p>the MS shall follow the procedure specified in this subclause (f), starting again from the beginning. If the SQN is invalid, the MS shall proceed as specified in (g).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; It can be assumed that the source of the authentication challenge is not genuine (authentication not accepted by the MS) if any of the following occurs:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the timer T3318 expires;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS detects any combination of the authentication failures: "MAC failure", "invalid SQN", and "GSM authentication unacceptable", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only, if the authentication challenges causing the second and third authentication failure are received by the MS, while the timer T3318 or T3320 started after the previous authentication failure is running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer T3318, if the timer is running and the MS detects a lower layer failure, the network releases the PS signalling connection, the MS performs inter-system change to S1 mode, or the MS initiates a GPRS suspension procedure (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84]).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; When it has been deemed by the MS that the source of the authentication challenge is not genuine (authentication not accepted by the MS), the MS shall behave as described in subclause&nbsp;4.7.7.6.1.</p>
<p>&nbsp;</p>
<p>Figure 4.7.7a/1 3GPP TS 24.008: Authentication failure cause "MAC failure" or "GSM authentication unacceptable"</p>
<p>(g) Authentication failure (GMM cause #19 "Synch failure"):</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall send an AUTHENTICATION AND CIPHERING FAILURE message, with the GMM cause "Synch failure", to the network and start the timer T3320. Furthermore, the MS shall stop any of the retransmission timers that are running (e.g. T3310, T3321, T3330 or T3317). Upon the first receipt of an AUTHENTICATION AND CIPHERING message from the MS with the GMM cause "synch failure", the network shall use the returned AUTS parameter from the authentication &amp; ciphering failure parameter IE in the AUTHENTICATION AND CIPHERING FAILURE message, to re-synchronise. The re-synchronisation procedure requires the SGSN to delete all unused authentication vectors for that IMSI and obtain new vectors from the HLR. When re-synchronisation is complete, the network shall initiate the authentication &amp; ciphering procedure. Upon receipt of the AUTHENTICATION AND CIPHERING REQUEST message, the MS shall stop timer T3320, if running.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon receipt of two consecutive AUTHENTICATION AND CIPHERING FAILURE messages from the MS with reject cause "synch failure", the network may terminate the authentication procedure by sending an AUTHENTICATION AND CIPHERING REJECT message.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network is validated successfully (a new AUTHENTICATION AND CIPHERING REQUEST message is received which contains a valid SQN and MAC) while T3320 is running, the MS shall send the AUTHENTICATION AND CIPHERING RESPONSE message to the network and shall start any retransmission timers (i.e. T3310, T3321, T3330 or T3317), if they were running and stopped when the MS received the first failed AUTHENTICATION AND CIPHERING REQUEST message.</p>
<p>If the MS receives the second AUTHENTICATION AND CIPHERING REQUEST message while T3320 is running and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MAC value cannot be resolved; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the message was received in Iu mode and contains a GSM authentication challenge,</p>
<p>the MS shall proceed as specified in (f). If the SQN is invalid, the MS shall follow the procedure specified in this subclause (g), starting again from the beginning.</p>
<p>The MS shall deem that the network has failed the authentication check and behave as described in subclause&nbsp;4.7.7.6.1, if any of the following occurs:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the timer T3320 expires;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS detects any combination of the authentication failures: "MAC failure", "invalid SQN", and "GSM authentication unacceptable", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only, if the authentication challenges causing the second and third authentication failure are received by the MS, while the timer T3318 or T3320 started after the previous authentication failure is running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer T3320, if the timer is running and the MS detects a lower layer failure, the network releases the PS signalling connection, the MS performs inter-system change to S1 mode, or the MS initiates a GPRS suspension procedure (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84]).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; When it has been deemed by the MS that the source of the authentication challenge is not genuine (authentication not accepted by the MS), the MS shall behave as described in subclause&nbsp;4.7.7.6.1.</p>
<p>Figure 4.7.7b/1 3GPP TS 24.008: Authentication failure cause 'Synch failure&rsquo;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon receipt of an AUTHENTICATION AND CIPHERING REJECT message, the UE shall perform the actions as specified in subclause&nbsp;4.7.7.5.</p>
<p>For items&nbsp;f and g:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Depending on local requirements or operator preference for emergency bearer services, if the MS has a PDN connection for emergency bearer services established or is establishing such a PDN connection, the SGSN need not follow the procedures specified for the authentication failure specified in the present subclause and shall continue using the current security context, if any. The SGSN shall deactivate all non-emergency PDP contexts, if any, by initiating a PDP context deactivation procedure. If there is an ongoing session management procedure, the SGSN shall deactivate all non-emergency PDP contexts upon completion of the session management procedure. The network shall consider the MS to be attached for emergency bearer services only.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If an MS has a PDN connection for emergency bearer services established or is establishing such a PDN connection when timer T3318 or T3320 expires, the MS shall not deem that the network has failed the authentication check and not behave as described in subclause&nbsp;4.7.7.6.1. Instead the MS shall continue using the current security context, if any. The MS shall deactivate all non-emergency PDP contexts, if any, by initiating a PDP context deactivation procedure. If there is an ongoing session management procedure, the MS shall deactivate all non-emergency PDP contexts upon completion of the session management procedure. The MS shall start any retransmission timers (e.g. T3310, T3317, T3321 or T3330) if:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; they were running and stopped when the MS received the AUTHENTICATION AND CIPHERING REJECT message and detected an authentication failure; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the procedures associated with these timers have not yet been completed.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall consider itself to be attached for emergency bearer services only.</p>
<h5><a name="_Toc171524056"></a>4.7.7.6.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MS behaviour towards a network that has failed the authentication procedure</h5>
<p>If the MS deems that the network has failed the authentication check, then it shall request RR or RRC to release the RR connection and the PS signalling connection, if any, and bar the active cell or cells (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84]). The MS shall start any retransmission timers (i.e. T3310, T3321, T3330 or T3317), if they were running and stopped when the MS received the first AUTHENTICATION AND CIPHERING REQUEST message containing an invalid MAC or invalid SQN, or no AUTN when a UMTS authentication challenge was expected.</p>
<h4><a name="_Toc171524057"></a>4.7.7.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Use of established security contexts</h4>
<p>In A/Gb mode, in the case of an established GSM security context, the GPRS GSM ciphering key shall be taken into use by the MS before the AUTHENTICATION AND CIPHERING RESPONSE message is transmitted.</p>
<p>In A/Gb mode, in the case of an established UMTS security context, and if the network indicates in the AUTHENTICATION AND CIPHERING REQUEST message to the MS that a GEA ciphering algorithm that requires a 64-bit ciphering key shall be taken into use, then the GPRS GSM ciphering key shall be taken into use by the MS before the AUTHENTICATION AND CIPHERING RESPONSE message is transmitted. The network shall derive a GPRS GSM ciphering key from the GPRS UMTS ciphering key and the GPRS UMTS integrity key, by using the conversion function named "c3" defined in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a].</p>
<p>In A/Gb mode, in the case of an established UMTS security context, and if the network indicates in the AUTHENTICATION AND CIPHERING REQUEST message to the MS that a GEA ciphering algorithm that requires a 128-bit ciphering key shall be taken into use, then the MS shall take the following actions:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if authentication is not requested and a GEA ciphering algorithm that requires 64-bit ciphering key is in use, the MS shall take into use the GPRS GSM Kc<sub>128</sub> derived by the ME from the GPRS UMTS ciphering key and GPRS UMTS integrity key of the established UMTS security context in use (see 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]) before the AUTHENTICATION AND CIPHERING RESPONSE message is transmitted;.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if authentication is not requested and a GEA ciphering algorithm that requires 128-bit ciphering key is in use, the GPRS GSM Kc<sub>128</sub> of the established UMTS security context in use still applies;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; otherwise, the MS shall take into use the GPRS GSM Kc<sub>128</sub> derived by the ME from the GPRS UMTS ciphering key and the GPRS UMTS integrity key provided by the USIM during the latest successful authentication procedure (see subclause 4.7.7.3a) before the AUTHENTICATION AND CIPHERING RESPONSE message is transmitted.</p>
<p>In A/Gb mode, in the case of an established UMTS security context, and if the network indicates in the AUTHENTICATION AND CIPHERING REQUEST message to the MS that a GEA ciphering algorithm that requires a 128-bit ciphering key shall be taken into use, then the network shall derive a GPRS GSM Kc<sub>128</sub> (see subclause&nbsp;4.7.7.3a).</p>
<p>In A/Gb mode, if an established UMTS security context context is available in the network, if the MS indicates support of integrity protection to the network and the network supports integrity protection, if the network indicates in the AUTHENTICATION AND CIPHERING REQUEST message to the MS that a new GPRS GSM integrity algorithm shall be taken into use but no authentication is requested, then the GPRS GSM Kint of the established UMTS security context in use still applies in the MS and network.</p>
<p>In A/Gb mode, in the case of an established UMTS security context, and if the network indicates in the AUTHENTICATION AND CIPHERING REQUEST message to the MS that a GIA integrity protection algorithm that requires a 128-bit integrity key shall be taken into use but no authentication is requested, then the GPRS GSM Kint of the established UMTS security context in use still applies in the MS.</p>
<p>In A/Gb mode, if during an ongoing, already ciphering protected RR connection, the network initiates a new Authentication and ciphering procedure, the new GPRS GSM ciphering key or GPRS GSM Kc<sub>128</sub> shall be taken into use by the MS before the AUTHENTICATION AND CIPHERING RESPONSE message is transmitted. In case of inter-system change to Iu mode after receipt of the AUTHENTICATION AND CIPHERING REQUEST message, the MS and the network shall take the new keys into use immediately after the inter-system change.</p>
<p>In Iu mode, in the case of an established GSM security context, the ME shall derive a GPRS UMTS ciphering key and a GPRS UMTS integrity key from the GPRS GSM ciphering key by using the conversion functions named "c4" and "c5" defined in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]. The derived GPRS UMTS ciphering key and GPRS UMTS integrity key shall be taken into use by the MS when a valid SECURITY MODE COMMAND message indicating PS domain is received during an RR connection (the definition of a valid SECURITY MODE COMMAND message is given in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]). The network shall derive a GPRS UMTS ciphering key and a GPRS UMTS integrity key from the GPRS GSM ciphering key by using the conversion functions named "c4" and "c5" defined in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a].</p>
<p>In Iu mode, in the case of an established UMTS security context, the GPRS UMTS ciphering key and the GPRS UMTS integrity key shall be taken into use by the MS when a valid SECURITY MODE COMMAND message indicating PS domain is received during a PS signalling connection (the definition of a valid SECURITY MODE COMMAND message is given in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<p>In Iu mode, if the MS received a valid SECURITY MODE COMMAND message indicating PS domain in Iu mode or a valid AUTHENTICATION AND CIPHERING REQUEST message in A/Gb mode before the network initiates a new authentication and ciphering procedure and establishes a new GSM/UMTS security context, the new GPRS UMTS ciphering key and GPRS UMTS integrity key are taken into use by the MS, when a new valid SECURITY MODE COMMAND message indicating PS domain is received during the PS signalling connection. In case of inter-system change to A/Gb mode, the MS and the network shall take the new keys into use immediately after the inter-system change.</p>
<h4><a name="_Toc171524058"></a>4.7.7.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of keys at intersystem change from Iu mode to A/Gb mode</h4>
<p>At an inter-system change from Iu mode to A/Gb mode, ciphering may be started (see 3GPP&nbsp;TS&nbsp;44.064&nbsp;[78a]) without any new authentication and ciphering procedure. Deduction of the appropriate security key for ciphering in A/Gb mode, depends on the current GSM/UMTS security context stored in the MS and the network.</p>
<p>The ME shall handle the GPRS GSM ciphering key and a potential GPRS GSM Kc<sub>128</sub> according to table 4.7.7.8.1.</p>
<p>In the case of an established GSM security context, before any initial GMM message is sent in the new cell in A/Gb mode, the GMM layer in the MS shall notify the LLC layer if ciphering shall be used or not. If ciphering shall be used, then the GPRS GSM ciphering key and the applicable GEA ciphering algorithm according to the stored <em>Ciphering Algorithm IE</em> in the MS shall also be indicated to the LLC layer (see 3GPP&nbsp;TS&nbsp;44.064 [78a]).</p>
<p>In the case of an established UMTS security context, before any initial GMM message is sent in the new cell in A/Gb mode, the GMM layer in the MS shall notify the LLC layer if ciphering shall be used or not. If ciphering shall be used, then the GPRS GSM ciphering key or GPRS GSM Kc<sub>128</sub> and the applicable GEA ciphering algorithm according to the stored <em>Ciphering Algorithm IE</em> in the MS shall also be indicated to the LLC layer (see 3GPP&nbsp;TS&nbsp;44.064&nbsp;[78a]). If the network has selected a GEA-algorithm that requires a 128-bit ciphering key, then the ME shall apply a GPRS GSM Kc<sub>128</sub> derived from the GPRS UMTS ciphering key and the GPRS UMTS integrity key of the established UTMS security context as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a].</p>
<p>Table 4.7.7.8.1/3GPP TS 24.008: Inter-system change from Iu mode to A/Gb mode</p>
<table>
<tbody>
<tr>
<td width="243">
<p>Security context established in MS and network in Iu mode</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>At inter-system change to A/Gb mode:</p>
</td>
</tr>
<tr>
<td width="243">
<p>GSM security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall apply the GPRS GSM ciphering key that was received from the GSM security context created in the SIM/USIM during the latest successful authentication procedure.</p>
<p>&nbsp;</p>
</td>
</tr>
<tr>
<td width="243">
<p>UMTS security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>If a GEA algorithm is taken into use that requires a 64-bit long ciphering key, then an ME shall apply the GPRS GSM ciphering key that was derived by the USIM from the GPRS UMTS ciphering key and the GPRS UMTS integrity key during the latest successful authentication procedure.</p>
<p>If a GEA algorithm is taken into use that requires a 128-bit ciphering key, then an ME shall apply the GPRS GSM Kc<sub>128</sub> derived by the ME from the GPRS UMTS ciphering key and the GPRS UMTS integrity key (see 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]) provided by the USIM during the lastest successful authentication procedure (see subclause&nbsp;4.7.7.3a).</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A USIM with UMTS security context, passes the GPRS UMTS ciphering key, the GPRS UMTS integrity key and the derived GPRS GSM ciphering key to the ME independent on the current radio access being UTRAN or GERAN.</p>
<h4><a name="_Toc171524059"></a>4.7.7.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of keys at intersystem change from A/Gb mode to Iu mode</h4>
<p>At an inter-system change from A/Gb mode to Iu mode, ciphering and integrity may be started (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) without any new authentication and ciphering procedure. Deduction of the appropriate security keys for ciphering and integrity check in Iu mode, depends on the current GSM/UMTS security context stored in the MS and the network.</p>
<p>The ME shall handle the GPRS UMTS ciphering key and the GPRS UMTS integrity key according to table 4.7.7.9.1.</p>
<p>Table 4.7.7.9.1/3GPP TS 24.008: Inter-system change from A/Gb mode to Iu mode</p>
<table>
<tbody>
<tr>
<td width="243">
<p>Security context established in MS and network in A/Gb mode</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>At inter-system change to Iu mode:</p>
</td>
</tr>
<tr>
<td width="243">
<p>GSM security context</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall derive the GPRS UMTS ciphering key and the GPRS UMTS integrity key from the GPRS GSM ciphering key that was provided by the SIM/USIM during the latest successful authentication procedure. The conversion functions named "c4" and "c5" in 3GPP TS 33.102 [5a] are used for this purpose.</p>
<p>&nbsp;</p>
</td>
</tr>
<tr>
<td width="243">
<p>UMTS security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall apply the GPRS UMTS ciphering key and the GPRS UMTS integrity key that were received from the UMTS security context created in the USIM during the latest successful authentication procedure.</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A USIM with UMTS security context, passes the GPRS UMTS ciphering key, the GPRS UMTS integrity key and the derived GPRS GSM ciphering key to the ME independent on the current radio access being UTRAN or GERAN.</p>
<h4><a name="_Toc171524060"></a>4.7.7.10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Handling of keys at intersystem change from S1 mode to Iu mode or A/Gb mode</h4>
<p>At an inter-system change from S1 mode to Iu mode, ciphering and integrity may be started (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]) without any new authentication and ciphering procedure. At an inter-system change from S1&nbsp;mode to A/Gb mode, ciphering may be started (see 3GPP&nbsp;TS&nbsp;44.064&nbsp;[78a]) without any new authentication and ciphering procedure. Deduction of the appropriate security keys for ciphering and integrity check in Iu mode or for ciphering in A/Gb mode, depends on the current EPS security context or the UMTS security context for the PS domain stored in the MS and the network.</p>
<p>The ME shall handle the GPRS UMTS ciphering key, the GPRS UMTS integrity key, the GPRS GSM ciphering key and a potential GPRS GSM Kc<sub>128</sub> according to table&nbsp;4.7.7.10.1, table&nbsp;4.7.7.10.2 and table&nbsp;4.7.7.10.3.</p>
<p>Table&nbsp;4.7.7.10.1/3GPP TS 24.008: Inter-system change from S1 mode to Iu mode or A/Gb mode in connected mode.</p>
<table>
<tbody>
<tr>
<td width="243">
<p>Security context established in MS and network</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>At inter-system change to Iu mode or A/Gb mode in connected mode</p>
</td>
</tr>
<tr>
<td width="243">
<p>EPS security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall derive the UMTS security keys GPRS UMTS ciphering key (CK') and GPRS UMTS integrity key (IK') from K<sub>ASME</sub> and the NAS downlink COUNT value as specified in 3GPP&nbsp;TS&nbsp;33.401&nbsp;[123]. The ME shall use the derived UMTS security keys to derive the GPRS GSM ciphering key using the "c3" conversion function as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a].</p>
<p>At inter-system change from S1 mode to Iu mode, the ME shall apply the new derived GPRS UMTS integrity key and GPRS UMTS ciphering key.</p>
<p>At inter-system change from S1 mode to A/Gb mode, the ME shall apply the new derived GPRS GSM ciphering key.</p>
<p>Furthermore, the ME shall replace an already established UMTS security context for the PS domain, if any, in the USIM. The MS shall in addition handle the START<sub>PS</sub> value as specified in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c].</p>
<p>At inter-system change from S1 mode to A/Gb mode, if a GEA algorithm is taken into use that requires a 64-bit long ciphering key, then an ME shall apply the derived GPRS GSM ciphering key.</p>
<p>At inter-system change from S1 mode to A/Gb mode, if a GEA algorithm is taken into use that requires a 128-bit long ciphering key, then an ME shall apply the derived GPRS GSM Kc<sub>128</sub> that was derived by the ME from the derived UMTS security keys (see subclause&nbsp;4.7.7.3a).</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>NOTE&nbsp;1:&nbsp; For the case in table&nbsp;4.7.7.10.1, because of deriving a new UMTS security context for the PS domain, a new GPRS GSM ciphering key needs to be derived from the new derived UMTS security keys (i.e. CK' and IK'). Note that the new GPRS GSM ciphering key is also part of the new UMTS security context for the PS domain, and therefore any old GPRS GSM ciphering key stored in the USIM and in the ME belongs to an old UMTS security context for the PS domain and can no longer be taken into use.</p>
<p>Table&nbsp;4.7.7.10.2/3GPP TS 24.008: Inter-system change from S1 mode to Iu mode or A/Gb mode in idle mode when the TIN indicates "GUTI".</p>
<table>
<tbody>
<tr>
<td width="243">
<p>Security context established in MS and network</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>At inter-system change to Iu mode or A/Gb mode in idle mode when the TIN indicates "GUTI"</p>
</td>
</tr>
<tr>
<td width="243">
<p>EPS security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>An ME shall derive the UMTS security keys GPRS UMTS ciphering key (CK') and GPRS UMTS integrity key (IK') from K<sub>ASME</sub> and the NAS uplink COUNT value as specified in 3GPP&nbsp;TS&nbsp;33.401&nbsp;[123]. The ME shall use the derived UMTS security keys to derive the GPRS GSM ciphering key using the "c3" conversion function as specified in 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a].</p>
<p>At inter-system change from S1 mode to Iu mode, the ME shall apply the new derived GPRS UMTS integrity key and GPRS UMTS ciphering key.</p>
<p>At inter-system change from S1 mode to A/Gb mode, the ME shall apply the new derived GPRS GSM ciphering key.</p>
<p>Furthermore, the ME shall replace an already established UMTS security context for the PS domain, if any, in the USIM. The MS shall in addition handle the START<sub>PS</sub> value as specified in 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c].</p>
<p>At inter-system change from S1 mode to A/Gb mode, if a GEA algorithm is taken into use that requires a 64-bit long ciphering key, then an ME shall apply the derived GPRS GSM ciphering key.</p>
<p>At inter-system change from S1 mode to A/Gb mode, if a GEA algorithm is taken into use that requires a 128-bit long ciphering key, then an ME shall apply the derived GPRS GSM Kc<sub>128</sub> that was derived by the ME from the derived UMTS security keys (see subclause&nbsp;4.7.7.3a).</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>NOTE&nbsp;2:&nbsp; For the case in table&nbsp;4.7.7.10.2, because of deriving a new UMTS security context for the PS domain, a new GPRS GSM ciphering key needs to be derived from the new derived UMTS security keys (i.e. CK' and IK'). The new GPRS GSM ciphering key is also part of the new UMTS security context for the PS domain, and therefore any old GPRS GSM ciphering key stored in the USIM and in the ME belongs to an old UMTS security context for the PS domain and can no longer be taken into use.</p>
<p>Table&nbsp;4.7.7.10.3/3GPP TS 24.008: Inter-system change from S1 mode to Iu mode or A/Gb mode in idle mode when the TIN indicates "RAT‑related TMSI"</p>
<table>
<tbody>
<tr>
<td width="243">
<p>Security context established in MS and network</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>At inter-system change to Iu mode or A/Gb mode in idle mode when the TIN indicates "RAT‑related TMSI"</p>
</td>
</tr>
<tr>
<td width="243">
<p>UMTS security context</p>
<p>&nbsp;</p>
</td>
<td width="357">
<p>At inter-system change from S1 mode to Iu mode, the ME shall apply the GPRS UMTS ciphering key and the GPRS UMTS integrity key that were received from the UMTS security context for the PS domain created in the USIM during the latest successful authentication procedure.</p>
<p>At inter-system change from S1 mode to A/Gb mode, if a GEA algorithm is taken into use that requires a 64-bit long ciphering key, then an ME shall apply the GPRS GSM ciphering key that was received from the GSM security context created in the SIM/USIM during the latest successful authentication procedure.</p>
<p>At inter-system change from S1 mode to A/Gb mode, if a GEA algorithm is taken into use that requires a 128-bit long ciphering key, then an ME shall apply the GPRS GSM Kc<sub>128</sub> derived by the ME from the GPRS UMTS ciphering key and the GPRS UMTS integrity key (see 3GPP&nbsp;TS&nbsp;33.102&nbsp;[5a]) provided by the USIM during the lastest successful authentication procedure (see subclause&nbsp;4.7.7.3a).</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>The network shall replace an already established UMTS security context for the PS domain, if any, when a handover from S1mode to Iu mode or from S1mode to A/Gb mode has been completed successfully.</p>
<p>If the handover from S1mode to Iu mode or S1mode to A/Gb mode has not been completed successfully, the ME and the network shall delete the new derived UMTS security context for the PS domain. Additionally, the network shall delete the already established UMTS security context for the PS domain, if the CKSN of the already established UMTS security context is equal to the CKSN of the new derived security context for the PS domain.</p>
<h3><a name="_Toc171524061"></a>4.7.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Identification procedure</h3>
<p>The identification procedure is used by the network to request an MS to provide specific identification parameters to the network e.g. International Mobile Subscriber Identity, International Mobile Equipment Identity (see 3GPP&nbsp;TS&nbsp;23.003&nbsp;[10]). For the presentation of the IMEI, the requirements of 3GPP&nbsp;TS&nbsp;42.009&nbsp;[5] apply.</p>
<h4><a name="_Toc171524062"></a>4.7.8.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Identification initiation by the network</h4>
<p>The network initiates the identification procedure by transferring an IDENTITY REQUEST message to the MS and starts the timer T3370. The IDENTITY REQUEST message specifies the requested identification parameters in the identity type information element.</p>
<h4><a name="_Toc171524063"></a>4.7.8.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Identification response by the MS</h4>
<p>An MS shall be ready to respond to an IDENTITY REQUEST message at any time.</p>
<p>Upon receipt of the IDENTITY REQUEST message the MS sends back an IDENTITY RESPONSE message. The IDENTITY RESPONSE message shall contain the identification parameters as requested by the network.</p>
<h4><a name="_Toc171524064"></a>4.7.8.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Identification completion by the network</h4>
<p>Upon receipt of the IDENTITY RESPONSE the network shall stop timer T3370.</p>
<h4><a name="_Toc171524065"></a>4.7.8.3a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases in the MS</h4>
<p>(a) Requested identity is not available:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS cannot encode the requested identity in the IDENTITY RESPONSE message, e.g. because no valid SIM is available, then it shall encode the identity type as "No identity".</p>
<h4><a name="_Toc171524066"></a>4.7.8.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the network side</h4>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) Lower layer failure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Upon detection of a lower layer failure before the IDENTITY RESPONSE is received, the network shall abort any ongoing GMM procedure.</p>
<ol>
<li>b) Expiry of timer T3370</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The identification procedure is supervised by the network by the timer T3370. The network shall, on the first expiry of the timer T3370, retransmit the IDENTITY REQUEST message and reset and restart the timer T3370. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3370, the network shall abort the identification procedure and any ongoing GMM procedure.</p>
<ol>
<li>c) Collision of an identification procedure with a GPRS attach procedure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives an ATTACH REQUEST message before the ongoing identification procedure has been completed and no GPRS attach procedure is pending on the network (i.e. no ATTACH ACCEPT/REJECT message has still to be sent as an answer to an ATTACH REQUEST message), the network shall proceed with the GPRS attach procedure.</p>
<ol>
<li>d) Collision of an identification procedure with a GPRS attach procedure when the identification procedure has been caused by a GPRS attach procedure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives an ATTACH REQUEST message before the ongoing identification procedure has been completed and a GPRS attach procedure is pending (i.e. an ATTACH ACCEPT/REJECT message has to be sent as an answer to an earlier ATTACH REQUEST message), then:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If one or more of the information elements in the ATTACH REQUEST message differs from the ones received within the previous ATTACH REQUEST message, the network shall proceed with the GPRS attach procedure; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the information elements do not differ, then the network shall not treat any further this new ATTACH REQUEST.</p>
<p>d1) Collision of an identification procedure with an MS initiated GPRS detach procedure</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing cause "power off":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a DETACH REQUEST message before the ongoing identification procedure has been completed, the network shall abort the identification procedure and shall progress the GPRS detach procedure.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing other causes than "power off":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a DETACH REQUEST message before the ongoing identification procedure has been completed, the network shall complete the identification procedure and shall respond to the GPRS detach procedure as described in subclause&nbsp;4.7.4.</p>
<ol>
<li>e) Collision of an identification procedure with a routing area updating procedure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a ROUTING AREA UPDATE REQUEST message before the ongoing identification procedure has been completed, the network shall progress both procedures.</p>
<ol>
<li>f) Collision of an identification procedure with a service request procedure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the network receives a SERVICE REQUEST message before the ongoing identification procedure has been completed, the network shall progress both procedures.</p>
<p>Figure 4.7.8/1 3GPP TS 24.008: Identification procedure</p>
<h3><a name="_Toc171524067"></a>4.7.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Paging procedure</h3>
<h4><a name="_Toc171524068"></a>4.7.9.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Paging for GPRS services</h4>
<p>In A/Gb mode, paging is used by the network to identify the cell the MS has currently selected, or to prompt the mobile to re-attach if necessary as a result of network failure. If the MS is not GPRS attached when it receives a paging for GPRS services, the MS shall ignore the paging.</p>
<p>In Iu mode, paging is used by the network to request the establishment of PS signalling connection or to prompt the mobile to re-attach if necessary as a result of network failure. If the MS is not GPRS attached when it receives a paging for GPRS services, the MS shall ignore the paging.</p>
<h5><a name="_Toc171524069"></a>4.7.9.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Paging for GPRS services using P-TMSI</h5>
<p>The network shall initiate the paging procedure for GPRS services using P-TMSI when GMM signalling messages or user data is pending to be sent to the MS while the mobile reachable timer is running. The network may page only GPRS MSs which are GMM-REGISTERED and identified by a local P-TMSI.</p>
<p>In Iu mode, for the MS using eDRX, the network initiates the paging procedure when the paging trigger is received within the paging time window. If the paging trigger is received outside the paging time window, the network initiates the paging procedure at T time ahead of the beginning of the next paging time window.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T time is a short time period based on implementation. The operator can take possible imperfections in the synchronization between the CN and the MS into account when choosing T time.</p>
<p>In Iu mode, to initiate the procedure the GMM entity in the network requests the lower layer to start paging (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;25.413&nbsp;[19c]) and shall start the timer:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; T3315 for this paging procedure, if the network accepted to use eDRX for the MS.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Otherwise T3313 for this paging procedure.</p>
<p>In Iu mode, if the network starts the timer T3315, the network shall set the timer T3315 to a value smaller than the value of timer T3-RESPONSE (see 3GPP&nbsp;TS&nbsp;29.274&nbsp;[16D] for further details on timer T3-RESPONSE).</p>
<p>In Iu mode, the GMM entity in the network may provide the lower layer with a list of CSG IDs, including the CSG IDs of both the expired and the unexpired subscriptions. If there is a PDN connection for emergency bearer services established, the GMM entity in the network shall not provide the list of CSG IDs to the lower layer.</p>
<p>Upon reception of a paging indication, the MS shall stop the timer T3346, if running, and:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; initiate a service request procedure to respond to the paging, the MS shall set the service type to "paging response" in the SERVICE REQUEST message (see 3GPP&nbsp;TS&nbsp;24.007&nbsp;[20], 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74], 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;25.413&nbsp;[19c]); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; initiate a routing area update procedure as specified in subclauses&nbsp;4.7.5.1 and 4.7.5.2.1.</p>
<p>If the paging request for GPRS services was received during an ongoing MS initiated GMM specific procedure, then the MS shall progress the GMM specific procedure, and the network shall proceed with the GMM specific procedure.</p>
<p>In A/Gb mode, to initiate the procedure the GMM entity requests the RR sublayer to start paging (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84], 3GPP&nbsp;TS&nbsp;44.060&nbsp;[76]), and shall start the timer:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; T3315 for this paging procedure, if the network accepted to use eDRX for the MS.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Otherwise T3313 for this paging procedure.</p>
<p>In A/Gb mode, if the network starts the timer T3315, the network shall set the timer T3315 to a value smaller than the value of timer T3-RESPONSE (see 3GPP&nbsp;TS&nbsp;29.274&nbsp;[16D] for further details on timer T3-RESPONSE).</p>
<p>In A/Gb mode, upon reception of a paging indication, the MS shall respond to the paging with any LLC frame (see 3GPP&nbsp;TS&nbsp;44.064&nbsp;[78a], 3GPP&nbsp;TS&nbsp;24.007&nbsp;[20], 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74]).</p>
<p>At intersystem change, an MS not having the READY timer running in A/Gb mode or an MS in PMM-IDLE mode in Iu mode, being paged in a different access network as when it last sent user data or signalling message, uses the ROUTING AREA UPDATE REQUEST message as paging response, i.e. the routing area updating procedure shall be performed instead according to the selective routing area updating procedure.</p>
<p>The network shall stop the timer for the paging procedure (i.e. either timer T3313 or timer T3315) when a response is received from the MS.</p>
<p>Upon expiry ofthe timer T3313, the network may re-initiate paging.</p>
<p>Upon expiry of the timer T3315, the network shall abort the paging procedure and shall proceed as specified in 3GPP&nbsp;TS&nbsp;23.060&nbsp;[74].</p>
<p>In Iu mode, when a response is received from the MS, the network shall change from PMM-IDLE mode to PMM-CONNECTED mode.</p>
<p>In A/Gb mode, when a response different from an LLC NULL frame is received from the MS, the network shall start the READY timer.</p>
<h5><a name="_Toc171524070"></a>4.7.9.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Paging for GPRS services using IMSI</h5>
<p>Paging for GPRS services using IMSI is an abnormal procedure used for error recovery in the network.</p>
<p>The network may initiate paging using IMSI if the P-TMSI is not available due to a network failure.</p>
<p>In Iu mode, to initiate the procedure the GMM entity in the network requests the lower layer to start paging (see 3GPP&nbsp;TS 25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;25.413&nbsp;[19c]).</p>
<p>In A/Gb mode, to initiate the procedure the GMM entity in the network requests the RR sublayer to start paging (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84], 3GPP&nbsp;TS&nbsp;44.060&nbsp;[76]).</p>
<p>Upon reception of a paging indication for GPRS services using IMSI, the MS shall stop the timer T3346, if it is running, locally deactivate any active PDP context(s), MBMS context(s) and locally detach from GPRS. The local detach includes deleting any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number stored, setting the GPRS update status to GU2 NOT UPDATED and changing state to GMM-DEREGISTERED. The MS shall stop all timers T3396 that are running.</p>
<p>If S1 mode is supported by the MS, the MS shall in addition handle the EMM parameters EMM state, EPS update status, last visited registered TAI, TAI list, GUTI and KSI<sub>ASME</sub> as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when a paging for EPS services using IMSI is received.</p>
<p>In Iu mode, when an MS receives a paging request for GPRS services using the IMSI from the network before an MS initiated GMM specific procedure has been completed, then the MS shall abort the GMM specific procedure, and the MS shall proceed according to the description in this clause.</p>
<p>After performing the local detach, the MS shall then perform a GPRS attach or combined GPRS attach procedure.</p>
<p>After performing the attach, the MS should activate PDP context(s) to replace any previously active PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).</p>
<p>NOTE&nbsp;1:&nbsp; In some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.</p>
<p>NOTE&nbsp;2:&nbsp; The MS does not respond to the paging except with the Attach Request. Hence timers T3313 and T3315 in the network are not used when paging with IMSI.</p>
<p>NOTE&nbsp;3:&nbsp; Paging without DRX parameters may require a considerable extension of the paging duration.</p>
<p>NOTE&nbsp;4:&nbsp; Paging without using eDRX parameters may result in the paging with IMSI not to be received by the MS for which eDRX has been negotiated or may require a considerable extension of the paging duration.</p>
<h4><a name="_Toc171524071"></a>4.7.9.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Paging for non-GPRS services</h4>
<p>The network may initiate the paging procedure for non-GPRS services when the MS is IMSI attached for non-GPRS services.</p>
<p>In Iu mode, to initiate the procedure the GMM entity requests the lower layer to start paging (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;25.413&nbsp;[19c]) for non-GPRS services.</p>
<p>In A/Gb mode, to initiate the procedure the GMM entity requests the RR sublayer to start paging (see 3GPP&nbsp;TS&nbsp;44.018&nbsp;[84] and 3GPP&nbsp;TS&nbsp;44.060&nbsp;[76] for non-GPRS services).</p>
<p>The MS identity used for paging shall be the allocated TMSI if acknowledged by the MS, otherwise the IMSI.</p>
<h3><a name="_Toc171524072"></a>4.7.10&nbsp;&nbsp;&nbsp;&nbsp; Receiving a GMM STATUS message by a GMM entity</h3>
<p>If the MS receives a GMM STATUS message no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible. The actions to be taken on receiving a GMM STATUS message in the network are an implementation dependent option.</p>
<h3><a name="_Toc171524073"></a>4.7.11&nbsp;&nbsp;&nbsp;&nbsp; Void</h3>
<h3><a name="_Toc171524074"></a>4.7.12&nbsp;&nbsp;&nbsp;&nbsp; GMM Information procedure</h3>
<p>The GMM information message support is optional in the network. The MM information procedure may be invoked by the network at any time during an established GMM context.</p>
<h4><a name="_Toc171524075"></a>4.7.12.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM information procedure initiation by the network</h4>
<p>The GMM information procedure consists only of the GMM INFORMATION message sent from the network to the mobile station. During an established GMM context, the network may send none, one, or more GMM INFORMATION messages to the mobile station. If more than one GMM INFORMATION message is sent, the messages need not have the same content.</p>
<h4><a name="_Toc171524076"></a>4.7.12.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM information procedure in the mobile station</h4>
<p>When the mobile station (supporting the GMM information message) receives an GMM INFORMATION message, it shall accept the message and optionally use the contents to update appropriate information stored within the mobile station.</p>
<p>If the mobile station does not support the GMM information message the mobile station shall ignore the contents of the message and return an GMM STATUS message with cause #97.</p>
<h3><a name="_Toc171524077"></a>4.7.13&nbsp;&nbsp;&nbsp;&nbsp; Service Request procedure (Iu mode only)</h3>
<p>The purpose of this procedure is to transfer the PMM mode from PMM-IDLE to PMM-CONNECTED mode, and/or to assign radio access bearer in case of PDP contexts are activated without radio access bearer assigned. In latter case, the PMM mode may be PMM-IDLE mode or may alternatively be the PMM-CONNECTED mode if the MS requires radio access bearer re-establishment. This procedure is used for;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the initiation of CM layer service (e.g. SM or SMS) procedure from the MS in PMM-IDLE mode,</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the network to transfer down link signalling,</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; uplink (in PMM-IDLE or PMM CONNECTED) and downlink (only in PMM-IDLE) user data,</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; counting the number of mobile stations in a cell which are interested in a specific MBMS service.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; requesting the establishment of a point-to-point Radio Bearer for receiving a MBMS service.</p>
<p>For downlink transfer of signalling or user data in PMM-IDLE mode, the trigger is given from the network by the paging request procedure, which is out of scope of the present document.</p>
<p>For pending downlink user data in PMM-CONNECTED mode, the re-establishment of radio access bearers for all active PDP contexts is done without paging.</p>
<p>For counting the number of mobile stations in PMM-IDLE mode interested in a specific MBMS service, the trigger is given from the network by the MBMS notification procedure (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<p>For establishing a point-to-point radio bearer to allow MBMS service, the trigger is given from the RRC determining this need from the MBMS control parameters broadcasted by the network (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c]).</p>
<p>Service type can take either of the following values; "signalling", "data", "paging response", "MBMS multicast service reception" or "MBMS broadcast service reception". Each of the values shall be selected according to the criteria to initiate the Service request procedure.</p>
<p>If the MS is triggered to send a Service Request message for both MBMS multicast service and MBMS broadcast service simultaneously, the MS shall include a Service Type indicating "MBMS multicast service reception".</p>
<p>The criteria to invoke the Service request procedure are when:</p>
<ol>
<li>a) the MS has any signalling messages except GMM messages (e.g. for SM or SMS) to be sent to the network in PMM-IDLE mode (i.e., no secure PS signalling connection has been established). In this case, the service type shall be set to "signalling".</li>
<li>b) the MS, either in PMM-IDLE or PMM-CONNECTED mode, has pending user data to be sent, no radio access bearer is established for the corresponding PDP context, and timer T3319 (see subclause&nbsp;4.7.13.3) is not running or, optionally, if timer T3319 is running and the flag in the Uplink data status IE for this PDP context has not been set in the last Service Request. The procedure is initiated by an indication from the lower layers (see 3GPP&nbsp;TS&nbsp;24.007&nbsp;[20]). In this case, the service type shall be set to "data".</li>
<li>c) the MS receives a paging request using P-TMSI for PS domain from the network in PMM-IDLE mode. In this case, the service type shall be set to "paging response".</li>
<li>d) the MS is in PMM-IDLE mode or PMM-CONNECTED, receives an MBMS notification for an MBMS multicast service for which the MS has activated an MBMS context or for an MBMS broadcast service which has been selected for reception locally by upper layers in the MS, and is prompted by the contents of the notification to establish a PS signalling connection (see 3GPP&nbsp;TS&nbsp;25.346&nbsp;[110]). In this case, the service type shall be set to "MBMS multicast service reception" or "MBMS broadcast service reception", respectively.</li>
<li>e) the MS in PMM-IDLE mode or PMM-CONNECTED, determines from the broadcast MBMS control parameters that there is a need to establish a point-to-point Radio Bearer to enable MBMS reception (see 3GPP&nbsp;TS&nbsp;25.346&nbsp;[110]). In this case, the service type shall be set to "MBMS multicast service reception" or "MBMS broadcast service reception", respectively.</li>
</ol>
<p>If one of the above criteria to invoke the Service request procedure is fulfilled, then the Service request procedure may only be initiated by the MS when the following conditions are fulfilled:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; its GPRS update status is GU1 UPDATED and the stored RAI is equal to the RAI of the current serving cell; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no GMM specific procedure is ongoing (see subclause&nbsp;4.1.1.1).</p>
<p>If a GMM specific procedure is ongoing at the time a request from CM sublayer, the RRC or the RABM (see 3GPP&nbsp;TS&nbsp;24.007&nbsp;[20]) is received and the ATTACH REQUEST or ROUTING AREA UPDATE REQUEST message has been sent, then, depending on implementation, the MS shall abort the received request or delay it until the GMM specific procedure is completed. If the ATTACH REQUEST or ROUTING AREA UPDATE REQUEST message has not been sent, the MS may indicate "follow-on request pending" in the message (i.e. the MS wishes to prolong the established PS signalling connection after the GMM specific procedure). Then, the MS shall delay the Service request procedure until the GMM specific procedure is completed.</p>
<p>If the network indicates "follow-on proceed" in the ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT message and the MS has a service request pending, the MS shall react depending on the service type. If the service type is:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; "signalling": the MS shall abort the Service request procedure and send the pending signalling messages immediately;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; "data": the MS shall immediately perform the pending Service request procedure using the current PS signalling connection;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; "paging response": the MS shall abort the Service request procedure. No further specific action is required from the MS.</p>
<p>If the network indicates "follow-on proceed" and the MS has no service request pending, then no specific action is required from the MS. As an implementation option, the MS may start timer T3340 as described in subclause&nbsp;4.7.1.9 if no user plane radio access bearers are set up.</p>
<p>If the network indicates "no follow-on proceed" in the ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT message, the MS shall not initiate the pending Service request procedure until the current PS signalling connection is released.</p>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The "follow-on proceed" indication was not defined in earlier versions of the protocol. A network that is compliant with the earlier versions of the protocol will always encode the respective bit as zero, i.e. as "follow-on proceed", even if it does not prolong the PS signalling connection.</p>
<p>After completion of a Service request procedure but before re-establishment of radio access bearer, if the PDP and MBMS context status information elements are included, then the network shall deactivate all those PDP and MBMS contexts locally (without peer to peer signalling between the MS and the network), which are not in SM state PDP-INACTIVE on network side but are indicated by the MS as being in state PDP-INACTIVE.</p>
<p>After completion of a Service request procedure, the pending service is resumed and uses then the connection established by the procedure. If the service type is indicating "data", then the radio access bearers for all activated PDP contexts are re-established by the network, except for those activated PDP contexts having maximum bit rate value set to 0 kbit/s for both uplink and downlink and as an option those which have no pending user data. The re-establishment of radio access bearers for those PDP contexts is specified in subclause&nbsp;6.1.3.3.</p>
<p>A service request attempt counter is used to limit the number of service request attempts and no response from the network. The service request attempt counter shall be incremented as specified in subclause&nbsp;4.7.13.5.</p>
<p>The service request attempt counter shall be reset when:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; an attach or combined attach procedure is successfully completed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a normal or periodic routing area updating or a combined routing area updating procedure is successfully completed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a service request procedure is successfully completed ; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the UE moves to GMM-DEREGISTERED state.</p>
<h4><a name="_Toc171524078"></a>4.7.13.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service Request procedure initiation</h4>
<p>The MS initiates the Service request procedure by sending a SERVICE REQUEST message. The timer T3317 shall be started after the SERVICE REQUEST message has been sent and state GMM-SERVICE-REQUEST-INITIATED is entered. The message SERVICE REQUEST shall contain the P-TMSI and the Service type shall indicate either "data", "signalling", "paging response", "MBMS multicast service reception" or "MBMS broadcast service reception". The MS shall not issue another Service request when the MS is in state GMM-SERVICE-REQUEST-INITIATED</p>
<p>If the PDP context status information element is included in the SERVICE REQUEST message, then the network shall deactivate all those PDP contexts locally (without peer to peer signalling between the MS and the network) which are not in SM state PDP-INACTIVE on the network side, but are indicated by the MS as being in state PDP-INACTIVE.</p>
<p>If the MBMS context status information element is included in the SERVICE REQUEST message, then the network shall deactivate all those MBMS contexts locally (without peer to peer signalling between the MS and network) which are not in SM state PDP-INACTIVE on the network side, but are indicated by the MS as being in state PDP-INACTIVE. If no MBMS context status information element is included, then the network shall deactivate all MBMS contexts locally which are not in SM state PDP-INACTIVE on the network side.</p>
<p>For a Service Request of type "data", the MS may include the Uplink data status information element in the SERVICE REQUEST message. The Uplink data status information indicates which preserved PDP contexts have pending uplink data to be sent. If the Uplink data status information element is included in the SERVICE REQUEST message with service type "data", the network may use this information to determine which of the RABs for the preserved PDP contexts to re-establish.</p>
<h4><a name="_Toc171524079"></a>4.7.13.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GMM common procedure initiation</h4>
<p>The network may initiate GMM common procedures, e.g. the GMM identification or the GMM authentication and ciphering procedure, depending on the received information such as GPRS ciphering key sequence number and P-TMSI.</p>
<h4><a name="_Toc171524080"></a>4.7.13.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service request procedure accepted by the network</h4>
<p>If the SERVICE REQUEST message was sent in PMM-IDLE mode, the indication from the lower layers that the security mode control procedure is completed shall be treated as a successful completion of the procedure. The service request attempt counter shall be reset, timer T3317 shall be stopped, and the MS enters GMM-REGISTERED state and PMM-CONNECTED mode.</p>
<p>If the SERVICE REQUEST message was sent in PMM-CONNECTED mode, then the reception of the SERVICE ACCEPT message shall be treated as a successful completion of the procedure. The timer T3317 shall be stopped and the MS remains in PMM-CONNECTED mode.</p>
<p>Upon reception of the SERVICE REQUEST message, if the EMM Combined UE Waiting Flag is 'true', the SGSN shall complete the procedure and perform a detach procedure for non-GPRS services only as described in subclause&nbsp;4.7.4.2.</p>
<p>If the SERVICE REQUEST message was sent in a CSG cell and the CSG subscription has expired or was removed for a MS, but the MS has a PDN connection for emergency bearer services established, the network shall accept the SERVICE REQUEST message and deactivate all non-emergency PDP contexts by initiating PDP context deactivation procedure. The PDP contexts for emergency services shall not be deactivated.</p>
<p>At successful completion of a service request procedure with Service type "data", the MS shall start timer T3319. The timer T3319 shall be stopped when the MS returns to PMM-IDLE mode or when the network releases the radio access bearer of any active PDP context. The MS shall not issue another Service Request with service type "data" while timer T3319 is running unless the Service request is being generated from a PDP context for which the flag in the Uplink data status IE has not been set in the last Service Request.</p>
<p>The network may indicate a value for timer T3319 in the ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT messages. The last provided value of T3319 shall be used by the MS. If the information element T3319 value is not included in the ATTACH ACCEPT or ROUTING AREA UPDATE ACCEPT messages, the default value shall be used. If the T3319 value received by the MS contains an indication that the timer is deactivated or the timer value is zero, then the MS shall use the default value.</p>
<p>If the PDP context status information element is included in the Service Accept, then the MS shall deactivate locally (without peer to peer signalling between the MS and the network) all that PDP contexts which are not in SM state PDP-INACTIVE on MS side but are indicated by the Network as being in state PDP-INACTIVE. If there is a default PDP context among the PDP contexts to be deactivated, an MS supporting S1 mode shall locally deactivate all PDP contexts associated to the same PDP address and APN as the default PDP context without peer-to-peer SM signalling to the network; an MS not supporting S1 mode may apply the same behaviour.</p>
<p>If the MBMS context status information element is included in the SERVICE ACCEPT message, then the MS shall deactivate all those MBMS contexts locally (without peer to peer signalling between the MS and network) which are not in SM state PDP-INACTIVE in the MS, but are indicated by the network as being in state PDP-INACTIVE. If no MBMS context status information element is included, then the MS shall deactivate all those MBMS contexts locally which are not in SM state PDP-INACTIVE in the MS.</p>
<p>If a service request is received from an MS with a LIPA PDN connection, and if:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a L-GW Transport Layer Address is provided by the lower layer together with the service request, and the GGSN address associated with the PDP context of the LIPA PDN connection is different from the provided L-GW Transport Layer Address (see 3GPP&nbsp;TS&nbsp;25.413&nbsp;[19c]); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no L-GW Transport Layer Address is provided together with the service request by the lower layer,</p>
<p>then the SGSN explicitly deactivates all PDP contexts associated with the LIPA PDN connection by initiating the PDP context deactivation procedure (see subclause&nbsp;6.1.3.4.2).</p>
<p>If a service request is received from an MS with a SIPTO at the local network PDN connection, the following different cases can be distinguished:</p>
<p>1)&nbsp;&nbsp; if the PDN connection is a SIPTO at the local network PDN connection with collocated L-GW and if:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a SIPTO L-GW Transport Layer Address is provided by the lower layer together with the service request, and the GGSN address associated with the PDP context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address (see 3GPP&nbsp;TS&nbsp;25.413&nbsp;[19c]); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no SIPTO L-GW Transport Layer Address is provided together with the service request by the lower layer,</p>
<p>2)&nbsp;&nbsp; if the PDN connection is a SIPTO at the local network PDN connection with stand-alone GW and if:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; a LHN-ID value is provided by the lower layer together with the service request, and the LHN-ID stored in the PDP context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP&nbsp;TS&nbsp;25.413&nbsp;[19c]); or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; no LHN-ID value is provided together with the service request by the lower layer,</p>
<p>then the SGSN explicitly deactivates all PDP contexts associated with the SIPTO at the local network PDN connection by initiating the PDP context deactivation procedure (see subclause&nbsp;6.1.3.4.2).</p>
<h4><a name="_Toc171524081"></a>4.7.13.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service request procedure not accepted by the network</h4>
<p>If the Service request cannot be accepted, the network returns a SERVICE REJECT message to the mobile station.</p>
<p>Based on local policies or configurations in the network, if the network determines to change the periodic routing area update timer (T3312), or if the network determines to change the PSM usage or the value of the timer T3324 in the MS for which PSM is allowed by the network, the network may return a SERVICE REJECT with the cause #10 "implicitly detached" to the MS.</p>
<p>If the service request for mobile originated services is rejected due to general NAS level mobility management congestion control, the network shall set the GMM cause value to #22 "congestion" and assign a back-off timer T3346.</p>
<p>An MS that receives a SERVICE REJECT message containing a reject cause other than GMM cause value #25 or the message is integrity protected, shall reset the service request attempt counter, shall stop the timer T3317.</p>
<p>If the SERVICE REJECT message containing GMM cause value #25 was received without integrity protection, then the MS shall discard the message.</p>
<p>The MS shall then take different actions depending on the received reject cause value:</p>
<p># 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Illegal MS); or</p>
<p># 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Illegal ME);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2), shall delete the list of equivalent PLMNs and enter the state GMM-DEREGISTERED.NO-IMSI. Furthermore, it shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and shall consider the SIM/USIM as invalid for GPRS services until switching off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B shall in addition set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid also for non-GPRS services until switching off or the SIM/USIM is removed or the timer T3245 expires as described in subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the service request procedure is rejected with the EMM cause with the same value.</p>
<p># 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GPRS services not allowed);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2.9) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The SIM/USIM shall be considered as invalid for GPRS services until switching off or the SIM/USIM is removed. The new state is GMM-DEREGISTERED. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services is still IMSI attached for CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B in network operation mode I shall then proceed with the appropriate MM specific procedure.</p>
<p>NOTE&nbsp;1:&nbsp; Optionally the MS starts the timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the service request procedure is rejected with the EMM cause with the same value.</p>
<p># 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GPRS services and non-GPRS services not allowed);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. The new GMM state is GMM-DEREGISTERED.NO-IMSI.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number. The MS shall delete the list of equivalent PLMNs. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall abort the RR connection, unless an emergency call is ongoing. The SIM/USIM shall be considered as invalid for GPRS and non-GPRS services until switching off or the SIM/USIM is removed. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for GPRS services", then the MS shall set this counter to MS implementation-specific maximum value. If the message has been successfully integrity checked by the lower layers and the MS maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the MS shall set this counter to MS implementation-specific maximum value.</p>
<p>NOTE&nbsp;2:&nbsp; Optionally the MS starts the timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the service request procedure is rejected with the EMM cause with the same value.</p>
<p># 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (MS identity cannot be derived by the network);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU2 NOT UPDATED (and shall store it according to subclause&nbsp;4.1.3.2), enter the state GMM-DEREGISTERED.NORMAL-SERVICE, and shall delete any P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS may subsequently, automatically initiate the GPRS attach procedure.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the service request procedure is rejected with the EMM cause with the same value.</p>
<p># 10&nbsp;&nbsp;&nbsp; (Implicitly detached);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode B in network operation mode I is IMSI detached for both GPRS and CS services.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A in network operation mode I is detached for GPRS services. If no RR connection exists then the MS is also IMSI detached for the CS services.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall change to state GMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall then perform a new attach procedure. The MS should also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS should also perform the procedures needed in order to activate any previously active multicast service(s).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM state as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the service request procedure is rejected with the EMM cause with the same value.</p>
<p>NOTE&nbsp;3:&nbsp; In some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.</p>
<p># 11&nbsp;&nbsp;&nbsp; (PLMN not allowed);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and enter the state GMM-DEREGISTERED. The MS shall delete the list of equivalent PLMNs.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the PLMN identity in the "forbidden PLMN list" and if the MS is configured to use timer T3245 (see 3GPP&nbsp;TS&nbsp;24.368&nbsp;[135] or 3GPP&nbsp;TS&nbsp;31.102&nbsp;[112]) then the MS shall start timer T3245 and proceed as described in subclause&nbsp;4.1.1.6. If the message has been successfully integrity checked by the lower layers and the MS maintains a PLMN-specific attempt counter for that PLMN, then the MS shall set this counter to the MS implementation-specific maximum value.</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a PLMN selection according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the service request procedure is rejected with the EMM cause with the same value.</p>
<p># 12&nbsp;&nbsp;&nbsp; (Location area not allowed);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number, shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall change to state GMM-DEREGISTERED.LIMITED-SERVICE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The mobile station shall store the LAI in the list of "forbidden location areas for regional provision of service".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED, shall delete any TMSI, LAI and ciphering key sequence number and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a cell selection according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>NOTE&nbsp;4:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state, EPS update status, GUTI, last visited registered TAI, TAI list and KSI as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the service request procedure is rejected with the EMM cause with the same value.</p>
<p># 13&nbsp;&nbsp;&nbsp; (Roaming not allowed in this location area);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall change to state GMM-REGISTERED.LIMITED-SERVICE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall perform a PLMN selection according to 3GPP TS&nbsp;23.122&nbsp;[14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; An MS in GAN mode shall request a PLMN list in GAN (see 3GPP&nbsp;TS&nbsp;44.318&nbsp;[76b]) prior to perform a PLMN selection from this list according to 3GPP TS&nbsp;23.122 [14].</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the service request procedure is rejected with the EMM cause with the same value.</p>
<p># 15&nbsp;&nbsp;&nbsp; (No Suitable Cells In Location Area);</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall change to state GMM-REGISTERED.LIMITED-SERVICE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall store the LAI in the list of "forbidden location areas for roaming".</p>
<p>The MS shall start timer T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If no RR connection exists, the MS shall perform the following additional actions immediately. If the MS is operating in MS operation mode A and an RR connection exists, the MS shall perform these actions when the RR connection is subsequently released:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the MS is IMSI attached, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall search for a suitable cell in another location area or a tracking area according to 3GPP TS&nbsp;43.022&nbsp;[82] and 3GPP TS&nbsp;25.304&nbsp;[98] or 3GPP&nbsp;TS&nbsp;36.304&nbsp;[121].</p>
<p>NOTE&nbsp;5:&nbsp; The cell selection procedure is not applicable for an MS in GAN mode.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the service request procedure is rejected with the EMM cause with the same value.</p>
<p>#22&nbsp;&nbsp;&nbsp;&nbsp; (Congestion);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the T3346 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the MS shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the MS for this case is specified in subclause&nbsp;4.7.13.5.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS shall abort the service request procedure and enter state GMM-REGISTERED, and stop timer T3317 if still running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall stop timer T3346 if it is running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the SERVICE REJECT message is integrity protected, the MS shall start timer T3346 with the value provided in the T3346 value IE.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the SERVICE REJECT message is not integrity protected, the MS shall start timer T3346 with a random value from the default range specified in table&nbsp;11.3a.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started by CM layer, if it is still necessary, when timer T3346 expires or is stopped.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A GPRS MS operating in MS operation mode A or B which is already IMSI attached for CS services in the network is still IMSI attached for CS services in the network.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the service request procedure is rejected with the EMM cause with the same value.</p>
<p># 25&nbsp;&nbsp;&nbsp; (Not authorized for this CSG)</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; Cause #25 is only applicable in UTRAN Iu mode and when received from a CSG cell. Other cases are considered as abnormal cases and the specification of the mobile station behaviour is given in subclause&nbsp;4.7.13.5.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall set the GPRS update status to GU3 ROAMING NOT ALLOWED (and shall store it according to subclause&nbsp;4.1.3.2) and shall change to state GMM-REGISTERED.LIMITED-SERVICE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the CSG ID and associated PLMN identity of the cell where the MS has sent the SERVICE REQUEST message are contained in the Allowed CSG list stored in the MS, the MS shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the CSG ID and associated PLMN identity of the cell where the MS has sent the SERVICE REQUEST message are contained in the Operator CSG list, the MS shall proceed as specified in 3GPP&nbsp;TS&nbsp;23.122&nbsp;[14] subclause&nbsp;3.1A.</p>
<p>The MS shall start timer&nbsp;T3340 as described in subclause&nbsp;4.7.1.9.</p>
<p>If the MS is IMSI attached for non-GPRS services, the MS shall set the update status to U3 ROAMING NOT ALLOWED and shall reset the location update attempt counter. The new MM state is MM IDLE.</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall search for a suitable cell according to 3GPP&nbsp;TS&nbsp;43.022&nbsp;[82] and 3GPP&nbsp;TS&nbsp;25.304&nbsp;[98].</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If S1 mode is supported in the MS, the MS shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP&nbsp;TS&nbsp;24.301&nbsp;[120] for the case when the service request procedure is rejected with the EMM cause with the same value.</p>
<p># 40&nbsp;&nbsp;&nbsp; (No PDP context activated)</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; The MS shall deactivate locally all active PDP and MBMS contexts and the MS shall enter the state GMM-REGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the MS may also activate PDP context(s) that were originally activated by the MS to replace any previously MS activated PDP context(s). The MS may also perform the procedures needed in order to activate any previously active multicast service(s).</p>
<p>NOTE&nbsp;6:&nbsp; In some cases, user interaction may be required and then the MS cannot activate the PDP and MBMS context(s) automatically.</p>
<p>Other values are considered as abnormal cases. The specification of the MS behaviour in those cases is described in subclause&nbsp;4.7.13.5.</p>
<h4><a name="_Toc171524082"></a>4.7.13.4a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Service request procedure for initiating a PDN connection for emergency bearer services not accepted by the network (UTRAN Iu mode only)</h4>
<p>If the service request for initiating a PDN connection for emergency bearer services cannot be accepted by the network, the MS shall perform the procedures as described in subclause&nbsp;4.7.13.4. Then if the MS is in the same selected PLMN where the last service request was attempted, the MS shall:</p>
<ol>
<li>a) inform the upper layers of the failure of the procedure; or</li>
</ol>
<p>NOTE&nbsp;1:&nbsp; This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[95] that can result in the emergency call being attempted to another IP-CAN.</p>
<ol>
<li>b) detach locally, if not detached already, attempt GPRS attach for emergency bearer services.</li>
</ol>
<p>If the service request for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in subclause&nbsp;4.7.13.5, the MS shall perform the procedures as described in subclause&nbsp;4.7.13.5 and inform the upper layers of the failure to access the network.</p>
<p>NOTE&nbsp;2:&nbsp; This can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[95] that can result in the emergency call being attempted to another IP-CAN.</p>
<p>If the service request for initiating a PDN connection for emergency bearer services fails due to abnormal cases b), c) or&nbsp;d) in subclause&nbsp;4.7.13.5, the MS shall perform the procedures as described in subclause&nbsp;4.7.13.5. Then if the MS is in the same selected PLMN where the last service request was attempted, the MS shall:</p>
<ol>
<li>a) inform the upper layers of the failure of the procedure; or</li>
</ol>
<p>NOTE&nbsp;3:&nbsp; This can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP&nbsp;TS&nbsp;24.229&nbsp;[95] that can result in the emergency call being attempted to another IP-CAN.</p>
<ol>
<li>b) detach locally, if not detached already, attempt GPRS attach for emergency bearer services.</li>
</ol>
<h4><a name="_Toc171524083"></a>4.7.13.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases in the MS</h4>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) Access barred because of access class control, EAB or ACDC</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the service request procedure is started in response to a paging request from the network, access class barring, EAB or ACDC is not applicable.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The service request procedure shall not be started. The MS stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started by CM layer if it is still necessary, i.e. when access is granted or because of a cell change.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If access is barred because of access class control, the service request is initiated due to a request from upper layers for PS signalling connection, ACDC is applicable to the request and the MS supports ACDC, then the service request procedure shall be started.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If access is barred for a certain ACDC category, and if the service request is initiated due to a request from upper layers for PS signalling connection for a higher ACDC category and the MS supports ACDC, then the service request procedure shall be started.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If an access request for an uncategorized application is barred due to ACDC , and if the service request is initiated due to a request from upper layers for PS signalling connection for a certain ACDC category and the MS supports ACDC, then the service request procedure shall be started.</p>
<ol>
<li>b) Lower layer failure without "Extended Wait Time" received from lower layers before the security mode control procedure is completed, SERVICE ACCEPT or SERVICE REJECT message is received</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The procedure shall be aborted except in the following implementation option cases b.1, b.2 and b.3.</p>
<p>b.1)&nbsp;&nbsp;&nbsp;&nbsp; Release of PS signalling connection in Iu mode (i.e. RRC connection release) before the completion of the service request procedure</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The service request procedure shall be initiated again, if the following conditions apply:</p>
<ol>
<li>i) The original service request procedure was initiated over an existing PS signalling connection; and</li>
<li>ii) No SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the PS signalling connection were received after the SERVICE REQUEST message was transmitted.</li>
</ol>
<p>b.2)&nbsp;&nbsp;&nbsp;&nbsp; RR release in Iu mode (i.e. RRC connection release) with cause different than "Directed signalling connection re-establishment", for example, "Normal", or "User inactivity" (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111])</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The service request procedure shall be initiated again, if the following conditions apply:</p>
<ol>
<li>i) The original service request procedure was initiated over an existing RRC connection and,</li>
<li>ii) No SECURITY MODE COMMAND message and no Non-Access Stratum (NAS) messages relating to the PS signalling connection were received after the SERVICE REQUEST messge was transmitted.</li>
</ol>
<p>NOTE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The RRC connection release cause different than "Directed signalling connection re-establishment" that triggers the re-initiation of the service request procedure is implementation specific.</p>
<p>b.3)&nbsp;&nbsp;&nbsp;&nbsp; RR release in Iu mode (i.e. RRC connection release) with cause "Directed signalling connection re-establishment" (see 3GPP&nbsp;TS&nbsp;25.331&nbsp;[23c] and 3GPP&nbsp;TS&nbsp;44.118&nbsp;[111])</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The routing area updating procedure shall be initiated followed by a rerun of the service request procedure if the following condition applies:</p>
<ol>
<li>i) The service request procedure was not due to a rerun of the procedure due to "Directed signalling connection re-establishment".</li>
<li>c) T3317 expired</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall enter GMM-REGISTERED state.</p>
<p>If the MS is in PMM-IDLE mode then the MS shall increment the service request attempt counter, abort the procedure and release locally any resources allocated for the service request procedure. If the service request procedure is initiated to establish a PDN connection for emergency bearer services or the MS has a PDN connection for emergency bearer services established or the MS is an MS configured to use AC11 &ndash; 15 in selected PLMN, the service request counter shall not be incremented. If the service request attempt counter is greater than or equal to 5, the MS shall start timer T3325. The MS shall not attempt service request until expiry of timer T3325 unless:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the service request is in response to paging from the network;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is an MS configured to use AC11 &ndash; 15 in selected PLMN;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the service request is initiated to establish a PDN connection for emergency bearer services;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS has a PDN connection for emergency bearer services established; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is registered in a new PLMN.</p>
<p>If the MS is in PMM-CONNECTED mode, then the procedure shall be aborted.</p>
<ol start="4">
<li>d) SERVICE REJECT received, other causes than those treated in subclause&nbsp;4.7.13.4, and cases of GMM cause values #22 and #25, if considered as abnormal cases according to subclause&nbsp;4.7.13.4</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The procedure shall be aborted.</p>
<ol>
<li>e) Routing area update procedure is triggered</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If a cell change into a new routing area occurs and the necessity of routing area update procedure is determined before the security mode control procedure is completed, a SERVICE ACCEPT or SERVICE REJECT message has been received, the Service request procedure shall be aborted and the routing area updating procedure is started immediately. Follow-on request pending may be indicated in the ROUTING AREA UPDATE REQUEST for the service, which was the trigger of the aborted Service request procedure, to restart the pending service itself or the Service request procedure after the completion of the routing area updating procedure. If the Service type of the aborted SERVICE REQUEST was indicating "data", then the routing area update procedure may be followed by a re-initiated Service request procedure indicating "data", if it is still necessary. If the Service type was indicating "MBMS multicast service reception", or "MBMS broadcast service reception" the Service request procedure shall be aborted.</p>
<ol>
<li>f) Power off</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS is in state GMM-SERVICE-REQUEST-INITIATED at power off, the GPRS detach procedure shall be performed.</p>
<ol>
<li>g) Detach procedure collision</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing detach type "re-attach required" or "re-attach not required":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a DETACH REQUEST message from the network in state GMM-SERVICE-REQUEST-INITIATED, the GPRS detach procedure shall be progressed and the Service request procedure shall be aborted. If the GMM cause IE, in the DETACH REQUEST message, indicated a "re-attach required", the GPRS attach procedure shall be performed. If the DETACH REQUEST message contains detach type "re-attach not required" and GMM cause #2 "IMSI unknown in HLR", the MS will follow the procedure as described below for the detach type "IMSI detach".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GPRS detach containing detach type "IMSI detach":</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the MS receives a DETACH REQUEST message from the network in state GMM-SERVICE-REQUEST-INITIATED, the network and the MS shall progress both procedures.</p>
<ol>
<li>h) "Extended wait time" for PS domain from the lower layers</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall abort the service request procedure, enter state GMM-REGISTERED, and stop timer T3317 if still running.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the SERVICE REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the MS shall start timer T3346 with the "Extended wait time" value.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In other cases the MS shall ignore the "Extended wait time".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.</p>
<ol>
<li>m) Timer T3346 is running</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS shall not start the service request procedure unless:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS receives a paging; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is an MS configured to use AC11 &ndash; 15 in selected PLMN; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS has a PDN connection for emergency bearer services established; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS is establishing a PDN connection for emergency bearer services; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the MS has a PDN connection established without the NAS signalling low priority indication or is establishing a PDN connection without the NAS signalling low priority indication, the timer T3302 and the timer T3311 are not running and the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, ROUTING AREA UPDATE REQUEST or SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority".</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The MS stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.</p>
<h4><a name="_Toc171524084"></a>4.7.13.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Abnormal cases on the network side</h4>
<p>The following abnormal cases can be identified:</p>
<ol>
<li>a) Lower layer failure</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If a low layer failure occurs before the security mode control procedure is completed, a SERVICE ACCEPT or SERVICE REJECT message has been sent to the MS, the network enters/stays in PMM-IDLE.</p>
<ol>
<li>b) Protocol error</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If the SERVICE REQUEST message is received with a protocol error, the network shall return a SERVICE REJECT message with one of the following reject causes:</p>
<p>#96:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mandatory information element error;</p>
<p>#99:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Information element non-existent or not implemented;</p>
<p>#100:&nbsp;&nbsp;&nbsp;&nbsp; Conditional IE error;</p>
<p>#111:&nbsp;&nbsp;&nbsp;&nbsp; Protocol error, unspecified.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The network stays in PMM-IDLE mode.</p>
<ol>
<li>c) More than one SERVICE REQUEST received and the procedure has not been completed (i.e., the security mode control procedure has not been completed or SERVICE ACCEPT, SERVICE REJECT message has not been sent)</li>
</ol>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If one or more of the information elements in the SERVICE REQUEST message differs from the ones received within the previous SERVICE REQUEST message, the previously initiated Service request procedure shall be aborted and the new Service request procedure shall be progressed;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; If the information elements do not differ, then the network shall continue with the previous Service request procedure and shall not treat any further this SERVICE REQUEST message.</p>
<ol>
<li>d) ATTACH REQUEST received before the security mode control procedure has been completed or an SERVICE ACCEPT or an SERVICE REJECT message has been sent</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If an ATTACH REQUEST message is received and the security mode control procedure has not been completed or an SERVICE ACCEPT or an SERVICE REJECT message has not been sent, the network may initiate the GMM common procedures, e.g. the GMM authentication and ciphering procedure. The network may e.g. after a succesful GMM authentication and ciphering procedure execution, abort the Service request procedure, the GMM context, PDP contexts and MBMS contexts, if any, are deleted and the new ATTACH REQUEST is progressed.</p>
<ol>
<li>e) ROUTING AREA UPDATE REQUEST message received before the security mode control procedure has been completed or an SERVICE ACCEPT or an SERVICE REJECT message has been sent</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If an ROUTING AREA UPDATE REQUEST message is received and the security mode control procedure has not been completed or an SERVICE ACCEPT or an SERVICE REJECT message has not been sent, the network may initiate the GMM common procedures, e.g. the GMM authentication and ciphering procedure. The network may e.g. after a successful GMM authentication and ciphering procedure execution, abort the Service request procedure and progress the routing area update procedure.</p>
<ol>
<li>f) If the Service Type indicates 'data&rsquo; and the network fails to re-establish some or all RAB(s) then the SGSN may determine if PDP Context Modification or PDP Context Deactivation should be initiated.<br /> The appropriate action is an operator choice and depends on the QoS profile of the PDP Context, and the Uplink data status.</li>
</ol>
<h3><a name="_Toc171524085"></a>4.7.14&nbsp;&nbsp;&nbsp;&nbsp; Void</h3>
<h3><a name="_Toc171524086"></a>4.7.15&nbsp;&nbsp;&nbsp;&nbsp; GMM eCall inactivity procedure</h3>
<p>The GMM eCall inactivity procedure is applicable only to an eCall only mobile station (as determined by information configured in USIM) that is capable of eCall over IMS and attached for GPRS services. The procedure shall be started when:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the mobile station is in PMM-IDLE mode (Iu mode) or packet idle mode;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the mobile station is in MM IDLE state;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; the mobile station is in any GMM-REGISTERED substate except GMM-REGISTERED.NO-CELL-AVAILABLE or GMM-REGISTERED.PLMN-SEARCH; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; one of the following conditions applies:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; timer T3242 expires or is found to have already expired and timer T3243 is not running;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; timer T3243 expires or is found to have already expired and timer T3242 is not running; or</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; timers T3242 and T3243 expire or have found to have already expired.</p>
<p>The mobile station shall then stop other running timers (e.g. T3311, T3312) and shall:</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the mobile station is also attached for non-GPRS services and the network operates in network operation mode I, perform a combined GPRS detach procedure for GPRS and non-GPRS services;</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the mobile station is also attached for non-GPRS services and the network operates in network operation mode II, perform a GPRS detach procedure for GPRS services and an IMSI detach procedure; and</p>
<p>-&nbsp;&nbsp;&nbsp;&nbsp; if the mobile station is not attached for non-GPRS services, perform a GPRS detach procedure for GPRS services.</p>
<p>The mobile station shall then enter MM Idle eCALL INACTIVE state, delete any LAI, TMSI, ciphering key sequence number stored in the SIM/USIM, delete any RAI, P-TMSI, P-TMSI signature and GPRS ciphering key sequence number stored, delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, KSI and set the update state to U4 Updating Disabled.</p>
<p>While in eCALL INACTIVE state, the mobile station shall behave as specified in subclause&nbsp;4.4.7.</p>
